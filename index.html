<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ABAE â€” Marketplace Agro-Pastorale Intelligente</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&family=JetBrains+Mono:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS â€” Fusion des deux fichiers (noms unifiÃ©s + aliases)
   Source principale : ABAE_Page_Accueil_v2 (noms complets)
   Source alias : ABAE_Auth_v3 (noms courts, conservÃ©s pour compatibilitÃ©)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* Palette principale */
  --vert-principal: #4A9E2A;
  --vert-fonce:     #2A5E10;
  --vert-clair:     #EDF7E5;
  --vert-accent:    #6ED63B;
  --or-accent:      #D4A843;
  --blanc:          #FFFFFF;
  --gris-100:       #F7F8F9;
  --gris-200:       #EAECEF;
  --gris-400:       #9BA3AE;
  --gris-700:       #3D4550;
  --gris-900:       #1A1E25;

  /* Alias courts (Auth v3) â€” pointent vers les mÃªmes valeurs */
  --vp: var(--vert-principal);
  --vf: var(--vert-fonce);
  --vc: var(--vert-clair);
  --va: var(--vert-accent);
  --or: var(--or-accent);
  --w:  var(--blanc);
  --g100: var(--gris-100);
  --g200: var(--gris-200);
  --g400: var(--gris-400);
  --g700: var(--gris-700);
  --g900: var(--gris-900);

  /* Erreurs & warnings (Auth v3) */
  --err:    #E53E3E;
  --err-bg: #FFF5F5;
  --warn:   #DD6B20;
  --warn-bg:#FFFAF0;

  /* Ombres */
  --shadow-sm:  0 1px 4px rgba(0,0,0,0.06);
  --shadow-md:  0 4px 16px rgba(0,0,0,0.09);
  --shadow-lg:  0 8px 32px rgba(0,0,0,0.12);
  --shadow-cta: 0 4px 14px rgba(74,158,42,0.35);
  --ss: var(--shadow-sm);
  --sm: var(--shadow-md);
  --sc: var(--shadow-cta);

  /* Transitions */
  --ease: cubic-bezier(0.4, 0, 0.2, 1);
  --transition: 0.22s var(--ease);
  --tr: var(--transition);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: 'DM Sans', sans-serif;
  font-size: 0.925rem;
  line-height: 1.65;
  color: var(--gris-900);
  background: var(--blanc);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 400; /* FIX v52 â€” corps du texte en poids normal */
}
/* FIX v52 â€” suppression du font-weight:700 global */
h1, h2, h3, h4, .sora { font-family: 'Sora', sans-serif; }
a { text-decoration: none; color: inherit; }
button { cursor: pointer; font-family: inherit; border: none; background: none; }
img { display: block; max-width: 100%; }
select, input, textarea { font-family: 'DM Sans', sans-serif; }

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
}

/* FIX v52 â€” AccessibilitÃ© : focus visible pour navigation clavier */
:focus-visible {
  outline: 3px solid var(--vert-principal);
  outline-offset: 2px;
  border-radius: 4px;
}
button:focus-visible, a:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible {
  outline: 3px solid var(--vert-principal);
  outline-offset: 2px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ABAE SMART IA â€” Assistant Intelligent Universel âœ¦ REDESIGN v2
   Aesthetic: Organic Luxury â€” deep forest meets liquid glass
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* FIX v52 â€” Playfair Display chargÃ© via <link> dans le <head> */

/* â”€â”€ Floating Button â”€â”€ */
#abaeIABtn {
  position: fixed; bottom: 88px; right: 18px; z-index: 9999;
  width: 58px; height: 58px; border-radius: 18px;
  background: linear-gradient(145deg, #5CAD3E 0%, #2A5E10 60%, #1D5C2E 100%);
  box-shadow:
    0 8px 32px rgba(42,94,16,0.55),
    0 2px 8px rgba(0,0,0,0.25),
    inset 0 1px 0 rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; border: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  transition: transform 0.28s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.25s;
  animation: iaPulse 3.5s ease-in-out infinite;
}
#abaeIABtn::before {
  content: '';
  position: absolute; inset: 0; border-radius: 18px;
  background: linear-gradient(135deg, rgba(255,255,255,0.12) 0%, transparent 60%);
  pointer-events: none;
}
#abaeIABtn:hover {
  transform: scale(1.1) translateY(-3px) rotate(-3deg);
  box-shadow: 0 14px 40px rgba(42,94,16,0.65), 0 4px 12px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
}
#abaeIABtn.ia-open {
  animation: none;
  transform: scale(0.9) rotate(0deg);
  border-radius: 50%;
  background: linear-gradient(145deg, #2A5E10, #5CAD3E);
}
.ia-btn-icon { transition: opacity 0.22s cubic-bezier(0.4,0,0.2,1), transform 0.22s cubic-bezier(0.4,0,0.2,1); }
#abaeIABtn .ia-btn-icon-close { opacity: 0; transform: scale(0.4) rotate(90deg); position: absolute; }
#abaeIABtn.ia-open .ia-btn-icon-chat { opacity: 0; transform: scale(0.4) rotate(-90deg); }
#abaeIABtn.ia-open .ia-btn-icon-close { opacity: 1; transform: scale(1) rotate(0deg); position: static; }

#abaeIABadge {
  position: absolute; top: -5px; right: -5px;
  width: 20px; height: 20px; border-radius: 50%;
  background: linear-gradient(135deg, #F0C040, #D4A843);
  color: #fff; font-size: 10px; font-weight: 800;
  font-family: 'Sora', sans-serif;
  display: flex; align-items: center; justify-content: center;
  border: 2.5px solid #fff;
  box-shadow: 0 2px 8px rgba(212,168,67,0.5);
  animation: badgePop 0.4s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes badgePop { from { transform: scale(0); } to { transform: scale(1); } }

/* â”€â”€ Tooltip â”€â”€ */
#abaeIATooltip {
  position: fixed; bottom: 156px; right: 18px; z-index: 9998;
  background: rgba(10,30,18,0.95);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-radius: 14px; padding: 10px 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.28), inset 0 1px 0 rgba(255,255,255,0.08);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.8rem; color: rgba(255,255,255,0.92); max-width: 210px;
  pointer-events: none;
  opacity: 0; transform: translateY(8px) scale(0.95);
  transition: opacity 0.3s cubic-bezier(0.4,0,0.2,1), transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
  border: 1px solid rgba(46,204,113,0.2);
}
#abaeIATooltip.show { opacity: 1; transform: translateY(0) scale(1); }
#abaeIATooltip::after {
  content: ''; position: absolute; bottom: -7px; right: 24px;
  border: 7px solid transparent;
  border-top-color: rgba(10,30,18,0.95); border-bottom: 0;
}

/* â”€â”€ Main Panel â”€â”€ */
#abaeIAPanel {
  position: fixed; bottom: 0; right: 0; left: 0; top: 0; z-index: 9998;
  width: 100%; height: 100%;
  background: #F2F5F3;
  display: flex; flex-direction: column; overflow: hidden;
  opacity: 0; transform: translateY(100%) scale(0.98); pointer-events: none;
  transition: opacity 0.38s cubic-bezier(0.4,0,0.2,1), transform 0.38s cubic-bezier(0.22,1,0.36,1);
  border: none;
}
#abaeIAPanel.ia-visible { opacity: 1; transform: translateY(0) scale(1); pointer-events: all; }

/* â”€â”€ Header â€” Immersive forest canopy â”€â”€ */
.ia-panel-hdr {
  background: linear-gradient(160deg, #1D5C2E 0%, #4A9E2A 50%, #3D8C1C 100%);
  padding: 10px 14px 10px;
  display: flex; align-items: center; gap: 10px;
  flex-shrink: 0; position: relative; overflow: hidden;
}
/* Organic light-leak blob top-right */
.ia-panel-hdr::before {
  content: '';
  position: absolute; top: -30px; right: -30px;
  width: 130px; height: 130px; border-radius: 50%;
  background: radial-gradient(circle, rgba(46,204,113,0.22) 0%, transparent 70%);
  pointer-events: none;
}
/* Secondary shimmer bottom-left */
.ia-panel-hdr::after {
  content: '';
  position: absolute; bottom: -20px; left: 20px;
  width: 90px; height: 90px; border-radius: 50%;
  background: radial-gradient(circle, rgba(212,168,67,0.12) 0%, transparent 70%);
  pointer-events: none;
}

/* Avatar â€” glassy orb */
.ia-avatar {
  width: 44px; height: 44px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; position: relative; z-index: 1;
}
.ia-avatar-pulse {
  width: 10px; height: 10px; border-radius: 50%;
  background: #6ED63B;
  position: absolute; bottom: 0px; right: 0px;
  border: 2px solid #4A9E2A;
  box-shadow: 0 0 0 0 rgba(46,204,113,0.5);
  animation: avatarPing 2.2s ease-in-out infinite;
}
@keyframes avatarPing {
  0% { box-shadow: 0 0 0 0 rgba(46,204,113,0.6); }
  70% { box-shadow: 0 0 0 8px rgba(46,204,113,0); }
  100% { box-shadow: 0 0 0 0 rgba(46,204,113,0); }
}

.ia-panel-info {
  flex: 1; min-width: 0; position: relative; z-index: 1;
  display: flex; flex-direction: column; gap: 3px;
}
.ia-panel-name {
  font-family: 'Playfair Display', 'Sora', serif;
  font-weight: 700; font-size: 1rem; color: #fff;
  letter-spacing: 0.01em; line-height: 1.2;
  text-shadow: 0 1px 4px rgba(0,0,0,0.3);
}
.ia-panel-name-row {
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
}
.ia-panel-hdr-logo {
  width: 30px; height: 30px; border-radius: 7px;
  background: rgba(255,255,255,0.92);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,1);
}
.ia-panel-hdr-logo span {
  font-family: 'Sora', sans-serif;
  font-weight: 800; font-size: 0.55rem;
  color: #4A9E2A; letter-spacing: 0.3px;
}

.ia-panel-sub {
  font-size: 0.72rem; color: rgba(255,255,255,0.72);
  display: flex; align-items: center; gap: 5px;
}
.ia-panel-sub-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: #6ED63B; flex-shrink: 0;
  animation: iaPulseSmall 2s ease-in-out infinite;
}
.ia-context-pill {
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.22);
  border-radius: 20px; padding: 3px 10px;
  font-size: 0.62rem; font-weight: 600;
  color: rgba(255,255,255,0.88);
  display: inline-flex; align-items: center; gap: 4px;
  white-space: nowrap; backdrop-filter: blur(4px);
  letter-spacing: 0.02em;
}

.ia-panel-close {
  width: 34px; height: 34px; border-radius: 50%;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.2);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  color: rgba(255,255,255,0.85);
  transition: background 0.2s, transform 0.2s;
  flex-shrink: 0; z-index: 1;
  backdrop-filter: blur(6px);
}
.ia-panel-close:hover {
  background: rgba(255,255,255,0.24);
  transform: scale(1.05);
}
.ia-panel-close:active { transform: scale(0.93); }

/* â”€â”€ Messages area â”€â”€ */
.ia-messages {
  flex: 1; overflow-y: auto;
  padding: 18px 16px;
  display: flex; flex-direction: column; gap: 14px;
  scroll-behavior: smooth;
  background: #F2F5F3;
}
.ia-messages::-webkit-scrollbar { width: 3px; }
.ia-messages::-webkit-scrollbar-track { background: transparent; }
.ia-messages::-webkit-scrollbar-thumb {
  background: rgba(74,158,42,0.2); border-radius: 3px;
}

/* â”€â”€ Message bubbles â”€â”€ */
.ia-msg {
  max-width: 86%;
  animation: iaMsgIn 0.3s cubic-bezier(0.22,1,0.36,1) both;
}
.ia-msg.ia-bot { align-self: flex-start; }
.ia-msg.ia-user { align-self: flex-end; }

.ia-msg-hdr {
  display: flex; align-items: center; gap: 7px; margin-bottom: 6px;
}
.ia-msg-av {
  width: 28px; height: 28px; border-radius: 50%;
  background: linear-gradient(135deg, #5CAD3E, #1D5C2E);
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(42,94,16,0.3);
  border: 1.5px solid rgba(255,255,255,0.8);
}
.ia-msg-sender {
  font-size: 0.72rem; font-weight: 700; color: #fff;
  font-family: 'Sora', sans-serif; letter-spacing: 0.02em;
}

/* Bot bubble â€” frosted card */
.ia-msg.ia-bot .ia-msg-bubble {
  padding: 14px 18px; border-radius: 20px; border-bottom-left-radius: 6px;
  font-size: 0.95rem; line-height: 1.65; font-family: 'DM Sans', sans-serif;
  background: #fff;
  color: #1A2820;
  border: 1px solid rgba(74,158,42,0.1);
  box-shadow: 0 2px 12px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.04);
}

/* User bubble â€” rich gradient */
.ia-msg.ia-user .ia-msg-bubble {
  padding: 14px 18px; border-radius: 20px; border-bottom-right-radius: 6px;
  font-size: 0.95rem; line-height: 1.65; font-family: 'DM Sans', sans-serif;
  background: linear-gradient(145deg, #5CAD3E, #2A5E10);
  color: #fff;
  box-shadow: 0 4px 20px rgba(42,94,16,0.4), 0 2px 6px rgba(0,0,0,0.15);
  position: relative; overflow: hidden;
}
.ia-msg.ia-user .ia-msg-bubble::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 50%;
  background: linear-gradient(180deg, rgba(255,255,255,0.08) 0%, transparent 100%);
  pointer-events: none; border-radius: inherit;
}

.ia-msg-time {
  font-size: 0.66rem; color: #9BA3AE; margin-top: 5px; padding: 0 6px;
  letter-spacing: 0.02em;
}
.ia-msg.ia-user .ia-msg-time { text-align: right; }

/* Context banner */
.ia-context-banner {
  background: linear-gradient(135deg, rgba(232,245,238,0.8), rgba(240,250,244,0.9));
  border: 1px solid rgba(74,158,42,0.18);
  border-radius: 14px; padding: 12px 14px;
  display: flex; align-items: flex-start; gap: 10px;
  font-size: 0.76rem; color: #4A9E2A;
  font-family: 'DM Sans', sans-serif; line-height: 1.5;
  align-self: stretch; max-width: 100%;
  backdrop-filter: blur(4px);
  box-shadow: 0 2px 12px rgba(74,158,42,0.08);
}

/* Typing indicator */
.ia-typing .ia-msg-bubble {
  display: flex; align-items: center; gap: 5px;
  padding: 14px 18px; border-radius: 20px; border-bottom-left-radius: 6px;
}
.ia-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: linear-gradient(135deg, #4A9E2A, #6ED63B);
  animation: iaBounce 1.4s ease-in-out infinite;
}
.ia-dot:nth-child(2) { animation-delay: 0.2s; }
.ia-dot:nth-child(3) { animation-delay: 0.4s; }

/* â”€â”€ Quick suggestion chips â”€â”€ */
.ia-suggestions {
  padding: 6px 14px 14px;
  display: flex; gap: 6px; flex-wrap: wrap;
  flex-shrink: 0;
  background: #fff;
  border-top: 1px solid rgba(0,0,0,0.05);
}
.ia-suggestion-chip {
  background: #fff;
  color: #4A9E2A;
  border: 1.5px solid rgba(74,158,42,0.25);
  border-radius: 24px; padding: 7px 13px;
  font-size: 0.75rem; font-weight: 600;
  font-family: 'Sora', sans-serif;
  cursor: pointer; white-space: nowrap;
  transition: all 0.22s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: 0 2px 8px rgba(74,158,42,0.08);
  position: relative; overflow: hidden;
}
.ia-suggestion-chip::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(145deg, #5CAD3E, #2A5E10);
  opacity: 0;
  transition: opacity 0.22s;
  border-radius: inherit;
}
.ia-suggestion-chip:hover {
  transform: translateY(-2px) scale(1.02);
  color: #fff;
  border-color: transparent;
  box-shadow: 0 6px 20px rgba(74,158,42,0.3);
}
.ia-suggestion-chip:hover::before { opacity: 1; }
.ia-suggestion-chip span { position: relative; z-index: 1; }

/* â”€â”€ Input zone â”€â”€ */
.ia-input-zone {
  display: flex; align-items: flex-end; gap: 10px;
  padding: 8px 14px 8px;
  background: #fff;
  border-top: 1px solid rgba(0,0,0,0.05);
  flex-shrink: 0;
}
.ia-textarea {
  flex: 1; border: 1.5px solid rgba(74,158,42,0.2);
  border-radius: 16px; padding: 9px 14px;
  font-family: 'DM Sans', sans-serif; font-size: 0.93rem;
  color: #1A2820; resize: none;
  min-height: 40px; max-height: 100px; overflow-y: auto;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
  line-height: 1.5;
  background: #F7FAF8;
}
.ia-textarea:focus {
  border-color: #4A9E2A;
  background: #fff;
  box-shadow: 0 0 0 3px rgba(74,158,42,0.12), 0 2px 8px rgba(74,158,42,0.1);
}
.ia-textarea::placeholder { color: #9BA3AE; font-weight: 400; }

/* Send button â€” animated gem */
.ia-send-btn {
  width: 40px; height: 40px; border-radius: 50%;
  background: linear-gradient(145deg, #5CAD3E, #2A5E10);
  border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  transition: transform 0.25s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.22s, opacity 0.18s;
  color: #fff;
  box-shadow: 0 4px 16px rgba(42,94,16,0.45), inset 0 1px 0 rgba(255,255,255,0.15);
  position: relative; overflow: hidden;
}
.ia-send-btn::before {
  content: '';
  position: absolute; inset: 0; border-radius: 50%;
  background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 60%);
  pointer-events: none;
}
.ia-send-btn:hover:not(:disabled) {
  transform: scale(1.1) translateY(-2px);
  box-shadow: 0 8px 24px rgba(42,94,16,0.55), inset 0 1px 0 rgba(255,255,255,0.2);
}
.ia-send-btn:active:not(:disabled) { transform: scale(0.94); }
.ia-send-btn:disabled {
  background: #E0E7E4; cursor: not-allowed;
  box-shadow: none; opacity: 0.6;
}

/* â”€â”€ Animations â”€â”€ */
@keyframes iaPulse {
  0%, 100% { box-shadow: 0 8px 32px rgba(42,94,16,0.55), 0 0 0 0 rgba(46,204,113,0.4); }
  50% { box-shadow: 0 8px 32px rgba(42,94,16,0.55), 0 0 0 12px rgba(46,204,113,0); }
}
@keyframes iaPulseSmall {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.4); opacity: 0.6; }
}
@keyframes iaMsgIn {
  from { opacity: 0; transform: translateY(12px) scale(0.97); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes iaBounce {
  0%, 80%, 100% { transform: translateY(0) scale(1); opacity: 0.5; }
  40% { transform: translateY(-7px) scale(1.1); opacity: 1; }
}

@media (max-width: 420px) {
  #abaeIAPanel { width: 100%; right: 0; left: 0; bottom: 0; top: 0; }
  #abaeIABtn { right: 14px; bottom: 84px; }
  #abaeIATooltip { right: 14px; bottom: 152px; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ABAE SMART â€” AI MODULES CSS
   FonctionnalitÃ©s IA intÃ©grÃ©es dans toutes les sections
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Module IA â€” Bloc principal */
.ai-module {
  background: linear-gradient(135deg, #2A5E10 0%, #4A9E2A 60%, #6ED63B 100%);
  border: none;
  border-radius: 18px;
  padding: 18px 16px 14px;
  margin: 12px;
  position: relative;
  overflow: visible;
  transition: box-shadow 0.22s, transform 0.18s;
  box-shadow: 0 6px 24px rgba(74,158,42,0.45), 0 2px 8px rgba(0,0,0,0.15);
  -webkit-tap-highlight-color: transparent;
}
/* Clip visually without blocking touch events */
.ai-module-inner {
  border-radius: 18px;
  overflow: hidden;
  position: relative;
}
.ai-module::before {
  content: '';
  position: absolute;
  top: -40px; right: -40px;
  width: 140px; height: 140px;
  border-radius: 50%;
  background: rgba(255,255,255,0.07);
  pointer-events: none;
  z-index: 0;
}
.ai-module::after {
  content: '';
  position: absolute;
  bottom: -20px; left: -20px;
  width: 90px; height: 90px;
  border-radius: 50%;
  background: rgba(255,255,255,0.05);
  pointer-events: none;
  z-index: 0;
}
.ai-module > * { position: relative; z-index: 1; }
.ai-module:hover { box-shadow: 0 10px 32px rgba(74,158,42,0.55); transform: translateY(-1px); }

.ai-module-header {
  display: flex; align-items: center; gap: 12px; margin-bottom: 14px;
}
.ai-module-icon {
  width: 46px; height: 46px; border-radius: 14px;
  background: rgba(255,255,255,0.18);
  border: 2px solid rgba(255,255,255,0.3);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.4rem; flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.ai-module-title {
  font-family: 'Sora', sans-serif; font-weight: 800;
  font-size: 1rem; color: #fff;
  text-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
.ai-module-desc {
  font-size: 0.72rem; color: rgba(255,255,255,0.8); margin-top: 2px;
  font-weight: 500;
}
.ai-badge-active {
  margin-left: auto;
  background: rgba(255,255,255,0.22);
  border: 1.5px solid rgba(255,255,255,0.4);
  color: #fff; font-size: 0.62rem; font-weight: 700; font-family: 'Sora', sans-serif;
  padding: 4px 10px; border-radius: 20px; white-space: nowrap;
  letter-spacing: 0.3px;
}
.ai-badge-limited {
  margin-left: auto;
  background: #D4A843; color: #fff;
  font-size: 0.6rem; font-weight: 700; font-family: 'Sora', sans-serif;
  padding: 3px 8px; border-radius: 20px; white-space: nowrap;
}
.ai-badge-locked {
  margin-left: auto;
  background: #EAECEF; color: #9BA3AE;
  font-size: 0.6rem; font-weight: 700; font-family: 'Sora', sans-serif;
  padding: 3px 8px; border-radius: 20px; white-space: nowrap;
}

/* Bouton IA principal */
.btn-ia {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  width: 100%; padding: 11px; border-radius: 10px; border: none; cursor: pointer;
  background: linear-gradient(135deg, #4A9E2A 0%, #2A5E10 100%);
  color: #fff; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.82rem;
  transition: all 0.22s; box-shadow: 0 3px 12px rgba(74,158,42,0.3);
  position: relative; overflow: hidden;
}
.btn-ia:hover { transform: translateY(-1px); box-shadow: 0 5px 18px rgba(74,158,42,0.4); }
.btn-ia:active { transform: translateY(0); }
.btn-ia::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
  transform: translateX(-100%); transition: transform 0.5s;
}
.btn-ia:hover::after { transform: translateX(100%); }
.btn-ia-icon { font-size: 1rem; }

/* Boutons IA dans le module dark */
.ai-module .btn-ia {
  background: rgba(255,255,255,0.15);
  border: 1.5px solid rgba(255,255,255,0.25);
  box-shadow: none;
  backdrop-filter: blur(4px);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  cursor: pointer;
  position: relative;
  z-index: 2;
}
.ai-module .btn-ia:hover { background: rgba(255,255,255,0.25); box-shadow: none; }
.ai-module .btn-ia:active { background: rgba(255,255,255,0.35); transform: scale(0.97); }
.ai-module .btn-ia.ai-glow {
  background: rgba(255,255,255,0.22);
  border: 2px solid rgba(255,255,255,0.5);
  font-size: 0.88rem; padding: 13px;
  box-shadow: 0 0 20px rgba(255,255,255,0.1);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.ai-module .btn-ia.ai-glow:hover { background: rgba(255,255,255,0.32); }

.btn-ia-outline {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  width: 100%; padding: 10px; border-radius: 10px; cursor: pointer;
  background: transparent; border: 1.5px solid #4A9E2A;
  color: #4A9E2A; font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.82rem;
  transition: all 0.22s;
}
.btn-ia-outline:hover { background: #EDF7E5; }

/* Zone rÃ©sultat IA */
.ai-result-zone {
  margin-top: 12px; padding: 14px; border-radius: 12px;
  background: #fff; border: 1px solid rgba(74,158,42,0.15);
  display: none; animation: aiResultIn 0.3s ease both;
}
.ai-module .ai-result-zone {
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.2);
}
.ai-module .ai-result-label { color: rgba(255,255,255,0.75); }
.ai-module .ai-result-value { color: #fff; }
.ai-module .ai-result-header { color: #fff; }
.ai-result-zone.show { display: block; }
@keyframes aiResultIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.ai-result-header {
  display: flex; align-items: center; gap: 6px;
  font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.8rem;
  color: #4A9E2A; margin-bottom: 10px;
}
.ai-result-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 7px 0; border-bottom: 1px solid #f0f2f4; font-size: 0.78rem;
}
.ai-result-row:last-child { border-bottom: none; padding-bottom: 0; }
.ai-result-label { color: #9BA3AE; }
.ai-result-value { font-family: 'JetBrains Mono', monospace; font-weight: 700; color: #1A1E25; }
.ai-result-value.good { color: #4A9E2A; }
.ai-result-value.warn { color: #D4A843; }
.ai-result-value.danger { color: #E53E3E; }

/* Loading IA */
.ai-loading {
  display: flex; align-items: center; gap: 8px; padding: 12px;
  font-size: 0.78rem; color: #9BA3AE; justify-content: center;
}
.ai-spinner {
  width: 16px; height: 16px; border: 2px solid #EDF7E5;
  border-top-color: #4A9E2A; border-radius: 50%;
  animation: aiSpin 0.7s linear infinite;
}
@keyframes aiSpin { to { transform: rotate(360deg); } }

/* Popup upgrade abonnement */
.ai-upgrade-popup {
  margin-top: 10px; padding: 14px; border-radius: 12px;
  background: linear-gradient(135deg, #fff9e6, #fffbf0);
  border: 1.5px solid #D4A843;
  display: none; animation: aiResultIn 0.3s ease both;
}
.ai-upgrade-popup.show { display: block; }
.ai-upgrade-title {
  font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.82rem;
  color: #D4A843; margin-bottom: 5px; display: flex; align-items: center; gap: 6px;
}
.ai-upgrade-desc { font-size: 0.72rem; color: #9BA3AE; margin-bottom: 10px; line-height: 1.45; }
.btn-upgrade {
  display: flex; align-items: center; justify-content: center; gap: 6px;
  width: 100%; padding: 10px; border-radius: 8px; border: none; cursor: pointer;
  background: linear-gradient(135deg, #D4A843, #b8902e);
  color: #fff; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.8rem;
  transition: all 0.22s;
}
.btn-upgrade:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(212,168,67,0.4); }

/* Score fiabilitÃ© */
.reliability-score {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 12px; background: #f2fae8; border-radius: 8px;
  border: 1px solid rgba(74,158,42,0.15); margin-top: 8px;
}
.score-circle {
  width: 40px; height: 40px; border-radius: 50%;
  background: conic-gradient(#4A9E2A var(--score-pct, 0%), #EDF7E5 0%);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; position: relative;
}
.score-circle::before {
  content: ''; position: absolute;
  width: 28px; height: 28px; border-radius: 50%; background: #fff;
}
.score-inner {
  font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.7rem;
  color: #4A9E2A; z-index: 1; position: relative;
}
.score-label { font-size: 0.72rem; color: #9BA3AE; }
.score-value { font-family: 'Sora', sans-serif; font-weight: 700; color: #4A9E2A; font-size: 0.82rem; }

/* Masquage tÃ©lÃ©phone */
.phone-masked {
  display: flex; align-items: center; gap: 8px;
  background: rgba(74,158,42,0.06); border: 1px solid rgba(74,158,42,0.15);
  border-radius: 8px; padding: 10px 12px;
  font-size: 0.78rem; color: #3D4550;
}
.phone-masked-icon { font-size: 1.1rem; flex-shrink: 0; }
.phone-masked-text { flex: 1; line-height: 1.4; }
.phone-masked-text strong { display: block; font-family: 'Sora', sans-serif; font-size: 0.75rem; color: #4A9E2A; }
.phone-unlock-btn {
  background: #4A9E2A; color: #fff; border: none; padding: 6px 10px;
  border-radius: 6px; font-size: 0.68rem; font-weight: 700; font-family: 'Sora', sans-serif;
  cursor: pointer; white-space: nowrap; transition: background 0.18s;
}
.phone-unlock-btn:hover { background: #2A5E10; }

/* Commission ABAE */
.commission-banner {
  background: linear-gradient(135deg, #4A9E2A, #2A5E10);
  color: #fff; border-radius: 12px; padding: 12px 14px;
  margin: 8px 12px; display: flex; align-items: center; gap: 10px;
}
.commission-banner-icon { font-size: 1.3rem; flex-shrink: 0; }
.commission-banner-text { flex: 1; }
.commission-banner-text strong { font-family: 'Sora', sans-serif; font-size: 0.78rem; display: block; margin-bottom: 2px; }
.commission-banner-text span { font-size: 0.68rem; opacity: 0.8; }
.commission-calc {
  background: #f2fae8; border: 1px solid rgba(74,158,42,0.15);
  border-radius: 10px; padding: 12px; margin-top: 8px;
}
.commission-row {
  display: flex; justify-content: space-between; padding: 5px 0;
  font-size: 0.78rem; border-bottom: 1px solid #edf7e5;
}
.commission-row:last-child { border-bottom: none; font-weight: 700; }

/* ScreenSmart ABAE */
.smart-hero {
  background: linear-gradient(135deg, #1E7040 0%, #3DB830 60%, #6ED63B 100%);
  padding: 20px 16px 16px; position: relative; overflow: hidden;
}
.smart-hero::before {
  content: 'ğŸ§ ';
  position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  font-size: 4rem; opacity: 0.15;
}
.smart-hero-title {
  font-family: 'Sora', sans-serif; font-weight: 800; font-size: 1.1rem;
  color: #fff; display: flex; align-items: center; gap: 8px;
}
.smart-hero-sub { font-size: 0.72rem; color: rgba(255,255,255,0.75); margin-top: 4px; }
.smart-plan-pill {
  display: inline-flex; align-items: center; gap: 6px;
  background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
  border-radius: 20px; padding: 4px 12px; margin-top: 10px;
  font-size: 0.7rem; font-weight: 700; font-family: 'Sora', sans-serif; color: #fff;
}

/* Plan cards */
.plan-card {
  background: #fff; border: 1.5px solid #EAECEF; border-radius: 14px;
  padding: 14px; margin: 8px 12px; transition: all 0.22s; position: relative;
}
.plan-card.active-plan {
  border-color: #4A9E2A;
  box-shadow: 0 0 0 3px rgba(74,158,42,0.1);
}
.plan-card.premium-plan { border-color: #D4A843; }
.plan-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.plan-icon { font-size: 1.3rem; }
.plan-name { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.88rem; }
.plan-price { font-family: 'JetBrains Mono', monospace; font-weight: 700; color: #4A9E2A; font-size: 0.78rem; }
.plan-current-badge {
  margin-left: auto; background: #4A9E2A; color: #fff;
  font-size: 0.58rem; font-weight: 700; font-family: 'Sora', sans-serif;
  padding: 3px 8px; border-radius: 20px;
}
.plan-feature {
  display: flex; align-items: center; gap: 6px; padding: 4px 0;
  font-size: 0.72rem; color: #3D4550;
}
.plan-feature.included { color: #4A9E2A; }
.plan-feature.locked { color: #9BA3AE; }
.plan-feature-dot {
  width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0;
}
.plan-feature.included .plan-feature-dot { background: #4A9E2A; }
.plan-feature.locked .plan-feature-dot { background: #EAECEF; }

/* Smart Stats Grid */
.smart-stats {
  display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 0 12px; margin-top: 8px;
}
.smart-stat-card {
  background: #fff; border: 1px solid #EAECEF; border-radius: 12px; padding: 12px;
}
.smart-stat-icon { font-size: 1.2rem; margin-bottom: 5px; }
.smart-stat-val {
  font-family: 'JetBrains Mono', monospace; font-weight: 800; font-size: 1.1rem;
  color: #1A1E25;
}
.smart-stat-lbl { font-size: 0.65rem; color: #9BA3AE; margin-top: 2px; }

/* Alertes marchÃ© IA */
.market-alert {
  display: flex; gap: 10px; align-items: flex-start;
  padding: 10px 12px; border-radius: 10px; margin-bottom: 8px;
  border-left: 3px solid;
}
.market-alert.up { background: rgba(46,204,113,0.07); border-color: #6ED63B; }
.market-alert.down { background: rgba(229,62,62,0.07); border-color: #E53E3E; }
.market-alert.neutral { background: rgba(212,168,67,0.07); border-color: #D4A843; }
.market-alert-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
.market-alert-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.78rem; color: #1A1E25; }
.market-alert-desc { font-size: 0.7rem; color: #9BA3AE; margin-top: 2px; line-height: 1.4; }

/* CrÃ©dits IA */
.ia-credits-bar {
  background: #f2fae8; border: 1px solid rgba(74,158,42,0.15);
  border-radius: 10px; padding: 10px 12px; margin: 8px 12px;
  display: flex; align-items: center; gap: 10px;
}
.ia-credits-icon { font-size: 1.1rem; flex-shrink: 0; }
.ia-credits-info { flex: 1; }
.ia-credits-label { font-size: 0.68rem; color: #9BA3AE; }
.ia-credits-val { font-family: 'JetBrains Mono', monospace; font-weight: 700; color: #4A9E2A; font-size: 0.88rem; }
.ia-credits-track { background: #EDF7E5; border-radius: 4px; height: 5px; margin-top: 4px; }
.ia-credits-fill { background: linear-gradient(90deg, #4A9E2A, #6ED63B); border-radius: 4px; height: 5px; transition: width 0.5s; }

/* Badge utilisateur certifiÃ© */
.certified-badge {
  display: inline-flex; align-items: center; gap: 5px;
  background: linear-gradient(135deg, #D4A843, #b8902e);
  color: #fff; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.62rem;
  padding: 4px 10px; border-radius: 20px;
  box-shadow: 0 2px 8px rgba(212,168,67,0.35);
}

/* Screen Smart IA supplÃ©mentaire */
#screen-smart { background: #F7F8F9; }
.smart-section-title {
  font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.82rem;
  color: #1A1E25; padding: 14px 12px 8px;
  display: flex; align-items: center; justify-content: space-between;
}
.smart-section-title span { font-size: 0.68rem; font-weight: 400; color: #9BA3AE; }

/* AI Cards dans Smart */
.ai-feature-card {
  background: #fff; border: 1px solid #EAECEF; border-radius: 14px;
  margin: 0 12px 10px; padding: 14px; cursor: pointer;
  transition: all 0.22s; display: flex; gap: 12px; align-items: flex-start;
}
.ai-feature-card:hover { border-color: #4A9E2A; box-shadow: 0 4px 14px rgba(74,158,42,0.1); }
.ai-feature-card-icon {
  width: 42px; height: 42px; border-radius: 12px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
}
.ai-feature-card-icon.green { background: #EDF7E5; }
.ai-feature-card-icon.blue { background: #EEF2FF; }
.ai-feature-card-icon.gold { background: #FFF8E6; }
.ai-feature-card-icon.red { background: #FFF5F5; }
.ai-feature-card-body { flex: 1; min-width: 0; }
.ai-feature-card-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.82rem; color: #1A1E25; margin-bottom: 3px; }
.ai-feature-card-desc { font-size: 0.7rem; color: #9BA3AE; line-height: 1.45; }
.ai-feature-card-action { display: flex; align-items: center; justify-content: flex-end; margin-top: 8px; }
.ai-mini-btn {
  background: #4A9E2A; color: #fff; border: none; padding: 5px 10px;
  border-radius: 6px; font-size: 0.68rem; font-weight: 700; font-family: 'Sora', sans-serif;
  cursor: pointer; transition: background 0.18s;
}
.ai-mini-btn:hover { background: #2A5E10; }
.ai-mini-btn.gold-btn { background: #D4A843; }

/* Sheet IA */
.sheet-ai-header {
  background: linear-gradient(135deg, #2A5E10, #4A9E2A);
  padding: 16px; margin: -16px -16px 16px; border-radius: 12px 12px 0 0;
}
.sheet-ai-header h3 { font-family: 'Sora', sans-serif; font-weight: 800; color: #fff; font-size: 1rem; }
.sheet-ai-header p { font-size: 0.7rem; color: rgba(255,255,255,0.7); margin-top: 3px; }

/* Animation pulse pour les Ã©lÃ©ments IA */
@keyframes aiGlow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(74,158,42,0.2); }
  50% { box-shadow: 0 0 0 8px rgba(74,158,42,0); }
}
.ai-glow { animation: aiGlow 2.5s ease-in-out infinite; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROUTER DE PAGES â€” Gestion de l'affichage des diffÃ©rentes vues
   Les pages "auth" sont masquÃ©es par dÃ©faut, seule la page "accueil" est visible
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page { display: none; }
.page.active { display: block; }

/* Page d'accueil : toujours affichÃ©e via son propre systÃ¨me (pas .page) */
#page-accueil { display: none; }
#page-accueil.hidden { display: none; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BARRE DE NAVIGATION DE DÃ‰MONSTRATION (Auth v3)
   Flottante en bas de page, permet de basculer entre les vues
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */





/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITAIRES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.container       { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 20px; }
.container--narrow { max-width: 860px; }
.container--xs   { max-width: 600px; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOUTONS â€” SystÃ¨me unifiÃ© (Page Accueil + Auth)
   .btn--* : variantes de la page d'accueil
   .btn-p / .btn-o / .btn-g / .btn-sm : variantes Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Bouton de base (page accueil â€” inline-flex, width auto) */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.9rem;
  padding: 10px 20px; border-radius: 8px;
  transition: all var(--transition);
  white-space: nowrap; cursor: pointer; border: none;
}
.btn:focus-visible { outline: 3px solid var(--vert-accent); outline-offset: 2px; }

/* Variantes page accueil */
.btn--primary { background: var(--vert-principal); color: var(--blanc); box-shadow: var(--shadow-cta); }
.btn--primary:hover { background: var(--vert-fonce); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(74,158,42,0.4); }

.btn--outline { background: transparent; color: var(--vert-principal); border: 1.5px solid var(--vert-principal); }
.btn--outline:hover { background: var(--vert-clair); }

.btn--ghost { background: transparent; color: var(--blanc); border: 1.5px solid rgba(255,255,255,0.4); }
.btn--ghost:hover { background: rgba(255,255,255,0.1); }

.btn--hero { background: var(--blanc); color: var(--vert-fonce); font-size: 1rem; padding: 14px 28px; box-shadow: 0 4px 20px rgba(0,0,0,0.25); }
.btn--hero:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,0,0,0.3); }

.btn--aff { background: transparent; color: var(--vert-fonce); border: 1.5px solid var(--vert-fonce); font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.9rem; padding: 12px 28px; border-radius: 8px; transition: all var(--transition); display: inline-flex; align-items: center; }
.btn--aff:hover { background: var(--vert-fonce); color: var(--blanc); }

.btn--lg { font-size: 1rem; padding: 14px 32px; width: 100%; }

/* Variantes Auth (pleine largeur par dÃ©faut dans les formulaires) */
.btn-p { background: var(--vert-principal); color: #fff; box-shadow: var(--shadow-cta); width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px; border-radius: 8px; font-family: 'Sora', sans-serif; font-weight: 600; font-size: 1rem; transition: all var(--tr); }
.btn-p:hover:not(:disabled) { background: var(--vert-fonce); transform: translateY(-1px); }
.btn-p:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
.btn-o { background: transparent; border: 1.5px solid var(--vert-principal); color: var(--vert-principal); width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px; border-radius: 8px; font-family: 'Sora', sans-serif; font-weight: 600; font-size: 1rem; transition: all var(--tr); }
.btn-o:hover { background: var(--vert-clair); }
.btn-g { background: transparent; border: 1.5px solid var(--gris-200); color: var(--gris-700); width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px; border-radius: 8px; font-family: 'Sora', sans-serif; font-weight: 600; font-size: 1rem; transition: all var(--tr); }
.btn-g:hover { background: var(--gris-100); }
.btn-sm { padding: 10px 20px; font-size: 0.875rem; width: auto; }
.btn-back { background: none; color: var(--gris-400); font-size: 0.85rem; font-family: 'DM Sans', sans-serif; font-weight: 400; display: flex; align-items: center; justify-content: center; gap: 4px; cursor: pointer; transition: color var(--tr); width: 100%; padding: 8px; border: none; margin-top: 10px; }
.btn-back:hover { color: var(--vert-principal); }
.btn-spinner { animation: spin 0.8s linear infinite; }
.sec-note { display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.75rem; color: var(--gris-400); margin-top: 10px; }
.sec-note svg { width: 12px; height: 12px; stroke: var(--gris-400); stroke-width: 2; fill: none; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER â€” Page d'accueil (large, sticky, navigation complÃ¨te)
   Classe : .header / .header__inner
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.header {
  position: sticky; top: 0; z-index: 100;
  height: 64px;
  background: var(--blanc);
  box-shadow: 0 1px 6px rgba(0,0,0,0.07);
}
.header__inner {
  height: 100%; max-width: 1100px; margin: 0 auto;
  padding: 0 20px;
  display: flex; align-items: center; justify-content: space-between; gap: 16px;
}
.logo { display: flex; align-items: center; gap: 10px; }
.logo__mark {
  width: 34px; height: 34px; border-radius: 8px;
  background: var(--vert-principal);
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.logo__mark span { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.78rem; color: var(--blanc); letter-spacing: 0.5px; }
.logo__text { display: flex; flex-direction: column; }
.logo__name { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.05rem; color: var(--gris-900); line-height: 1.1; letter-spacing: -0.3px; }
.logo__sub { font-size: 0.68rem; font-weight: 300; color: var(--gris-400); line-height: 1; display: none; }

.nav { display: none; align-items: center; gap: 2px; }
.nav__link { font-family: 'DM Sans', sans-serif; font-weight: 500; font-size: 0.875rem; color: var(--gris-700); padding: 7px 12px; border-radius: 6px; transition: all var(--transition); }
.nav__link:hover { color: var(--vert-principal); background: var(--vert-clair); }

.header__ctas { display: flex; align-items: center; gap: 8px; }
.header__ctas .btn--primary { padding: 9px 20px; }

.burger { display: flex; flex-direction: column; gap: 5px; padding: 6px; border-radius: 6px; transition: background var(--transition); }
.burger:hover { background: var(--gris-100); }
.burger__bar { display: block; width: 22px; height: 2px; background: var(--gris-700); border-radius: 2px; transition: all var(--transition); }
.burger.open .burger__bar:nth-child(1) { transform: translateY(7px) rotate(45deg); }
.burger.open .burger__bar:nth-child(2) { opacity: 0; transform: translateX(-4px); }
.burger.open .burger__bar:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

/* Menu mobile */
.mobile-nav { display: none; position: fixed; top: 64px; left: 0; right: 0; bottom: 0; background: var(--blanc); z-index: 99; padding: 24px 20px; overflow-y: auto; flex-direction: column; gap: 4px; animation: fadeIn 0.2s var(--ease); }
.mobile-nav.open { display: flex; }
.mobile-nav__link { font-family: 'DM Sans', sans-serif; font-weight: 500; font-size: 1rem; color: var(--gris-700); padding: 14px 4px; border-bottom: 1px solid var(--gris-200); display: block; transition: color var(--transition); }
.mobile-nav__link:hover { color: var(--vert-principal); }
.mobile-nav__ctas { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
.mobile-nav__ctas .btn { width: 100%; }

@media (min-width: 768px) {
  .header { height: 80px; }
  .logo__sub { display: block; }
  .nav { display: flex; }
  .burger { display: none; }
  .header__ctas .btn--outline { display: inline-flex; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER MINIMAL â€” Pages Auth (compact, centrÃ©, retour)
   Classe : .hdr / .hdr-in  (coexiste avec .header sans conflit)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hdr { position: sticky; top: 0; z-index: 100; height: 56px; background: var(--blanc); box-shadow: var(--shadow-sm); }
.hdr-in { height: 100%; max-width: 520px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
.hdr-back { display: flex; align-items: center; gap: 5px; font-size: 0.875rem; font-weight: 500; color: var(--gris-700); transition: color var(--tr); }
.hdr-back:hover { color: var(--vert-principal); }
.hdr-back svg { width: 16px; height: 16px; stroke: currentColor; stroke-width: 2; fill: none; }
.hdr-logo { display: flex; align-items: center; gap: 8px; text-decoration: none; }
.logo-mark { width: 30px; height: 30px; border-radius: 8px; background: var(--vert-principal); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.logo-mark span { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.72rem; color: #fff; }
.logo-name { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1rem; color: var(--gris-900); }
.hdr-right { font-size: 0.8rem; color: var(--gris-400); white-space: nowrap; }
.hdr-right a { color: var(--vert-principal); font-weight: 600; font-family: 'Sora', sans-serif; transition: opacity var(--tr); }
.hdr-right a:hover { opacity: 0.75; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO â€” Page d'accueil
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero { background-color: var(--vert-fonce); position: relative; overflow: hidden; padding: 56px 20px 52px; }
.hero::before { content: ''; position: absolute; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"); opacity: 0.04; pointer-events: none; }
.hero::after { content: ''; position: absolute; bottom: -80px; right: -80px; width: 400px; height: 400px; border-radius: 50%; background: rgba(255,255,255,0.04); pointer-events: none; }
.hero__deco { position: absolute; top: -60px; left: -60px; width: 280px; height: 280px; border-radius: 50%; background: rgba(46,204,113,0.05); pointer-events: none; }
.hero__inner { position: relative; z-index: 1; max-width: 640px; }
.hero__badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 100px; padding: 6px 14px; margin-bottom: 24px; animation: fadeSlideUp 0.5s var(--ease) both; }
.hero__badge-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--vert-accent); flex-shrink: 0; }
.hero__badge-text { font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.72rem; color: var(--blanc); text-transform: uppercase; letter-spacing: 1px; }
.hero__title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 1.75rem; color: var(--blanc); letter-spacing: -0.5px; line-height: 1.25; margin-bottom: 16px; animation: fadeSlideUp 0.5s var(--ease) 0.08s both; }
.hero__title em { color: var(--or-accent); font-style: italic; font-weight: 800; }
.hero__sub { font-size: 0.9rem; color: rgba(255,255,255,0.75); line-height: 1.7; max-width: 520px; margin-bottom: 36px; animation: fadeSlideUp 0.5s var(--ease) 0.16s both; }
.hero__ctas { display: flex; flex-direction: column; gap: 12px; animation: fadeSlideUp 0.5s var(--ease) 0.24s both; }
.hero__ctas .btn { font-size: 1rem; padding: 14px 28px; }

@media (min-width: 768px) {
  .hero { padding: 80px 40px 72px; }
  .hero__title { font-size: 2.4rem; }
  .hero__sub { font-size: 1.05rem; }
  .hero__ctas { flex-direction: row; }
  .hero__ctas .btn { width: auto; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS BAR â€” Page d'accueil
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats { background: var(--gris-100); padding: 28px 20px; }
.stats__inner { display: flex; justify-content: space-around; align-items: center; max-width: 600px; margin: 0 auto; }
.stat { text-align: center; }
.stat__number { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.6rem; color: var(--vert-principal); line-height: 1.1; display: block; }
.stat__label { font-size: 0.72rem; font-weight: 500; color: var(--gris-400); text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; display: block; }
.stats__sep { width: 1px; height: 36px; background: var(--gris-200); display: none; }
@media (min-width: 480px) { .stats__sep { display: block; } }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION PROFILS â€” Page d'accueil
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.profiles { background: var(--blanc); padding: 64px 20px 44px; }
.section-header { text-align: center; margin-bottom: 36px; }
.section-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.75rem; color: var(--gris-900); letter-spacing: -0.5px; line-height: 1.2; }
.section-sub { font-size: 0.975rem; color: var(--gris-700); margin-top: 10px; line-height: 1.6; }

.profiles__grid { display: grid; grid-template-columns: 1fr; gap: 14px; max-width: 860px; margin: 0 auto; }

.profile-card { background: var(--blanc); border: 1.5px solid var(--gris-200); border-radius: 16px; padding: 20px; box-shadow: var(--shadow-sm); cursor: pointer; display: flex; flex-direction: column; gap: 12px; transition: all var(--transition); user-select: none; animation: cardIn 0.4s var(--ease) both; position: relative; }

/* Cartes multi-sÃ©lection â€” style "checkbox" visuel */
.sel-card--multi { position: relative; }
.sel-card--multi .sc-badge {
  position: absolute; top: 12px; right: 12px;
  width: 22px; height: 22px; border-radius: 50%;
  background: var(--gris-200); border: 1.5px solid var(--gris-200);
  display: flex; align-items: center; justify-content: center;
  transition: all var(--transition);
}
.sel-card--multi .sc-badge svg { opacity: 0; transition: opacity 0.2s; width: 11px; height: 11px; stroke: white; stroke-width: 3; fill: none; }
.sel-card--multi.active .sc-badge { background: var(--vert-principal); border-color: var(--vert-principal); }
.sel-card--multi.active .sc-badge svg { opacity: 1; }
.sel-card--affilie .sc-badge { background: rgba(155,27,106,0.12); border-color: rgba(155,27,106,0.3); }
.sel-card--affilie.active .sc-badge { background: linear-gradient(135deg,#9B1B6A,#4A0E6B); border-color: #9B1B6A; }
.profile-card:nth-child(1) { animation-delay: 0.05s; }
.profile-card:nth-child(2) { animation-delay: 0.10s; }
.profile-card:nth-child(3) { animation-delay: 0.15s; }
.profile-card:nth-child(4) { animation-delay: 0.20s; }
.profile-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); border-color: rgba(74,158,42,0.3); }
.profile-card.active { background: var(--vert-clair); border-color: var(--vert-principal); box-shadow: 0 0 0 3px rgba(74,158,42,0.12), var(--shadow-md); transform: translateY(-1px); }
.profile-card.dimmed { opacity: 0.42; }
.profile-card.dimmed:hover { opacity: 0.7; }

.profile-card__top { display: flex; align-items: flex-start; justify-content: space-between; }
.profile-card__icon { width: 44px; height: 44px; border-radius: 12px; background: var(--gris-100); display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: background var(--transition); }
.profile-card.active .profile-card__icon { background: rgba(74,158,42,0.15); }
.profile-card__icon svg { width: 22px; height: 22px; stroke: var(--gris-700); stroke-width: 1.5; fill: none; transition: stroke var(--transition); }
.profile-card.active .profile-card__icon svg { stroke: var(--vert-principal); }
.profile-card__arrow { font-size: 1.2rem; color: var(--gris-400); transition: all var(--transition); margin-top: 2px; }
.profile-card.active .profile-card__arrow { color: var(--vert-principal); transform: translateX(4px); }
.profile-card:hover:not(.active) .profile-card__arrow { transform: translateX(3px); color: var(--gris-700); }
.profile-card__title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1rem; color: var(--gris-900); }
.profile-card__desc { font-size: 0.875rem; color: var(--gris-700); line-height: 1.5; }
.profile-card__check { position: absolute; top: 12px; right: 44px; width: 20px; height: 20px; border-radius: 50%; background: var(--vert-principal); display: none; align-items: center; justify-content: center; }
.profile-card__check svg { width: 11px; height: 11px; stroke: white; stroke-width: 2.5; fill: none; }
.profile-card.active .profile-card__check { display: flex; }

@media (min-width: 768px) {
  .profiles__grid { grid-template-columns: 1fr 1fr; gap: 16px; }
  .section-title { font-size: 2.25rem; }
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION ACTIONS DYNAMIQUES â€” Page d'accueil
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.actions { background: var(--blanc); padding: 0 20px 60px; display: none; }
.actions.visible { display: block; animation: fadeSlideUp 0.35s var(--ease) both; }
.actions__inner { max-width: 860px; margin: 0 auto; }
.actions__divider { width: 48px; height: 3px; background: var(--vert-principal); border-radius: 2px; margin: 0 auto 28px; }
.actions__title { font-family: 'Sora', sans-serif; font-weight: 600; font-size: 1.1rem; color: var(--gris-900); text-align: center; margin-bottom: 16px; }
.actions__grid { display: flex; flex-direction: column; gap: 10px; }
.action-card { background: var(--blanc); border: 1.5px solid var(--gris-200); border-radius: 12px; padding: 14px 18px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; box-shadow: var(--shadow-sm); transition: all var(--transition); }
.action-card:hover { border-color: var(--vert-principal); background: var(--vert-clair); transform: translateX(5px); box-shadow: var(--shadow-md); }
.action-card:focus-visible { outline: 3px solid var(--vert-accent); outline-offset: 2px; }
.action-card__label { font-weight: 500; font-size: 0.925rem; color: var(--gris-900); }
.action-card__arrow { color: var(--gris-400); font-size: 1rem; transition: all var(--transition); }
.action-card:hover .action-card__arrow { color: var(--vert-principal); transform: translateX(3px); }
.actions__cta { margin-top: 24px; }
.actions__cta .btn--lg { border-radius: 8px; }
.trust-line { text-align: center; font-size: 0.78rem; color: var(--gris-400); margin-top: 12px; letter-spacing: 0.2px; }
.trust-line span { margin: 0 6px; color: var(--gris-200); }

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-6px); }
  40% { transform: translateX(6px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
}
.shake { animation: shake 0.4s var(--ease); }

@media (min-width: 768px) {
  .actions__grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
  .actions__cta .btn--lg { width: 320px; display: flex; margin: 0 auto; }
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AFFILIATION â€” Page d'accueil
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.affiliation { background: var(--vert-clair); padding: 64px 20px; text-align: center; }
.affiliation__inner { max-width: 680px; margin: 0 auto; }
.affiliation__label { font-family: 'Sora', sans-serif; font-size: 0.72rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--vert-principal); margin-bottom: 14px; display: block; }
.affiliation h2 { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.4rem; color: var(--gris-900); letter-spacing: -0.5px; margin-bottom: 12px; }
.affiliation__sub { font-size: 0.925rem; color: var(--gris-700); margin-bottom: 36px; line-height: 1.65; }
.aff-steps { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 4px; margin-bottom: 32px; }
.aff-step { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 8px 16px; }
.aff-step__icon { width: 52px; height: 52px; border-radius: 50%; background: var(--blanc); border: 1.5px solid var(--gris-200); box-shadow: var(--shadow-sm); display: flex; align-items: center; justify-content: center; transition: all var(--transition); }
.aff-step__icon:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
.aff-step__icon svg { width: 22px; height: 22px; stroke: var(--vert-principal); stroke-width: 1.5; fill: none; }
.aff-step__label { font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.82rem; color: var(--gris-700); }
.aff-connector { font-size: 1.3rem; color: var(--gris-400); align-self: center; margin-bottom: 20px; }
@media (min-width: 768px) { .affiliation h2 { font-size: 1.75rem; } }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RASSURANCE â€” Page d'accueil
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.reassurance { background: var(--blanc); padding: 56px 20px; }
.reassurance__inner { display: flex; flex-wrap: wrap; justify-content: center; gap: 32px; max-width: 820px; margin: 0 auto; }
.reas-item { flex: 1; min-width: 200px; max-width: 240px; display: flex; flex-direction: column; align-items: center; text-align: center; gap: 14px; }
.reas-item__icon { width: 56px; height: 56px; border-radius: 14px; background: var(--gris-100); display: flex; align-items: center; justify-content: center; transition: all var(--transition); }
.reas-item:hover .reas-item__icon { background: var(--vert-clair); transform: translateY(-2px); }
.reas-item__icon svg { width: 26px; height: 26px; stroke: var(--vert-principal); stroke-width: 1.5; fill: none; }
.reas-item__title { font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.95rem; color: var(--gris-900); }
.reas-item__desc { font-size: 0.82rem; color: var(--gris-400); line-height: 1.6; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER â€” Page d'accueil (grand footer sombre)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.footer { background: var(--vert-fonce); padding: 52px 20px 28px; }
.footer__grid { display: grid; grid-template-columns: 1fr 1fr; gap: 28px 20px; max-width: 1100px; margin: 0 auto 40px; }
.footer__col h4 { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.72rem; color: var(--blanc); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 14px; }
.footer__col a { display: block; font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-bottom: 9px; transition: color var(--transition); }
.footer__col a:hover { color: var(--blanc); }
.footer__bottom { border-top: 1px solid rgba(255,255,255,0.12); padding-top: 20px; max-width: 1100px; margin: 0 auto; display: flex; flex-wrap: wrap; gap: 16px; justify-content: space-between; align-items: center; }
.footer__copy { font-size: 0.78rem; color: rgba(255,255,255,0.35); }
.footer__copy strong { color: var(--or-accent); font-weight: 600; }
.social-links { display: flex; gap: 10px; }
.social-link { width: 36px; height: 36px; border-radius: 8px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; transition: all var(--transition); }
.social-link:hover { background: rgba(255,255,255,0.2); transform: translateY(-1px); }
.social-link svg { width: 16px; height: 16px; fill: rgba(255,255,255,0.8); }
@media (min-width: 768px) { .footer__grid { grid-template-columns: repeat(4, 1fr); } }

/* Footer mini â€” Pages Auth */
.footer-mini { padding: 20px; text-align: center; border-top: 1px solid var(--gris-200); margin-top: 20px; }
.footer-mini p { font-size: 0.78rem; color: var(--gris-400); }
.footer-mini a { color: var(--gris-400); transition: color var(--tr); }
.footer-mini a:hover { color: var(--vert-principal); }
.footer-mini span { margin: 0 8px; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BARRE DE PROGRESSION â€” Pages Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prog { padding: 20px 20px 0; max-width: 480px; margin: 0 auto; }
.prog-steps { display: flex; align-items: flex-start; }
.prog-step { display: flex; flex-direction: column; align-items: center; gap: 6px; flex: 1; position: relative; }
.prog-step:not(:last-child)::after { content: ''; position: absolute; top: 14px; left: 55%; width: 90%; height: 2px; background: var(--gris-200); z-index: 0; transition: background 0.4s; }
.prog-step.done:not(:last-child)::after, .prog-step.active:not(:last-child)::after { background: var(--vert-principal); }
.prog-num { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.78rem; position: relative; z-index: 1; transition: all 0.3s; }
.pending .prog-num { background: var(--gris-200); color: var(--gris-400); }
.active  .prog-num { background: var(--vert-principal); color: #fff; box-shadow: 0 0 0 4px rgba(74,158,42,0.15); }
.done    .prog-num { background: var(--vert-principal); color: #fff; }
.prog-lbl { font-size: 0.68rem; font-weight: 500; text-align: center; white-space: nowrap; transition: color 0.3s; }
.pending .prog-lbl { color: var(--gris-400); }
.active  .prog-lbl { color: var(--vert-principal); font-weight: 600; font-family: 'Sora', sans-serif; }
.done    .prog-lbl { color: var(--vert-principal); opacity: 0.7; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMULAIRES AUTH â€” Wrapper, titres, sections
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fw { max-width: 480px; margin: 0 auto; padding: 28px 20px 80px; }
.form-head { margin-bottom: 24px; }
.form-lm { width: 52px; height: 52px; border-radius: 13px; background: var(--vert-principal); display: flex; align-items: center; justify-content: center; margin-bottom: 16px; }
.form-lm span { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 1rem; color: #fff; }
.form-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.6rem; color: var(--gris-900); letter-spacing: -0.5px; line-height: 1.2; margin-bottom: 6px; }
.form-sub { font-size: 0.925rem; color: var(--gris-700); }

/* Ã‰tapes Auth */
.step { display: none; }
.step.active { display: block; animation: fadeUp 0.3s var(--ease) both; }

/* Ã‰tiquettes de section */
.sec-lbl { display: flex; align-items: center; gap: 10px; margin: 24px 0 14px; }
.sec-lbl:first-child { margin-top: 0; }
.sec-lbl span { font-size: 0.72rem; font-weight: 600; color: var(--gris-400); text-transform: uppercase; letter-spacing: 1px; white-space: nowrap; }
.sec-lbl::after { content: ''; flex: 1; height: 1px; background: var(--gris-200); }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARTES DE SÃ‰LECTION â€” Auth (type compte, profil, document)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.cards-grid.cols3 { grid-template-columns: repeat(3, 1fr); }
.sel-card { background: var(--blanc); border: 1.5px solid var(--gris-200); border-radius: 14px; padding: 16px 12px; text-align: center; cursor: pointer; transition: all var(--tr); user-select: none; position: relative; }
.sel-card:hover { border-color: rgba(74,158,42,0.35); box-shadow: var(--shadow-md); transform: translateY(-1px); }
.sel-card.active { background: var(--vert-clair); border-color: var(--vert-principal); box-shadow: 0 0 0 3px rgba(74,158,42,0.12); }
.sc-badge { position: absolute; top: 8px; right: 8px; width: 18px; height: 18px; border-radius: 50%; background: var(--vert-principal); display: none; align-items: center; justify-content: center; }
.sc-badge svg { width: 10px; height: 10px; stroke: #fff; stroke-width: 2.5; fill: none; }
.sel-card.active .sc-badge { display: flex; }
.sc-icon { width: 48px; height: 48px; border-radius: 12px; background: var(--gris-100); display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; transition: background var(--tr); }
.sel-card.active .sc-icon { background: rgba(74,158,42,0.15); }
.sc-icon svg { width: 24px; height: 24px; stroke: var(--gris-700); stroke-width: 1.5; fill: none; transition: stroke var(--tr); }
.sel-card.active .sc-icon svg { stroke: var(--vert-principal); }
.sc-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.875rem; color: var(--gris-900); margin-bottom: 3px; }
.sc-sub { font-size: 0.72rem; color: var(--gris-400); line-height: 1.4; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAMPS DE FORMULAIRE â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.field { margin-bottom: 16px; }
.field-label { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; }
.field-label span { font-weight: 600; font-size: 0.875rem; color: var(--gris-900); }
.freq { color: var(--err); margin-left: 2px; }
.fopt { font-size: 0.7rem; font-weight: 400; color: var(--gris-400); background: var(--gris-100); padding: 2px 7px; border-radius: 4px; }
.input, .sel { width: 100%; height: 52px; border: 1.5px solid var(--gris-200); border-radius: 10px; padding: 0 16px; font-size: 1rem; color: var(--gris-900); background: var(--blanc); transition: all var(--tr); outline: none; -webkit-appearance: none; appearance: none; }
.input::placeholder { color: var(--gris-400); }
.input:focus, .sel:focus { border-color: var(--vert-principal); box-shadow: 0 0 0 3px rgba(74,158,42,0.1); }
.input.err { border-color: var(--err); background: var(--err-bg); }
.input.ok  { border-color: var(--vert-principal); }
.sel { cursor: pointer; padding-right: 36px; }
.sel-wrap { position: relative; }
.sel-wrap::after { content: ''; position: absolute; right: 14px; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 5px solid var(--gris-400); pointer-events: none; }
.fmsg { font-size: 0.75rem; margin-top: 5px; display: none; align-items: center; gap: 4px; }
.fmsg.err { color: var(--err); display: flex; }
.fmsg.ok  { color: var(--vert-principal); display: flex; }
.fhint { font-size: 0.75rem; color: var(--gris-400); margin-top: 5px; }
.fwarn { font-size: 0.75rem; color: var(--warn); margin-top: 5px; display: none; }

/* â”€â”€ SÃ©lecteur de profil intelligent â”€â”€ */
.profil-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-top: 4px;
}
.profil-chip {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 5px;
  padding: 10px 6px 9px;
  border: 1.5px solid var(--gris-200);
  border-radius: 12px;
  background: var(--blanc);
  cursor: pointer;
  transition: all var(--tr);
  text-align: center;
  min-height: 72px;
}
.profil-chip:hover { border-color: rgba(74,158,42,0.4); background: var(--vert-clair); transform: translateY(-1px); box-shadow: var(--shadow-sm); }
.profil-chip.active { border-color: var(--vert-principal); background: var(--vert-clair); box-shadow: 0 0 0 3px rgba(74,158,42,0.12), var(--shadow-sm); }
.profil-chip__icon { font-size: 1.5rem; line-height: 1; }
.profil-chip__label { font-size: 0.7rem; font-weight: 700; color: var(--gris-700); line-height: 1.2; }
.profil-chip.active .profil-chip__label { color: var(--vert-principal); }

/* Sous-champs profil */
.profil-subfields {
  margin-top: 14px;
  padding: 14px;
  border: 1.5px solid var(--vert-principal);
  border-radius: 12px;
  background: var(--vert-clair);
  animation: fadeIn 0.25s ease;
}
.profil-subfields .psf-title {
  font-size: 0.78rem;
  font-weight: 700;
  color: var(--vert-principal);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.profil-subfields .field { margin-bottom: 10px; }
.profil-subfields .field:last-child { margin-bottom: 0; }
.profil-subfields .input, .profil-subfields .sel {
  background: var(--blanc);
  border-color: rgba(74,158,42,0.25);
  height: 44px;
  font-size: 0.9rem;
}
.profil-subfields .field-label { font-size: 0.78rem; margin-bottom: 5px; }
.profil-subfields .sel-wrap::after { border-top-color: var(--vert-principal); }
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* Champ tÃ©lÃ©phone */
.phone-wrap { display: flex; border: 1.5px solid var(--gris-200); border-radius: 10px; overflow: hidden; transition: all var(--tr); }
.phone-wrap:focus-within { border-color: var(--vert-principal); box-shadow: 0 0 0 3px rgba(74,158,42,0.1); }
.phone-pfx { display: flex; align-items: center; gap: 5px; padding: 0 10px; border-right: 1.5px solid var(--gris-200); background: var(--gris-100); cursor: pointer; min-width: 88px; white-space: nowrap; font-size: 0.875rem; font-weight: 500; color: var(--gris-700); position: relative; transition: background var(--tr); flex-shrink: 0; }
.phone-pfx:hover { background: var(--gris-200); }
.phone-pfx svg { width: 12px; height: 12px; stroke: var(--gris-400); stroke-width: 2; fill: none; }
.phone-input { border: none; outline: none; flex: 1; padding: 0 14px; font-size: 1rem; font-family: 'DM Sans', sans-serif; color: var(--gris-900); background: var(--blanc); height: 50px; min-width: 0; }
.phone-input::placeholder { color: var(--gris-400); }

/* Dropdown pays */
.country-drop { position: absolute; top: calc(100% + 4px); left: -1px; width: 240px; background: var(--blanc); border: 1.5px solid var(--gris-200); border-radius: 10px; box-shadow: var(--shadow-md); z-index: 200; overflow: hidden; max-height: 240px; overflow-y: auto; }
.country-drop-item { padding: 9px 14px; cursor: pointer; font-size: 0.85rem; display: flex; gap: 8px; align-items: center; transition: background 0.15s; }
.country-drop-item:hover { background: var(--gris-100); }
.country-drop-item span:nth-child(2) { font-weight: 600; color: var(--gris-700); }
.country-drop-item span:nth-child(3) { color: var(--gris-400); font-size: 0.78rem; }

/* Input avec icÃ´ne */
.iico { position: relative; }
.iico .input { padding-left: 42px; }
.iico .ico-l { position: absolute; left: 13px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; stroke: var(--gris-400); stroke-width: 1.5; fill: none; pointer-events: none; }
.iico .ico-r { position: absolute; right: 13px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; stroke: var(--gris-400); stroke-width: 1.5; fill: none; cursor: pointer; transition: stroke var(--tr); }
.iico .ico-r:hover { stroke: var(--gris-700); }

/* Textarea */
.textarea { width: 100%; min-height: 80px; border: 1.5px solid var(--gris-200); border-radius: 10px; padding: 13px 16px; font-family: 'DM Sans', sans-serif; font-size: 0.925rem; color: var(--gris-900); resize: vertical; outline: none; transition: all var(--tr); }
.textarea:focus { border-color: var(--vert-principal); box-shadow: 0 0 0 3px rgba(74,158,42,0.1); }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ZONES D'UPLOAD â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.upload-zone { border: 2px dashed var(--gris-200); border-radius: 12px; padding: 24px 16px; text-align: center; cursor: pointer; background: var(--gris-100); transition: all var(--tr); position: relative; }
.upload-zone:hover { border-color: var(--vert-principal); background: var(--vert-clair); }
.upload-zone.loaded { border: 2px solid var(--vert-principal); background: var(--vert-clair); }
.upload-zone input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
.upload-icon { width: 40px; height: 40px; border-radius: 10px; background: var(--blanc); display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; box-shadow: var(--shadow-sm); }
.upload-icon svg { width: 20px; height: 20px; stroke: var(--gris-400); stroke-width: 1.5; fill: none; }
.upload-zone.loaded .upload-icon svg { stroke: var(--vert-principal); }
.upload-title { font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.85rem; color: var(--gris-900); margin-bottom: 3px; }
.upload-sub { font-size: 0.72rem; color: var(--gris-400); }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INDICATEUR DE FORCE MDP â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pw-wrap { margin-top: 8px; }
.pw-bars { display: flex; gap: 3px; margin-bottom: 7px; }
.pw-bar { flex: 1; height: 3px; border-radius: 2px; background: var(--gris-200); transition: background 0.3s; }
.pw-bar.s1 { background: #E53E3E; }
.pw-bar.s2 { background: #DD6B20; }
.pw-bar.s3 { background: var(--or-accent); }
.pw-bar.s4 { background: var(--vert-principal); }
.pw-rules { display: flex; flex-direction: column; gap: 3px; }
.pw-rule { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: var(--gris-400); transition: color 0.2s; }
.pw-rule.ok { color: var(--vert-principal); }
.pw-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--gris-200); flex-shrink: 0; transition: background 0.2s; }
.pw-rule.ok .pw-dot { background: var(--vert-accent); }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECKBOX CGU / RESTER CONNECTÃ‰ â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cgu { display: flex; align-items: flex-start; gap: 10px; padding: 16px; background: var(--gris-100); border-radius: 10px; cursor: pointer; margin-bottom: 18px; }
.chk { width: 18px; height: 18px; border: 1.5px solid var(--gris-200); border-radius: 4px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; transition: all var(--tr); margin-top: 2px; background: var(--blanc); }
.chk.on { background: var(--vert-principal); border-color: var(--vert-principal); }
.chk svg { display: none; width: 10px; height: 10px; stroke: #fff; stroke-width: 3; fill: none; }
.chk.on svg { display: block; }
.cgu-txt { font-size: 0.875rem; color: var(--gris-700); line-height: 1.55; }
.cgu-txt a { color: var(--vert-principal); font-weight: 500; }
.cgu-txt a:hover { text-decoration: underline; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALERTES â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.alert { border-radius: 10px; padding: 14px 16px; font-size: 0.875rem; margin-bottom: 16px; display: flex; align-items: flex-start; gap: 10px; }
.alert svg { width: 18px; height: 18px; flex-shrink: 0; margin-top: 1px; }
.alert-info { background: var(--vert-clair); border-left: 4px solid var(--vert-principal); color: var(--gris-700); }
.alert-info svg { stroke: var(--vert-principal); fill: none; stroke-width: 1.5; }
.alert-warn { background: var(--warn-bg); border-left: 4px solid var(--warn); color: var(--gris-700); }
.alert-warn svg { stroke: var(--warn); fill: none; stroke-width: 1.5; }
.alert-err { background: var(--err-bg); border-left: 4px solid var(--err); color: var(--err); }
.alert-err svg { stroke: var(--err); fill: none; stroke-width: 1.5; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ONGLETS (login email/tel) â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs { display: flex; background: var(--gris-100); border-radius: 10px; padding: 4px; margin-bottom: 20px; }
.tab { flex: 1; text-align: center; padding: 9px 12px; border-radius: 8px; font-size: 0.875rem; font-weight: 500; color: var(--gris-700); cursor: pointer; transition: all var(--tr); }
.tab.active { background: var(--blanc); box-shadow: var(--shadow-sm); font-family: 'Sora', sans-serif; font-weight: 600; color: var(--vert-principal); }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE VÃ‰RIFICATION EMAIL â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.verify-wrap { max-width: 420px; margin: 0 auto; padding: 48px 20px 60px; text-align: center; }
.verify-icon { width: 96px; height: 96px; border-radius: 50%; background: var(--vert-clair); border: 2px solid rgba(74,158,42,0.1); display: flex; align-items: center; justify-content: center; margin: 0 auto 28px; animation: pulse 2s ease-in-out infinite; }
.verify-icon svg { width: 44px; height: 44px; stroke: var(--vert-principal); stroke-width: 1.5; fill: none; }
.verify-email-badge { display: inline-block; background: var(--vert-clair); color: var(--vert-principal); font-weight: 600; font-size: 0.95rem; padding: 8px 16px; border-radius: 8px; margin: 10px 0 14px; word-break: break-all; }
.email-btns { display: flex; gap: 10px; margin: 20px 0; }
.email-btns .btn { font-size: 0.875rem; padding: 11px; }
.separator { display: flex; align-items: center; gap: 12px; margin: 20px 0; color: var(--gris-400); font-size: 0.8rem; }
.separator::before, .separator::after { content: ''; flex: 1; height: 1px; background: var(--gris-200); }
.resend-link { color: var(--vert-principal); font-weight: 600; font-family: 'Sora', sans-serif; cursor: pointer; transition: opacity var(--tr); }
.resend-link:hover { opacity: 0.75; }
.resend-link.disabled { color: var(--gris-400); pointer-events: none; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE SUCCÃˆS / CONFIRMATION â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.success-wrap { max-width: 440px; margin: 0 auto; padding: 48px 20px 60px; text-align: center; }
.success-icon { width: 84px; height: 84px; border-radius: 50%; background: var(--vert-clair); display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; animation: bounce 0.5s var(--ease) 0.1s both; }
.success-icon svg { width: 38px; height: 38px; stroke: var(--vert-principal); stroke-width: 2.5; fill: none; }
.success-box { background: var(--gris-100); border-radius: 12px; padding: 16px; margin-top: 16px; text-align: left; }
.success-box p { font-size: 0.85rem; color: var(--gris-700); margin-bottom: 12px; line-height: 1.55; }
.aff-code-row { display: flex; gap: 8px; align-items: center; }
.aff-code { flex: 1; background: var(--blanc); border: 1.5px solid var(--gris-200); border-radius: 8px; padding: 10px 14px; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.925rem; color: var(--vert-principal); text-align: center; }
.copy-btn { display: flex; align-items: center; gap: 5px; background: transparent; border: 1.5px solid var(--vert-principal); color: var(--vert-principal); font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.82rem; padding: 10px 12px; border-radius: 8px; transition: all var(--tr); white-space: nowrap; cursor: pointer; }
.copy-btn:hover { background: var(--vert-principal); color: #fff; }
.copy-btn svg { width: 13px; height: 13px; stroke: currentColor; stroke-width: 2; fill: none; }
.kyc-box { background: var(--gris-100); border-radius: 12px; padding: 16px; margin-top: 12px; text-align: left; }
.kyc-box-title { display: flex; align-items: center; gap: 8px; font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.875rem; color: var(--gris-900); margin-bottom: 6px; }
.kyc-box-title svg { width: 18px; height: 18px; stroke: var(--vert-principal); stroke-width: 1.5; fill: none; }
.kyc-btns { display: flex; gap: 10px; margin-top: 12px; }
.kyc-btns .btn { font-size: 0.85rem; padding: 10px; }

/* Liens divers */
.reas-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; margin-top: 14px; }
/* NOTE : .reas-item existe dÃ©jÃ  (page accueil) â€” on prÃ©fixe les variantes Auth */
.reas-row .reas-item { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; color: var(--gris-400); padding: 0 10px; flex: unset; min-width: unset; max-width: unset; flex-direction: row; text-align: left; }
.reas-row .reas-item svg { width: 13px; height: 13px; stroke: var(--gris-400); stroke-width: 1.5; fill: none; }
.reas-sep { width: 1px; height: 14px; background: var(--gris-200); }
.link-center { text-align: center; font-size: 0.875rem; color: var(--gris-400); margin-top: 14px; }
.link-center a, .link-center button { color: var(--vert-principal); font-weight: 600; font-family: 'Sora', sans-serif; background: none; border: none; cursor: pointer; font-size: 0.875rem; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL KYC â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 500; display: flex; align-items: center; justify-content: center; padding: 20px; animation: fadeIn 0.2s ease; }
.modal-bg.hidden { display: none; }
.modal { background: var(--blanc); border-radius: 16px; padding: 28px 24px; max-width: 380px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
.modal h3 { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.1rem; color: var(--gris-900); margin-bottom: 14px; }
.modal-list { list-style: none; margin: 8px 0 14px; }
.modal-list li { display: flex; align-items: center; gap: 8px; font-size: 0.875rem; color: var(--gris-700); padding: 4px 0; }
.modal-list li svg { width: 16px; height: 16px; flex-shrink: 0; }
.modal-list .yes svg { stroke: var(--vert-principal); fill: none; stroke-width: 2; }
.modal-list .no  svg { stroke: var(--err); fill: none; stroke-width: 2; }
.modal-btns { display: flex; gap: 10px; margin-top: 16px; }
.modal-btns .btn { font-size: 0.875rem; padding: 11px; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST â€” Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(20px); background: var(--gris-900); color: #fff; font-size: 0.85rem; font-weight: 500; padding: 10px 20px; border-radius: 100px; z-index: 999; opacity: 0; transition: all 0.3s; pointer-events: none; white-space: nowrap; }
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYFRAMES â€” UnifiÃ©s (sans doublons)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes fadeSlideUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes cardIn {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
  from { opacity: 0; } to { opacity: 1; }
}
@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}
@keyframes pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(74,158,42,0.2); }
  50% { box-shadow: 0 0 0 12px rgba(74,158,42,0); }
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Step banner */
.step-banner {
  background: linear-gradient(135deg, var(--vert-clair), #f0faf5);
  border-left: 4px solid var(--vert-principal);
  border-radius: 8px;
  padding: 10px 16px;
  font-family: 'Sora', sans-serif;
  font-weight: 600;
  font-size: 0.82rem;
  color: var(--vert-fonce);
  margin-bottom: 20px;
}

/* Admin login page */
.admin-login-wrap { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--gris-100); padding: 20px; }
.admin-login-box { background: var(--blanc); border-radius: 20px; padding: 40px 32px; max-width: 400px; width: 100%; box-shadow: 0 8px 32px rgba(0,0,0,0.12); }
.admin-code-inputs { display: flex; gap: 10px; justify-content: center; margin: 24px 0 8px; }
.admin-code-inputs input { width: 48px; height: 60px; border: 2px solid var(--gris-200); border-radius: 12px; text-align: center; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.4rem; color: var(--gris-900); outline: none; transition: all 0.2s; }
.admin-code-inputs input:focus { border-color: var(--vert-principal); box-shadow: 0 0 0 3px rgba(74,158,42,0.1); }
.admin-code-inputs input.filled { background: var(--vert-clair); border-color: var(--vert-principal); }
.admin-code-err { text-align: center; color: var(--err); font-size: 0.82rem; margin: 6px 0; display: none; }
.admin-code-hint { text-align: center; font-size: 0.78rem; color: var(--gris-400); margin-bottom: 20px; }

/* Admin dashboard */
#page-admin { background: var(--gris-100); min-height: 100vh; }
.admin-header { background: var(--gris-900); height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 24px; position: sticky; top: 0; z-index: 100; }
.admin-header-left { display: flex; align-items: center; gap: 12px; }
.admin-logo-mark { width: 32px; height: 32px; border-radius: 8px; background: var(--vert-principal); display: flex; align-items: center; justify-content: center; }
.admin-logo-mark span { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.72rem; color: #fff; }
.admin-header-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.95rem; color: #fff; }
.admin-badge { background: var(--vert-principal); color: #fff; font-size: 0.62rem; font-weight: 700; text-transform: uppercase; padding: 3px 8px; border-radius: 4px; }
.admin-header-right { display: flex; align-items: center; gap: 12px; }
.admin-time { font-size: 0.78rem; color: rgba(255,255,255,0.5); font-family: monospace; }
.admin-logout-btn { font-size: 0.78rem; color: rgba(255,255,255,0.6); background: rgba(255,255,255,0.1); border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
.admin-logout-btn:hover { background: rgba(255,255,255,0.2); color: #fff; }
.admin-content { max-width: 1200px; margin: 0 auto; padding: 28px 20px; }
.admin-top-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; flex-wrap: wrap; gap: 12px; }
.admin-page-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.4rem; color: var(--gris-900); }
.admin-refresh-btn { display: flex; align-items: center; gap: 6px; background: var(--blanc); border: 1.5px solid var(--gris-200); color: var(--gris-700); font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.8rem; padding: 9px 16px; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
.admin-refresh-btn:hover { border-color: var(--vert-principal); color: var(--vert-principal); }
.admin-refresh-btn svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2; }
.admin-refresh-btn.spinning svg { animation: spin 0.8s linear infinite; }
.admin-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; margin-bottom: 24px; }
@media (min-width: 640px) { .admin-stats { grid-template-columns: repeat(4, 1fr); } }
.admin-stat-card { background: var(--blanc); border-radius: 14px; padding: 18px 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); border: 1px solid var(--gris-200); }
.admin-stat-label { font-size: 0.72rem; font-weight: 600; color: var(--gris-400); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.admin-stat-value { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 2rem; color: var(--gris-900); line-height: 1; margin-bottom: 4px; }
.admin-stat-change { font-size: 0.75rem; color: var(--vert-principal); font-weight: 500; }
.admin-stat-change.down { color: var(--err); }
.admin-section { background: var(--blanc); border-radius: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); border: 1px solid var(--gris-200); overflow: hidden; margin-bottom: 20px; }
.admin-section-header { display: flex; align-items: center; justify-content: space-between; padding: 18px 20px; border-bottom: 1px solid var(--gris-200); flex-wrap: wrap; gap: 10px; }
.admin-section-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.95rem; color: var(--gris-900); }
.admin-filter-row { display: flex; gap: 6px; flex-wrap: wrap; }
.admin-filter-btn { font-size: 0.75rem; font-weight: 600; padding: 5px 12px; border-radius: 20px; border: 1.5px solid var(--gris-200); color: var(--gris-700); background: transparent; cursor: pointer; transition: all 0.2s; }
.admin-filter-btn.active, .admin-filter-btn:hover { background: var(--vert-principal); border-color: var(--vert-principal); color: #fff; }
.admin-table-wrap { overflow-x: auto; }
.admin-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
.admin-table th { text-align: left; padding: 12px 16px; font-size: 0.68rem; font-weight: 600; color: var(--gris-400); text-transform: uppercase; letter-spacing: 0.8px; border-bottom: 1px solid var(--gris-200); white-space: nowrap; background: var(--gris-100); }
.admin-table td { padding: 13px 16px; border-bottom: 1px solid var(--gris-100); vertical-align: middle; }
.admin-table tr:last-child td { border-bottom: none; }
.admin-table tr:hover td { background: #fafbfc; }
.admin-user-cell { display: flex; align-items: center; gap: 10px; }
.admin-avatar { width: 34px; height: 34px; border-radius: 50%; background: var(--vert-clair); display: flex; align-items: center; justify-content: center; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.75rem; color: var(--vert-principal); flex-shrink: 0; }
.admin-user-name { font-weight: 600; font-size: 0.875rem; color: var(--gris-900); }
.admin-user-email { font-size: 0.75rem; color: var(--gris-400); }
.badge { display: inline-flex; align-items: center; gap: 4px; font-size: 0.68rem; font-weight: 700; padding: 3px 9px; border-radius: 20px; white-space: nowrap; }
.badge::before { content: ''; width: 5px; height: 5px; border-radius: 50%; flex-shrink: 0; }
.badge-attente { background: #FFF3CD; color: #856404; } .badge-attente::before { background: #FFC107; }
.badge-verifie { background: #EDF7E5; color: #2A5E10; } .badge-verifie::before { background: #6ED63B; }
.badge-rejete  { background: #FFF5F5; color: #E53E3E; } .badge-rejete::before  { background: #E53E3E; }
.badge-producteur  { background: #EDF7E5; color: #2A5E10; }
.badge-acheteur    { background: #EBF4FF; color: #1A56DB; }
.badge-transporteur{ background: #FFF8E6; color: #7B5200; }
.badge-partenaire  { background: #F0ECFF; color: #5521B5; }
.badge-affilie     { background: #FFF0F6; color: #9B1B6A; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFIL AFFILIÃ‰ â€” Styles spÃ©cifiques
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.aff-profil-banner {
  background: linear-gradient(135deg, #4A0E6B 0%, #9B1B6A 100%);
  border-radius: 14px;
  padding: 20px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 14px;
  color: #fff;
}
.aff-profil-icon {
  width: 52px; height: 52px; border-radius: 12px;
  background: rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.aff-profil-icon svg { width: 26px; height: 26px; stroke: #fff; stroke-width: 1.5; fill: none; }
.aff-profil-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1rem; margin-bottom: 3px; }
.aff-profil-sub { font-size: 0.78rem; opacity: 0.8; line-height: 1.4; }

.aff-perks { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 16px 0; }
.aff-perk { background: var(--gris-100); border-radius: 10px; padding: 12px; display: flex; align-items: flex-start; gap: 8px; }
.aff-perk-icon { width: 28px; height: 28px; border-radius: 7px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.aff-perk-icon.green { background: #EDF7E5; }
.aff-perk-icon.gold  { background: #FFF8E6; }
.aff-perk-icon.blue  { background: #EBF4FF; }
.aff-perk-icon.purple{ background: #F0ECFF; }
.aff-perk-icon svg { width: 14px; height: 14px; stroke-width: 2; fill: none; }
.aff-perk-icon.green svg { stroke: #2A5E10; }
.aff-perk-icon.gold  svg { stroke: #7B5200; }
.aff-perk-icon.blue  svg { stroke: #1A56DB; }
.aff-perk-icon.purple svg { stroke: #5521B5; }
.aff-perk-text { font-size: 0.75rem; font-weight: 500; color: var(--gris-700); line-height: 1.35; }
.aff-perk-text strong { display: block; font-family: 'Sora', sans-serif; font-size: 0.72rem; color: var(--gris-900); margin-bottom: 1px; }

/* Code affiliÃ© preview */
.aff-code-preview {
  background: linear-gradient(135deg, #F0ECFF 0%, #FFF0F6 100%);
  border: 1.5px solid rgba(155,27,106,0.2);
  border-radius: 12px;
  padding: 18px;
  text-align: center;
  margin: 20px 0;
}
.aff-code-label { font-size: 0.72rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #9B1B6A; margin-bottom: 6px; }
.aff-code-value { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 1.6rem; color: #4A0E6B; letter-spacing: 3px; margin-bottom: 4px; }
.aff-code-hint { font-size: 0.72rem; color: var(--gris-400); }

/* Dashboard affiliÃ© */
.aff-dashboard { max-width: 520px; margin: 0 auto; padding: 32px 20px 60px; }
.aff-dash-header { text-align: center; margin-bottom: 28px; }
.aff-dash-avatar {
  width: 72px; height: 72px; border-radius: 50%;
  background: linear-gradient(135deg, #4A0E6B, #9B1B6A);
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 12px; font-family: 'Sora', sans-serif;
  font-weight: 800; font-size: 1.3rem; color: #fff;
}
.aff-dash-name { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.2rem; color: var(--gris-900); }
.aff-dash-role { font-size: 0.8rem; color: #9B1B6A; font-weight: 600; margin-top: 2px; }

.aff-dash-code-card {
  background: linear-gradient(135deg, #4A0E6B 0%, #9B1B6A 100%);
  border-radius: 16px; padding: 20px 24px; color: #fff; margin-bottom: 20px;
  position: relative; overflow: hidden;
}
.aff-dash-code-card::before {
  content: ''; position: absolute; top: -30px; right: -30px;
  width: 120px; height: 120px; border-radius: 50%;
  background: rgba(255,255,255,0.06);
}
.aff-dash-code-lbl { font-size: 0.7rem; opacity: 0.7; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
.aff-dash-code { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 1.5rem; letter-spacing: 3px; margin-bottom: 12px; }
.aff-dash-code-actions { display: flex; gap: 8px; }
.aff-dash-btn-sm {
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25);
  color: #fff; font-size: 0.78rem; font-weight: 600; font-family: 'Sora', sans-serif;
  padding: 7px 14px; border-radius: 7px; cursor: pointer; transition: all 0.2s;
  display: flex; align-items: center; gap: 5px;
}
.aff-dash-btn-sm:hover { background: rgba(255,255,255,0.25); }
.aff-dash-btn-sm svg { width: 13px; height: 13px; stroke: currentColor; stroke-width: 2; fill: none; }

.aff-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
.aff-stat-card {
  background: var(--blanc); border: 1.5px solid var(--gris-200);
  border-radius: 12px; padding: 14px; text-align: center;
}
.aff-stat-val { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 1.4rem; color: var(--gris-900); }
.aff-stat-lbl { font-size: 0.7rem; color: var(--gris-400); margin-top: 3px; font-weight: 500; }

.aff-section { background: var(--blanc); border: 1.5px solid var(--gris-200); border-radius: 14px; overflow: hidden; margin-bottom: 14px; }
.aff-section-hd { padding: 14px 16px; border-bottom: 1px solid var(--gris-100); display: flex; align-items: center; justify-content: space-between; }
.aff-section-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.85rem; color: var(--gris-900); }
.aff-section-link { font-size: 0.75rem; color: #9B1B6A; font-weight: 600; cursor: pointer; }
.aff-filleul-row { display: flex; align-items: center; gap: 10px; padding: 12px 16px; border-bottom: 1px solid var(--gris-100); }
.aff-filleul-row:last-child { border-bottom: none; }
.aff-filleul-av { width: 32px; height: 32px; border-radius: 50%; background: var(--vert-clair); display: flex; align-items: center; justify-content: center; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.7rem; color: var(--vert-principal); flex-shrink: 0; }
.aff-filleul-info { flex: 1; }
.aff-filleul-name { font-size: 0.82rem; font-weight: 600; color: var(--gris-900); }
.aff-filleul-date { font-size: 0.7rem; color: var(--gris-400); }
.aff-filleul-status { font-size: 0.7rem; font-weight: 600; }
.aff-filleul-status.verifie { color: #2A5E10; }
.aff-filleul-status.attente { color: #856404; }

.aff-commission-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--gris-100); }
.aff-commission-row:last-child { border-bottom: none; }
.aff-commission-desc { font-size: 0.82rem; font-weight: 500; color: var(--gris-700); }
.aff-commission-date { font-size: 0.7rem; color: var(--gris-400); }
.aff-commission-amount { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.9rem; color: var(--vert-principal); }

.aff-restricted-banner {
  background: #FFF8E6; border: 1.5px solid #FFC107; border-radius: 12px;
  padding: 14px 16px; display: flex; gap: 10px; align-items: flex-start; margin-bottom: 14px;
}
.aff-restricted-banner svg { width: 18px; height: 18px; stroke: #7B5200; stroke-width: 1.5; fill: none; flex-shrink: 0; margin-top: 1px; }
.aff-restricted-banner p { font-size: 0.8rem; color: #7B5200; line-height: 1.5; margin: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL CGU AFFILIATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cgu-aff-modal-bg {
  position: fixed; inset: 0; z-index: 2000;
  background: rgba(0,0,0,0.55); backdrop-filter: blur(4px);
  display: flex; align-items: flex-end;
  animation: fadeIn 0.2s var(--ease);
}
.cgu-aff-modal-bg.hidden { display: none; }
.cgu-aff-modal {
  background: var(--blanc);
  border-radius: 20px 20px 0 0;
  width: 100%; max-width: 540px;
  margin: 0 auto;
  max-height: 88vh;
  display: flex; flex-direction: column;
  animation: slideUp 0.3s var(--ease);
}
@keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.cgu-aff-modal-header {
  padding: 20px 20px 16px;
  border-bottom: 1px solid var(--gris-200);
  display: flex; align-items: flex-start; justify-content: space-between;
  gap: 12px; flex-shrink: 0;
}
.cgu-aff-modal-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.95rem; color: var(--gris-900); }
.cgu-aff-modal-subtitle { font-size: 0.75rem; color: var(--gris-400); margin-top: 2px; }
.cgu-aff-close {
  width: 30px; height: 30px; border-radius: 50%;
  background: var(--gris-100); border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  transition: background var(--tr);
}
.cgu-aff-close:hover { background: var(--gris-200); }
.cgu-aff-close svg { width: 14px; height: 14px; stroke: var(--gris-700); stroke-width: 2.5; fill: none; }

.cgu-aff-body {
  overflow-y: auto; padding: 20px;
  flex: 1;
  scroll-behavior: smooth;
}
.cgu-aff-body::-webkit-scrollbar { width: 4px; }
.cgu-aff-body::-webkit-scrollbar-track { background: transparent; }
.cgu-aff-body::-webkit-scrollbar-thumb { background: var(--gris-200); border-radius: 4px; }

/* Sections CGU */
.cgu-section {
  border: 1.5px solid var(--gris-200);
  border-radius: 12px; overflow: hidden;
  margin-bottom: 10px;
}
.cgu-section-hd {
  display: flex; align-items: center; justify-content: space-between;
  padding: 13px 16px; cursor: pointer;
  background: var(--gris-100); transition: background var(--tr);
  user-select: none;
}
.cgu-section-hd:hover { background: var(--vert-clair); }
.cgu-section-hd.open { background: var(--vert-clair); }
.cgu-section-num { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.75rem; color: #9B1B6A; min-width: 28px; }
.cgu-section-ttl { font-family: 'Sora', sans-serif; font-weight: 600; font-size: 0.875rem; color: var(--gris-900); flex: 1; }
.cgu-section-arrow { width: 16px; height: 16px; stroke: var(--gris-400); stroke-width: 2; fill: none; transition: transform 0.25s var(--ease); }
.cgu-section-hd.open .cgu-section-arrow { transform: rotate(180deg); }

.cgu-section-bd {
  max-height: 0; overflow: hidden;
  transition: max-height 0.35s var(--ease), padding 0.2s;
  padding: 0 16px;
}
.cgu-section-bd.open {
  max-height: 600px;
  padding: 14px 16px 16px;
}
.cgu-section-bd p {
  font-size: 0.83rem; color: var(--gris-700); line-height: 1.65; margin-bottom: 10px;
}
.cgu-section-bd p:last-child { margin-bottom: 0; }
.cgu-section-bd ul { padding-left: 0; list-style: none; margin: 8px 0; display: flex; flex-direction: column; gap: 5px; }
.cgu-section-bd ul li {
  font-size: 0.82rem; color: var(--gris-700); line-height: 1.5;
  display: flex; align-items: flex-start; gap: 8px;
}
.cgu-section-bd ul li::before {
  content: ''; display: block; width: 5px; height: 5px; border-radius: 50%;
  background: #9B1B6A; flex-shrink: 0; margin-top: 7px;
}
.cgu-section-bd .cgu-highlight {
  background: linear-gradient(135deg, #FFF0F6, #F0ECFF);
  border: 1px solid rgba(155,27,106,0.2);
  border-radius: 10px; padding: 12px 14px; margin: 10px 0;
}
.cgu-section-bd .cgu-highlight strong { color: #4A0E6B; font-family: 'Sora', sans-serif; font-size: 0.8rem; }
.cgu-section-bd .cgu-warn {
  background: var(--err-bg); border: 1px solid rgba(229,62,62,0.2);
  border-radius: 10px; padding: 12px 14px; margin: 10px 0;
  font-size: 0.82rem; color: var(--err);
}
.cgu-section-bd .cgu-example {
  background: var(--gris-100); border-radius: 8px; padding: 10px 12px; margin: 8px 0;
  font-size: 0.8rem; color: var(--gris-700);
}
.cgu-section-bd .cgu-example strong { color: var(--gris-900); font-family: 'Sora', sans-serif; }

.cgu-aff-footer {
  padding: 16px 20px; border-top: 1px solid var(--gris-200);
  background: var(--blanc); flex-shrink: 0;
}
.cgu-aff-accept-btn {
  width: 100%; padding: 14px; border-radius: 10px;
  background: linear-gradient(135deg, #4A0E6B, #9B1B6A);
  color: #fff; font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.95rem;
  border: none; cursor: pointer; transition: opacity 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  box-shadow: 0 4px 14px rgba(155,27,106,0.35);
}
.cgu-aff-accept-btn:hover { opacity: 0.9; }
.cgu-aff-accept-btn svg { width: 16px; height: 16px; stroke: #fff; stroke-width: 2.5; fill: none; }
.cgu-aff-read-hint { text-align: center; font-size: 0.72rem; color: var(--gris-400); margin-top: 8px; }

/* Checkbox CGU Affiliation (dans step 4) */
.cgu-aff-row {
  background: linear-gradient(135deg, #F0ECFF 0%, #FFF0F6 100%);
  border: 1.5px solid rgba(155,27,106,0.2);
  border-radius: 12px; padding: 14px; cursor: pointer;
  display: flex; align-items: flex-start; gap: 10px;
  margin-bottom: 10px; transition: all var(--tr);
}
.cgu-aff-row:hover { border-color: #9B1B6A; }
.cgu-aff-row .chk { margin-top: 2px; flex-shrink: 0; }
.cgu-aff-row .chk.on { background: #9B1B6A; border-color: #9B1B6A; }
.cgu-aff-row-txt { font-size: 0.875rem; color: var(--gris-700); line-height: 1.5; }
.cgu-aff-row-txt strong { font-family: 'Sora', sans-serif; color: #4A0E6B; }
.cgu-aff-row-txt a { color: #9B1B6A; font-weight: 600; }
.cgu-aff-row-txt a:hover { text-decoration: underline; }
.cgu-aff-badge-required {
  display: inline-flex; align-items: center; gap: 4px;
  background: rgba(155,27,106,0.1); color: #9B1B6A;
  font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
  padding: 2px 7px; border-radius: 20px; margin-left: 6px;
}
.cgu-aff-not-accepted {
  background: var(--err-bg); border-left: 3px solid var(--err);
  border-radius: 8px; padding: 10px 12px; font-size: 0.8rem; color: var(--err);
  display: none; margin-bottom: 10px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN â€” SÃ©lecteur de profil (Membre / AffiliÃ©)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.login-profile-selector {
  margin-bottom: 20px;
}
.login-profile-label {
  font-size: 0.75rem; font-weight: 600; color: var(--gris-400);
  text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px;
}
.login-profile-tabs {
  display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
}
.login-profile-tab {
  display: flex; align-items: center; justify-content: center; gap: 7px;
  padding: 12px 16px; border-radius: 10px; border: 2px solid var(--gris-200);
  background: var(--blanc); font-family: 'Sora', sans-serif; font-weight: 600;
  font-size: 0.875rem; color: var(--gris-400); cursor: pointer;
  transition: all var(--tr);
}
.login-profile-tab svg {
  width: 16px; height: 16px; stroke: currentColor; stroke-width: 1.8; fill: none;
}
.login-profile-tab:hover {
  border-color: var(--gris-400); color: var(--gris-700);
}
.login-profile-tab.active {
  border-color: var(--vert-principal); background: var(--vert-clair);
  color: var(--vert-fonce);
}
.login-profile-tab.active[id="lpt-affilie"],
.login-profile-tab[id="lpt-affilie"]:hover {
  border-color: #9B1B6A; background: #FFF0F6; color: #4A0E6B;
}
.login-profile-tab.active[id="lpt-membre"] {
  border-color: var(--vert-principal); background: var(--vert-clair); color: var(--vert-fonce);
}

/* Bandeau affiliÃ© dans le login */
.login-aff-banner {
  background: linear-gradient(135deg, #4A0E6B, #9B1B6A);
  border-radius: 12px; padding: 14px 16px; margin-bottom: 20px;
  display: flex; align-items: center; gap: 12px; color: #fff;
  animation: fadeSlideUp 0.3s var(--ease) both;
}
.login-aff-banner-icon {
  width: 40px; height: 40px; border-radius: 10px;
  background: rgba(255,255,255,0.15); display: flex; align-items: center;
  justify-content: center; flex-shrink: 0;
}
.login-aff-banner-icon svg {
  width: 20px; height: 20px; stroke: #fff; stroke-width: 1.8; fill: none;
}
.login-aff-banner-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.9rem; }
.login-aff-banner-sub { font-size: 0.72rem; opacity: 0.8; margin-top: 2px; line-height: 1.4; }

/* Page inscription affiliÃ© */
#page-inscription-affilie .prog { display: block; }
.aff-step-banner { background: linear-gradient(90deg, #4A0E6B22, #9B1B6A11); border-left: 3px solid #9B1B6A; border-radius: 0 8px 8px 0; padding: 10px 14px; font-size: 0.82rem; font-weight: 600; color: #4A0E6B; margin-bottom: 20px; }

/* Type affiliÃ© cards */
.aff-type-card { border: 2px solid var(--gris-200); border-radius: 12px; padding: 16px; cursor: pointer; transition: all var(--tr); background: var(--blanc); display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
.aff-type-card:hover { border-color: #9B1B6A; background: #FFF0F6; }
.aff-type-card.active { border-color: #9B1B6A; background: #FFF0F6; box-shadow: 0 0 0 3px rgba(155,27,106,0.1); }
.aff-type-icon { width: 44px; height: 44px; border-radius: 10px; background: var(--gris-100); display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: background var(--tr); }
.aff-type-card.active .aff-type-icon, .aff-type-card:hover .aff-type-icon { background: rgba(155,27,106,0.1); }
.aff-type-icon svg { width: 20px; height: 20px; stroke: var(--gris-400); stroke-width: 1.5; fill: none; transition: stroke var(--tr); }
.aff-type-card.active .aff-type-icon svg, .aff-type-card:hover .aff-type-icon svg { stroke: #9B1B6A; }
.aff-type-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.875rem; color: var(--gris-900); }
.aff-type-sub { font-size: 0.75rem; color: var(--gris-400); margin-top: 2px; }
.aff-type-chk { width: 18px; height: 18px; border-radius: 50%; border: 2px solid var(--gris-200); margin-left: auto; flex-shrink: 0; display: flex; align-items: center; justify-content: center; transition: all var(--tr); }
.aff-type-card.active .aff-type-chk { background: #9B1B6A; border-color: #9B1B6A; }
.aff-type-chk svg { display: none; width: 10px; height: 10px; stroke: #fff; stroke-width: 3; fill: none; }
.aff-type-card.active .aff-type-chk svg { display: block; }
.admin-btn { background: transparent; border: 1.5px solid var(--gris-200); color: var(--gris-700); font-size: 0.72rem; font-weight: 600; padding: 5px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s; margin-right: 4px; }
.admin-btn:hover { border-color: var(--vert-principal); color: var(--vert-principal); }
.admin-btn.danger:hover { border-color: var(--err); color: var(--err); }
.admin-empty { text-align: center; padding: 48px 20px; color: var(--gris-400); font-size: 0.875rem; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN NAV â€” Barre de navigation de l'espace administrateur
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-nav-bar {
  background: rgba(255,255,255,0.07);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding: 0 24px;
  display: flex;
  align-items: center;
  gap: 4px;
  overflow-x: auto;
  scrollbar-width: none;
}
.admin-nav-bar::-webkit-scrollbar { display: none; }

.admin-nav-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px 14px;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.8rem;
  font-weight: 500;
  color: rgba(255,255,255,0.6);
  background: none;
  border: none;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  white-space: nowrap;
  transition: all 0.18s;
  border-radius: 6px 6px 0 0;
}
.admin-nav-item:hover { color: rgba(255,255,255,0.9); background: rgba(255,255,255,0.05); }
.admin-nav-item.active { color: #fff; border-bottom-color: var(--vert-accent); background: rgba(255,255,255,0.08); }
.admin-nav-item svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2; flex-shrink: 0; }

/* Badge rouge sur les items de nav */
.admin-nav-badge { background: var(--err); color: #fff; font-size: 0.6rem; font-weight: 700; padding: 2px 5px; border-radius: 10px; line-height: 1; }

/* SÃ©parateur vertical */
.admin-nav-sep { width: 1px; height: 20px; background: rgba(255,255,255,0.12); margin: 0 6px; flex-shrink: 0; }

/* Panneau de prÃ©visualisation des pages */
.admin-preview-bar {
  background: var(--gris-900);
  padding: 10px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  border-bottom: 2px solid var(--vert-principal);
}
.admin-preview-label {
  font-size: 0.72rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--vert-accent);
  font-family: 'Sora', sans-serif;
  display: flex;
  align-items: center;
  gap: 6px;
}
.admin-preview-label::before {
  content: '';
  width: 7px; height: 7px; border-radius: 50%; background: var(--vert-accent);
  animation: pulse 1.5s ease-in-out infinite;
}
.admin-preview-path {
  font-family: monospace;
  font-size: 0.75rem;
  color: rgba(255,255,255,0.45);
  background: rgba(255,255,255,0.06);
  padding: 3px 10px;
  border-radius: 4px;
}
.admin-preview-close {
  font-size: 0.75rem;
  color: rgba(255,255,255,0.5);
  background: rgba(255,255,255,0.08);
  border: none;
  padding: 5px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.18s;
  font-family: 'DM Sans', sans-serif;
}
.admin-preview-close:hover { background: rgba(255,255,255,0.15); color: #fff; }

/* Frame de prÃ©visualisation */
.admin-preview-frame {
  position: fixed;
  inset: 0;
  z-index: 200;
  background: var(--gris-900);
  display: none;
  flex-direction: column;
}
.admin-preview-frame.open { display: flex; }
.admin-preview-frame-inner {
  flex: 1;
  overflow: hidden;
  background: var(--blanc);
  position: relative;
}
/* Overlay transparent pour indiquer le mode aperÃ§u */
.admin-preview-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  border: 3px solid var(--vert-accent);
  z-index: 10;
  opacity: 0.4;
}

/* Panel de navigation admin */
.admin-panel-nav { display: none; }
.admin-panel-nav.active { display: block; }

/* Sous-navigation pour le panel admin interne */
.admin-sub-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
  border-bottom: 1px solid var(--gris-200);
  overflow-x: auto;
}
.admin-sub-tab {
  padding: 10px 16px;
  font-size: 0.82rem;
  font-weight: 600;
  font-family: 'Sora', sans-serif;
  color: var(--gris-400);
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.18s;
  margin-bottom: -1px;
}
.admin-sub-tab:hover { color: var(--gris-700); }
.admin-sub-tab.active { color: var(--vert-principal); border-bottom-color: var(--vert-principal); }

/* â”€â”€ Flux d'activitÃ© temps rÃ©el â”€â”€ */
.admin-activity-item {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 20px;
  border-bottom: 1px solid var(--gris-100);
  transition: background 0.2s;
}
.admin-activity-item:last-child { border-bottom: none; }
.admin-activity-item:hover { background: var(--gris-100); }
.admin-activity-new {
  background: rgba(46,204,113,0.06);
  animation: activitySlideIn 0.4s cubic-bezier(0.4,0,0.2,1) both;
}
@keyframes activitySlideIn {
  from { opacity:0; transform:translateX(-10px); background: rgba(46,204,113,0.18); }
  to   { opacity:1; transform:translateX(0);    background: rgba(46,204,113,0.06); }
}
.admin-activity-icon {
  width:32px; height:32px; border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-size:0.95rem; flex-shrink:0;
}
.admin-activity-body { flex:1; min-width:0; }
.admin-activity-label { font-size:0.82rem; font-weight:500; color:var(--gris-900); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.admin-activity-time { font-family:monospace; font-size:0.72rem; color:var(--gris-400); flex-shrink:0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE EDITOR â€” SystÃ¨me d'Ã©dition en temps rÃ©el depuis l'admin
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Barre d'outils du mode Ã©dition (sous la barre de prÃ©visualisation) */
.editor-toolbar {
  background: #1e1e2e;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding: 8px 20px;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
.editor-toolbar-group {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 0 8px 0 0;
  border-right: 1px solid rgba(255,255,255,0.1);
}
.editor-toolbar-group:last-child { border-right: none; }
.editor-toolbar-label {
  font-size: 0.62rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: rgba(255,255,255,0.3);
  font-family: 'Sora', sans-serif;
  font-weight: 600;
  margin-right: 4px;
  white-space: nowrap;
}
.editor-btn {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 600;
  font-family: 'DM Sans', sans-serif;
  cursor: pointer;
  border: 1px solid transparent;
  transition: all 0.15s;
  white-space: nowrap;
}
.editor-btn svg { width: 12px; height: 12px; stroke: currentColor; fill: none; stroke-width: 2; flex-shrink: 0; }
.editor-btn--edit  { background: rgba(46,204,113,0.15); color: #6ED63B; border-color: rgba(46,204,113,0.3); }
.editor-btn--edit:hover, .editor-btn--edit.active { background: rgba(46,204,113,0.28); border-color: #6ED63B; }
.editor-btn--theme { background: rgba(212,168,67,0.15); color: #D4A843; border-color: rgba(212,168,67,0.3); }
.editor-btn--theme:hover, .editor-btn--theme.active { background: rgba(212,168,67,0.28); border-color: #D4A843; }
.editor-btn--biz   { background: rgba(59,130,246,0.15); color: #60a5fa; border-color: rgba(59,130,246,0.3); }
.editor-btn--biz:hover, .editor-btn--biz.active { background: rgba(59,130,246,0.28); border-color: #60a5fa; }
.editor-btn--export { background: rgba(155,27,106,0.2); color: #e879f9; border-color: rgba(155,27,106,0.3); }
.editor-btn--export:hover { background: rgba(155,27,106,0.35); border-color: #e879f9; }
.editor-btn--undo { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.6); border-color: rgba(255,255,255,0.1); }
.editor-btn--undo:hover { background: rgba(255,255,255,0.12); color: #fff; }
.editor-changes-count {
  font-size: 0.7rem;
  color: #6ED63B;
  font-family: monospace;
  background: rgba(46,204,113,0.1);
  padding: 3px 8px;
  border-radius: 4px;
  display: none;
}
.editor-changes-count.visible { display: inline; }

/* Ã‰lÃ©ments Ã©ditables en mode Ã©dition */
.edit-mode [data-editable]:not(input):not(select):not(textarea) {
  outline: 2px dashed rgba(46,204,113,0.5) !important;
  outline-offset: 2px !important;
  cursor: text !important;
  border-radius: 3px;
  transition: outline-color 0.15s;
  min-width: 20px;
  min-height: 1em;
}
.edit-mode [data-editable]:not(input):not(select):not(textarea):hover {
  outline-color: #6ED63B !important;
  background: rgba(46,204,113,0.05) !important;
}
.edit-mode [data-editable]:not(input):not(select):not(textarea):focus {
  outline: 2px solid #6ED63B !important;
  background: rgba(46,204,113,0.08) !important;
  box-shadow: 0 0 0 4px rgba(46,204,113,0.1) !important;
}
/* Exclure les formulaires auth du mode Ã©dition */
.edit-mode .page:not(#page-accueil):not(#page-dashboard-affilie) [data-editable] {
  outline: none !important;
  cursor: default !important;
  pointer-events: none !important;
}

/* Tooltip "Cliquer pour Ã©diter" */
.edit-mode [data-editable]:hover::after {
  content: attr(data-edit-label);
  position: absolute;
  bottom: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  background: #1e1e2e;
  color: #6ED63B;
  font-size: 0.65rem;
  font-family: 'DM Sans', sans-serif;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 3px 8px;
  border-radius: 4px;
  white-space: nowrap;
  pointer-events: none;
  z-index: 9999;
  border: 1px solid rgba(46,204,113,0.3);
}
.edit-mode [data-editable]:hover { position: relative; }

/* Panneau flottant ThÃ¨me */
#themePanel {
  position: fixed;
  top: 120px;
  right: 20px;
  width: 280px;
  background: #1e1e2e;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 14px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.5);
  z-index: 1000;
  display: none;
  overflow: hidden;
  font-family: 'DM Sans', sans-serif;
}
#themePanel.open { display: block; animation: slideInRight 0.25s cubic-bezier(0.4,0,0.2,1) both; }
.theme-panel-header {
  padding: 14px 16px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.theme-panel-title {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 0.85rem;
  color: #D4A843;
}
.theme-panel-close {
  background: none;
  border: none;
  cursor: pointer;
  color: rgba(255,255,255,0.4);
  font-size: 1rem;
  padding: 2px 6px;
  border-radius: 4px;
  transition: color 0.15s;
}
.theme-panel-close:hover { color: #fff; }
.theme-panel-body { padding: 14px 16px; display: flex; flex-direction: column; gap: 12px; }
.theme-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}
.theme-row-label { font-size: 0.78rem; color: rgba(255,255,255,0.65); flex: 1; }
.theme-row input[type=color] {
  width: 32px;
  height: 28px;
  border: 2px solid rgba(255,255,255,0.15);
  border-radius: 6px;
  cursor: pointer;
  padding: 1px;
  background: transparent;
}
.theme-row select {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.15);
  color: #fff;
  font-size: 0.75rem;
  padding: 4px 8px;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  max-width: 140px;
}
.theme-row select option { background: #1e1e2e; }
.theme-reset-btn {
  width: 100%;
  padding: 8px;
  background: rgba(229,62,62,0.12);
  border: 1px solid rgba(229,62,62,0.25);
  color: #fc8181;
  border-radius: 7px;
  font-size: 0.75rem;
  font-family: 'DM Sans', sans-serif;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  margin-top: 4px;
}
.theme-reset-btn:hover { background: rgba(229,62,62,0.22); }

/* Panneau flottant Valeurs mÃ©tier */
#bizPanel {
  position: fixed;
  top: 120px;
  right: 20px;
  width: 320px;
  background: #1e1e2e;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 14px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.5);
  z-index: 1000;
  display: none;
  overflow: hidden;
  font-family: 'DM Sans', sans-serif;
  max-height: 80vh;
  overflow-y: auto;
}
#bizPanel.open { display: block; animation: slideInRight 0.25s cubic-bezier(0.4,0,0.2,1) both; }
.biz-panel-header {
  padding: 14px 16px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  background: #1e1e2e;
  z-index: 1;
}
.biz-panel-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.85rem; color: #60a5fa; }
.biz-panel-body { padding: 14px 16px; display: flex; flex-direction: column; gap: 14px; }
.biz-section-label {
  font-size: 0.62rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: rgba(255,255,255,0.35);
  font-family: 'Sora', sans-serif;
  font-weight: 600;
  margin-bottom: 2px;
  padding-bottom: 6px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}
.biz-field { display: flex; flex-direction: column; gap: 4px; }
.biz-field-label { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
.biz-field input, .biz-field textarea {
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.12);
  color: #fff;
  font-size: 0.82rem;
  padding: 7px 10px;
  border-radius: 7px;
  font-family: 'DM Sans', sans-serif;
  transition: border-color 0.15s;
  width: 100%;
}
.biz-field textarea { min-height: 64px; resize: vertical; }
.biz-field input:focus, .biz-field textarea:focus {
  outline: none;
  border-color: #60a5fa;
  background: rgba(96,165,250,0.08);
}
.biz-apply-btn {
  width: 100%;
  padding: 9px;
  background: rgba(96,165,250,0.15);
  border: 1px solid rgba(96,165,250,0.3);
  color: #60a5fa;
  border-radius: 7px;
  font-size: 0.8rem;
  font-family: 'Sora', sans-serif;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  margin-top: 4px;
  position: sticky;
  bottom: 0;
}
.biz-apply-btn:hover { background: rgba(96,165,250,0.28); }

/* Indicateur de modification non sauvegardÃ©e */
.unsaved-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #f59e0b;
  display: inline-block;
  margin-left: 4px;
  animation: pulse 1.5s ease-in-out infinite;
}

/* Raccourcis rapides */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORD-STYLE TOOLBAR â€” Barre de mise en forme flottante
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#wordToolbar {
  background: #23233a;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  padding: 4px 12px;
  display: none;
  align-items: center;
  gap: 2px;
  flex-wrap: nowrap;
  overflow-x: auto;
  scrollbar-width: none;
  min-height: 40px;
  user-select: none;
}
#wordToolbar::-webkit-scrollbar { display: none; }
#wordToolbar.wt-visible { display: flex; }
.wt-sep { width:1px; height:20px; background:rgba(255,255,255,0.1); margin:0 5px; flex-shrink:0; }
.wt-label { font-size:0.57rem; text-transform:uppercase; letter-spacing:0.8px; color:rgba(255,255,255,0.22); font-family:'Sora',sans-serif; font-weight:600; padding:0 3px; flex-shrink:0; white-space:nowrap; }
.wt-btn {
  display:flex; align-items:center; justify-content:center;
  min-width:28px; height:28px; padding:0 4px;
  border-radius:4px; background:none; border:1px solid transparent;
  color:rgba(255,255,255,0.65); cursor:pointer; font-size:0.78rem;
  font-family:'Sora',sans-serif; font-weight:700; flex-shrink:0; transition:all 0.1s;
}
.wt-btn svg { width:13px; height:13px; stroke:currentColor; fill:none; stroke-width:2; }
.wt-btn:hover { background:rgba(255,255,255,0.1); color:#fff; border-color:rgba(255,255,255,0.15); }
.wt-btn.wt-on { background:rgba(46,204,113,0.2); color:#6ED63B; border-color:rgba(46,204,113,0.35); }
.wt-select {
  background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.1);
  color:rgba(255,255,255,0.82); font-size:0.74rem; font-family:'DM Sans',sans-serif;
  padding:3px 5px; border-radius:4px; cursor:pointer; outline:none; height:28px; flex-shrink:0;
  transition:border-color 0.1s;
}
.wt-select:hover { border-color:rgba(255,255,255,0.28); }
.wt-select option { background:#1e1e2e; }
#wtFontFamily { width:108px; }
#wtFontSize { width:50px; }
.wt-size-btn {
  width:20px; height:28px; background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.09); color:rgba(255,255,255,0.55);
  font-size:1rem; cursor:pointer; border-radius:4px; display:flex;
  align-items:center; justify-content:center; flex-shrink:0; transition:all 0.1s; line-height:1;
}
.wt-size-btn:hover { background:rgba(255,255,255,0.14); color:#fff; }
.wt-size-num {
  background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.1);
  color:#fff; font-size:0.76rem; font-family:monospace; width:36px; height:28px;
  text-align:center; border-radius:4px; outline:none; flex-shrink:0; padding:0;
}
.wt-size-num:focus { border-color:rgba(46,204,113,0.5); }
.wt-color-wrap { position:relative; display:flex; align-items:center; flex-shrink:0; }
.wt-color-btn {
  width:28px; height:28px; border-radius:4px; border:1px solid rgba(255,255,255,0.1);
  background:rgba(255,255,255,0.06); display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:1px; cursor:pointer; transition:border-color 0.1s; overflow:hidden;
}
.wt-color-btn:hover { border-color:rgba(255,255,255,0.28); }
.wt-color-letter { font-family:'Sora',sans-serif; font-weight:800; font-size:0.68rem; color:#fff; line-height:1; }
.wt-color-swatch { width:16px; height:4px; border-radius:2px; }
.wt-color-btn input[type=color] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
#wtSelInfo { font-size:0.62rem; color:rgba(255,255,255,0.25); font-family:monospace; background:rgba(255,255,255,0.04); padding:2px 7px; border-radius:4px; flex-shrink:0; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-left:auto; }
/* Bubble contextuelle flottante */
#wtBubble {
  position:fixed; background:#16162a; border:1px solid rgba(255,255,255,0.15);
  border-radius:7px; padding:4px 7px; display:none; align-items:center; gap:2px;
  box-shadow:0 8px 28px rgba(0,0,0,0.55); z-index:99999; user-select:none;
  backdrop-filter:blur(10px); pointer-events:all;
}
#wtBubble.wt-visible { display:flex; }
#wtBubble .wt-btn { width:25px; height:25px; font-size:0.72rem; }
#wtBubble .wt-btn svg { width:11px; height:11px; }
#wtBubble .wt-sep { height:16px; margin:0 3px; }

.admin-quicklink {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  background: var(--gris-100);
  border: 1.5px solid var(--gris-200);
  border-radius: 10px;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--gris-700);
  font-family: 'DM Sans', sans-serif;
  transition: all 0.18s;
  text-align: left;
}
.admin-quicklink:hover {
  border-color: var(--vert-principal);
  background: var(--vert-clair);
  color: var(--vert-fonce);
  transform: translateY(-1px);
  box-shadow: var(--shadow-sm);
}
.admin-quicklink span:first-child { font-size: 1.1rem; flex-shrink: 0; }


/* â•â•â• FILE 2 CSS (Marketplace Mobile) â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --vp:#4A9E2A; --vf:#2A5E10; --vc:#E6F4EC; --va:#30D06E;
  --or:#D4A843; --or-bg:#FEF7E7;
  --w:#FFFFFF; --bg:#F5F7F5; --bg2:#EBF0EB;
  --g50:#F8FAF8; --g100:#EFF1EF; --g200:#DDE0DC;
  --g400:#8A9388; --g600:#5A6358; --g700:#3A4238; --g900:#161A16;
  --err:#C0392B; --ok:#219150; --info:#1F6DAB;
  --sh1:0 1px 6px rgba(0,0,0,0.08); --sh2:0 4px 20px rgba(0,0,0,0.12); --sh3:0 12px 48px rgba(0,0,0,0.18);
  --r:12px; --rsm:8px; --rlg:18px;
  --ease:cubic-bezier(0.4,0,0.2,1); --tr:0.2s var(--ease);
  --nav-h:62px; --topbar-h:56px;
  --safe-bottom:env(safe-area-inset-bottom, 0px);
  --safe-top:env(safe-area-inset-top, 0px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME SOMBRE (Dark)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
[data-theme="dark"] {
  --w:#1A1C1A; --bg:#0D0F0D; --bg2:#141614;
  --g50:#1E201E; --g100:#252725; --g200:#2E302E;
  --g400:#7A8278; --g600:#A0A89E; --g700:#C8D0C6; --g900:#E8EDE6;
  --sh1:0 1px 6px rgba(0,0,0,0.35); --sh2:0 4px 20px rgba(0,0,0,0.45); --sh3:0 12px 48px rgba(0,0,0,0.6);
}
[data-theme="dark"] body { background:#0D0F0D; color:#E8EDE6; }
[data-theme="dark"] .hero-banner { background:linear-gradient(135deg,#1D5C2E,#2A5E10) !important; }
[data-theme="dark"] .card { background:#1A1C1A; border-color:#2E302E; }
[data-theme="dark"] .topbar { background:#1A1C1A !important; border-color:#252725 !important; }
[data-theme="dark"] .bottomnav { background:#1A1C1A !important; border-color:#252725 !important; }
[data-theme="dark"] .menu-group { border-color:#252725 !important; }
[data-theme="dark"] .menu-item { background:#1A1C1A; border-color:#252725; }
[data-theme="dark"] .menu-item:active { background:#252725; }
[data-theme="dark"] .menu-icon { background:#252725 !important; }
[data-theme="dark"] .form-input,
[data-theme="dark"] .form-select { background:#252725; border-color:#2E302E; color:#E8EDE6; }
[data-theme="dark"] .sheet { background:#1A1C1A !important; }
[data-theme="dark"] .wallet-hero { background:linear-gradient(135deg,#1D5C2E,#155E3A) !important; }
[data-theme="dark"] .smart-hero { background:linear-gradient(135deg,#0A2818,#0D3D22) !important; }
[data-theme="dark"] .plan-card { background:#1A1C1A; border-color:#2E302E; }
[data-theme="dark"] .ia-textarea { background:#252725; border-color:#2E302E; color:#E8EDE6; }
[data-theme="dark"] .filter-chip { background:#252725; border-color:#2E302E; color:#C8D0C6; }
[data-theme="dark"] .filter-chip.active { background:rgba(74,158,42,0.25); border-color:#4A9E2A; color:#30D06E; }
[data-theme="dark"] .logo-name { color:#E8EDE6 !important; }
[data-theme="dark"] .menu-info h4 { color:#E8EDE6; }
[data-theme="dark"] .menu-info p { color:#7A8278; }
[data-theme="dark"] .nav-label { color:#7A8278 !important; }
[data-theme="dark"] .nav-item.active .nav-label { color:#30D06E !important; }
[data-theme="dark"] .nav-item svg { stroke:#7A8278 !important; }
[data-theme="dark"] .nav-item.active svg { stroke:#4A9E2A !important; }
[data-theme="dark"] .cards-list .card-title { color:#E8EDE6; }
[data-theme="dark"] .card-meta { color:#7A8278; }
[data-theme="dark"] .wallet-card-row { background:rgba(255,255,255,0.06); }
[data-theme="dark"] .cmd-card { background:#1A1C1A; border-color:#2E302E; }
[data-theme="dark"] .doc-card { background:#1A1C1A; border-color:#2E302E; }
[data-theme="dark"] .order-step { background:#252725; }
[data-theme="dark"] .menu-group-title { color:#7A8278; }
[data-theme="dark"] .topbar-search { background:#252725; border-color:#2E302E; }
[data-theme="dark"] .topbar-search input { background:transparent; color:#E8EDE6; }
[data-theme="dark"] .hero-name { color:#E8EDE6 !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME BLEU MARINE (Navy)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
[data-theme="blue"] {
  --w:#2C3E50; --bg:#1E2C3A; --bg2:#253444;
  --g50:#253444; --g100:#2E3F52; --g200:#384D62;
  --g400:#7A9BB5; --g600:#A8C0D4; --g700:#C8DCE8; --g900:#EAF2F8;
  --sh1:0 1px 6px rgba(0,0,0,0.3); --sh2:0 4px 20px rgba(0,0,0,0.4); --sh3:0 12px 48px rgba(0,0,0,0.55);
}
[data-theme="blue"] body { background:#1E2C3A; color:#EAF2F8; }
[data-theme="blue"] .hero-banner { background:linear-gradient(135deg,#2A5E10,#1A5276) !important; }
[data-theme="blue"] .card { background:#2C3E50; border-color:#384D62; }
[data-theme="blue"] .topbar { background:#2C3E50 !important; border-color:#384D62 !important; }
[data-theme="blue"] .bottomnav { background:#253444 !important; border-color:#384D62 !important; }
[data-theme="blue"] .menu-group { border-color:#384D62 !important; }
[data-theme="blue"] .menu-item { background:#2C3E50; border-color:#384D62; }
[data-theme="blue"] .menu-item:active { background:#2E3F52; }
[data-theme="blue"] .menu-icon { background:#2E3F52 !important; }
[data-theme="blue"] .form-input,
[data-theme="blue"] .form-select { background:#2E3F52; border-color:#384D62; color:#EAF2F8; }
[data-theme="blue"] .sheet { background:#2C3E50 !important; }
[data-theme="blue"] .wallet-hero { background:linear-gradient(135deg,#1A5276,#2471A3) !important; }
[data-theme="blue"] .smart-hero { background:linear-gradient(135deg,#0D3D52,#1A5E7A) !important; }
[data-theme="blue"] .plan-card { background:#2C3E50; border-color:#384D62; }
[data-theme="blue"] .ia-textarea { background:#2E3F52; border-color:#384D62; color:#EAF2F8; }
[data-theme="blue"] .filter-chip { background:#2E3F52; border-color:#384D62; color:#C8DCE8; }
[data-theme="blue"] .filter-chip.active { background:rgba(74,158,42,0.25); border-color:#4A9E2A; color:#30D06E; }
[data-theme="blue"] .logo-name { color:#EAF2F8 !important; }
[data-theme="blue"] .menu-info h4 { color:#EAF2F8; }
[data-theme="blue"] .menu-info p { color:#7A9BB5; }
[data-theme="blue"] .nav-label { color:#7A9BB5 !important; }
[data-theme="blue"] .nav-item.active .nav-label { color:#30D06E !important; }
[data-theme="blue"] .nav-item svg { stroke:#7A9BB5 !important; }
[data-theme="blue"] .nav-item.active svg { stroke:#4A9E2A !important; }
[data-theme="blue"] .cards-list .card-title { color:#EAF2F8; }
[data-theme="blue"] .card-meta { color:#7A9BB5; }
[data-theme="blue"] .wallet-card-row { background:rgba(255,255,255,0.08); }
[data-theme="blue"] .cmd-card { background:#2C3E50; border-color:#384D62; }
[data-theme="blue"] .doc-card { background:#2C3E50; border-color:#384D62; }
[data-theme="blue"] .order-step { background:#2E3F52; }
[data-theme="blue"] .menu-group-title { color:#7A9BB5; }
[data-theme="blue"] .topbar-search { background:#2E3F52; border-color:#384D62; }
[data-theme="blue"] .topbar-search input { background:transparent; color:#EAF2F8; }
[data-theme="blue"] .hero-name { color:#EAF2F8 !important; }

/* Transition douce entre thÃ¨mes */
.phone, .screen, .bottomnav, .topbar, .card, .menu-item, .menu-group, .sheet {
  transition: background-color 0.28s ease, border-color 0.28s ease, color 0.28s ease;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SMART IA â€” THÃˆME SOMBRE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
[data-theme="dark"] #screen-smart { background:#0D0F0D !important; }
[data-theme="dark"] .smart-stat-card { background:#1A1C1A; border-color:#2E302E; }
[data-theme="dark"] .smart-stat-val { color:#E8EDE6; }
[data-theme="dark"] .smart-stat-lbl { color:#7A8278; }
[data-theme="dark"] .smart-section-title { color:#E8EDE6; }
[data-theme="dark"] .smart-section-title span { color:#7A8278; }
[data-theme="dark"] .ia-credits-bar { background:#1A2A1A; border-color:rgba(74,158,42,0.25); }
[data-theme="dark"] .ia-credits-label { color:#7A8278; }
[data-theme="dark"] .ia-credits-track { background:#252725; }
[data-theme="dark"] .market-alert.up { background:rgba(46,204,113,0.06); }
[data-theme="dark"] .market-alert.down { background:rgba(192,57,43,0.06); }
[data-theme="dark"] .market-alert.neutral { background:rgba(212,168,67,0.06); }
[data-theme="dark"] .market-alert-title { color:#E8EDE6; }
[data-theme="dark"] .market-alert-desc { color:#7A8278; }
[data-theme="dark"] .ai-feature-card { background:#1A1C1A; border-color:#2E302E; }
[data-theme="dark"] .ai-feature-card:hover { border-color:#4A9E2A; }
[data-theme="dark"] .ai-feature-card-title { color:#E8EDE6; }
[data-theme="dark"] .ai-feature-card-desc { color:#7A8278; }
[data-theme="dark"] .ai-feature-card-icon.green { background:rgba(74,158,42,0.18); }
[data-theme="dark"] .ai-feature-card-icon.blue { background:rgba(31,109,171,0.18); }
[data-theme="dark"] .ai-feature-card-icon.gold { background:rgba(212,168,67,0.18); }
[data-theme="dark"] .ai-feature-card-icon.red { background:rgba(192,57,43,0.18); }
[data-theme="dark"] .plan-card { background:#1A1C1A !important; border-color:#2E302E !important; }
[data-theme="dark"] .plan-feature { color:#C8D0C6; }
[data-theme="dark"] .plan-feature.included { color:#30D06E; }
[data-theme="dark"] .plan-feature.locked { color:#7A8278; }
[data-theme="dark"] .plan-feature.locked .plan-feature-dot { background:#2E302E; }
[data-theme="dark"] .plan-name { color:#E8EDE6; }
[data-theme="dark"] .smart-plan-pill { background:rgba(255,255,255,0.12); border-color:rgba(255,255,255,0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SMART IA â€” THÃˆME BLEU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
[data-theme="blue"] #screen-smart { background:#1E2C3A !important; }
[data-theme="blue"] .smart-stat-card { background:#2C3E50; border-color:#384D62; }
[data-theme="blue"] .smart-stat-val { color:#EAF2F8; }
[data-theme="blue"] .smart-stat-lbl { color:#7A9BB5; }
[data-theme="blue"] .smart-section-title { color:#EAF2F8; }
[data-theme="blue"] .smart-section-title span { color:#7A9BB5; }
[data-theme="blue"] .ia-credits-bar { background:#1E3A2C; border-color:rgba(74,158,42,0.25); }
[data-theme="blue"] .ia-credits-label { color:#7A9BB5; }
[data-theme="blue"] .ia-credits-track { background:#2E3F52; }
[data-theme="blue"] .market-alert.up { background:rgba(46,204,113,0.07); }
[data-theme="blue"] .market-alert.down { background:rgba(192,57,43,0.07); }
[data-theme="blue"] .market-alert.neutral { background:rgba(212,168,67,0.07); }
[data-theme="blue"] .market-alert-title { color:#EAF2F8; }
[data-theme="blue"] .market-alert-desc { color:#7A9BB5; }
[data-theme="blue"] .ai-feature-card { background:#2C3E50; border-color:#384D62; }
[data-theme="blue"] .ai-feature-card:hover { border-color:#4A9E2A; }
[data-theme="blue"] .ai-feature-card-title { color:#EAF2F8; }
[data-theme="blue"] .ai-feature-card-desc { color:#7A9BB5; }
[data-theme="blue"] .ai-feature-card-icon.green { background:rgba(74,158,42,0.2); }
[data-theme="blue"] .ai-feature-card-icon.blue { background:rgba(36,113,163,0.2); }
[data-theme="blue"] .ai-feature-card-icon.gold { background:rgba(212,168,67,0.2); }
[data-theme="blue"] .ai-feature-card-icon.red { background:rgba(192,57,43,0.2); }
[data-theme="blue"] .plan-card { background:#2C3E50 !important; border-color:#384D62 !important; }
[data-theme="blue"] .plan-feature { color:#C8DCE8; }
[data-theme="blue"] .plan-feature.included { color:#30D06E; }
[data-theme="blue"] .plan-feature.locked { color:#7A9BB5; }
[data-theme="blue"] .plan-feature.locked .plan-feature-dot { background:#384D62; }
[data-theme="blue"] .plan-name { color:#EAF2F8; }
[data-theme="blue"] .smart-plan-pill { background:rgba(255,255,255,0.12); border-color:rgba(255,255,255,0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
/* html,body rules scoped to marche-mode */
/* body base scoped to marche-mode */
h1,h2,h3,h4,.sora{font-family:'Sora',sans-serif;}
button{cursor:pointer;font-family:inherit;border:none;background:none;-webkit-tap-highlight-color:transparent;}
input,select,textarea{font-family:'DM Sans',sans-serif;}
img{display:block;max-width:100%;}
a{text-decoration:none;color:inherit;}



/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PHONE SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.phone{
  width:100%;
  max-width:390px;
  height:100dvh;
  max-height:844px;
  background:var(--bg);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
  box-shadow:var(--sh3);
  /* FIX v17 â€” containing block pour position:fixed enfants */
  isolation:isolate;
  transform:translateZ(0);
  will-change:transform;
}
@media(min-width:500px){
  .phone{border-radius:44px;height:calc(100dvh - 32px);max-height:812px;}
  body{background:#111;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS â€” empilage SPA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screens{
  flex:1;
  overflow:hidden;
  position:relative;
  /* FIX v17 â€” laisser la place Ã  la navbar fixe */
  height:calc(100% - var(--nav-h));
}
.screen{
  position:absolute;
  inset:0;
  overflow-y:auto;
  overflow-x:hidden;
  overscroll-behavior-y:contain;
  background:var(--bg);
  display:none;
  flex-direction:column;
  padding-bottom:calc(var(--nav-h) + 8px);
}
.screen.active{display:flex;}
.screen-slide{
  transform:translateX(100%);
  transition:transform 0.28s var(--ease);
}
.screen-slide.in{transform:none;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN-ORDER â€” Plein Ã©cran immersif
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-order{
  padding-bottom: 0 !important;
  background: var(--blanc) !important;
  position: fixed !important;
  inset: 0 !important;
  z-index: 600 !important;
  transform: translateY(100%);
  opacity: 0;
  transition: transform 0.42s cubic-bezier(0.22,1,0.36,1), opacity 0.3s ease;
}
#screen-order.active {
  display: flex !important;
  transform: translateY(0);
  opacity: 1;
}
#screen-order.screen-slide{
  transform: translateY(100%) scale(0.97);
  opacity: 0;
  transition: transform 0.38s cubic-bezier(0.22, 1, 0.36, 1),
              opacity 0.28s ease,
              scale 0.38s cubic-bezier(0.22, 1, 0.36, 1);
  border-radius: 24px 24px 0 0;
  overflow: hidden;
}
#screen-order.screen-slide.in{
  transform: translateY(0) scale(1);
  opacity: 1;
  border-radius: 0;
}

/* Topbar order : plus grande */
#screen-order .topbar{
  height: 60px;
  min-height: 60px;
  padding: 0 20px;
  border-bottom: none;
  background: linear-gradient(135deg, var(--vert-fonce) 0%, var(--vert-principal) 100%);
}
#screen-order .topbar-title{
  font-family: 'Sora', sans-serif;
  font-size: 1.15rem !important;
  font-weight: 700;
  color: #fff !important;
  flex: 1;
  text-align: center;
}
#screen-order .topbar-back svg{
  stroke: #fff;
  width: 24px; height: 24px;
}

/* Progress steps */
.order-steps-bar{
  display: flex;
  margin: 0;
  gap: 0;
  height: 5px;
  background: rgba(255,255,255,0.2);
}
.ostep{
  flex: 1;
  height: 5px;
  border-radius: 0;
  background: rgba(255,255,255,0.25);
  transition: background 0.4s;
}
.ostep.active{ background: rgba(255,255,255,0.9); }
.ostep.done{   background: #fff; }

/* Content padding agrandi */
.step-content{
  padding: 28px 22px 16px;
}
.step-title{
  font-family: 'Sora', sans-serif;
  font-weight: 800;
  font-size: 1.45rem !important;
  color: var(--gris-900);
  margin-bottom: 6px;
  letter-spacing: -0.3px;
}
.step-sub{
  font-size: 0.92rem !important;
  color: var(--gris-400);
  margin-bottom: 22px;
  line-height: 1.5;
}

/* RÃ©sumÃ© commande â€” plus aÃ©rÃ© */
.order-summary{
  background: var(--gris-100);
  border-radius: 16px;
  padding: 18px 20px;
  margin-bottom: 20px;
  border: 1px solid var(--gris-200);
}
.os-row{
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  font-size: 0.97rem !important;
  gap: 12px;
}
.os-row:not(:last-child){ border-bottom: 1px solid var(--gris-200); }
.os-row.total{
  font-family: 'Sora', sans-serif;
  font-weight: 800;
  color: var(--gris-900);
  font-size: 1.15rem !important;
  padding-top: 14px;
}
.os-row.comm{
  font-size: 0.88rem !important;
  color: var(--gris-400);
}
.os-row.comm span:last-child{ color: var(--vert-principal); font-weight: 700; }

/* Labels couleur dans le rÃ©sumÃ© */
#screen-order .os-row span[style*="g400"]{
  font-size: 0.88rem;
}

/* MÃ©thodes de paiement â€” plus grandes */
.pay-method{
  padding: 18px 18px;
  border: 2px solid var(--gris-200);
  border-radius: 16px;
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: all var(--tr);
}
.pay-method.sel{
  border-color: var(--vert-principal);
  background: #fff;
  box-shadow: 0 0 0 3px rgba(74,158,42,0.12);
}
.pay-method-icon{
  width: 52px; height: 52px;
  border-radius: 14px;
  background: var(--gris-100);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.6rem;
  flex-shrink: 0;
}
.pay-method h4{
  font-size: 1rem !important;
  font-weight: 700;
  color: var(--gris-900);
}
.pay-method p{
  font-size: 0.82rem !important;
  color: var(--gris-400);
  margin-top: 2px;
}

/* Note escrow */
.escrow-note{
  background: rgba(74,158,42,0.07);
  border: 1.5px solid rgba(74,158,42,0.2);
  border-radius: 16px;
  padding: 16px 18px;
  font-size: 0.9rem !important;
  color: var(--vert-fonce);
  line-height: 1.65;
  margin-top: 14px;
}
.escrow-note strong{
  display: block;
  font-size: 1rem;
  margin-bottom: 5px;
}

/* Inputs dans le tunnel */
#screen-order .form-row{ margin-bottom: 18px; }
#screen-order .form-label{
  font-size: 0.88rem !important;
  font-weight: 700;
  color: var(--gris-700);
  margin-bottom: 8px;
}
#screen-order .form-input{
  height: 52px !important;
  font-size: 1rem !important;
  border-radius: 14px !important;
  padding: 0 16px !important;
}

/* Footer sticky â€” bouton plein Ã©cran */
.step-footer{
  padding: 16px 22px calc(16px + env(safe-area-inset-bottom));
  background: var(--blanc);
  border-top: 1px solid var(--gris-100);
  display: flex;
  gap: 12px;
  flex-shrink: 0;
  position: sticky;
  bottom: 0;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.06);
}
#screen-order .btn.btn-primary{
  height: 56px !important;
  font-size: 1.05rem !important;
  border-radius: 16px !important;
  letter-spacing: 0.2px;
}
#screen-order .btn.btn-ghost{
  height: 56px !important;
  font-size: 0.95rem !important;
  border-radius: 16px !important;
  min-width: 90px;
}

/* Ã‰cran succÃ¨s */
.success-screen{
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px 28px;
  text-align: center;
}
.success-icon{ font-size: 5.5rem; margin-bottom: 24px; }
.success-screen h2{
  font-family: 'Sora', sans-serif;
  font-weight: 800;
  font-size: 1.6rem !important;
  color: var(--gris-900);
  margin-bottom: 12px;
}
.success-screen p{
  font-size: 1rem !important;
  color: var(--gris-700);
  line-height: 1.7;
  max-width: 300px;
  margin: 0 auto;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOP BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar{
  height:var(--topbar-h);
  min-height:var(--topbar-h);
  background:var(--w);
  border-bottom:1px solid var(--g100);
  display:flex;
  align-items:center;
  padding:0 16px;
  gap:12px;
  flex-shrink:0;
  position:sticky;
  top:0;
  z-index:10;
}
.topbar-logo{display:flex;align-items:center;gap:8px;}
.logo-mark{width:30px;height:30px;background:var(--vp);border-radius:8px;display:flex;align-items:center;justify-content:center;}
.logo-mark span{font-family:'Sora',sans-serif;font-weight:800;font-size:0.62rem;color:#fff;letter-spacing:0.3px;}
.logo-name{font-family:'Sora',sans-serif;font-weight:700;font-size:0.95rem;color:var(--g900);}
.topbar-search{
  flex:1;
  height:36px;
  background:var(--g100);
  border-radius:10px;
  display:flex;
  align-items:center;
  gap:8px;
  padding:0 12px;
}
.topbar-search input{
  flex:1;
  background:none;
  border:none;
  outline:none;
  font-size:0.82rem;
  color:var(--g900);
}
.topbar-search input::placeholder{color:var(--g400);}
.topbar-search svg{width:15px;height:15px;stroke:var(--g400);fill:none;stroke-width:2;flex-shrink:0;}
.topbar-icon{
  width:38px;height:38px;border-radius:10px;
  background:var(--g100);
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;position:relative;
}
.topbar-icon svg{width:18px;height:18px;stroke:var(--g700);fill:none;stroke-width:2;}
.notif-dot{
  position:absolute;top:6px;right:6px;
  width:8px;height:8px;background:var(--err);
  border-radius:50%;border:1.5px solid var(--w);
}
.topbar-back{
  width:36px;height:36px;border-radius:10px;
  background:var(--g100);
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
}
.topbar-back svg{width:18px;height:18px;stroke:var(--g900);fill:none;stroke-width:2.5;}
.topbar-title{font-family:'Sora',sans-serif;font-weight:700;font-size:0.95rem;flex:1;}
.topbar-action{font-size:0.8rem;font-weight:600;color:var(--vp);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottomnav{
  height:var(--nav-h);
  min-height:var(--nav-h);
  background:var(--w);
  border-top:1px solid var(--g100);
  display:flex;
  align-items:stretch;
  padding-bottom:var(--safe-bottom);
  flex-shrink:0;
  /* FIX v17 â€” fixed dans le containing block du .phone */
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  z-index:200;
}
.nav-item{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:3px;
  padding:8px 4px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  position:relative;
  transition:all var(--tr);
}

/* â”€â”€ Animation zoom au clic sur nav-item â”€â”€ */
@keyframes navItemZoom {
  0%   { transform: scale(1); }
  35%  { transform: scale(1.35); }
  60%  { transform: scale(0.92); }
  80%  { transform: scale(1.08); }
  100% { transform: scale(1); }
}
.nav-item.nav-zoom-anim {
  animation: navItemZoom 0.42s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}
.nav-item.nav-zoom-anim svg {
  filter: drop-shadow(0 0 6px rgba(74,158,42,0.55));
}
.nav-item svg{width:20px;height:20px;stroke:var(--g400);fill:none;stroke-width:1.8;transition:stroke var(--tr);}
.nav-label{font-size:0.70rem;font-weight:600;color:var(--g400);transition:color var(--tr);white-space:nowrap;}
.nav-item.active svg{stroke:var(--vp);}
.nav-item.active .nav-label{color:var(--vp);}
.nav-badge{
  position:absolute;top:6px;right:calc(50% - 14px);
  background:var(--err);color:#fff;
  font-size:0.68rem;font-weight:700;
  padding:1px 4px;border-radius:6px;
  min-width:14px;text-align:center;
  border:1.5px solid var(--w);
}

/* â”€â”€ Mode Visiteur â€” UI â”€â”€ */
body.visitor-mode .nav-item[data-visitor-locked] {
  opacity: 0.35;
  pointer-events: auto; /* garder les clics pour afficher popup */
}
body.visitor-mode .nav-item[data-visitor-locked] .nav-label::after {
  content: ' ğŸ”’';
  font-size: 0.45rem;
}
#visitor-market-notice {
  background: linear-gradient(135deg, rgba(74,158,42,0.10), rgba(13,74,43,0.07));
  border: 1.5px dashed rgba(74,158,42,0.35);
  border-radius: 14px;
  margin: 0 12px 10px;
  padding: 13px 15px;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  font-size: 0.78rem;
  color: #2E7D32;
  box-shadow: 0 2px 12px rgba(74,158,42,0.08);
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN : MARCHÃ‰ (HOME)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero-banner{
  background:linear-gradient(135deg,#1A6635,#4FAB2D);
  padding:18px 16px 20px;
  flex-shrink:0;
}
.hero-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.hero-greeting{color:rgba(255,255,255,0.75);font-size:0.78rem;}
.hero-name{font-family:'Sora',sans-serif;font-weight:700;font-size:1.05rem;color:#fff;}
.hero-profil{
  display:inline-flex;align-items:center;gap:5px;
  margin-top:5px;
  background:rgba(255,255,255,0.15);
  border:1px solid rgba(255,255,255,0.25);
  border-radius:20px;
  padding:3px 10px;
  font-size:0.68rem;font-weight:600;
  color:rgba(255,255,255,0.9);
  letter-spacing:0.3px;
  backdrop-filter:blur(6px);
}
.hero-profil-dot{
  width:6px;height:6px;border-radius:50%;
  background:var(--va);flex-shrink:0;
}
.wallet-pill{
  background:rgba(255,255,255,0.15);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:20px;
  padding:6px 12px;
  display:flex;align-items:center;gap:6px;
  backdrop-filter:blur(8px);
}
.wallet-pill svg{width:13px;height:13px;stroke:#fff;fill:none;stroke-width:2;}
.wallet-pill span{font-family:'JetBrains Mono',monospace;font-size:0.8rem;font-weight:600;color:#fff;}
.hero-search{
  height:42px;
  background:#ffffff;
  border:1px solid rgba(255,255,255,0.9);
  border-radius:12px;
  display:flex;
  align-items:center;
  gap:10px;
  padding:0 14px;
  box-shadow:0 2px 10px rgba(0,0,0,0.12);
}
.hero-search input{
  flex:1;background:none;border:none;outline:none;
  font-size:0.85rem;color:var(--gris-900);
}
.hero-search input::placeholder{color:var(--gris-400);}
.hero-search svg{width:16px;height:16px;stroke:var(--vert-principal);fill:none;stroke-width:2;}

/* Chips horizontaux */
.chips-scroll{
  overflow:hidden;
  flex-shrink:0;
  background:var(--w);
  border-bottom:1px solid var(--g100);
  position:relative;
  padding:10px 0;
}
/* Fondu sur les bords */
.chips-scroll::before,.chips-scroll::after{
  content:'';position:absolute;top:0;bottom:0;width:32px;z-index:2;pointer-events:none;
}
.chips-scroll::before{left:0;background:linear-gradient(to right,var(--w),transparent);}
.chips-scroll::after{right:0;background:linear-gradient(to left,var(--w),transparent);}
.chips-track{
  display:inline-flex;gap:8px;
  white-space:nowrap;
  animation:chipsScroll 22s linear infinite;
  padding:0 16px;
}
.chips-track:hover{animation-play-state:paused;}
@keyframes chipsScroll{
  0%{transform:translateX(0);}
  100%{transform:translateX(-50%);}
}

/* Ticker catÃ©gories â€” pages secondaires */
.chips-ticker-bar {
  overflow: hidden;
  flex-shrink: 0;
  background: var(--w);
  border-bottom: 1px solid var(--g100);
  position: relative;
  padding: 10px 0;
}
.chips-ticker-bar::before,.chips-ticker-bar::after{
  content:'';position:absolute;top:0;bottom:0;width:32px;z-index:2;pointer-events:none;
}
.chips-ticker-bar::before{left:0;background:linear-gradient(to right,var(--w),transparent);}
.chips-ticker-bar::after{right:0;background:linear-gradient(to left,var(--w),transparent);}
.chips-ticker-track {
  display: inline-flex; gap: 8px;
  white-space: nowrap;
  animation: chipsScroll 22s linear infinite;
  padding: 0 16px;
}
.chips-ticker-track:hover { animation-play-state: paused; }
.chip-ticker-item {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 7px 14px;
  border-radius: 20px;
  font-size: 0.78rem; font-weight: 600;
  white-space: nowrap;
  border: 1.5px solid var(--g200);
  background: var(--w); color: var(--g700);
  flex-shrink: 0;
}
.chip{
  display:inline-flex;align-items:center;gap:5px;
  padding:7px 14px;
  border-radius:20px;
  font-size:0.78rem;font-weight:600;
  white-space:nowrap;cursor:pointer;
  border:1.5px solid var(--g200);
  background:var(--w);color:var(--g700);
  transition:all var(--tr);
  flex-shrink:0;
}
.chip.active{background:var(--vp);color:#fff;border-color:var(--vp);}

/* Stats row */
.stats-row{
  display:grid;grid-template-columns:repeat(4,1fr);
  gap:0;background:var(--vf);
  flex-shrink:0;
}
.stat-cell{
  padding:7px 4px;
  text-align:center;
  border-right:1px solid rgba(255,255,255,0.08);
}
.stat-cell:last-child{border-right:none;}
.stat-num{font-family:'Sora',sans-serif;font-weight:700;font-size:0.78rem;color:#fff;}
.stat-lbl{font-size:0.68rem;color:rgba(255,255,255,0.55);margin-top:1px;line-height:1.2;}

/* Section header */
.section-hd{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px 10px;
  flex-shrink:0;
}
.section-hd h2{font-family:'Sora',sans-serif;font-size:0.95rem;font-weight:700;color:var(--g900);}
.section-hd a{font-size:0.78rem;color:var(--vp);font-weight:700;}

/* CARD PRODUIT */
.cards-list{
  display:flex;flex-direction:column;gap:10px;
  padding:0 12px;
}
.card{
  background:var(--w);
  border-radius:var(--r);
  overflow:hidden;
  box-shadow:var(--sh1);
  display:flex;
  flex-direction:row;
  min-height:108px;
  cursor:pointer;
  border:1px solid var(--g100);
  transition:transform var(--tr);
  -webkit-tap-highlight-color:transparent;
}
.card:active{transform:scale(0.98);}
.card-thumb{
  width:100px;flex-shrink:0;
  position:relative;
  background:var(--g100);
  overflow:hidden;
}
.card-thumb img{width:100%;height:100%;object-fit:cover;}
.badge-cat{
  position:absolute;bottom:0;left:0;right:0;
  background:rgba(0,0,0,0.5);
  color:#fff;font-size:0.70rem;font-weight:600;
  padding:3px 6px;backdrop-filter:blur(4px);
  text-align:center;
}
.badge-v{
  position:absolute;top:6px;left:6px;
  background:var(--vp);color:#fff;
  font-size:0.68rem;font-weight:700;
  padding:2px 5px;border-radius:3px;
}
.card-info{
  flex:1;padding:10px 12px 10px;
  display:flex;flex-direction:column;gap:3px;
  min-width:0;overflow:hidden;
}
.card-name{
  font-family:'Sora',sans-serif;font-size:0.82rem;font-weight:700;
  color:var(--g900);line-height:1.25;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.card-seller{font-size:0.78rem;color:var(--g400);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.card-loc{font-size:0.75rem;color:var(--g400);display:flex;align-items:center;gap:3px;}
.card-loc svg{width:10px;height:10px;stroke:currentColor;fill:none;stroke-width:2;flex-shrink:0;}
.card-row{display:flex;align-items:center;justify-content:space-between;margin-top:auto;}
.card-price{font-family:'JetBrains Mono',monospace;font-size:0.85rem;font-weight:700;color:var(--vp);}
.card-price.on-quote{font-family:'DM Sans',sans-serif;font-size:0.72rem;font-weight:500;color:var(--g400);font-style:italic;}
.card-rating{font-size:0.75rem;color:var(--g400);display:flex;align-items:center;gap:2px;}
.card-rating .star{color:var(--or);}
.card-escrow{
  font-size:0.6rem;font-weight:600;
  color:var(--vp);background:var(--vc);
  padding:2px 6px;border-radius:4px;
  display:inline-flex;align-items:center;gap:3px;
  margin-top:3px;width:fit-content;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SYSTÃˆME VENDEUR â€” RÃ´les & Publication
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card-mine-badge {
  position:absolute; top:6px; right:6px;
  background:linear-gradient(135deg,#D4A843,#B8860B);
  color:#fff; font-size:0.52rem; font-weight:800;
  padding:3px 7px; border-radius:5px;
  letter-spacing:0.3px; text-transform:uppercase;
  font-family:'Sora',sans-serif;
  box-shadow:0 2px 8px rgba(212,168,67,0.4);
}
.card-seller-actions { display:flex; gap:6px; margin-top:5px; }
.card-seller-btn {
  flex:1; padding:5px 4px; border-radius:8px;
  font-size:0.63rem; font-weight:700; font-family:'DM Sans',sans-serif;
  cursor:pointer; border:none; transition:all 0.18s;
  display:flex; align-items:center; justify-content:center; gap:3px;
}
.card-seller-btn.edit  { background:#EDF7E5; color:#4A9E2A; border:1.5px solid #4A9E2A; }
.card-seller-btn.pause { background:#FFF5E8; color:#D4A843; border:1.5px solid #D4A843; }
.card-seller-btn.del   { background:#FFF0F0; color:#C0392B; border:1.5px solid rgba(192,57,43,0.25); }
.card-seller-btn:active { transform:scale(0.96); }


.hero-seller-banner {
  margin-top:10px;
  background:rgba(212,168,67,0.18);
  border:1px solid rgba(212,168,67,0.45);
  border-radius:12px; padding:10px 14px;
  display:flex; align-items:center; gap:10px;
  cursor:pointer; transition:transform 0.18s;
}
.hero-seller-banner:active { transform:scale(0.98); }
/* BanniÃ¨re acheteur â€” variante bleue/dorÃ©e */
.hero-buyer-banner {
  margin-top:10px;
  background:linear-gradient(135deg,rgba(26,92,138,0.22),rgba(74,158,42,0.15));
  border:1px solid rgba(26,92,138,0.35);
  border-radius:12px; padding:10px 14px;
  display:flex; align-items:center; gap:10px;
  cursor:pointer; transition:transform 0.18s;
}
.hero-buyer-banner:active { transform:scale(0.98); }
.hero-seller-banner-icon {
  width:38px; height:38px; border-radius:10px;
  background:rgba(212,168,67,0.3);
  display:flex; align-items:center; justify-content:center;
  font-size:1.3rem; flex-shrink:0;
}
.hero-seller-banner-title { font-family:'Sora',sans-serif; font-weight:800; font-size:0.82rem; color:#fff; }
.hero-seller-banner-sub { font-size:0.68rem; color:rgba(255,255,255,0.72); margin-top:1px; }
.hero-seller-banner-cta {
  background:rgba(212,168,67,0.9); color:#fff; border:none;
  border-radius:8px; padding:6px 12px;
  font-family:'Sora',sans-serif; font-weight:700; font-size:0.72rem;
  cursor:pointer; white-space:nowrap; flex-shrink:0;
}
.hero-seller-stats {
  display:grid; grid-template-columns:repeat(3,1fr); gap:6px; margin-top:8px;
}
.hero-seller-stat {
  background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.15);
  border-radius:8px; padding:6px 4px; text-align:center;
}
.hero-seller-stat-val { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:0.8rem; color:#fff; }
.hero-seller-stat-lbl { font-size:0.54rem; color:rgba(255,255,255,0.65); margin-top:1px; }
.pub-step { display:none; }
.pub-step.active { display:block; }
.pub-step-bar { display:flex; gap:5px; margin-bottom:18px; }
.pub-step-dot { flex:1; height:4px; border-radius:4px; background:var(--gris-200); transition:background 0.3s; }
.pub-step-dot.active { background:var(--or-accent); }
.pub-step-dot.done  { background:var(--vert-principal); }
.pub-cat-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-bottom:14px; }
.pub-cat-card {
  border:2px solid var(--gris-200); border-radius:14px;
  padding:14px 10px; text-align:center; cursor:pointer;
  transition:all 0.18s; background:#fff;
}
.pub-cat-card.sel { border-color:var(--or-accent); background:#FFFBF0; box-shadow:0 0 0 3px rgba(212,168,67,0.12); }
.pub-cat-card-icon { font-size:1.5rem; margin-bottom:5px; }
.pub-cat-card-label { font-weight:700; font-size:0.77rem; color:var(--gris-900); }
.pub-preview-card { background:var(--gris-100); border-radius:14px; padding:14px; margin-bottom:14px; border:1.5px solid var(--gris-200); }
.pub-preview-row { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid var(--gris-200); font-size:0.85rem; }
.pub-preview-row:last-child { border-bottom:none; }
.pub-preview-label { color:var(--gris-400); }
.pub-preview-val { font-weight:700; color:var(--gris-900); text-align:right; max-width:58%; }
/* â”€â”€ BOOST & GAINS CSS â”€â”€ */
.boost-option { display:flex; align-items:center; gap:12px; border:2px solid #E5E7EB; border-radius:14px; padding:13px 14px; margin-bottom:10px; cursor:pointer; transition:all .2s; background:#fff; }
.boost-option.sel { border-color:var(--or-accent); background:#FFFBF0; box-shadow:0 0 0 3px rgba(212,168,67,0.1); }
.boost-option__icon { width:42px; height:42px; border-radius:11px; display:flex; align-items:center; justify-content:center; font-size:1.3rem; flex-shrink:0; }
.boost-option__body { flex:1; }
.boost-option__title { font-weight:700; font-size:0.88rem; color:#111; }
.boost-option__desc { font-size:0.72rem; color:#6B7280; margin-top:2px; }
.boost-option__price { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:0.82rem; color:var(--or-accent); white-space:nowrap; }
.card-boost-badge { position:absolute; top:8px; left:8px; background:linear-gradient(135deg,#D4A843,#B8860B); color:#fff; font-size:0.58rem; font-weight:800; font-family:'Sora',sans-serif; padding:3px 8px; border-radius:6px; z-index:2; text-transform:uppercase; letter-spacing:.04em; }
.card-urgent-badge { position:absolute; top:8px; right:8px; background:#E53E3E; color:#fff; font-size:0.58rem; font-weight:800; font-family:'Sora',sans-serif; padding:3px 8px; border-radius:6px; z-index:2; text-transform:uppercase; }
.diff-category { background:#F8FAFB; border:1.5px solid #E5E7EB; border-radius:14px; padding:13px 14px; margin-bottom:9px; cursor:pointer; display:flex; align-items:center; gap:12px; transition:all .2s; }
.diff-category:active { transform:scale(0.97); }
.diff-category__icon { width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.2rem; flex-shrink:0; }
.diff-ai-bubble { background:linear-gradient(135deg,#F4FDE8,#E8F5E9); border:1.5px solid rgba(74,158,42,0.2); border-radius:14px; padding:14px; margin-bottom:10px; font-size:0.82rem; color:#1A4A2B; line-height:1.65; }
.diff-ai-bubble strong { color:var(--vp); }
.gains-stat-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:14px; }
.gains-stat-card { background:linear-gradient(135deg,#F4FDE8,#fff); border:1.5px solid rgba(74,158,42,0.15); border-radius:14px; padding:14px; text-align:center; }
.gains-stat-val { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:1.1rem; color:var(--vp); }
.gains-stat-label { font-size:0.7rem; color:#6B7280; margin-top:3px; }
.mes-offres-section {
  margin:0 12px 8px;
  background:linear-gradient(135deg,#FFFBF0,#FFF5D6);
  border:1.5px solid rgba(212,168,67,0.3);
  border-radius:14px; padding:10px;
}
.mes-offres-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:7px; }
.mes-offres-title { font-family:'Sora',sans-serif; font-weight:800; font-size:0.82rem; color:#7A5A00; }
.mes-offres-badge { background:#D4A843; color:#fff; border-radius:20px; padding:2px 7px; font-size:0.62rem; font-weight:700; }

/* â”€â”€ Barre de raccourcis marchÃ© â”€â”€ */
.market-shortcuts {
  margin: 4px 12px 12px;
  display: grid;
  gap: 8px;
}
.market-shortcuts.cols-2 { grid-template-columns: 1fr 1fr; }
.market-shortcuts.cols-3 { grid-template-columns: 1fr 1fr 1fr; }
.mshortcut {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 5px;
  padding: 12px 8px 11px;
  border-radius: 16px;
  border: none;
  cursor: pointer;
  font-family: 'Sora', sans-serif;
  font-size: 0.72rem;
  font-weight: 800;
  color: #fff;
  letter-spacing: 0.1px;
  transition: transform 0.15s, box-shadow 0.15s;
  -webkit-tap-highlight-color: transparent;
}
.mshortcut:active { transform: scale(0.96); }
.mshortcut__icon { font-size: 1.5rem; line-height: 1; }
.mshortcut.green  { background: linear-gradient(135deg, #4A9E2A, #2A5E10); box-shadow: 0 4px 14px rgba(74,158,42,0.3); }
.mshortcut.gold   { background: linear-gradient(135deg, #D4A843, #B8860B); box-shadow: 0 4px 14px rgba(212,168,67,0.35); }
.mshortcut.blue   { background: linear-gradient(135deg, #1A5C8A, #0D3A5C); box-shadow: 0 4px 14px rgba(26,92,138,0.3); }
.mshortcut.dark   { background: linear-gradient(135deg, #3D4550, #1A1E25); box-shadow: 0 4px 14px rgba(0,0,0,0.2); }
.mshortcut.purple { background: linear-gradient(135deg, #6B3FA0, #4A0E6B); box-shadow: 0 4px 14px rgba(107,63,160,0.3); }

/* SKELETON */
.skeleton{background:linear-gradient(90deg,var(--g100) 25%,var(--g200) 50%,var(--g100) 75%);background-size:200% 100%;animation:shimmer 1.3s infinite;border-radius:6px;}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
.sk-card{background:var(--w);border-radius:var(--r);border:1px solid var(--g100);display:flex;min-height:108px;overflow:hidden;}
.sk-thumb{width:100px;flex-shrink:0;}
.sk-body{flex:1;padding:12px;display:flex;flex-direction:column;gap:8px;justify-content:center;}
.sk-line{height:11px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CAROUSEL PHOTOS â€” DÃ©tail produit
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.detail-carousel {
  position: relative; flex-shrink: 0;
  width: 100%; height: 280px; overflow: hidden;
  background: #1A1E25;
  user-select: none; -webkit-user-select: none;
}
.carousel-track {
  display: flex; height: 100%;
  transition: transform 0.38s cubic-bezier(0.4,0,0.2,1);
  will-change: transform;
}
.carousel-track.no-transition { transition: none; }
.carousel-slide {
  flex: 0 0 100%; height: 100%; position: relative;
}
.carousel-slide img {
  width: 100%; height: 100%; object-fit: cover; display: block;
  pointer-events: none;
}
/* Badges positionnÃ©s sur le carousel */
.carousel-badges {
  position: absolute; bottom: 14px; left: 14px;
  display: flex; gap: 8px; z-index: 3; pointer-events: none;
}
/* Dots indicateurs */
.carousel-dots {
  position: absolute; bottom: 14px; right: 14px;
  display: flex; gap: 6px; align-items: center; z-index: 3;
}
.carousel-dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: rgba(255,255,255,0.45);
  transition: all 0.25s; cursor: pointer;
  border: 1.5px solid rgba(255,255,255,0.3);
}
.carousel-dot.active {
  background: #fff; width: 20px; border-radius: 4px;
  border-color: transparent;
}
/* Compteur photo */
.carousel-counter {
  position: absolute; top: 12px; right: 12px; z-index: 3;
  background: rgba(0,0,0,0.52); backdrop-filter: blur(8px);
  color: #fff; font-family: 'Sora', sans-serif;
  font-size: 0.68rem; font-weight: 700;
  padding: 4px 10px; border-radius: 20px;
  pointer-events: none;
}

/* â”€â”€ Upload photos publication â”€â”€ */
.pub-photos-section {
  margin-bottom: 16px;
}
.pub-photos-label {
  font-size: 0.88rem;
  font-weight: 700;
  color: var(--gris-700);
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.pub-photos-hint {
  font-size: 0.72rem;
  color: var(--gris-400);
  margin-bottom: 10px;
  line-height: 1.4;
}
.pub-photos-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}
.pub-photo-slot {
  position: relative;
  aspect-ratio: 1;
  border-radius: 14px;
  border: 2px dashed var(--gris-200);
  background: var(--gris-100);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  overflow: hidden;
  transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.pub-photo-slot:first-child {
  border-color: rgba(74,158,42,0.35);
  background: rgba(74,158,42,0.04);
}
.pub-photo-slot:hover { border-color: var(--vert-principal); background: var(--vert-clair); }
.pub-photo-slot__icon { font-size: 1.6rem; margin-bottom: 4px; }
.pub-photo-slot__label { font-size: 0.62rem; font-weight: 700; color: var(--gris-400); text-align: center; line-height: 1.2; }
.pub-photo-slot:first-child .pub-photo-slot__label { color: var(--vert-principal); }
.pub-photo-slot__badge {
  position: absolute; top: 6px; left: 6px;
  background: var(--vert-principal); color: #fff;
  font-size: 0.55rem; font-weight: 800;
  padding: 2px 6px; border-radius: 6px;
  font-family: 'Sora', sans-serif;
}
.pub-photo-slot img {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  object-fit: cover;
  border-radius: 12px;
}
.pub-photo-slot__delete {
  position: absolute; top: 5px; right: 5px;
  width: 22px; height: 22px; border-radius: 50%;
  background: rgba(229,62,62,0.9); color: #fff;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.7rem; font-weight: 900;
  cursor: pointer; z-index: 2;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: transform 0.15s;
}
.pub-photo-slot__delete:hover { transform: scale(1.15); }
.pub-photo-slot.has-photo { border-color: var(--vert-principal); border-style: solid; }
  position: absolute; top: 12px; right: 12px; z-index: 3;
  background: rgba(0,0,0,0.52); backdrop-filter: blur(8px);
  color: #fff; font-family: 'Sora', sans-serif;
  font-size: 0.68rem; font-weight: 700;
  padding: 4px 10px; border-radius: 20px;
  pointer-events: none;
}
/* FlÃ¨ches latÃ©rales (apparaissent au touch/hover) */
.carousel-arrow {
  position: absolute; top: 50%; transform: translateY(-50%);
  z-index: 4; width: 34px; height: 34px; border-radius: 50%;
  background: rgba(255,255,255,0.22); backdrop-filter: blur(6px);
  border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: opacity 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.carousel-arrow svg { width: 16px; height: 16px; stroke: #fff; fill: none; stroke-width: 2.5; }
.carousel-arrow.prev { left: 10px; }
.carousel-arrow.next { right: 10px; }
.detail-carousel:hover .carousel-arrow,
.detail-carousel.show-arrows .carousel-arrow { opacity: 1; }
.carousel-arrow.hidden { opacity: 0 !important; pointer-events: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN : DÃ‰TAIL PRODUIT â€” PLEIN Ã‰CRAN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Override screen-emplois : plein Ã©cran slide-up */
#screen-emplois {
  position: fixed !important;
  inset: 0 !important;
  z-index: 490 !important;
  background: var(--g50) !important;
  display: none !important;
  flex-direction: column !important;
  padding-bottom: 0 !important;
  transform: translateY(100%);
  transition: transform 0.35s cubic-bezier(0.4,0,0.2,1), opacity 0.35s;
  opacity: 0;
}
#screen-emplois.active {
  display: flex !important;
  transform: translateY(0);
  opacity: 1;
}
/* Override screen-detail pour sortir du flux SPA et couvrir tout l'Ã©cran */
#screen-detail {
  position: fixed !important;
  inset: 0 !important;
  z-index: 500 !important;
  background: var(--bg) !important;
  display: none !important;
  flex-direction: column !important;
  padding-bottom: 0 !important;
  transform: translateY(100%);
  transition: transform 0.35s cubic-bezier(0.4,0,0.2,1), opacity 0.35s;
  opacity: 0;
}
#screen-detail.active {
  display: flex !important;
  transform: translateY(0);
  opacity: 1;
}

/* Topbar agrandi */
#screen-detail .topbar {
  height: 62px; min-height: 62px;
  padding: 0 16px; gap: 14px;
  border-bottom: 1px solid var(--g100);
}
#screen-detail .topbar-back {
  width: 40px; height: 40px; border-radius: 12px;
  background: var(--g100); flex-shrink: 0;
}
#screen-detail .topbar-back svg { width: 20px; height: 20px; stroke-width: 2.5; }
#screen-detail .topbar-title {
  font-size: 1rem; font-weight: 700;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
#screen-detail .topbar-icon {
  width: 40px; height: 40px; border-radius: 12px;
  background: var(--g100);
}
#screen-detail .topbar-icon svg { width: 20px; height: 20px; }

/* Image hero agrandie */
.detail-img { width: 100%; height: 280px; object-fit: cover; flex-shrink: 0; }
.detail-img-wrap { position: relative; flex-shrink: 0; }
.detail-img-badges {
  position: absolute; bottom: 14px; left: 14px;
  display: flex; gap: 8px;
}
.d-badge {
  font-size: 0.72rem; font-weight: 700;
  padding: 6px 12px; border-radius: 8px;
  backdrop-filter: blur(10px);
}
.d-badge-green { background: rgba(74,158,42,0.88); color: #fff; }
.d-badge-dark  { background: rgba(0,0,0,0.65); color: #fff; }

/* Corps agrandi */
.detail-body { padding: 18px 18px 10px; flex-shrink: 0; }
.detail-price {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.75rem; font-weight: 700; color: var(--vp); margin-bottom: 8px;
}
.detail-price.on-quote {
  font-family: 'DM Sans', sans-serif; font-size: 1.1rem;
  color: var(--g400); font-style: italic;
}
.detail-name {
  font-family: 'Sora', sans-serif; font-size: 1.1rem; font-weight: 700;
  color: var(--g900); margin-bottom: 14px; line-height: 1.35;
}
.detail-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px; }
.detail-tag {
  font-size: 0.78rem; font-weight: 600; padding: 6px 12px;
  border-radius: 8px; background: var(--g100); color: var(--g700);
}
.detail-tag.green { background: var(--vc); color: var(--vp); }

/* Sections agrandies */
.detail-section { padding: 0 18px 18px; flex-shrink: 0; }
.detail-section-title {
  font-family: 'Sora', sans-serif; font-size: 0.82rem; font-weight: 700;
  color: var(--g900); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 10px;
}
.detail-desc { font-size: 0.92rem; color: var(--g600); line-height: 1.75; }

/* Contacts & comm box agrandis */
.masked-contact {
  background: var(--g100); border: 1px dashed var(--g200);
  border-radius: 14px; padding: 14px 16px;
  display: flex; align-items: center; gap: 12px;
  font-size: 0.84rem; color: var(--g500);
}
.masked-contact svg { width: 20px; height: 20px; stroke: var(--vp); fill: none; stroke-width: 2; flex-shrink: 0; }
.comm-box {
  background: #F2FAE8;
  border: 1.5px solid rgba(74,158,42,0.22);
  border-radius: 14px; padding: 12px 14px;
  font-size: 0.82rem; color: var(--vf); line-height: 1.5;
}
.comm-box-header {
  display: flex; align-items: center; gap: 6px;
  margin-bottom: 10px; padding-bottom: 8px;
  border-bottom: 1px solid rgba(74,158,42,0.12);
}
.comm-box-header-icon { font-size: 1rem; }
.comm-box-header-label {
  font-family: 'Sora', sans-serif; font-size: 0.78rem; font-weight: 700;
  color: var(--vp, #4A9E2A); flex: 1;
}
.comm-box-header-badge {
  background: var(--vp, #4A9E2A); color: #fff;
  font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; font-weight: 700;
  padding: 2px 8px; border-radius: 20px;
}
.comm-box-rows { display: flex; flex-direction: column; gap: 5px; }
.comm-box-row {
  display: flex; align-items: center; justify-content: space-between;
}
.comm-box-row-label { font-size: 0.72rem; color: #5A7A6A; font-weight: 600; }
.comm-box-row-value {
  font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
  font-weight: 700; color: var(--vf, #2A5E10);
}
.comm-box-row-value.red { color: #C53030; }
.comm-box strong { display: block; margin-bottom: 4px; font-size: 0.9rem; }

/* Footer agrandi */
.detail-footer {
  padding: 14px 18px 20px;
  background: var(--w);
  border-top: 1px solid var(--g100);
  display: flex; gap: 12px;
  position: sticky; bottom: 0; flex-shrink: 0;
}
.detail-footer .btn-contact {
  width: 52px; height: 52px; border-radius: 14px;
  border: 1.5px solid var(--g200);
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.detail-footer .btn-contact svg { width: 22px; height: 22px; stroke: var(--g700); fill: none; stroke-width: 2; }
.detail-footer .btn-primary {
  flex: 1; height: 52px; border-radius: 14px;
  font-family: 'Sora', sans-serif; font-size: 0.96rem; font-weight: 700;
  background: linear-gradient(135deg, #4A9E2A, #2A5E10);
  color: #fff; border: none; cursor: pointer;
  box-shadow: 0 4px 16px rgba(74,158,42,0.3);
  transition: transform 0.15s, box-shadow 0.15s;
}
.detail-footer .btn-primary:active { transform: scale(0.98); box-shadow: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM SHEETS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sheet-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.45);
  z-index:8999;
  display:none;backdrop-filter:blur(2px);
}
.sheet-overlay.open{display:block;}
.sheet{
  position:fixed;bottom:0;left:0;right:0;
  background:var(--w);
  border-radius:20px 20px 0 0;
  max-height:90%;
  overflow-y:auto;
  z-index:9000;
  transform:translateY(100%);
  transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);
  padding-bottom:env(safe-area-inset-bottom,16px);
}
.sheet.open{transform:none;}
.sheet-handle{
  width:36px;height:4px;
  background:var(--g200);border-radius:2px;
  margin:10px auto 6px;
}
.sheet-hd{
  padding:6px 16px 14px;
  display:flex;align-items:center;justify-content:space-between;
  border-bottom:1px solid var(--g100);
}
.sheet-title{font-family:'Sora',sans-serif;font-weight:700;font-size:0.95rem;}
.sheet-close{
  width:30px;height:30px;
  background:var(--g100);border-radius:7px;
  display:flex;align-items:center;justify-content:center;
  font-size:0.9rem;color:var(--g400);
}
.sheet-body{padding:16px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:7px;
  font-family:'Sora',sans-serif;font-weight:700;font-size:0.85rem;
  padding:12px 20px;border-radius:12px;
  transition:all var(--tr);white-space:nowrap;
  cursor:pointer;border:none;
  -webkit-tap-highlight-color:transparent;
}
.btn-primary{background:var(--vp);color:#fff;box-shadow:0 3px 10px rgba(74,158,42,0.35);}
.btn-primary:active{background:var(--vf);transform:scale(0.97);}
.btn-outline{background:transparent;color:var(--vp);border:1.5px solid var(--vp);}
.btn-outline:active{background:var(--vc);}
.btn-ghost{background:var(--g100);color:var(--g700);}
.btn-ghost:active{background:var(--g200);}
.btn-gold{background:var(--or);color:#fff;box-shadow:0 3px 10px rgba(212,168,67,0.3);}
.btn-block{width:100%;justify-content:center;}
.btn svg{width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.form-row{margin-bottom:14px;}
.form-label{font-size:0.75rem;font-weight:600;color:var(--g700);margin-bottom:6px;display:flex;align-items:center;gap:3px;}
.form-label .req{color:var(--err);}
.form-input{
  width:100%;padding:12px 14px;
  border:1.5px solid var(--g200);border-radius:10px;
  font-size:0.88rem;color:var(--g900);background:var(--w);
  outline:none;transition:border-color var(--tr);
}
.form-input:focus{border-color:var(--vp);box-shadow:0 0 0 3px rgba(74,158,42,0.1);}
.form-select{
  width:100%;padding:12px 14px;
  border:1.5px solid var(--g200);border-radius:10px;
  font-size:0.88rem;color:var(--g900);background:var(--w);
  cursor:pointer;outline:none;appearance:none;
  transition:border-color var(--tr);
}
.form-select:focus{border-color:var(--vp);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN : COMMANDES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.order-card{
  background:var(--w);border-radius:var(--r);
  border:1px solid var(--g100);padding:14px;
  box-shadow:var(--sh1);margin:0 12px 10px;
  cursor:pointer;
}
.order-card-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:8px;}
.order-num{font-family:'JetBrains Mono',monospace;font-size:0.7rem;color:var(--g400);}
.order-status{
  font-size:0.65rem;font-weight:700;
  padding:3px 8px;border-radius:5px;
}
.status-pending{background:var(--or-bg);color:var(--or);}
.status-transit{background:#EBF5FF;color:var(--info);}
.status-done{background:var(--vc);color:var(--vp);}
.order-name{font-family:'Sora',sans-serif;font-weight:700;font-size:0.85rem;color:var(--g900);margin-bottom:4px;}
.order-meta{font-size:0.72rem;color:var(--g400);display:flex;gap:10px;flex-wrap:wrap;}
.order-price{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);font-size:0.9rem;margin-top:8px;}
.order-progress{
  height:4px;background:var(--g100);border-radius:2px;margin-top:8px;overflow:hidden;
}
.order-progress-fill{height:100%;border-radius:2px;background:var(--vp);transition:width 0.5s var(--ease);}
.order-steps-labels{display:flex;justify-content:space-between;margin-top:5px;}
.order-step-lbl{font-size:0.6rem;color:var(--g400);}
.order-step-lbl.done{color:var(--vp);font-weight:600;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN : DOCUMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.doc-item{
  background:var(--w);border-radius:var(--r);
  border:1px solid var(--g100);
  padding:14px 16px;margin:0 12px 10px;
  display:flex;align-items:center;gap:12px;
  cursor:pointer;box-shadow:var(--sh1);
  -webkit-tap-highlight-color:transparent;
}
.doc-icon{
  width:40px;height:40px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:1.2rem;flex-shrink:0;
}
.doc-icon.green{background:var(--vc);}
.doc-icon.blue{background:#EBF5FF;}
.doc-icon.orange{background:var(--or-bg);}
.doc-info{flex:1;min-width:0;}
.doc-name{font-family:'Sora',sans-serif;font-weight:700;font-size:0.83rem;color:var(--g900);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.doc-meta{font-size:0.7rem;color:var(--g400);margin-top:2px;}
.doc-badge{
  font-size:0.62rem;font-weight:700;
  padding:3px 7px;border-radius:5px;flex-shrink:0;
}
.doc-badge.signed{background:var(--vc);color:var(--vp);}
.doc-badge.pending{background:var(--or-bg);color:var(--or);}
.doc-badge.paid{background:#EBF5FF;color:var(--info);}
.doc-action svg{width:16px;height:16px;stroke:var(--g400);fill:none;stroke-width:2;}

/* DOCUMENT VIEWER */
.doc-viewer{padding:12px;flex:1;}
.doc-paper{
  background:var(--w);border-radius:var(--r);
  border:1px solid var(--g200);
  padding:20px;font-size:0.75rem;color:var(--g900);
  box-shadow:var(--sh1);
}
.doc-paper-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:18px;padding-bottom:14px;border-bottom:2px solid var(--vp);}
.doc-logo-sm{display:flex;align-items:center;gap:6px;}
.doc-logo-sm .mark{width:24px;height:24px;background:var(--vp);border-radius:5px;display:flex;align-items:center;justify-content:center;}
.doc-logo-sm .mark span{font-family:'Sora',sans-serif;font-weight:800;font-size:0.52rem;color:#fff;}
.doc-logo-sm strong{font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;color:var(--vp);}
.doc-type-label{font-family:'Sora',sans-serif;font-weight:800;font-size:0.82rem;color:var(--vf);text-transform:uppercase;letter-spacing:0.8px;text-align:right;}
.doc-num-sm{font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:var(--g400);text-align:right;margin-top:2px;}
.doc-parties-sm{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
.doc-party-lbl{font-size:0.58rem;font-weight:700;text-transform:uppercase;letter-spacing:0.6px;color:var(--g400);margin-bottom:3px;}
.doc-party-nm{font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:var(--g900);}
.doc-party-info{font-size:0.65rem;color:var(--g600);line-height:1.4;}
.doc-tbl{width:100%;border-collapse:collapse;font-size:0.7rem;margin-bottom:14px;}
.doc-tbl th{background:var(--g100);padding:6px 8px;font-size:0.6rem;font-weight:700;color:var(--g400);text-transform:uppercase;border-bottom:1px solid var(--g200);text-align:left;}
.doc-tbl td{padding:8px 8px;border-bottom:1px solid var(--g50);}
.doc-totals-sm{margin-left:auto;width:50%;font-size:0.72rem;}
.doc-total-row-sm{display:flex;justify-content:space-between;padding:4px 0;}
.doc-total-row-sm.main{font-family:'Sora',sans-serif;font-weight:700;color:var(--vp);border-top:1px solid var(--g200);padding-top:6px;margin-top:2px;}
.doc-total-row-sm.comm{color:var(--g400);font-size:0.65rem;}
.sig-zone{
  border:1.5px dashed var(--g200);border-radius:8px;
  padding:10px;text-align:center;margin-top:14px;
}
.sig-zone-label{font-size:0.6rem;font-weight:700;text-transform:uppercase;letter-spacing:0.6px;color:var(--g400);margin-bottom:4px;}
.sig-img{max-height:44px;margin:0 auto;}
.sig-name{font-size:0.65rem;color:var(--g600);margin-top:4px;}
.doc-sig-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px;padding-top:12px;border-top:1px solid var(--g100);}
.doc-footer-sm{font-size:0.58rem;color:var(--g400);text-align:center;margin-top:14px;line-height:1.5;}
.doc-actions-strip{
  display:flex;gap:8px;padding:10px 12px;
  background:var(--w);border-top:1px solid var(--g100);
  flex-shrink:0;
}
/* FIX v17 â€” docviewer a son propre footer, pas besoin du padding bottomnav */
#screen-docviewer{
  padding-bottom:0 !important;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN : PORTEFEUILLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wallet-hero{
  background:linear-gradient(135deg,#1A6635,#4FAB2D);
  padding:20px 16px 24px;text-align:center;flex-shrink:0;
}
.wallet-balance-label{font-size:0.75rem;color:rgba(255,255,255,0.6);margin-bottom:4px;}
.wallet-balance{font-family:'JetBrains Mono',monospace;font-size:2.2rem;font-weight:700;color:#fff;}
.wallet-escrow{font-size:0.72rem;color:rgba(255,255,255,0.55);margin-top:4px;}
.wallet-actions{display:flex;gap:10px;justify-content:center;margin-top:16px;}
.wallet-action-btn{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.2);
  border-radius:12px;padding:10px 16px;min-width:64px;
}
.wallet-action-btn svg{width:20px;height:20px;stroke:#fff;fill:none;stroke-width:2;}
.wallet-action-btn span{font-size:0.65rem;font-weight:600;color:rgba(255,255,255,0.85);}
.tx-item{
  background:var(--w);border-radius:var(--r);
  border:1px solid var(--g100);
  padding:12px 14px;margin:0 12px 8px;
  display:flex;align-items:center;gap:12px;
}
.tx-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.tx-icon.in{background:var(--vc);}
.tx-icon.out{background:#FEE8E8;}
.tx-info{flex:1;}
.tx-name{font-size:0.82rem;font-weight:600;color:var(--g900);}
.tx-date{font-size:0.68rem;color:var(--g400);}
.tx-amount{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.88rem;}
.tx-amount.in{color:var(--ok);}
.tx-amount.out{color:var(--err);}
.tx-comm{font-size:0.62rem;color:var(--g400);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN : PROFIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.profile-hero{
  background:linear-gradient(135deg,#1A6635,#4FAB2D);
  padding:20px 16px 32px;flex-shrink:0;
  text-align:center;
}
.avatar{
  width:64px;height:64px;border-radius:50%;
  background:rgba(255,255,255,0.2);
  margin:0 auto 10px;
  display:flex;align-items:center;justify-content:center;
  font-family:'Sora',sans-serif;font-weight:700;font-size:1.4rem;color:#fff;
  border:3px solid rgba(255,255,255,0.4);
}
.profile-name{font-family:'Sora',sans-serif;font-weight:700;font-size:1.05rem;color:#fff;}
.profile-type{font-size:0.75rem;color:rgba(255,255,255,0.7);margin-top:2px;}
.profile-badge{
  display:inline-flex;align-items:center;gap:5px;
  background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.2);
  border-radius:20px;padding:5px 12px;margin-top:10px;
  font-size:0.72rem;font-weight:600;color:#fff;
}
.menu-item{
  background:var(--w);border-bottom:1px solid var(--g50);
  display:flex;align-items:center;gap:12px;
  padding:14px 16px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  transition:background var(--tr);
}
.menu-item:active{background:var(--g100);}
.menu-item:first-child{border-radius:var(--r) var(--r) 0 0;}
.menu-item:last-child{border-radius:0 0 var(--r) var(--r);border-bottom:none;}
.menu-icon{width:36px;height:36px;border-radius:9px;background:var(--g100);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.menu-icon svg{width:18px;height:18px;stroke:var(--vp);fill:none;stroke-width:2;}
.menu-info{flex:1;}
.menu-info h4{font-size:0.85rem;font-weight:600;color:var(--g900);}
.menu-info p{font-size:0.72rem;color:var(--g400);margin-top:1px;}
.menu-arrow svg{width:16px;height:16px;stroke:var(--g300);fill:none;stroke-width:2;}
.menu-group{margin:0 12px 12px;border-radius:var(--r);overflow:hidden;border:1px solid var(--g100);}
.menu-group-title{font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.7px;color:var(--g400);padding:12px 16px 6px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TUNNEL COMMANDE (STEPS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.order-steps-bar{
  display:flex;margin:14px 16px;gap:4px;
}
.ostep{
  flex:1;height:4px;border-radius:2px;
  background:var(--g200);transition:background 0.3s;
}
.ostep.active{background:var(--vp);}
.ostep.done{background:var(--vp);}
.step-content{padding:0 16px;}
.step-title{font-family:'Sora',sans-serif;font-weight:700;font-size:0.9rem;color:var(--g900);margin-bottom:4px;}
.step-sub{font-size:0.78rem;color:var(--g400);margin-bottom:14px;}
.order-summary{background:var(--g100);border-radius:10px;padding:12px 14px;margin-bottom:14px;}
.os-row{display:flex;justify-content:space-between;padding:4px 0;font-size:0.8rem;}
.os-row:not(:last-child){border-bottom:1px solid var(--g200);}
.os-row.total{font-family:'Sora',sans-serif;font-weight:700;color:var(--g900);padding-top:8px;}
.os-row.comm{font-size:0.72rem;color:var(--g400);}
.os-row.comm span:last-child{color:var(--vp);}
.pay-method{
  padding:12px 14px;border:1.5px solid var(--g200);border-radius:10px;
  display:flex;align-items:center;gap:12px;margin-bottom:8px;cursor:pointer;
  transition:all var(--tr);
}
.pay-method.sel{border-color:var(--vp);background:var(--vc);}
.pay-method-icon{width:36px;height:36px;border-radius:8px;background:var(--g100);display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;}
.pay-method h4{font-size:0.82rem;font-weight:600;color:var(--g900);}
.pay-method p{font-size:0.7rem;color:var(--g400);}
.escrow-note{background:rgba(74,158,42,0.07);border:1px solid rgba(74,158,42,0.18);border-radius:10px;padding:12px 14px;font-size:0.75rem;color:var(--vf);line-height:1.6;margin-top:10px;}
.escrow-note strong{display:block;margin-bottom:3px;}
.step-footer{
  padding:12px 16px;background:var(--w);
  border-top:1px solid var(--g100);
  display:flex;gap:10px;flex-shrink:0;
  position:sticky;bottom:0;
}

/* SUCCÃˆS */
.success-screen{
  flex:1;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  padding:32px 24px;text-align:center;
}
.success-icon{font-size:4rem;margin-bottom:16px;}
.success-screen h2{font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;color:var(--g900);margin-bottom:8px;}
.success-screen p{font-size:0.82rem;color:var(--g600);line-height:1.65;max-width:280px;margin:0 auto;}

/* SIGNATURE CANVAS */
.sig-canvas-wrap{
  border:1.5px solid var(--g200);border-radius:10px;
  overflow:hidden;background:var(--g50);margin-bottom:12px;
}
#sigCanvas{display:block;width:100%;height:150px;cursor:crosshair;touch-action:none;}
.sig-help{font-size:0.75rem;color:var(--g400);text-align:center;margin-bottom:10px;}
.sig-footer{display:flex;gap:8px;}

/* FILTRE SHEET */
.filter-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--g100);}
.filter-row:last-child{border-bottom:none;}
.filter-row-label{font-size:0.85rem;font-weight:500;color:var(--g900);}
.toggle{position:relative;width:40px;height:22px;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-track{position:absolute;inset:0;background:var(--g200);border-radius:11px;cursor:pointer;transition:background var(--tr);}
.toggle input:checked+.toggle-track{background:var(--vp);}
.toggle-track::after{content:'';position:absolute;left:3px;top:3px;width:16px;height:16px;background:#fff;border-radius:50%;transition:transform var(--tr);box-shadow:0 1px 3px rgba(0,0,0,0.2);}
.toggle input:checked+.toggle-track::after{transform:translateX(18px);}

/* TOAST */
.toast{
  position:absolute;bottom:calc(var(--nav-h) + 12px);left:12px;right:12px;
  background:var(--g900);color:#fff;
  padding:12px 16px;border-radius:12px;
  font-size:0.82rem;font-weight:500;
  box-shadow:var(--sh3);z-index:200;
  transform:translateY(80px);opacity:0;
  transition:all 0.3s var(--ease);
  pointer-events:none;
  display:flex;align-items:center;gap:8px;
}
.toast.show{transform:none;opacity:1;}
.toast.ok{background:var(--vf);}
.toast.err{background:var(--err);}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BRIDGE â€” Page MarchÃ© Mobile : rÃ¨gles globales conditionnelles
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Quand le marchÃ© est affichÃ©, on applique les styles body/html de File2 */
body.marche-mode {
  overflow: hidden;
  background: #1A1E1A;
  display: flex;
  align-items: center;
  justify-content: center;
}
body.marche-mode h1, body.marche-mode h2,
body.marche-mode h3, body.marche-mode h4 {
  font-family: 'Sora', sans-serif;
}

/* Page marchÃ© : cachÃ©e par dÃ©faut */
#page-marche {
  display: none;
  width: 100%;
  min-height: 100vh;
}
#page-marche.active {
  display: block !important;
}

/* Scrollbar cachÃ©e sur la page marchÃ© uniquement */
#page-marche ::-webkit-scrollbar { display: none; }
#page-marche * { -ms-overflow-style: none; scrollbar-width: none; }

/* Quand le marchÃ© est actif, masquer les autres pages proprement */
body.marche-mode #page-accueil { display: none !important; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRIX MARCHÃ‰ EN TEMPS RÃ‰EL â€” Ticker & Indicateurs
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.market-ticker {
  background: linear-gradient(135deg, #2A5E10, #4A9E2A);
  padding: 0;
  overflow: hidden;
  flex-shrink: 0;
  position: relative;
}
.ticker-label {
  position: absolute; left: 0; top: 0; bottom: 0;
  background: rgba(0,0,0,0.25);
  display: flex; align-items: center; padding: 0 12px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem; font-weight: 700;
  color: rgba(255,255,255,0.9); letter-spacing: 0.5px;
  z-index: 2; white-space: nowrap;
}
.ticker-track {
  display: flex; align-items: center; gap: 0;
  animation: tickerScroll 40s linear infinite;
  white-space: nowrap;
  padding: 10px 0 10px 96px;
}
.ticker-track:hover { animation-play-state: paused; }
.ticker-item {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 0 18px; border-right: 1px solid rgba(255,255,255,0.15);
  cursor: pointer;
}
.ticker-item:hover .ticker-name { text-decoration: underline; }
.ticker-name {
  font-family: 'Sora', sans-serif; font-size: 0.75rem;
  font-weight: 700; color: rgba(255,255,255,0.9);
}
.ticker-price {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem; font-weight: 700; color: #fff;
}
.ticker-change {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem; font-weight: 700;
  padding: 2px 6px; border-radius: 4px;
}
.ticker-change.up { background: rgba(46,204,113,0.25); color: #6ED63B; }
.ticker-change.down { background: rgba(192,57,43,0.25); color: #FF6B6B; }
.ticker-change.flat { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6); }
@keyframes tickerScroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

/* Badge prix temps rÃ©el sur les cards */
.card-price-live {
  display: flex; align-items: center; gap: 5px;
}
.price-trend {
  font-size: 0.6rem; font-weight: 700; padding: 1px 5px;
  border-radius: 4px; font-family: 'JetBrains Mono', monospace;
}
.price-trend.up { background: rgba(46,204,113,0.12); color: #1A9A50; }
.price-trend.down { background: rgba(192,57,43,0.1); color: #C0392B; }
.price-trend.flat { background: rgba(0,0,0,0.05); color: var(--g400); }

/* Section prix du marchÃ© dans Smart IA */
.market-price-panel {
  margin: 0 12px 12px;
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid var(--g100);
}
.market-price-header {
  background: linear-gradient(135deg, #2A5E10, #4A9E2A);
  padding: 10px 14px;
  display: flex; align-items: center; justify-content: space-between;
}
.market-price-header-title {
  font-family: 'Sora', sans-serif; font-weight: 700;
  font-size: 0.78rem; color: #fff;
  display: flex; align-items: center; gap: 6px;
}
.live-dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: #6ED63B;
  animation: livePulse 1.5s ease-in-out infinite;
  flex-shrink: 0;
}
@keyframes livePulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(1.3); }
}
.market-price-last-update {
  font-size: 0.58rem; color: rgba(255,255,255,0.6);
  font-family: 'JetBrains Mono', monospace;
}
.market-price-row {
  display: flex; align-items: center; padding: 9px 14px;
  border-bottom: 1px solid var(--g100); background: var(--w);
  cursor: pointer; transition: background 0.15s;
}
.market-price-row:last-child { border-bottom: none; }
.market-price-row:active { background: var(--g50); }
.market-price-emoji { font-size: 1rem; margin-right: 8px; flex-shrink: 0; }
.market-price-name { flex: 1; font-size: 0.75rem; font-weight: 600; color: var(--g900); }
.market-price-unit { font-size: 0.62rem; color: var(--g400); font-family: 'DM Sans', sans-serif; margin-top: 1px; }
.market-price-val {
  text-align: right;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700; font-size: 0.8rem; color: var(--g900);
}
.market-price-change {
  font-size: 0.6rem; font-weight: 700; margin-top: 2px;
  text-align: right;
}
.market-price-change.up { color: #1A9A50; }
.market-price-change.down { color: #C0392B; }
.market-price-change.flat { color: var(--g400); }

/* ThÃ¨mes dark/blue */
[data-theme="dark"] .market-price-row { background: #1A1C1A; border-color: #252725; }
[data-theme="dark"] .market-price-row:active { background: #252725; }
[data-theme="dark"] .market-price-name { color: #E8EDE6; }
[data-theme="dark"] .market-price-panel { border-color: #252725; }
[data-theme="blue"] .market-price-row { background: #2C3E50; border-color: #384D62; }
[data-theme="blue"] .market-price-row:active { background: #2E3F52; }
[data-theme="blue"] .market-price-name { color: #EAF2F8; }
[data-theme="blue"] .market-price-panel { border-color: #384D62; }

/* Loading shimmer pour les prix */
.price-loading {
  display: inline-block; width: 60px; height: 14px;
  background: linear-gradient(90deg, var(--g100) 25%, var(--g50) 50%, var(--g100) 75%);
  background-size: 200% 100%;
  animation: priceShimmer 1.2s infinite;
  border-radius: 4px;
}
@keyframes priceShimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ABAE v53 â€” CARTE VENDEUR + PRÃ‰VISIONS MÃ‰TÃ‰O
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.seller-map-section { padding: 0 16px 0; flex-shrink: 0; }
.seller-map-title {
  font-family: 'Sora', sans-serif; font-weight: 700;
  font-size: 0.92rem; color: var(--gris-900);
  margin-bottom: 10px; display: flex; align-items: center; gap: 7px;
}
.seller-map-wrap {
  border-radius: 16px; overflow: hidden;
  border: 1.5px solid rgba(74,158,42,0.2);
  box-shadow: 0 3px 16px rgba(0,0,0,0.10);
}
/* â”€â”€ CARTE VENDEUR SVG RÃ‰ALISTE (hors-ligne) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.seller-map-static {
  width: 100%; height: 220px;
  background: #C8DEF0;
  position: relative; overflow: hidden;
}
.seller-map-zoomable {
  position: absolute; inset: 0;
  transform-origin: center center;
  transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  will-change: transform;
}
.sms-svg { position: absolute; inset: 0; width: 100%; height: 100%; overflow: visible; }
.sms-ocean { fill: #C8DEF0; }
.sms-territory { fill: #C8DDB0; stroke: #7FAE5A; stroke-width: 1.2; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.18)); }
.sms-route-major { fill: none; stroke: rgba(255,255,255,0.85); stroke-width: 2.2; stroke-linecap: round; stroke-linejoin: round; }
.sms-route-minor { fill: none; stroke: rgba(255,255,255,0.5); stroke-width: 1.2; stroke-linecap: round; }
.sms-city-dot { fill: rgba(255,255,255,0.75); stroke: #5A8A3A; stroke-width: 1; }
.sms-city-label { font-family: 'DM Sans', sans-serif; font-size: 7.5px; fill: #2E4A18; font-weight: 600; }
.sms-city-halo { fill: rgba(229,57,53,0.12); animation: smHaloPulse 2.5s ease-in-out infinite; }
@keyframes smHaloPulse { 0%,100% { r: 18; opacity:0.5; } 50% { r: 28; opacity:0.1; } }
.sms-pin-group { filter: drop-shadow(0 3px 7px rgba(0,0,0,0.4)); }
.sms-pin-body { fill: #E53935; stroke: #fff; stroke-width: 2; }
.sms-pin-dot { fill: #fff; }
.sms-pin-label {
  font-family: 'Sora', sans-serif; font-size: 9px; font-weight: 800; fill: #1B5E20;
  paint-order: stroke; stroke: rgba(255,255,255,0.97); stroke-width: 3.5px; stroke-linecap: round;
}
.sms-pulse  { fill: none; stroke: #E53935; stroke-width: 1.8; animation: smsPulse 2s ease-out infinite; transform-box: fill-box; transform-origin: center; }
.sms-pulse2 { fill: none; stroke: #E53935; stroke-width: 1; animation: smsPulse 2s ease-out 0.8s infinite; transform-box: fill-box; transform-origin: center; }
@keyframes smsPulse { 0% { r: 7; opacity: 0.9; } 100% { r: 24; opacity: 0; } }
/* Boussole */
.sms-compass {
  position: absolute; bottom: 10px; right: 10px; z-index: 10;
  width: 30px; height: 30px; background: rgba(255,255,255,0.93);
  border-radius: 50%; border: 1px solid rgba(0,0,0,0.12);
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  font-size: 0.72rem; font-weight: 800; font-family: 'Sora', sans-serif;
  color: #E53935; user-select: none; cursor: default;
}
/* Zoom controls */
.seller-map-zoom {
  position: absolute; top: 10px; left: 10px; display: flex; flex-direction: column; gap: 1px; z-index: 11;
}
.seller-map-zoom-btn {
  width: 28px; height: 28px; background: rgba(255,255,255,0.97);
  border: 1px solid rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center;
  font-size: 1rem; font-weight: 700; color: #333; cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.12);
  transition: background 0.15s, transform 0.1s; user-select: none;
}
.seller-map-zoom-btn:hover { background: #f0f0f0; }
.seller-map-zoom-btn:active { background: #e0e0e0; transform: scale(0.92); }
.seller-map-zoom-btn:first-child { border-radius: 6px 6px 0 0; }
.seller-map-zoom-btn:last-child  { border-radius: 0 0 6px 6px; }
.seller-map-zoom-level {
  position: absolute; top: 10px; right: 10px; z-index: 11;
  background: rgba(255,255,255,0.92); border: 1px solid rgba(0,0,0,0.12);
  border-radius: 6px; padding: 3px 7px;
  font-size: 0.65rem; font-weight: 700; color: #555;
  font-family: 'JetBrains Mono', monospace;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}
/* Barre infÃ©rieure */
.seller-map-info {
  display: flex; align-items: center; gap: 10px;
  padding: 11px 14px; background: var(--blanc);
  border-top: 1.5px solid rgba(74,158,42,0.1);
  font-size: 0.82rem; color: var(--gris-700); font-weight: 600;
}
.seller-map-info svg { width: 16px; height: 16px; stroke: var(--vert-principal); fill: none; stroke-width: 2.5; flex-shrink: 0; }
.seller-map-dist {
  margin-left: auto; background: linear-gradient(135deg,#E8F5E9,#D4EDD4); color: #2E7D32;
  font-size: 0.75rem; font-weight: 700; padding: 5px 11px; border-radius: 20px;
  border: 1px solid rgba(74,158,42,0.2); white-space: nowrap;
}
.seller-map-wrap { border-radius: 16px; overflow: hidden; border: 1.5px solid rgba(74,158,42,0.2); box-shadow: 0 3px 16px rgba(0,0,0,0.10); }
.seller-map-section { padding: 0 16px 0; flex-shrink: 0; }
.seller-map-title { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.92rem; color: var(--gris-900); margin-bottom: 10px; display: flex; align-items: center; gap: 7px; }
.map-popup-name { font-family:'Sora',sans-serif; font-weight:700; font-size:0.88rem; color:#1a1a1a; }
.map-popup-loc  { font-size:0.76rem; color:#6B7280; margin-top:3px; }

/* PrÃ©visions mÃ©tÃ©o 7 jours */
.wx-forecast-strip {
  display: flex; gap: 7px; overflow-x: auto;
  padding: 10px 0 4px; margin-top: 6px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
}
.wx-forecast-strip::-webkit-scrollbar { display: none; }
.wx-forecast-day {
  flex-shrink: 0; scroll-snap-align: start;
  background: rgba(255,255,255,0.10); border: 1.5px solid rgba(255,255,255,0.2);
  border-radius: 12px; padding: 9px 11px; min-width: 66px; text-align: center;
  transition: background 0.2s;
}
.wx-forecast-day.today { background: rgba(249,232,74,0.25); border-color: rgba(249,232,74,0.7); box-shadow:0 2px 8px rgba(249,232,74,0.15); }
.wx-forecast-day-name {
  font-size: 0.65rem; font-weight: 700; color: rgba(255,255,255,0.75);
  font-family: 'Sora',sans-serif; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;
}
.wx-forecast-day.today .wx-forecast-day-name { color: #FFE55A; }
.wx-forecast-icon { font-size: 1.2rem; margin-bottom: 4px; line-height: 1; }
.wx-forecast-max { font-family:'JetBrains Mono',monospace; font-size:0.82rem; font-weight:700; color:#fff; }
.wx-forecast-min { font-size:0.68rem; color:rgba(255,255,255,0.6); margin-top:1px; }
.wx-forecast-rain { font-size:0.63rem; color:rgba(149,213,255,0.8); margin-top:3px; font-weight:600; }

/* Barre mÃ©tÃ©o compacte (autres pages) */
.wx-bar {
  background: #FFF9C4; border-bottom: 1px solid #F9E84A;
  padding: 8px 14px 10px; cursor: pointer; flex-shrink: 0; transition: background 0.2s;
}
.wx-bar:active { background: #FFF176; }
.wx-bar-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
.wx-bar .wx-icon { font-size:1rem; }
.wx-bar .wx-temp { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:0.88rem; color:#5D4037; }
.wx-bar .wx-desc { font-size:0.68rem; color:#8D6E63; text-transform:capitalize; }
.wx-bar .wx-hum, .wx-bar .wx-wind { font-size:0.68rem; color:#8D6E63; font-weight:700; }
.wx-bar .wx-city { color:#6D4C41 !important; }
.wx-bar-advice { display:flex; align-items:center; gap:6px; padding-top:6px; border-top:1px solid #FFF176; }
.wx-bar-advice .wx-advice-icon { font-size:0.85rem; flex-shrink:0; }
.wx-bar-advice .wx-advice-text { font-size:0.72rem; font-weight:700; color:#4E342E; line-height:1.35; }
</style>

<style>

/* â”€â”€ ABONNEMENT PAGE STYLES â”€â”€ */
#page-abonnement {
  min-height: 100vh;
  background: #163D25;
  font-family: 'DM Sans', sans-serif;
  overflow-y: auto;
}
.abo-hdr {
  display: flex; align-items: center; justify-content: center;
  padding: 20px 20px 0; position: relative;
}
.abo-logo { display: flex; align-items: center; gap: 8px; }
.abo-logo-mark {
  width: 36px; height: 36px; border-radius: 10px;
  background: rgba(255,255,255,0.2); border: 1.5px solid rgba(255,255,255,0.3);
  display: flex; align-items: center; justify-content: center;
  font-family: 'Sora',sans-serif; font-weight: 800; color: #fff; font-size: 0.9rem;
}
.abo-logo-name { font-family: 'Sora',sans-serif; font-weight: 700; color: #fff; font-size: 1rem; }
.abo-hero {
  text-align: center; padding: 28px 20px 20px;
  position: relative; z-index: 1;
}
.abo-hero-badge {
  display: inline-flex; align-items: center; gap: 6px;
  background: rgba(212,168,67,0.25); border: 1px solid rgba(212,168,67,0.5);
  border-radius: 20px; padding: 5px 14px; margin-bottom: 14px;
  font-size: 0.72rem; font-weight: 700; color: #D4A843; font-family: 'Sora',sans-serif;
  letter-spacing: 0.5px;
}
.abo-hero h1 {
  font-family: 'Sora',sans-serif; font-weight: 800;
  font-size: 1.5rem; color: #fff; line-height: 1.25; margin-bottom: 8px;
}
.abo-hero p {
  font-size: 0.85rem; color: rgba(255,255,255,0.75); line-height: 1.55;
}
/* Billing toggle */
.abo-toggle-wrap {
  display: flex; align-items: center; justify-content: center; gap: 10px;
  margin: 0 0 20px;
}
.abo-toggle-label { font-size: 0.8rem; color: rgba(255,255,255,0.7); font-weight: 500; }
.abo-toggle-label.active { color: #fff; font-weight: 700; }
.abo-toggle {
  width: 44px; height: 24px; border-radius: 12px;
  background: rgba(255,255,255,0.2); border: none; cursor: pointer;
  position: relative; transition: background 0.22s; flex-shrink: 0;
}
.abo-toggle-thumb {
  position: absolute; top: 3px; left: 3px;
  width: 18px; height: 18px; border-radius: 50%; background: #D4A843;
  transition: transform 0.22s cubic-bezier(0.4,0,0.2,1);
}
.abo-toggle.annual .abo-toggle-thumb { transform: translateX(20px); }
.abo-annual-badge {
  background: #D4A843; color: #fff; font-size: 0.6rem; font-weight: 700;
  padding: 2px 7px; border-radius: 10px; font-family: 'Sora',sans-serif;
}
/* Cards container â€” horizontal scroll */
.abo-cards {
  padding: 0 16px 20px;
  display: flex;
  flex-direction: row;
  gap: 14px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.abo-cards::-webkit-scrollbar { display: none; }
.abo-card {
  min-width: 72vw;
  max-width: 280px;
  flex-shrink: 0;
  scroll-snap-align: start;
  background: rgba(255,255,255,0.06);
  border: 1.5px solid rgba(255,255,255,0.1);
  border-radius: 22px;
  padding: 22px 18px 18px;
  cursor: pointer;
  transition: all 0.25s;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(12px);
  -webkit-tap-highlight-color: transparent;
}
.abo-card::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 22px;
  opacity: 0;
  transition: opacity 0.25s;
  z-index: 0;
}
.abo-card.gratuit::before  { background: linear-gradient(145deg, rgba(155,163,174,0.15), transparent); }
.abo-card.standard::before { background: linear-gradient(145deg, rgba(59,130,246,0.18), transparent); }
.abo-card.pro::before      { background: linear-gradient(145deg, rgba(139,92,246,0.22), transparent); }
.abo-card.entreprise::before { background: linear-gradient(145deg, rgba(212,168,67,0.22), transparent); }
.abo-card.selected {
  border-color: rgba(110,214,59,0.6);
  box-shadow: 0 0 0 1px rgba(110,214,59,0.3), 0 8px 32px rgba(0,0,0,0.3);
}
.abo-card.selected::before { opacity: 1; }
.abo-card > * { position: relative; z-index: 1; }
.abo-card-top {
  display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px;
}
.abo-card-left { display: flex; align-items: center; gap: 10px; }
.abo-card-icon {
  width: 44px; height: 44px; border-radius: 14px;
  display: flex; align-items: center; justify-content: center; font-size: 1.3rem;
  flex-shrink: 0;
}
.abo-card.gratuit  .abo-card-icon { background: rgba(155,163,174,0.18); }
.abo-card.standard .abo-card-icon { background: rgba(59,130,246,0.18); }
.abo-card.pro      .abo-card-icon { background: rgba(139,92,246,0.18); }
.abo-card.entreprise .abo-card-icon { background: rgba(212,168,67,0.18); }
.abo-card-name {
  font-family: 'Sora',sans-serif; font-weight: 800; font-size: 1rem; color: #fff;
}
.abo-card-tagline { font-size: 0.68rem; color: rgba(255,255,255,0.5); margin-top: 2px; font-weight: 500; }
.abo-badge-popular {
  background: linear-gradient(135deg, #8B5CF6, #A78BFA);
  color: #fff; font-size: 0.58rem; font-weight: 700; font-family: 'Sora',sans-serif;
  padding: 4px 10px; border-radius: 20px; white-space: nowrap;
}
.abo-card-price { text-align: right; }
.abo-price-amount {
  font-family: 'Sora',sans-serif; font-weight: 800; font-size: 1.15rem; color: #6ED63B;
  line-height: 1;
}
.abo-card.gratuit .abo-price-amount { color: rgba(255,255,255,0.55); }
.abo-card.entreprise .abo-price-amount { color: #D4A843; }
.abo-price-period { font-size: 0.62rem; color: rgba(255,255,255,0.4); margin-top: 3px; font-weight: 500; }
.abo-price-annual  { font-size: 0.62rem; color: #D4A843; margin-top: 2px; font-weight: 600; }
.abo-card-features {
  display: flex; flex-direction: column; gap: 9px; border-top: 1px solid rgba(255,255,255,0.08); padding-top: 14px;
}
.abo-feat {
  font-size: 0.72rem; color: rgba(255,255,255,0.8); font-weight: 500;
  display: flex; align-items: center; gap: 8px;
}
.abo-feat-check {
  width: 17px; height: 17px; border-radius: 50%; flex-shrink: 0;
  background: rgba(110,214,59,0.18); border: 1px solid rgba(110,214,59,0.45);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.6rem; color: #6ED63B;
}
/* CTA */
.abo-cta-wrap {
  padding: 16px 12px 10px;
}
.abo-cta-btn {
  width: 100%; padding: 15px; border-radius: 14px; border: none; cursor: pointer;
  font-family: 'Sora',sans-serif; font-weight: 700; font-size: 0.95rem;
  transition: all 0.22s; display: flex; align-items: center; justify-content: center; gap: 8px;
}
.abo-cta-btn.gratuit { background: rgba(255,255,255,0.15); color: #fff; border: 1.5px solid rgba(255,255,255,0.3); }
.abo-cta-btn.payant {
  background: linear-gradient(135deg, #D4A843 0%, #F59E0B 100%);
  color: #2A5E10;
  box-shadow: 0 4px 20px rgba(212,168,67,0.4);
}
.abo-cta-btn:hover { transform: translateY(-1px); }
.abo-cta-btn:active { transform: scale(0.98); }
.abo-security {
  display: flex; align-items: center; justify-content: center; gap: 6px;
  margin-top: 10px; font-size: 0.7rem; color: rgba(255,255,255,0.55);
}
/* Payment modal inside abo page */
.abo-pay-overlay {
  display: none; position: fixed; inset: 0; z-index: 9999;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
  align-items: flex-end; justify-content: center;
}
.abo-pay-overlay.show { display: flex; }
.abo-pay-sheet {
  width: 100%; max-width: 480px;
  background: #fff; border-radius: 24px 24px 0 0;
  padding: 24px 20px 36px;
  animation: slideUpAbo 0.3s cubic-bezier(0.4,0,0.2,1);
}
@keyframes slideUpAbo {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.abo-pay-title {
  font-family: 'Sora',sans-serif; font-weight: 800; font-size: 1.1rem;
  color: #1A1E25; text-align: center; margin-bottom: 4px;
}
.abo-pay-subtitle { font-size: 0.8rem; color: #9BA3AE; text-align: center; margin-bottom: 20px; }
.abo-pay-summary {
  background: #F7F8F9; border-radius: 12px; padding: 14px;
  margin-bottom: 18px; display: flex; align-items: center; justify-content: space-between;
}
.abo-pay-plan-name { font-family: 'Sora',sans-serif; font-weight: 700; font-size: 0.88rem; color: #1A1E25; }
.abo-pay-plan-price { font-family: 'Sora',sans-serif; font-weight: 800; font-size: 1rem; }
.abo-pay-plan-price.standard { color: #3B82F6; }
.abo-pay-plan-price.pro { color: #8B5CF6; }
.abo-pay-plan-price.entreprise { color: #D4A843; }
.abo-pay-methods-title { font-weight: 700; font-size: 0.82rem; color: #3D4550; margin-bottom: 10px; }
.abo-pay-methods { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
.abo-pay-method {
  display: flex; align-items: center; gap: 12px; padding: 12px 14px;
  border: 1.5px solid #EAECEF; border-radius: 12px; cursor: pointer;
  transition: all 0.18s; background: #fff;
}
.abo-pay-method.sel { border-color: #4A9E2A; background: #EDF7E5; }
.abo-pay-method-icon { font-size: 1.3rem; flex-shrink: 0; }
.abo-pay-method-info { flex: 1; }
.abo-pay-method-name { font-weight: 700; font-size: 0.82rem; color: #1A1E25; }
.abo-pay-method-desc { font-size: 0.7rem; color: #9BA3AE; }
.abo-pay-confirm-btn {
  width: 100%; padding: 15px; border-radius: 12px; border: none; cursor: pointer;
  background: linear-gradient(135deg, #4A9E2A, #2A5E10);
  color: #fff; font-family: 'Sora',sans-serif; font-weight: 700; font-size: 0.92rem;
  transition: all 0.22s; box-shadow: 0 4px 16px rgba(74,158,42,0.3);
}
.abo-pay-confirm-btn:hover { transform: translateY(-1px); }
.abo-pay-cancel { text-align: center; margin-top: 12px; font-size: 0.78rem; color: #9BA3AE; cursor: pointer; }
.abo-pay-cancel:hover { color: #E53E3E; }
/* Expiration wall */
.abo-expiry-wall {
  display: none; position: fixed; inset: 0; z-index: 10000;
  background: linear-gradient(160deg, #2A5E10, #4A9E2A);
  flex-direction: column; align-items: center; justify-content: center;
  padding: 32px 24px; text-align: center;
}
.abo-expiry-wall.show { display: flex; }
.abo-expiry-icon { font-size: 3.5rem; margin-bottom: 16px; }
.abo-expiry-title {
  font-family: 'Sora',sans-serif; font-weight: 800; font-size: 1.3rem;
  color: #fff; margin-bottom: 10px;
}
.abo-expiry-text { font-size: 0.85rem; color: rgba(255,255,255,0.75); line-height: 1.6; margin-bottom: 28px; }
.abo-expiry-btn {
  padding: 14px 32px; border-radius: 14px; border: none; cursor: pointer;
  background: linear-gradient(135deg, #D4A843, #F59E0B);
  color: #2A5E10; font-family: 'Sora',sans-serif; font-weight: 800; font-size: 0.92rem;
  box-shadow: 0 4px 20px rgba(212,168,67,0.4);
}

/* â”€â”€ FIXES CRITIQUES â”€â”€ */
#page-abonnement {
  height: 100vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  position: relative;
  z-index: 1;
}
.abo-card {
  position: relative;
  z-index: 2;
  cursor: pointer;
  -webkit-tap-highlight-color: rgba(74,158,42,0.1);
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
}
.abo-cta-btn {
  position: relative;
  z-index: 2;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}
.abo-toggle {
  position: relative;
  z-index: 2;
  touch-action: manipulation;
}
.abo-card.standard .abo-price-amount { color: #3B82F6; }
.abo-card.pro .abo-price-amount { color: #8B5CF6; }
.abo-card.entreprise .abo-price-amount { color: #D4A843; }
.abo-card.standard .abo-card-name { color: #1A1E25; }
.abo-card.pro .abo-card-name { color: #1A1E25; }
.abo-card.entreprise .abo-card-name { color: #1A1E25; }
.abo-card .abo-card-features .abo-feat-check { color: #4A9E2A; font-weight: 900; }

</style>
  <!-- Leaflet â€” OpenStreetMap (gratuit, sans clÃ© API) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
</head>
<body>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  WELCOME SCREEN â€” ABAE v27                                  â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<style>
/* â”€â”€â”€ Reset Welcome â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#ws-screen {
  position: fixed; inset: 0; z-index: 100000;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  background: radial-gradient(ellipse at 50% 30%, #0e3d22 0%, #071a0f 55%, #000 100%);
  overflow: hidden;
  font-family: 'Sora', 'DM Sans', sans-serif;
  min-height: 100vh; min-height: 100dvh;
  width: 100%; height: 100%;
}
body.ws-active { overflow: hidden !important; }

/* â”€â”€â”€ Particules de fond â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#ws-particles {
  position: absolute; inset: 0; overflow: hidden; pointer-events: none;
}
.ws-particle {
  position: absolute; border-radius: 50%;
  background: radial-gradient(circle, rgba(46,204,113,0.6) 0%, transparent 70%);
  animation: ws-particle-float linear infinite;
  opacity: 0;
}
@keyframes ws-particle-float {
  0%   { transform: translateY(100vh) scale(0); opacity: 0; }
  10%  { opacity: 1; }
  90%  { opacity: 0.4; }
  100% { transform: translateY(-20vh) scale(1.5); opacity: 0; }
}

/* â”€â”€â”€ Anneaux lumineux derriÃ¨re le logo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#ws-rings {
  position: absolute; inset: 0; display: flex;
  align-items: center; justify-content: center;
  pointer-events: none; top: -60px;
}
.ws-ring {
  position: absolute; border-radius: 50%;
  border: 1.5px solid rgba(46,204,113,0.18);
  animation: ws-ring-pulse 3s ease-out infinite;
  opacity: 0;
}
.ws-ring:nth-child(1) { width: 200px; height: 200px; animation-delay: 0s; }
.ws-ring:nth-child(2) { width: 300px; height: 300px; animation-delay: 0.7s; }
.ws-ring:nth-child(3) { width: 420px; height: 420px; animation-delay: 1.4s; }
.ws-ring:nth-child(4) { width: 550px; height: 550px; animation-delay: 2.1s; }
@keyframes ws-ring-pulse {
  0%   { transform: scale(0.6); opacity: 0; }
  30%  { opacity: 1; }
  100% { transform: scale(1.4); opacity: 0; }
}

/* â”€â”€â”€ Zone logo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#ws-logo-wrap {
  position: relative; z-index: 2;
  display: flex; flex-direction: column; align-items: center;
  margin-bottom: 10px;
}

/* Halo vert derriÃ¨re le logo */
#ws-logo-halo {
  position: absolute;
  width: 180px; height: 180px; border-radius: 50%;
  background: radial-gradient(circle, rgba(74,158,42,0.55) 0%, transparent 70%);
  animation: ws-halo 2.8s ease-in-out infinite;
  filter: blur(12px);
}
@keyframes ws-halo {
  0%, 100% { transform: scale(1);   opacity: 0.6; }
  50%       { transform: scale(1.3); opacity: 1;   }
}

/* Logo image */
#ws-logo {
  width: 108px; height: 108px; border-radius: 24px;
  object-fit: cover; position: relative; z-index: 3;
  box-shadow: 0 0 0 0 rgba(46,204,113,0.5);
  animation: ws-logo-levitate 3.5s ease-in-out infinite,
             ws-logo-glow     2.8s ease-in-out infinite,
             ws-logo-appear   0.9s cubic-bezier(0.34,1.56,0.64,1) 0.2s both;
}
@keyframes ws-logo-appear {
  from { opacity: 0; transform: scale(0.4) rotate(-8deg); }
  to   { opacity: 1; transform: scale(1) rotate(0deg); }
}
@keyframes ws-logo-levitate {
  0%, 100% { transform: translateY(0px)   rotate(0deg); }
  30%      { transform: translateY(-12px) rotate(1.5deg); }
  70%      { transform: translateY(-6px)  rotate(-1deg); }
}
@keyframes ws-logo-glow {
  0%, 100% { box-shadow: 0 0 20px 4px rgba(46,204,113,0.25), 0 8px 32px rgba(0,0,0,0.5); }
  50%      { box-shadow: 0 0 40px 12px rgba(46,204,113,0.55), 0 12px 40px rgba(0,0,0,0.6); }
}

/* Ã‰tincelles orbitales autour du logo */
.ws-spark {
  position: absolute; z-index: 4;
  width: 6px; height: 6px; border-radius: 50%;
  background: #6ED63B;
  box-shadow: 0 0 6px 2px rgba(46,204,113,0.8);
  animation: ws-orbit var(--dur,4s) linear infinite;
  transform-origin: var(--tx,80px) var(--ty,0px);
}
@keyframes ws-orbit {
  from { transform: rotate(var(--start,0deg)) translateX(var(--r,75px)); }
  to   { transform: rotate(calc(var(--start,0deg) + 360deg)) translateX(var(--r,75px)); }
}

/* â”€â”€â”€ Texte â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#ws-texts {
  position: relative; z-index: 2;
  display: flex; flex-direction: column; align-items: center;
  margin-bottom: 48px; padding: 0 24px; text-align: center;
}
#ws-title {
  font-family: 'Sora', sans-serif;
  font-size: 1.35rem; font-weight: 800; color: #fff;
  letter-spacing: -0.3px; line-height: 1.1;
  white-space: nowrap; margin-bottom: 8px;
  opacity: 0; transform: translateY(18px);
  animation: ws-fadeslide 0.7s ease 0.85s forwards;
}
#ws-title span { color: #6ED63B; }
#ws-sub {
  font-family: 'DM Sans', sans-serif;
  font-size: 0.95rem; font-weight: 400;
  color: rgba(255,255,255,0.62); line-height: 1.5;
  opacity: 0; transform: translateY(14px);
  animation: ws-fadeslide 0.7s ease 1.1s forwards;
}
@keyframes ws-fadeslide {
  to { opacity: 1; transform: translateY(0); }
}

/* â”€â”€â”€ Boutons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#ws-btns {
  position: relative; z-index: 2;
  display: flex; flex-direction: column; align-items: center;
  gap: 14px; width: 100%; max-width: 340px; padding: 0 24px;
}
#ws-btn-connect {
  width: 100%; padding: 14px 24px;
  background: linear-gradient(135deg, #4A9E2A 0%, #0f5234 100%);
  color: #fff; font-family: 'Sora', sans-serif;
  font-size: 1rem; font-weight: 700; letter-spacing: 0.3px;
  border: none; border-radius: 16px; cursor: pointer;
  box-shadow: 0 6px 24px rgba(74,158,42,0.5), 0 0 0 0 rgba(46,204,113,0.3);
  opacity: 0; transform: scale(0.88);
  animation: ws-btn-pop 0.65s cubic-bezier(0.34,1.56,0.64,1) 1.35s forwards;
  transition: transform 0.18s ease, box-shadow 0.18s ease;
  position: relative; overflow: hidden;
}
#ws-btn-connect::before {
  content: '';
  position: absolute; top: -50%; left: -60%; width: 40%; height: 200%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
  transform: skewX(-20deg);
  animation: ws-btn-shine 3s ease 2s infinite;
}
@keyframes ws-btn-shine {
  0%   { left: -60%; }
  40%, 100% { left: 140%; }
}
#ws-btn-connect:hover { transform: scale(1.04) !important; box-shadow: 0 10px 32px rgba(74,158,42,0.65); }
#ws-btn-connect:active { transform: scale(0.97) !important; }

@keyframes ws-btn-pop {
  to { opacity: 1; transform: scale(1); }
}

#ws-btn-visitor {
  background: none; border: none;
  color: rgba(255,255,255,0.5);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.88rem; font-weight: 500;
  cursor: pointer; padding: 6px 12px;
  border-radius: 10px; letter-spacing: 0.2px;
  opacity: 0; animation: ws-fadeslide 0.5s ease 1.65s forwards;
  transition: color 0.2s ease;
}
#ws-btn-visitor:hover { color: rgba(255,255,255,0.9); }

/* â”€â”€â”€ Popup Inscription Requise â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#ws-popup-overlay {
  position: fixed; inset: 0; z-index: 999999;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
  display: flex; align-items: flex-end; justify-content: center;
  opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
}
#ws-popup-overlay.show { opacity: 1; pointer-events: all; }
#ws-popup {
  background: #fff; border-radius: 24px 24px 0 0;
  padding: 32px 24px 44px; width: 100%; max-width: 480px;
  transform: translateY(100%);
  transition: transform 0.38s cubic-bezier(0.34,1.15,0.64,1);
  text-align: center;
}
#ws-popup-overlay.show #ws-popup { transform: translateY(0); }
#ws-popup-icon { font-size: 2.4rem; margin-bottom: 12px; }
#ws-popup-title {
  font-family: 'Sora', sans-serif; font-weight: 800;
  font-size: 1.15rem; color: #1A1E25; margin-bottom: 8px;
}
#ws-popup-msg {
  font-size: 0.9rem; color: #6B7280; line-height: 1.6; margin-bottom: 26px;
}
#ws-popup-btn-main {
  width: 100%; padding: 15px;
  background: linear-gradient(135deg, #4A9E2A, #0f5234);
  color: #fff; font-family: 'Sora', sans-serif; font-weight: 700;
  font-size: 0.95rem; border: none; border-radius: 14px; cursor: pointer;
  margin-bottom: 10px; box-shadow: 0 4px 14px rgba(74,158,42,0.35);
  transition: transform 0.15s ease;
}
#ws-popup-btn-main:hover { transform: scale(1.02); }
#ws-popup-btn-later {
  width: 100%; padding: 13px; background: none;
  color: #9BA3AE; font-family: 'DM Sans', sans-serif;
  font-weight: 600; font-size: 0.9rem;
  border: none; border-radius: 14px; cursor: pointer;
  transition: color 0.15s ease;
}
#ws-popup-btn-later:hover { color: #3D4550; }

/* â”€â”€â”€ Badge visiteur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

</style>

<!-- â•â• WELCOME SCREEN HTML â•â• -->
<div id="ws-screen">
  <!-- Particules -->
  <div id="ws-particles"></div>

  <!-- Anneaux lumineux -->
  <div id="ws-rings">
    <div class="ws-ring"></div>
    <div class="ws-ring"></div>
    <div class="ws-ring"></div>
    <div class="ws-ring"></div>
  </div>

  <!-- Logo -->
  <div id="ws-logo-wrap">
    <div id="ws-logo-halo"></div>
    <img id="ws-logo" src="data:image/webp;base64,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" alt="ABAE Logo" />
    <!-- Ã‰tincelles orbitales -->
    <div class="ws-spark" style="--r:82px;--start:0deg;  --dur:5s;  --tx:82px; --ty:0;"></div>
    <div class="ws-spark" style="--r:82px;--start:120deg;--dur:7s;  --tx:82px; --ty:0;background:#D4A843;box-shadow:0 0 6px 2px rgba(212,168,67,0.8);"></div>
    <div class="ws-spark" style="--r:82px;--start:240deg;--dur:6s;  --tx:82px; --ty:0;background:#fff;box-shadow:0 0 6px 2px rgba(255,255,255,0.8);"></div>
    <div class="ws-spark" style="--r:100px;--start:60deg; --dur:9s;  --tx:100px;--ty:0;width:4px;height:4px;opacity:0.6;"></div>
    <div class="ws-spark" style="--r:100px;--start:200deg;--dur:8s;  --tx:100px;--ty:0;width:4px;height:4px;background:#D4A843;box-shadow:0 0 4px 2px rgba(212,168,67,0.6);opacity:0.7;"></div>
  </div>

  <!-- Texte -->
  <div id="ws-texts">
    <h1 id="ws-title">Bienvenue sur <span>ABAE</span></h1>
    <p id="ws-sub">Votre plateforme Digitale Agribusiness</p>
  </div>

  <!-- Boutons -->
  <div id="ws-btns">
    <button id="ws-btn-connect" onclick="wsConnect()">Se connecter</button>
    <button id="ws-btn-visitor" onclick="wsVisitor()">AccÃ©der en tant que visiteur</button>
  </div>
</div>

<!-- â•â• POPUP INSCRIPTION REQUISE â•â• -->
<div id="ws-popup-overlay">
  <div id="ws-popup">
    <div id="ws-popup-icon">ğŸ”’</div>
    <div id="ws-popup-title">ğŸ”’ Inscription requise</div>
    <p id="ws-popup-msg">Pour publier, commander ou interagir, veuillez crÃ©er un compte.</p>
    <button id="ws-popup-btn-main" onclick="wsPopupSignup()">S'inscrire maintenant</button>
    <button id="ws-popup-btn-later" onclick="wsClosePopup()">Plus tard</button>
  </div>
</div>


<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE STATE MANAGER v27
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ABAE_STATE = {
  isAuthenticated: false,
  isVisitorMode:   false,
  setAuth(v)    { this.isAuthenticated = v; if(v) this.isVisitorMode = false; this._sync(); },
  setVisitor(v) { this.isVisitorMode = v;   if(v) this.isAuthenticated = false; this._sync(); },
  _sync() {

  }
};
window.ABAE_STATE = ABAE_STATE;

// Middleware global pour actions sensibles
function abaeCanDo(action) {
  if (ABAE_STATE.isAuthenticated) return true;
  if (ABAE_STATE.isVisitorMode)  { wsShowPopup(action); return false; }
  return true;
}
window.abaeCanDo = abaeCanDo;

// â”€â”€ WelcomeScreen Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function _wsDismiss(cb) {
  const ws = document.getElementById('ws-screen');
  ws.style.transition = 'opacity 0.55s ease, transform 0.55s ease';
  ws.style.opacity = '0';
  ws.style.transform = 'scale(1.04)';
  setTimeout(() => {
    ws.style.display = 'none';
    document.body.classList.remove('ws-active');
    if(cb) cb();
  }, 560);
}
// Bloquer le scroll pendant que le welcome screen est visible
document.body.classList.add('ws-active');

function wsConnect() {
  _wsDismiss(() => {
    const _pacc_safe = document.getElementById('page-accueil') || document.getElementById('ws-screen'); if(_pacc_safe) _pacc_safe.style.display = 'none';
    if (typeof showView === 'function') showView('login');
  });
}

function wsVisitor() {
  ABAE_STATE.setVisitor(true);
  window.ABAE_BYPASS_AUTH = true;
  _wsDismiss(() => {
    const _pacc_safe = document.getElementById('page-accueil') || document.getElementById('ws-screen'); if(_pacc_safe) _pacc_safe.style.display = 'none';
    // Masquer toutes les pages sauf marche
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const pm = document.getElementById('page-marche');
    if (pm) { pm.classList.add('active'); pm.style.display = 'block'; }
    document.body.classList.add('marche-mode');
    document.documentElement.style.overflow = 'hidden';
    document.documentElement.style.height   = '100%';

    // Adapter l'interface pour le mode visiteur
    _applyVisitorUI();
  });
}

// â”€â”€ Appliquer l'UI visiteur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function _applyVisitorUI() {
  // â”€â”€ 1. Hero : nom et rÃ´le visiteur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const heroName = document.getElementById('heroUserName');
  if (heroName) heroName.textContent = 'Bienvenue ğŸ‘‹';
  const heroProfilLabel = document.getElementById('heroProfilLabel');
  if (heroProfilLabel) heroProfilLabel.textContent = 'ğŸ‘ Mode visiteur';

  // â”€â”€ 2. Masquer fonctionnalitÃ©s rÃ©servÃ©es aux membres â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const walletPill = document.querySelector('.wallet-pill');
  if (walletPill) walletPill.style.display = 'none';
  const subBadge = document.getElementById('subBadgeHero');
  if (subBadge) subBadge.style.display = 'none';

  // â”€â”€ 4. Masquer sections vendeur/acheteur personnel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // (pas d'offres ni demandes pour un visiteur)
  const mesOffres   = document.getElementById('mesOffresSection');
  const mesDemandes = document.getElementById('mesDemandesSection');
  const sellerBanner = document.getElementById('heroSellerBanner');
  const buyerBanner  = document.getElementById('heroBuyerBanner');
  if (mesOffres)    mesOffres.style.display = 'none';
  if (mesDemandes)  mesDemandes.style.display = 'none';
  if (sellerBanner) sellerBanner.style.display = 'none';
  if (buyerBanner)  buyerBanner.style.display = 'none';

  // â”€â”€ 6. Nav items restreints â€” feedback visuel et title â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const restrictedNavIds = ['nav-commandes','nav-portefeuille','nav-documents','nav-smart','nav-profil','nav-parametres'];
  restrictedNavIds.forEach(navId => {
    const el = document.getElementById(navId);
    if (!el) return;
    el.title = 'ğŸ”’ Connexion requise';
    // badge cadenas discret
    if (!el.dataset.visitorPatched) {
      el.dataset.visitorPatched = '1';
      const lock = document.createElement('span');
      lock.id = navId + '-lock';
      lock.style.cssText = 'position:absolute;top:4px;right:4px;font-size:0.5rem;line-height:1;opacity:0.65;';
      lock.textContent = 'ğŸ”’';
      el.style.position = 'relative';
      el.appendChild(lock);
    }
  });

  // â”€â”€ 7. Synchroniser le marchÃ© (pipeline existant) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Le ticker, la mÃ©tÃ©o et les cards s'initialisent automatiquement
  // via leur DOMContentLoaded. On s'assure juste que tout est cohÃ©rent.
  setTimeout(function syncVisitorMarket() {
    // 7a. Cards produits â€” mÃªmes PRODUCTS que les utilisateurs connectÃ©s
    if (typeof renderCards === 'function' && typeof PRODUCTS !== 'undefined') {
      renderCards(PRODUCTS);
    }

    // 7b. MÃ©tÃ©o â€” dÃ©clencher si pas encore chargÃ©e
    if (typeof refreshWeather === 'function') {
      const weatherTemp = document.getElementById('weatherTemp');
      if (weatherTemp && weatherTemp.textContent === '--Â°C') refreshWeather();
    }

    // 7c. Masquer la barre de raccourcis (actions rÃ©servÃ©es aux membres)
    const shortcutsBar = document.getElementById('marketShortcuts');
    if (shortcutsBar) shortcutsBar.style.display = 'none';

    // 7d. Stats globales marchÃ© â€” identiques Ã  tous les utilisateurs
    // (dÃ©jÃ  dans le HTML statique, aucune modification nÃ©cessaire)

    // 7e. Encart "Ce que vous pouvez faire" â€” notice visiteur sous les cards
    if (!document.getElementById('visitor-market-notice')) {
      const notice = document.createElement('div');
      notice.id = 'visitor-market-notice';
      notice.innerHTML = [
        '<span style="font-size:1.6rem;flex-shrink:0;margin-top:2px;">ğŸ‘</span>',
        '<div>',
          '<div style="font-family:Sora,sans-serif;font-weight:800;font-size:0.82rem;color:#2E7D32;margin-bottom:4px;letter-spacing:0.1px;">',
            'Mode Visiteur â€” AccÃ¨s en lecture seule',
          '</div>',
          '<div style="font-size:0.73rem;font-weight:500;color:#3D4550;line-height:1.55;">',
            'âœ… Voir les produits & prix Â· âœ… Explorer le marchÃ©<br>',
            'ğŸ”’ Commander Â· ğŸ”’ Publier Â· ğŸ”’ Contacter un vendeur',
          '</div>',
          '<button onclick="wsPopupSignup()" style="',
            'margin-top:10px;background:linear-gradient(135deg,#4A9E2A,#2A5E10);',
            'color:#fff;border:none;border-radius:11px;padding:9px 18px;',
            'font-family:Sora,sans-serif;font-weight:700;font-size:0.78rem;',
            'cursor:pointer;display:inline-flex;align-items:center;gap:7px;',
            'box-shadow:0 4px 14px rgba(74,158,42,0.35);',
          '">',
            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>',
            'CrÃ©er mon compte gratuitement',
          '</button>',
        '</div>',
      ].join('');
      const cardsGrid = document.getElementById('cardsGrid');
      if (cardsGrid && cardsGrid.parentNode) {
        cardsGrid.parentNode.insertBefore(notice, cardsGrid);
      }
    }
  }, 300);
}

// â”€â”€ Popup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wsShowPopup(action) {
  const msg = document.getElementById('ws-popup-msg');
  if (msg) {
    const msgs = {
      publier:   'Pour publier un produit ou service, vous devez crÃ©er un compte ABAE.',
      commander: 'Pour passer une commande, vous devez crÃ©er un compte ABAE.',
      service:   'Pour demander un service ou envoyer un message, vous devez crÃ©er un compte ABAE.',
      message:   'Pour envoyer un message, vous devez crÃ©er un compte ABAE.',
    };
    msg.textContent = msgs[action] || 'Pour publier, commander ou interagir, veuillez crÃ©er un compte.';
  }
  document.getElementById('ws-popup-overlay').classList.add('show');
}
function wsClosePopup() { document.getElementById('ws-popup-overlay').classList.remove('show'); }
function wsPopupSignup() {
  wsClosePopup();
  ABAE_STATE.setVisitor(false);
  const _pacc_safe = document.getElementById('page-accueil') || document.getElementById('ws-screen'); if(_pacc_safe) _pacc_safe.style.display = 'none';
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  if (typeof showView === 'function') showView('inscription');
}
document.getElementById('ws-popup-overlay').addEventListener('click', e => {
  if (e.target.id === 'ws-popup-overlay') wsClosePopup();
});

// â”€â”€ Particules animÃ©es â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function spawnParticles() {
  const container = document.getElementById('ws-particles');
  for (let i = 0; i < 18; i++) {
    const p = document.createElement('div');
    p.className = 'ws-particle';
    const size = 4 + Math.random() * 10;
    p.style.cssText = `
      width:${size}px; height:${size}px;
      left:${Math.random()*100}%;
      animation-duration:${5 + Math.random()*8}s;
      animation-delay:${Math.random()*6}s;
    `;
    container.appendChild(p);
  }
})();

// â”€â”€ Patch actions restreintes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// patchRestrictedActions est appliquÃ© aprÃ¨s chargement complet du DOM
document.addEventListener('DOMContentLoaded', function patchRestrictedActions() {
  const _origPush = window.pushScreen;
  if (typeof _origPush === 'function') {
    window.pushScreen = function(id) {
      if (window.ABAE_STATE && ABAE_STATE.isVisitorMode && (id === 'order' || id === 'commandes' || id === 'messages')) {
        wsShowPopup('commander'); return;
      }
      return _origPush.apply(this, arguments);
    };
  }
});
</script>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BARRE DE NAVIGATION DÃ‰MO â€” Flottante, permet de basculer entre les vues
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Toast (global) -->
<div class="toast" id="toast"></div>





<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VUES AUTH (ABAE_Auth_v3) â€” masquÃ©es par dÃ©faut
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- â”€â”€ PAGE : INSCRIPTION â”€â”€ -->
<div class="page" id="page-inscription">

  <!-- Dark immersive background -->
  <div class="insc-orb" style="width:350px;height:350px;background:#4A9E2A;top:-100px;left:-100px;animation-duration:9s;"></div>
  <div class="insc-orb" style="width:220px;height:220px;background:#6ED63B;bottom:-60px;right:-60px;animation-duration:12s;animation-delay:3s;opacity:0.15;"></div>
  <div class="insc-orb" style="width:180px;height:180px;background:#D4A843;top:45%;right:3%;animation-duration:10s;animation-delay:5s;opacity:0.1;"></div>
  <div style="position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;" aria-hidden="true">
    <div class="insc-particle" style="left:8%;animation-duration:12s;animation-delay:0s;width:3px;height:3px;"></div>
    <div class="insc-particle" style="left:22%;animation-duration:16s;animation-delay:2s;"></div>
    <div class="insc-particle" style="left:38%;animation-duration:11s;animation-delay:4s;width:3px;height:3px;"></div>
    <div class="insc-particle" style="left:55%;animation-duration:14s;animation-delay:1s;"></div>
    <div class="insc-particle" style="left:72%;animation-duration:13s;animation-delay:6s;"></div>
    <div class="insc-particle" style="left:88%;animation-duration:15s;animation-delay:3s;"></div>
  </div>

  <header class="hdr">
    <div class="hdr-in">
      <a href="#" class="hdr-back" onclick="showView('accueil');return false;"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>Retour</a>
      <a href="#" class="hdr-logo" onclick="showView('accueil');return false;"><img src="data:image/webp;base64,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" alt="ABAE" style="height:32px;width:auto;object-fit:contain;display:block;"></a>
      <span class="hdr-right"><a href="#" onclick="showView('login');return false;">Se connecter</a></span>
    </div>
  </header>

  <div class="prog" id="inscProg">
    <div class="prog-steps">
      <div class="prog-step active" id="ps1"><div class="prog-num">1</div><div class="prog-lbl">Profil</div></div>
      <div class="prog-step pending" id="ps2"><div class="prog-num">2</div><div class="prog-lbl">Infos</div></div>
      <div class="prog-step pending" id="ps3"><div class="prog-num">3</div><div class="prog-lbl">IdentitÃ©</div></div>
      <div class="prog-step pending" id="ps4"><div class="prog-num">4</div><div class="prog-lbl">SÃ©curitÃ©</div></div>
    </div>
  </div>

  <div class="fw">
    <div class="form-head">
      <div class="form-lm" style="background:none;box-shadow:none;border:none;padding:0;width:auto;height:auto;"><img src="data:image/webp;base64,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" alt="ABAE" style="width:56px;height:56px;object-fit:contain;"></div>
      <h1 class="form-title">CrÃ©er votre compte</h1>
      <p class="form-sub">Rejoignez ABAE gratuitement.</p>
    </div>

    <!-- Ã‰TAPE 1 â€” TYPE & PROFIL -->
    <div class="step active" id="s1"><div class="step-banner">ğŸ“‹ Ã‰tape 1 sur 4 â€” Votre profil</div>
      <div class="sec-lbl"><span>Vous reprÃ©sentezâ€¦</span></div>
      <div class="cards-grid" id="typeGrid">
        <div class="sel-card" data-type="individu" onclick="selCard('typeGrid',this);checkS1()">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
          <div class="sc-title">Je suis un individu</div><div class="sc-sub">Particulier, auto-entrepreneur</div>
        </div>
        <div class="sel-card" data-type="structure" onclick="selCard('typeGrid',this);checkS1()">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/><line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/></svg></div>
          <div class="sc-title">Je reprÃ©sente une structure</div><div class="sc-sub">SociÃ©tÃ©, coopÃ©rative, ONG</div>
        </div>
      </div>
      <div class="sec-lbl" style="margin-top:20px"><span>Vos rÃ´les <span style="font-weight:400;color:var(--gris-400);font-size:0.78rem;">(vous pouvez en choisir plusieurs)</span></span></div>

      <!-- Info message multi-rÃ´les -->
      <div style="background:var(--vert-clair);border-left:3px solid var(--vert-principal);border-radius:0 8px 8px 0;padding:10px 14px;margin-bottom:16px;font-size:0.82rem;color:var(--vert-fonce);display:flex;gap:8px;align-items:flex-start;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink:0;margin-top:1px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        <span>4 profils disponibles sur le marchÃ©. Vous pouvez en activer plusieurs. Le programme affiliÃ© est un parcours distinct ci-dessous.</span>
      </div>

      <div class="cards-grid" id="profilGrid">
        <div class="sel-card sel-card--multi" data-profil="producteur" onclick="toggleProfil(this);checkS1()">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><path d="M12 22V12"/><path d="M12 12C12 12 7 10 5 6c4 0 7 2 7 6z"/><path d="M12 12c0 0 5-2 7-6-4 0-7 2-7 6z"/><path d="M3 22h18"/></svg></div>
          <div class="sc-title">Vendeur</div><div class="sc-sub">Vente produits agricoles</div>
        </div>
        <div class="sel-card sel-card--multi" data-profil="acheteur" onclick="toggleProfil(this);checkS1()">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg></div>
          <div class="sc-title">Acheteur</div><div class="sc-sub">Achat produits & matiÃ¨res</div>
        </div>
        <div class="sel-card sel-card--multi" data-profil="transporteur" onclick="toggleProfil(this);checkS1()">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><rect x="1" y="3" width="15" height="13" rx="1"/><path d="M16 8h4l3 3v5h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg></div>
          <div class="sc-title">Transporteur</div><div class="sc-sub">Transport & logistique</div>
        </div>
        <div class="sel-card sel-card--multi" data-profil="partenaire" onclick="toggleProfil(this);checkS1()">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
          <div class="sc-title">Partenaire</div><div class="sc-sub">Investisseur, financeur</div>
        </div>

      </div>

      <!-- SÃ©parateur affiliÃ© â€” programme distinct -->
      <div style="margin-top:14px;padding:14px 16px;background:linear-gradient(135deg,#FFF0F6,#F0ECFF);border:1.5px solid rgba(155,27,106,0.25);border-radius:14px;display:flex;align-items:center;gap:12px;cursor:pointer;" onclick="showView('inscription-affilie');return false;">
        <div style="width:42px;height:42px;border-radius:12px;background:rgba(155,27,106,0.12);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#9B1B6A" stroke-width="2" stroke-linecap="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
        </div>
        <div style="flex:1;">
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:#4A0E6B;">Programme AffiliÃ© âœ¦</div>
          <div style="font-size:0.72rem;color:#9B1B6A;margin-top:2px;font-weight:500;">Invitez des pros Â· Gagnez des commissions Â· Inscription sÃ©parÃ©e â†’</div>
        </div>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9B1B6A" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
      </div>

      <!-- Case Ã  cocher demandeur d'emploi -->
      <div style="margin-top:16px;background:linear-gradient(135deg,#EFF8FF,#E8F5E9);border:1.5px solid rgba(26,92,138,0.2);border-radius:12px;padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;" onclick="document.getElementById('checkEmploi').click()">
        <input type="checkbox" id="checkEmploi" style="width:20px;height:20px;accent-color:#1A5C8A;flex-shrink:0;cursor:pointer;">
        <div>
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.85rem;color:#1A5C8A;">ğŸ’¼ Je cherche un emploi dans le secteur agro-pastoral</div>
          <div style="font-size:0.72rem;color:#4A7A9B;margin-top:2px;">Activez cette option pour Ãªtre visible des recruteurs sur la plateforme</div>
        </div>
      </div>

      <!-- RÃ©sumÃ© des rÃ´les sÃ©lectionnÃ©s -->
      <div id="rolesResume" style="display:none;margin-top:12px;padding:10px 14px;background:var(--gris-100);border-radius:10px;font-size:0.82rem;color:var(--gris-700);">
        <strong style="color:var(--vert-fonce);">Vos rÃ´les sÃ©lectionnÃ©s :</strong> <span id="rolesResumeText"></span>
      </div>
      <div style="margin-top:24px">
        <button class="btn btn-p" id="btn1" onclick="goStep(2)" disabled>Continuer <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
        <div class="sec-note"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>DonnÃ©es protÃ©gÃ©es, jamais revendues.</div>
      </div>
    </div>

    <!-- Ã‰TAPE 2 â€” INFORMATIONS (adaptÃ© individu ou structure) -->
    <div class="step" id="s2">
      <div class="step-banner" id="s2Banner">ğŸ‘¤ Ã‰tape 2 sur 4 â€” Informations personnelles</div>

      <!-- â•â• PAYS / RÃ‰GION / VILLE (commun) â•â• -->
      <div id="s2-pays-block">
        <div class="field">
          <div class="field-label"><span>Pays<span class="freq">*</span></span></div>
          <div class="sel-wrap">
            <select class="sel" id="pays" onchange="onPaysChange(this);checkS2()">
              <option value="" disabled selected>â€” SÃ©lectionner votre pays â€”</option>
              <optgroup label="ğŸŒ Afrique centrale">
                <option value="CM" data-code="+237" data-flag="ğŸ‡¨ğŸ‡²">ğŸ‡¨ğŸ‡² Cameroun (+237)</option>
                <option value="CG" data-code="+242" data-flag="ğŸ‡¨ğŸ‡¬">ğŸ‡¨ğŸ‡¬ Congo-Brazzaville (+242)</option>
                <option value="CD" data-code="+243" data-flag="ğŸ‡¨ğŸ‡©">ğŸ‡¨ğŸ‡© RD Congo (+243)</option>
                <option value="CF" data-code="+236" data-flag="ğŸ‡¨ğŸ‡«">ğŸ‡¨ğŸ‡« Centrafrique (+236)</option>
                <option value="TD" data-code="+235" data-flag="ğŸ‡¹ğŸ‡©">ğŸ‡¹ğŸ‡© Tchad (+235)</option>
                <option value="GA" data-code="+241" data-flag="ğŸ‡¬ğŸ‡¦">ğŸ‡¬ğŸ‡¦ Gabon (+241)</option>
                <option value="GQ" data-code="+240" data-flag="ğŸ‡¬ğŸ‡¶">ğŸ‡¬ğŸ‡¶ GuinÃ©e Ã‰quatoriale (+240)</option>
              </optgroup>
              <optgroup label="ğŸŒ Afrique de l'Ouest">
                <option value="BF" data-code="+226" data-flag="ğŸ‡§ğŸ‡«">ğŸ‡§ğŸ‡« Burkina Faso (+226)</option>
                <option value="CI" data-code="+225" data-flag="ğŸ‡¨ğŸ‡®">ğŸ‡¨ğŸ‡® CÃ´te d'Ivoire (+225)</option>
                <option value="GH" data-code="+233" data-flag="ğŸ‡¬ğŸ‡­">ğŸ‡¬ğŸ‡­ Ghana (+233)</option>
                <option value="ML" data-code="+223" data-flag="ğŸ‡²ğŸ‡±">ğŸ‡²ğŸ‡± Mali (+223)</option>
                <option value="NG" data-code="+234" data-flag="ğŸ‡³ğŸ‡¬">ğŸ‡³ğŸ‡¬ Nigeria (+234)</option>
                <option value="SN" data-code="+221" data-flag="ğŸ‡¸ğŸ‡³">ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal (+221)</option>
                <option value="TG" data-code="+228" data-flag="ğŸ‡¹ğŸ‡¬">ğŸ‡¹ğŸ‡¬ Togo (+228)</option>
                <option value="BJ" data-code="+229" data-flag="ğŸ‡§ğŸ‡¯">ğŸ‡§ğŸ‡¯ BÃ©nin (+229)</option>
              </optgroup>
              <optgroup label="ğŸŒ Afrique de l'Est">
                <option value="KE" data-code="+254" data-flag="ğŸ‡°ğŸ‡ª">ğŸ‡°ğŸ‡ª Kenya (+254)</option>
                <option value="RW" data-code="+250" data-flag="ğŸ‡·ğŸ‡¼">ğŸ‡·ğŸ‡¼ Rwanda (+250)</option>
              </optgroup>
              <optgroup label="ğŸŒ Europe">
                <option value="FR" data-code="+33"  data-flag="ğŸ‡«ğŸ‡·">ğŸ‡«ğŸ‡· France (+33)</option>
                <option value="BE" data-code="+32"  data-flag="ğŸ‡§ğŸ‡ª">ğŸ‡§ğŸ‡ª Belgique (+32)</option>
                <option value="CH" data-code="+41"  data-flag="ğŸ‡¨ğŸ‡­">ğŸ‡¨ğŸ‡­ Suisse (+41)</option>
                <option value="GB" data-code="+44"  data-flag="ğŸ‡¬ğŸ‡§">ğŸ‡¬ğŸ‡§ Royaume-Uni (+44)</option>
              </optgroup>
              <optgroup label="ğŸŒ AmÃ©rique">
                <option value="US" data-code="+1" data-flag="ğŸ‡ºğŸ‡¸">ğŸ‡ºğŸ‡¸ Ã‰tats-Unis (+1)</option>
                <option value="CA" data-code="+1" data-flag="ğŸ‡¨ğŸ‡¦">ğŸ‡¨ğŸ‡¦ Canada (+1)</option>
              </optgroup>
            </select>
          </div>
        </div>
        <div class="grid2">
          <div class="field">
            <div class="field-label"><span>RÃ©gion<span class="freq">*</span></span></div>
            <div class="sel-wrap">
              <select class="sel" id="region" disabled onchange="checkS2()">
                <option value="">â€” RÃ©gion â€”</option>
              </select>
            </div>
          </div>
          <div class="field">
            <div class="field-label"><span>Ville<span class="freq">*</span></span></div>
            <input class="input" id="ville" type="text" placeholder="Ex : Douala" autocapitalize="words" oninput="checkS2()" disabled>
          </div>
        </div>
      </div>

      <!-- â•â• FORMULAIRE INDIVIDU â•â• -->
      <div id="form-individu">
        <div class="sec-lbl"><span>IdentitÃ© personnelle</span></div>
        <div class="grid2">
          <div class="field"><div class="field-label"><span>PrÃ©nom<span class="freq">*</span></span></div><input class="input" id="prenom" type="text" placeholder="Ex : Jean-Pierre" autocomplete="given-name" autocapitalize="words" oninput="checkS2()"></div>
          <div class="field"><div class="field-label"><span>Nom<span class="freq">*</span></span></div><input class="input" id="nom" type="text" placeholder="Ex : Mbida" autocomplete="family-name" autocapitalize="words" oninput="checkS2()"></div>
        </div>
        <div class="field">
          <div class="field-label"><span>Date de naissance</span><span class="fopt">optionnel</span></div>
          <input class="input" id="ddn" type="date" autocomplete="bday">
        </div>
        <div class="field">
          <div class="field-label"><span>TÃ©lÃ©phone / WhatsApp<span class="freq">*</span></span></div>
          <div class="phone-wrap">
            <div class="phone-pfx" id="phonePfx" onclick="togglePhoneDrop()">
              <span id="phoneFlag">ğŸ‡¨ğŸ‡²</span><span id="phoneCode">+237</span>
              <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
            </div>
            <input class="phone-input" id="tel" type="tel" inputmode="numeric" placeholder="6 XX XX XX XX" autocomplete="tel-national" oninput="checkS2()">
          </div>
          <div class="fhint">UtilisÃ© pour vous contacter via WhatsApp</div>
        </div>
        <div class="field">
          <div class="field-label"><span>Adresse e-mail</span><span class="fopt">recommandÃ©</span></div>
          <input class="input" id="email" type="email" placeholder="exemple@mail.com" autocomplete="email">
          <div class="fwarn" id="emailWarn">âš  Un email vous permettra de rÃ©cupÃ©rer votre compte.</div>
        </div>
        <!-- â•â• PROFIL INTELLIGENT â•â• -->
        <div class="field" id="profilField">
          <div class="field-label"><span>Profil spÃ©cifique</span><span class="fopt">optionnel</span></div>
          <div class="sel-wrap">
            <select class="sel" id="activiteIndividu" onchange="selectProfil(this.value)">
              <option value="">â€” SÃ©lectionner â€”</option>
              <option value="agriculteur">ğŸŒ¾ Agriculteur</option>
              <option value="eleveur">ğŸ„ Ã‰leveur</option>
              <option value="maraicher">ğŸ¥¬ MaraÃ®cher</option>
              <option value="peche">ğŸŸ PÃªcheur / Aquaculteur</option>
              <option value="restaurant">ğŸ½ï¸ Restaurant / Maquis</option>
              <option value="hotel">ğŸ¨ HÃ´tel / HÃ©bergement</option>
              <option value="commerce">ğŸª Commerce / NÃ©goce</option>
              <option value="transformation">ğŸ­ Transformation agroalimentaire</option>
              <option value="transport">ğŸš› Transport agricole</option>
              <option value="cooperative">ğŸ¤ CoopÃ©rative / GIE</option>
              <option value="apiculture">ğŸ¯ Apiculture</option>
              <option value="autre">â• Autre activitÃ©</option>
            </select>
          </div>

          <!-- Sous-champs dynamiques selon le profil -->
          <div class="profil-subfields" id="profilSubfields" style="display:none"></div>
        </div>
      </div>

      <!-- â•â• FORMULAIRE STRUCTURE â•â• -->
      <div id="form-structure" style="display:none">
        <div class="sec-lbl"><span>Informations de la structure</span></div>
        <div class="field"><div class="field-label"><span>Nom de la structure<span class="freq">*</span></span></div><input class="input" id="nomStructure" type="text" placeholder="Ex : CoopÃ©rative Agricole du Centre" autocapitalize="words" oninput="checkS2()"></div>
        <div class="grid2">
          <div class="field">
            <div class="field-label"><span>Type de structure<span class="freq">*</span></span></div>
            <div class="sel-wrap">
              <select class="sel" id="typeStructure" onchange="checkS2()">
                <option value="">â€” Choisir â€”</option>
                <option>SociÃ©tÃ© (SARL, SAâ€¦)</option>
                <option>CoopÃ©rative agricole</option>
                <option>Association / ONG</option>
                <option>GIE (Groupement d'IntÃ©rÃªt Ã‰conomique)</option>
                <option>Entreprise individuelle</option>
                <option>Autre</option>
              </select>
            </div>
          </div>
          <div class="field"><div class="field-label"><span>NumÃ©ro RC / RCCM</span><span class="fopt">optionnel</span></div><input class="input" id="rccm" type="text" placeholder="Ex : RC/DLA/2020/B/1234"></div>
        </div>
        <div class="field"><div class="field-label"><span>NumÃ©ro de contribuable / NIF</span><span class="fopt">optionnel</span></div><input class="input" id="nif" type="text" placeholder="Ex : M012024578901K"></div>
        <div class="field">
          <div class="field-label"><span>Secteur d'activitÃ©<span class="freq">*</span></span></div>
          <div class="sel-wrap">
            <select class="sel" id="secteurStructure" onchange="checkS2()">
              <option value="">â€” SÃ©lectionner â€”</option>
              <option>Production agricole</option>
              <option>Ã‰levage & pastoralisme</option>
              <option>Transformation agroalimentaire</option>
              <option>Commerce & distribution</option>
              <option>Transport & logistique</option>
              <option>Stockage & entrepÃ´t</option>
              <option>Finance & investissement agricole</option>
              <option>Conseil & formation</option>
              <option>Autre</option>
            </select>
          </div>
        </div>

        <div class="sec-lbl"><span>ReprÃ©sentant lÃ©gal</span></div>
        <div class="grid2">
          <div class="field"><div class="field-label"><span>PrÃ©nom<span class="freq">*</span></span></div><input class="input" id="prenomS" type="text" placeholder="Ex : Jean-Pierre" autocomplete="given-name" autocapitalize="words" oninput="checkS2()"></div>
          <div class="field"><div class="field-label"><span>Nom<span class="freq">*</span></span></div><input class="input" id="nomS" type="text" placeholder="Ex : Mbida" autocomplete="family-name" autocapitalize="words" oninput="checkS2()"></div>
        </div>
        <div class="field"><div class="field-label"><span>Fonction / Poste</span><span class="fopt">optionnel</span></div><input class="input" id="fonction" type="text" placeholder="Ex : Directeur GÃ©nÃ©ral, PrÃ©sident"></div>

        <div class="sec-lbl"><span>Contacts de la structure</span></div>
        <div class="field">
          <div class="field-label"><span>TÃ©lÃ©phone principal<span class="freq">*</span></span></div>
          <div class="phone-wrap">
            <div class="phone-pfx" id="phonePfxS" onclick="togglePhoneDrop('S')">
              <span id="phoneFlagS">ğŸ‡¨ğŸ‡²</span><span id="phoneCodeS">+237</span>
              <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
            </div>
            <input class="phone-input" id="telS" type="tel" inputmode="numeric" placeholder="6 XX XX XX XX" oninput="checkS2()">
          </div>
        </div>
        <div class="grid2">
          <div class="field"><div class="field-label"><span>Email professionnel</span><span class="fopt">recommandÃ©</span></div><input class="input" id="emailS" type="email" placeholder="contact@societe.com" autocomplete="email"><div class="fwarn" id="emailWarnS"></div></div>
          <div class="field"><div class="field-label"><span>Site web</span><span class="fopt">optionnel</span></div><input class="input" id="siteWeb" type="url" placeholder="https://www.societe.com"></div>
        </div>
        <div class="field"><div class="field-label"><span>Nombre d'employÃ©s</span><span class="fopt">optionnel</span></div>
          <div class="sel-wrap"><select class="sel" id="nbEmployes">
            <option value="">â€” SÃ©lectionner â€”</option>
            <option>1 (auto-entrepreneur)</option>
            <option>2 â€“ 10</option>
            <option>11 â€“ 50</option>
            <option>51 â€“ 200</option>
            <option>Plus de 200</option>
          </select></div>
        </div>
      </div>

      <!-- â•â• CODE PARRAINAGE (commun) â•â• -->
      <div class="field" style="margin-top:8px">
        <div class="field-label"><span>Code de parrainage</span><span class="fopt">optionnel</span></div>
        <div class="iico">
          <svg class="ico-l" viewBox="0 0 24 24"><path d="M20 12v10H4V12"/><path d="M22 7H2v5h20V7z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 010-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 000-5C13 2 12 7 12 7z"/></svg>
          <input class="input" id="parrainage" type="text" placeholder="ABAE-XXXX" style="text-transform:uppercase" oninput="checkAffiliate(this.value)">
        </div>
        <div class="fmsg ok" id="affOk"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>Code valide â€” votre parrain recevra une commission.</div>
      </div>

      <button class="btn btn-p" id="btn2" onclick="goStep(3)" disabled>Continuer <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
      <button class="btn-back" onclick="goStep(1)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Ã‰tape prÃ©cÃ©dente</button>
    </div>

    <!-- Ã‰TAPE 3 â€” KYC / IDENTITÃ‰ -->
    <div class="step" id="s3"><div class="step-banner">ğŸ” Ã‰tape 3 sur 4 â€” VÃ©rification d'identitÃ© (KYC)</div>
      <div class="alert alert-info">
        <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        <div><strong>VÃ©rification d'identitÃ©</strong><br>Vos documents sont chiffrÃ©s et ne sont jamais partagÃ©s sans votre consentement.</div>
      </div>
      <div class="sec-lbl"><span>Type de document</span></div>
      <div class="cards-grid cols3" id="docGrid">
        <div class="sel-card" data-doc="cni" onclick="selCard('docGrid',this)">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg></div>
          <div class="sc-title">CNI</div><div class="sc-sub">Carte Nationale d'IdentitÃ©</div>
        </div>
        <div class="sel-card" data-doc="passeport" onclick="selCard('docGrid',this)">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"/><circle cx="12" cy="10" r="3"/><line x1="8" y1="17" x2="16" y2="17"/></svg></div>
          <div class="sc-title">Passeport</div><div class="sc-sub">International</div>
        </div>
        <div class="sel-card" data-doc="permis" onclick="selCard('docGrid',this)">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><rect x="1" y="3" width="15" height="13" rx="1"/><path d="M16 8h4l3 3v5h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg></div>
          <div class="sc-title">Permis</div><div class="sc-sub">De conduire</div>
        </div>
      </div>
      <div class="sec-lbl" style="margin-top:20px"><span>Photos du document</span></div>
      <div class="grid2">
        <div class="upload-zone" id="uz1" onclick="triggerUpload('uf1')">
          <input type="file" id="uf1" accept="image/*,.pdf" onchange="handleUpload(this,'uz1')" style="display:none">
          <div class="upload-icon"><svg viewBox="0 0 24 24"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0018 9h-1.26A8 8 0 103 16.3"/></svg></div>
          <div class="upload-title">Recto</div><div class="upload-sub">JPG, PNG, PDF Â· max 5 Mo</div>
        </div>
        <div class="upload-zone" id="uz2" onclick="triggerUpload('uf2')">
          <input type="file" id="uf2" accept="image/*,.pdf" onchange="handleUpload(this,'uz2')" style="display:none">
          <div class="upload-icon"><svg viewBox="0 0 24 24"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0018 9h-1.26A8 8 0 103 16.3"/></svg></div>
          <div class="upload-title">Verso</div><div class="upload-sub">JPG, PNG, PDF Â· max 5 Mo</div>
        </div>
      </div>
      <div class="field" style="margin-top:16px">
        <div class="field-label"><span>NumÃ©ro du document<span class="freq">*</span></span></div>
        <input class="input" id="docNum" type="text" placeholder="Ex : 12345678A" autocomplete="off">
      </div>
      <button class="btn btn-p" onclick="goStep(4)">Continuer <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
      <div class="link-center" style="margin-top:12px"><button onclick="showKycModal()">Passer cette Ã©tape pour l'instant</button></div>
      <button class="btn-back" onclick="goStep(2)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Ã‰tape prÃ©cÃ©dente</button>
    </div>

    <!-- Ã‰TAPE 4 â€” SÃ‰CURITÃ‰ -->
    <div class="step" id="s4"><div class="step-banner">ğŸ”’ Ã‰tape 4 sur 4 â€” SÃ©curitÃ© & mot de passe</div>
      <div class="sec-lbl"><span>Choisissez un mot de passe</span></div>
      <div class="field">
        <div class="field-label"><span>Mot de passe<span class="freq">*</span></span></div>
        <div class="iico">
          <input class="input" id="pw1" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" oninput="updatePwStr(this.value);checkS4()" style="padding-right:42px">
          <svg class="ico-r" viewBox="0 0 24 24" onclick="togglePw('pw1',this)"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </div>
        <div class="pw-wrap" id="pwWrap" style="display:none">
          <div class="pw-bars"><div class="pw-bar" id="b1"></div><div class="pw-bar" id="b2"></div><div class="pw-bar" id="b3"></div><div class="pw-bar" id="b4"></div></div>
          <div class="pw-rules">
            <div class="pw-rule" id="r1"><div class="pw-dot"></div>Au moins 8 caractÃ¨res</div>
            <div class="pw-rule" id="r2"><div class="pw-dot"></div>Une lettre majuscule</div>
            <div class="pw-rule" id="r3"><div class="pw-dot"></div>Un chiffre ou symbole</div>
          </div>
        </div>
      </div>
      <div class="field">
        <div class="field-label"><span>Confirmer<span class="freq">*</span></span></div>
        <div class="iico">
          <input class="input" id="pw2" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" oninput="checkPwMatch();checkS4()" style="padding-right:42px">
          <svg class="ico-r" viewBox="0 0 24 24" onclick="togglePw('pw2',this)"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </div>
        <div class="fmsg err" id="pwErr">Les mots de passe ne correspondent pas.</div>
      </div>
      <div class="cgu" onclick="toggleCgu()">
        <div class="chk" id="cguChk"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
        <div class="cgu-txt">J'accepte les <a href="#" onclick="event.stopPropagation();openSheet('cguSheet')">CGU</a> et la <a href="#" onclick="event.stopPropagation();openSheet('privacySheet')">Politique de confidentialitÃ©</a> d'ABAE.</div>
      </div>
      <button class="btn btn-p" id="btn4" onclick="submitForm()" disabled>CrÃ©er mon compte <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
      <div class="reas-row">
        <div class="reas-item"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>SÃ©curisÃ©</div>
        <div class="reas-sep"></div>
        <div class="reas-item"><svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>Gratuit</div>
        <div class="reas-sep"></div>
        <div class="reas-item"><svg viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>2 minutes</div>
      </div>
      <div class="link-center" style="margin-top:14px">DÃ©jÃ  inscrit ? <a href="#" onclick="showView('login')">Se connecter</a></div>
      <button class="btn-back" onclick="goStep(3)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Ã‰tape prÃ©cÃ©dente</button>
    </div>
  </div>

  <footer class="footer-mini"><p>Â© 2026 <strong style="color:var(--or-accent)">ABAE</strong><span>Â·</span><a href="#" onclick="openSheet('privacySheet')">ConfidentialitÃ©</a><span>Â·</span><a href="#" onclick="openSheet('cguSheet')">CGU</a><span>Â·</span><a href="#">Contact</a></p></footer>
</div><!-- /page-inscription -->


<!-- â”€â”€ PAGE : INSCRIPTION AFFILIÃ‰ â”€â”€ -->
<div class="page" id="page-inscription-affilie">

  <!-- Dark immersive background -->
  <div class="insc-orb" style="width:320px;height:320px;background:#4A0E6B;top:-80px;left:-80px;animation-duration:10s;"></div>
  <div class="insc-orb" style="width:200px;height:200px;background:#9B1B6A;bottom:-50px;right:-50px;animation-duration:13s;animation-delay:4s;opacity:0.18;"></div>
  <div class="insc-orb" style="width:150px;height:150px;background:#4A9E2A;top:40%;right:5%;animation-duration:9s;animation-delay:2s;opacity:0.12;"></div>

  <header class="hdr">
    <div class="hdr-in">
      <a href="#" class="hdr-back" onclick="showView('inscription');return false;"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>Retour</a>
      <a href="#" class="hdr-logo" onclick="showView('accueil');return false;"><img src="data:image/webp;base64,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" alt="ABAE" style="height:32px;width:auto;object-fit:contain;display:block;"></a>
      <span class="hdr-right"><a href="#" onclick="showView('login');switchLoginProfile('affilie');return false;" style="color:#9B1B6A;font-weight:700">Se connecter âœ¦</a></span>
    </div>
  </header>

  <div class="prog" id="affProg">
    <div class="prog-steps">
      <div class="prog-step active" id="aps1"><div class="prog-num">1</div><div class="prog-lbl">Profil</div></div>
      <div class="prog-step pending" id="aps2"><div class="prog-num">2</div><div class="prog-lbl">Infos</div></div>
      <div class="prog-step pending" id="aps3"><div class="prog-num">3</div><div class="prog-lbl">IdentitÃ©</div></div>
      <div class="prog-step pending" id="aps4"><div class="prog-num">4</div><div class="prog-lbl">SÃ©curitÃ©</div></div>
    </div>
  </div>

  <div class="fw">
    <div class="form-head">
      <div class="form-lm" style="background:linear-gradient(135deg,#4A0E6B,#9B1B6A)"><span>AFF</span></div>
      <h1 class="form-title">Devenir AffiliÃ© ABAE</h1>
      <p class="form-sub">Parcours simplifiÃ© â€” 4 Ã©tapes en 2 minutes.</p>
    </div>

    <!-- AFF Ã‰TAPE 1 â€” TYPE D'AFFILIÃ‰ -->
    <div class="step active" id="as1">
      <div class="aff-step-banner">ğŸ”— Ã‰tape 1 sur 4 â€” Votre profil d'affiliÃ©</div>

      <div class="aff-profil-banner">
        <div class="aff-profil-icon">
          <svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
        </div>
        <div>
          <div class="aff-profil-title">Programme AffiliÃ© ABAE</div>
          <div class="aff-profil-sub">Recrutez des acteurs du secteur agro-pastoral et percevez des commissions sur leurs transactions.</div>
        </div>
      </div>

      <div class="aff-perks">
        <div class="aff-perk">
          <div class="aff-perk-icon green"><svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
          <div class="aff-perk-text"><strong>Commissions</strong>Sur chaque transaction de vos filleuls</div>
        </div>
        <div class="aff-perk">
          <div class="aff-perk-icon gold"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
          <div class="aff-perk-text"><strong>Filleuls illimitÃ©s</strong>Aucun plafond de recrutement</div>
        </div>
        <div class="aff-perk">
          <div class="aff-perk-icon blue"><svg viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg></div>
          <div class="aff-perk-text"><strong>Tableau de bord</strong>Suivi en temps rÃ©el de vos gains</div>
        </div>
        <div class="aff-perk">
          <div class="aff-perk-icon purple"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></div>
          <div class="aff-perk-text"><strong>KYC simplifiÃ©</strong>Seulement une piÃ¨ce d'identitÃ©</div>
        </div>
      </div>

      <div class="sec-lbl"><span>Vous Ãªtesâ€¦</span></div>

      <div class="aff-type-card active" id="affType-individu" onclick="selAffType('individu')">
        <div class="aff-type-icon">
          <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        </div>
        <div>
          <div class="aff-type-title">Individu</div>
          <div class="aff-type-sub">Particulier, crÃ©ateur de contenu, influenceur</div>
        </div>
        <div class="aff-type-chk" id="affTypeChk-individu"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
      </div>

      <div class="aff-type-card" id="affType-agence" onclick="selAffType('agence')">
        <div class="aff-type-icon">
          <svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/><line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/></svg>
        </div>
        <div>
          <div class="aff-type-title">Structure / Agence</div>
          <div class="aff-type-sub">Agence de recrutement, association, ONG</div>
        </div>
        <div class="aff-type-chk" id="affTypeChk-agence"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
      </div>

      <div style="margin-top:24px">
        <button class="btn btn-p" id="abtn1" onclick="affGoStep(2)" style="background:linear-gradient(135deg,#4A0E6B,#9B1B6A);box-shadow:0 4px 14px rgba(155,27,106,0.35)">Continuer <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
        <div class="sec-note"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>Inscription gratuite Â· Activez votre code en 2 min.</div>
      </div>
    </div>

    <!-- AFF Ã‰TAPE 2 â€” INFOS DE BASE -->
    <div class="step" id="as2">
      <div class="aff-step-banner">ğŸ‘¤ Ã‰tape 2 sur 4 â€” Informations de base</div>

      <div id="aff-form-individu">
        <div class="grid2">
          <div class="field"><div class="field-label"><span>PrÃ©nom<span class="freq">*</span></span></div><input class="input" id="affPrenom" type="text" placeholder="Ex : Aminata" autocomplete="given-name" autocapitalize="words" oninput="checkAffS2()"></div>
          <div class="field"><div class="field-label"><span>Nom<span class="freq">*</span></span></div><input class="input" id="affNom" type="text" placeholder="Ex : Diallo" autocomplete="family-name" autocapitalize="words" oninput="checkAffS2()"></div>
        </div>
      </div>

      <div id="aff-form-agence" style="display:none">
        <div class="field"><div class="field-label"><span>Nom de la structure<span class="freq">*</span></span></div><input class="input" id="affNomStructure" type="text" placeholder="Ex : AfriConnect Agency" autocapitalize="words" oninput="checkAffS2()"></div>
        <div class="field">
          <div class="field-label"><span>Type de structure<span class="freq">*</span></span></div>
          <div class="sel-wrap"><select class="sel" id="affTypeStructure" onchange="checkAffS2()">
            <option value="">â€” Choisir â€”</option>
            <option>Agence de recrutement</option>
            <option>Association / ONG</option>
            <option>Entreprise de communication</option>
            <option>RÃ©seau de distribution</option>
            <option>Autre</option>
          </select></div>
        </div>
        <div class="sec-lbl"><span>ReprÃ©sentant</span></div>
        <div class="grid2">
          <div class="field"><div class="field-label"><span>PrÃ©nom<span class="freq">*</span></span></div><input class="input" id="affPrenom2" type="text" placeholder="Ex : Aminata" autocapitalize="words" oninput="checkAffS2()"></div>
          <div class="field"><div class="field-label"><span>Nom<span class="freq">*</span></span></div><input class="input" id="affNom2" type="text" placeholder="Ex : Diallo" autocapitalize="words" oninput="checkAffS2()"></div>
        </div>
      </div>

      <div class="field">
        <div class="field-label"><span>Pays<span class="freq">*</span></span></div>
        <div class="sel-wrap">
          <select class="sel" id="affPays" onchange="onAffPaysChange(this);checkAffS2()">
            <option value="" disabled selected>â€” SÃ©lectionner votre pays â€”</option>
            <optgroup label="ğŸŒ Afrique centrale">
              <option value="CM" data-code="+237" data-flag="ğŸ‡¨ğŸ‡²">ğŸ‡¨ğŸ‡² Cameroun (+237)</option>
              <option value="CG" data-code="+242" data-flag="ğŸ‡¨ğŸ‡¬">ğŸ‡¨ğŸ‡¬ Congo (+242)</option>
              <option value="GA" data-code="+241" data-flag="ğŸ‡¬ğŸ‡¦">ğŸ‡¬ğŸ‡¦ Gabon (+241)</option>
              <option value="CD" data-code="+243" data-flag="ğŸ‡¨ğŸ‡©">ğŸ‡¨ğŸ‡© RD Congo (+243)</option>
            </optgroup>
            <optgroup label="ğŸŒ Afrique de l'Ouest">
              <option value="SN" data-code="+221" data-flag="ğŸ‡¸ğŸ‡³">ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal (+221)</option>
              <option value="CI" data-code="+225" data-flag="ğŸ‡¨ğŸ‡®">ğŸ‡¨ğŸ‡® CÃ´te d'Ivoire (+225)</option>
              <option value="NG" data-code="+234" data-flag="ğŸ‡³ğŸ‡¬">ğŸ‡³ğŸ‡¬ Nigeria (+234)</option>
              <option value="GH" data-code="+233" data-flag="ğŸ‡¬ğŸ‡­">ğŸ‡¬ğŸ‡­ Ghana (+233)</option>
              <option value="ML" data-code="+223" data-flag="ğŸ‡²ğŸ‡±">ğŸ‡²ğŸ‡± Mali (+223)</option>
              <option value="BF" data-code="+226" data-flag="ğŸ‡§ğŸ‡«">ğŸ‡§ğŸ‡« Burkina Faso (+226)</option>
            </optgroup>
            <optgroup label="ğŸŒ Europe">
              <option value="FR" data-code="+33" data-flag="ğŸ‡«ğŸ‡·">ğŸ‡«ğŸ‡· France (+33)</option>
              <option value="BE" data-code="+32" data-flag="ğŸ‡§ğŸ‡ª">ğŸ‡§ğŸ‡ª Belgique (+32)</option>
              <option value="CH" data-code="+41" data-flag="ğŸ‡¨ğŸ‡­">ğŸ‡¨ğŸ‡­ Suisse (+41)</option>
            </optgroup>
            <optgroup label="ğŸŒ AmÃ©rique">
              <option value="US" data-code="+1" data-flag="ğŸ‡ºğŸ‡¸">ğŸ‡ºğŸ‡¸ Ã‰tats-Unis (+1)</option>
              <option value="CA" data-code="+1" data-flag="ğŸ‡¨ğŸ‡¦">ğŸ‡¨ğŸ‡¦ Canada (+1)</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="field">
        <div class="field-label"><span>TÃ©lÃ©phone / WhatsApp<span class="freq">*</span></span></div>
        <div class="phone-wrap">
          <div class="phone-pfx" id="affPhonePfx" onclick="toggleAffPhoneDrop()">
            <span id="affPhoneFlag">ğŸ‡¨ğŸ‡²</span><span id="affPhoneCode">+237</span>
            <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
          </div>
          <input class="phone-input" id="affTel" type="tel" inputmode="numeric" placeholder="6 XX XX XX XX" oninput="checkAffS2()">
        </div>
        <div class="fhint">UtilisÃ© pour vous contacter via WhatsApp</div>
      </div>

      <div class="field">
        <div class="field-label"><span>Adresse e-mail<span class="freq">*</span></span></div>
        <input class="input" id="affEmail" type="email" placeholder="exemple@mail.com" autocomplete="email" oninput="checkAffS2()">
        <div class="fhint">Obligatoire pour recevoir vos commissions et accÃ©der Ã  votre espace affiliÃ©</div>
      </div>

      <button class="btn btn-p" id="abtn2" onclick="affGoStep(3)" disabled style="background:linear-gradient(135deg,#4A0E6B,#9B1B6A);box-shadow:0 4px 14px rgba(155,27,106,0.35)">Continuer <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
      <button class="btn-back" onclick="affGoStep(1)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Ã‰tape prÃ©cÃ©dente</button>
    </div>

    <!-- AFF Ã‰TAPE 3 â€” IDENTITÃ‰ LÃ‰GÃˆRE -->
    <div class="step" id="as3">
      <div class="aff-step-banner">ğŸªª Ã‰tape 3 sur 4 â€” VÃ©rification d'identitÃ©</div>

      <div class="alert alert-info">
        <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        <div><strong>KYC simplifiÃ© pour les affiliÃ©s</strong><br>Seulement une CNI ou un passeport â€” pas d'autres documents requis.</div>
      </div>

      <div class="sec-lbl"><span>Type de document</span></div>
      <div class="cards-grid" id="affDocGrid" style="grid-template-columns:1fr 1fr">
        <div class="sel-card" data-doc="cni" onclick="selCard('affDocGrid',this)">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg></div>
          <div class="sc-title">CNI</div><div class="sc-sub">Carte Nationale d'IdentitÃ©</div>
        </div>
        <div class="sel-card" data-doc="passeport" onclick="selCard('affDocGrid',this)">
          <div class="sc-badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="sc-icon"><svg viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"/><circle cx="12" cy="10" r="3"/><line x1="8" y1="17" x2="16" y2="17"/></svg></div>
          <div class="sc-title">Passeport</div><div class="sc-sub">International</div>
        </div>
      </div>

      <div class="sec-lbl" style="margin-top:20px"><span>Photos du document</span></div>
      <div class="grid2">
        <div class="upload-zone" id="auz1" onclick="triggerUpload('auf1')">
          <input type="file" id="auf1" accept="image/*,.pdf" onchange="handleUpload(this,'auz1')" style="display:none">
          <div class="upload-icon"><svg viewBox="0 0 24 24"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0018 9h-1.26A8 8 0 103 16.3"/></svg></div>
          <div class="upload-title">Recto</div><div class="upload-sub">JPG, PNG, PDF Â· max 5 Mo</div>
        </div>
        <div class="upload-zone" id="auz2" onclick="triggerUpload('auf2')">
          <input type="file" id="auf2" accept="image/*,.pdf" onchange="handleUpload(this,'auz2')" style="display:none">
          <div class="upload-icon"><svg viewBox="0 0 24 24"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0018 9h-1.26A8 8 0 103 16.3"/></svg></div>
          <div class="upload-title">Verso</div><div class="upload-sub">JPG, PNG, PDF Â· max 5 Mo</div>
        </div>
      </div>
      <div class="field" style="margin-top:16px">
        <div class="field-label"><span>NumÃ©ro du document<span class="freq">*</span></span></div>
        <input class="input" id="affDocNum" type="text" placeholder="Ex : 12345678A" autocomplete="off">
      </div>
      <button class="btn btn-p" onclick="affGoStep(4)" style="background:linear-gradient(135deg,#4A0E6B,#9B1B6A);box-shadow:0 4px 14px rgba(155,27,106,0.35)">Continuer <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
      <button class="btn-back" onclick="affGoStep(2)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Ã‰tape prÃ©cÃ©dente</button>
    </div>

    <!-- AFF Ã‰TAPE 4 â€” MOT DE PASSE + CODE -->
    <div class="step" id="as4">
      <div class="aff-step-banner">ğŸ”’ Ã‰tape 4 sur 4 â€” SÃ©curitÃ© & code affiliÃ©</div>

      <div class="aff-code-preview" id="affCodePreviewBox">
        <div class="aff-code-label">Votre code affiliÃ© (gÃ©nÃ©rÃ© automatiquement)</div>
        <div class="aff-code-value" id="affCodePreview">ABAE-????</div>
        <div class="aff-code-hint">Ce code sera confirmÃ© aprÃ¨s la crÃ©ation de votre compte</div>
      </div>

      <div class="sec-lbl"><span>Choisissez un mot de passe</span></div>
      <div class="field">
        <div class="field-label"><span>Mot de passe<span class="freq">*</span></span></div>
        <div class="iico">
          <input class="input" id="affPw1" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" oninput="updateAffPwStr(this.value);checkAffS4()" style="padding-right:42px">
          <svg class="ico-r" viewBox="0 0 24 24" onclick="togglePw('affPw1',this)"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </div>
        <div class="pw-wrap" id="affPwWrap" style="display:none">
          <div class="pw-bars"><div class="pw-bar" id="ab1"></div><div class="pw-bar" id="ab2"></div><div class="pw-bar" id="ab3"></div><div class="pw-bar" id="ab4"></div></div>
          <div class="pw-rules">
            <div class="pw-rule" id="ar1"><div class="pw-dot"></div>Au moins 8 caractÃ¨res</div>
            <div class="pw-rule" id="ar2"><div class="pw-dot"></div>Une lettre majuscule</div>
            <div class="pw-rule" id="ar3"><div class="pw-dot"></div>Un chiffre ou symbole</div>
          </div>
        </div>
      </div>
      <div class="field">
        <div class="field-label"><span>Confirmer<span class="freq">*</span></span></div>
        <div class="iico">
          <input class="input" id="affPw2" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" oninput="checkAffPwMatch();checkAffS4()" style="padding-right:42px">
          <svg class="ico-r" viewBox="0 0 24 24" onclick="togglePw('affPw2',this)"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </div>
        <div class="fmsg err" id="affPwErr">Les mots de passe ne correspondent pas.</div>
      </div>
      <div class="cgu-aff-row" onclick="toggleAffCguProg()">
        <div class="chk" id="affCguProgChk"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
        <div class="cgu-aff-row-txt">
          <strong>J'accepte les Conditions du Programme d'Affiliation ABAE</strong>
          <span class="cgu-aff-badge-required">Obligatoire</span><br>
          <span style="font-size:0.8rem">Commission unique de 50% du 1er mois Â· Paiement sur seuil minimum Â· ZÃ©ro auto-parrainage</span><br>
          <a href="#" onclick="event.stopPropagation();openCguAffModal()" style="font-size:0.8rem">Lire les conditions complÃ¨tes â†’</a>
        </div>
      </div>
      <div class="cgu-aff-not-accepted" id="affCguProgErr">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:inline;vertical-align:middle;margin-right:4px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        Vous devez accepter les Conditions du Programme d'Affiliation pour crÃ©er votre compte.
      </div>
      <div class="cgu" onclick="toggleAffCgu()">
        <div class="chk" id="affCguChk"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
        <div class="cgu-txt">J'accepte les <a href="#" onclick="event.stopPropagation();openSheet('cguSheet')">CGU</a> et la <a href="#" onclick="event.stopPropagation();openSheet('privacySheet')">Politique de confidentialitÃ©</a> d'ABAE.</div>
      </div>
      <button class="btn btn-p" id="abtn4" onclick="submitAffForm()" disabled style="background:linear-gradient(135deg,#4A0E6B,#9B1B6A);box-shadow:0 4px 14px rgba(155,27,106,0.35)">CrÃ©er mon compte affiliÃ© <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
      <div class="sec-note" style="margin-top:10px"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>Inscription gratuite Â· Activation immÃ©diate du code</div>
      <div class="link-center" style="margin-top:14px">DÃ©jÃ  inscrit ? <a href="#" onclick="showView('login')">Se connecter</a></div>
      <button class="btn-back" onclick="affGoStep(3)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Ã‰tape prÃ©cÃ©dente</button>
    </div>
  </div>

  <footer class="footer-mini"><p>Â© 2026 <strong style="color:var(--or-accent)">ABAE</strong><span>Â·</span><a href="#" onclick="openSheet('privacySheet')">ConfidentialitÃ©</a><span>Â·</span><a href="#" onclick="openSheet('cguSheet')">CGU</a><span>Â·</span><a href="#">Contact</a></p></footer>
</div><!-- /page-inscription-affilie -->


<!-- â”€â”€ PAGE : DASHBOARD AFFILIÃ‰ â”€â”€ -->
<div class="page" id="page-dashboard-affilie">
  <header class="hdr">
    <div class="hdr-in">
      <a href="#" onclick="showView('accueil');return false;" class="hdr-back"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>Accueil</a>
      <a href="#" class="hdr-logo" onclick="showView('accueil');return false;"><div class="logo-mark" style="background:linear-gradient(135deg,#4A0E6B,#9B1B6A)"><span>AB</span></div><span class="logo-name">ABAE</span></a>
      <span class="hdr-right" style="color:#9B1B6A;font-weight:700;font-family:'Sora',sans-serif;font-size:0.8rem;">âœ¦ AffiliÃ©</span>
    </div>
  </header>

  <div class="aff-dashboard">
    <div class="aff-dash-header">
      <div class="aff-dash-avatar" id="affDashAvatar">AM</div>
      <div class="aff-dash-name" id="affDashName">Aminata Mbida</div>
      <div class="aff-dash-role">âœ¦ AffiliÃ© ABAE</div>
    </div>

    <!-- Code card -->
    <div class="aff-dash-code-card">
      <div class="aff-dash-code-lbl">Votre code affiliÃ©</div>
      <div class="aff-dash-code" id="affDashCode">ABAE-K7M2</div>
      <div class="aff-dash-code-actions">
        <button class="aff-dash-btn-sm" onclick="copyAffDashCode()">
          <svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>Copier
        </button>
        <button class="aff-dash-btn-sm" onclick="shareAffCode()">
          <svg viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>Partager
        </button>
      </div>
    </div>

    <!-- Stats -->
    <div class="aff-stats-grid">
      <div class="aff-stat-card">
        <div class="aff-stat-val" id="affStatFilleuls">12</div>
        <div class="aff-stat-lbl">Filleuls actifs</div>
      </div>
      <div class="aff-stat-card">
        <div class="aff-stat-val" style="color:#9B1B6A" id="affStatCommissions">47 500</div>
        <div class="aff-stat-lbl">FCFA gagnÃ©s</div>
      </div>
      <div class="aff-stat-card">
        <div class="aff-stat-val" style="color:var(--or-accent)" id="affStatPending">3</div>
        <div class="aff-stat-lbl">En attente</div>
      </div>
    </div>

    <!-- AccÃ¨s restreint marketplace -->
    <div class="aff-restricted-banner">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      <p><strong>AccÃ¨s Marketplace limitÃ©</strong> â€” En tant qu'affiliÃ©, vous ne pouvez pas vendre ni acheter sur la marketplace. Votre rÃ´le est de recruter de nouveaux membres.</p>
    </div>

    <!-- Derniers filleuls -->
    <div class="aff-section">
      <div class="aff-section-hd">
        <div class="aff-section-title">Mes filleuls rÃ©cents</div>
        <div class="aff-section-link">Voir tout â†’</div>
      </div>
      <div class="aff-filleul-row">
        <div class="aff-filleul-av">AK</div>
        <div class="aff-filleul-info"><div class="aff-filleul-name">Amina KonÃ©</div><div class="aff-filleul-date">Inscrit le 24/02/2026 Â· Producteur</div></div>
        <div class="aff-filleul-status verifie">âœ“ VÃ©rifiÃ©</div>
      </div>
      <div class="aff-filleul-row">
        <div class="aff-filleul-av">ID</div>
        <div class="aff-filleul-info"><div class="aff-filleul-name">Ibrahim Diallo</div><div class="aff-filleul-date">Inscrit le 23/02/2026 Â· Acheteur</div></div>
        <div class="aff-filleul-status attente">â³ En attente</div>
      </div>
      <div class="aff-filleul-row">
        <div class="aff-filleul-av">CM</div>
        <div class="aff-filleul-info"><div class="aff-filleul-name">CÃ©lestin Mba</div><div class="aff-filleul-date">Inscrit le 22/02/2026 Â· Transporteur</div></div>
        <div class="aff-filleul-status verifie">âœ“ VÃ©rifiÃ©</div>
      </div>
    </div>

    <!-- Commissions rÃ©centes -->
    <div class="aff-section">
      <div class="aff-section-hd">
        <div class="aff-section-title">Commissions rÃ©centes</div>
        <div class="aff-section-link">Retrait â†’</div>
      </div>
      <div class="aff-commission-row">
        <div><div class="aff-commission-desc">Transaction d'Amina KonÃ©</div><div class="aff-commission-date">24/02/2026</div></div>
        <div class="aff-commission-amount">+2 500 FCFA</div>
      </div>
      <div class="aff-commission-row">
        <div><div class="aff-commission-desc">Transaction de CÃ©lestin Mba</div><div class="aff-commission-date">23/02/2026</div></div>
        <div class="aff-commission-amount">+5 000 FCFA</div>
      </div>
      <div class="aff-commission-row">
        <div><div class="aff-commission-desc">Bonus parrainage Marie-Claire</div><div class="aff-commission-date">22/02/2026</div></div>
        <div class="aff-commission-amount">+1 500 FCFA</div>
      </div>
    </div>

    <!-- Lien de recrutement -->
    <div class="aff-section">
      <div class="aff-section-hd"><div class="aff-section-title">Mon lien de recrutement</div></div>
      <div style="padding:14px 16px">
        <div style="background:var(--gris-100);border-radius:8px;padding:10px 14px;font-family:monospace;font-size:0.8rem;color:var(--gris-700);word-break:break-all;margin-bottom:10px" id="affLienRecrutement">https://abae.com/s?ref=ABAE-K7M2</div>
        <button class="btn btn-o" style="font-size:0.875rem;padding:11px;border-color:#9B1B6A;color:#9B1B6A" onclick="copyAffLink()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          Copier le lien
        </button>
      </div>
    </div>

    <div class="link-center" style="margin-top:20px">
      <a href="#" onclick="showView('accueil');return false;" style="color:var(--gris-400)">â† Retour Ã  l'accueil</a>
      <span style="color:var(--gris-200);margin:0 8px">Â·</span>
      <a href="#" onclick="showView('login');switchLoginProfile('affilie');return false;" style="color:var(--gris-400)">Se dÃ©connecter</a>
    </div>
  </div>

  <footer class="footer-mini"><p>Â© 2026 <strong style="color:var(--or-accent)">ABAE</strong><span>Â·</span><a href="#" onclick="openSheet('cguSheet')">CGU</a></p></footer>
</div><!-- /page-dashboard-affilie -->


<!-- â”€â”€ PAGE : VÃ‰RIFICATION EMAIL â”€â”€ -->
<div class="page" id="page-verify-email">

  <!-- Dark immersive background -->
  <div class="insc-orb" style="width:280px;height:280px;background:#4A9E2A;top:-60px;left:-60px;animation-duration:10s;"></div>
  <div class="insc-orb" style="width:200px;height:200px;background:#6ED63B;bottom:-40px;right:-40px;animation-duration:13s;animation-delay:3s;opacity:0.13;"></div>
  <div class="insc-orb" style="width:120px;height:120px;background:#D4A843;top:30%;right:5%;animation-duration:9s;animation-delay:5s;opacity:0.1;"></div>
  <!-- Floating email particles -->
  <div class="ve-particles" aria-hidden="true">
    <div class="ve-particle" style="left:10%;animation-duration:8s;animation-delay:0s;"></div>
    <div class="ve-particle" style="left:30%;animation-duration:11s;animation-delay:2s;width:4px;height:4px;"></div>
    <div class="ve-particle" style="left:60%;animation-duration:9s;animation-delay:4s;"></div>
    <div class="ve-particle" style="left:80%;animation-duration:13s;animation-delay:1s;width:3px;height:3px;"></div>
  </div>

  <header class="hdr"><div class="hdr-in"><a href="#" onclick="showView('inscription');return false;" class="hdr-back"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>Retour</a><a href="#" class="hdr-logo" onclick="showView('accueil');return false;"><img src="data:image/webp;base64,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" alt="ABAE" style="height:32px;width:auto;object-fit:contain;display:block;"></a><span></span></div></header>
  <div class="verify-wrap">
    <div class="verify-icon"><svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
    <h1 class="form-title" style="text-align:center">VÃ©rifiez votre email</h1>
    <p class="form-sub" style="text-align:center;margin-top:8px">Nous avons envoyÃ© un lien de confirmation Ã  :</p>
    <div class="verify-email-badge" id="verifyEmailDisplay"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c3b5acb7b1a683a6aea2aaafeda0acae">[email&#160;protected]</a></div>
    <p style="font-size:.875rem;color:var(--gris-700);text-align:center;margin-bottom:24px">Cliquez sur le lien dans l'email pour activer votre compte ABAE.</p>
    <div class="email-btns">
      <a href="https://mail.google.com" target="_blank" class="btn btn-g btn-sm" style="flex:1"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>Gmail</a>
      <a href="https://outlook.live.com" target="_blank" class="btn btn-g btn-sm" style="flex:1"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>Outlook</a>
    </div>
    <div class="separator">pas encore reÃ§u ?</div>
    <p style="font-size:.875rem;color:var(--gris-400);text-align:center">VÃ©rifiez vos spams ou <a id="resendLink" class="resend-link" onclick="startResend()">Renvoyer l'email</a></p>
    <p style="font-size:.8rem;color:var(--gris-400);text-align:center;margin-top:16px"><a href="#" onclick="showView('inscription');return false;" style="color:var(--gris-400)">â† Modifier mon adresse email</a></p>

    <!-- â”€â”€ ACCÃˆS ADMIN : Bypass confirmation email â”€â”€ -->
    <div style="margin-top:32px;padding-top:24px;border-top:1px dashed var(--gris-200);">
      <div style="display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:10px;">
        <svg viewBox="0 0 24 24" style="width:13px;height:13px;stroke:var(--gris-400);fill:none;stroke-width:2;flex-shrink:0"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        <span style="font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gris-400);">AccÃ¨s Administrateur</span>
      </div>
      <div id="adminBypassArea" style="display:none;animation:fadeIn .2s ease;">
        <input id="adminBypassCode" type="password" placeholder="Code admin" autocomplete="off"
          style="width:100%;padding:10px 14px;border:1.5px solid var(--gris-200);border-radius:10px;font-family:'DM Sans',sans-serif;font-size:0.9rem;color:var(--gris-900);outline:none;text-align:center;letter-spacing:3px;margin-bottom:8px;box-sizing:border-box;"
          oninput="checkAdminBypassCode(this.value)"
          onfocus="this.style.borderColor='var(--vert-principal)'"
          onblur="this.style.borderColor='var(--gris-200)'">
        <div id="adminBypassErr" style="display:none;font-size:0.75rem;color:var(--err);text-align:center;margin-bottom:6px;">âŒ Code incorrect</div>
        <button onclick="adminBypassConfirm()" style="width:100%;padding:11px;background:linear-gradient(135deg,#2A5E10,#4A9E2A);color:#fff;border:none;border-radius:10px;font-family:'Sora',sans-serif;font-weight:700;font-size:0.85rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;">
          <svg viewBox="0 0 24 24" style="width:15px;height:15px;stroke:#fff;fill:none;stroke-width:2.5"><polyline points="20 6 9 17 4 12"/></svg>
          Valider la confirmation email
        </button>
      </div>
      <button onclick="toggleAdminBypass()" id="adminBypassToggle"
        style="display:block;margin:0 auto;font-size:0.72rem;color:var(--gris-400);background:none;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;text-decoration:underline;text-underline-offset:2px;">
        âš™ Passer la vÃ©rification (admin)
      </button>
    </div>
  </div>
  <footer class="footer-mini"><p>Â© 2026 <strong style="color:var(--or-accent)">ABAE</strong><span>Â·</span><a href="#" onclick="openSheet('cguSheet')">CGU</a></p></footer>
</div><!-- /page-verify-email -->


<!-- â”€â”€ PAGE : EMAIL CONFIRMÃ‰ â”€â”€ -->
<div class="page" id="page-email-confirmed">

  <!-- Dark immersive background -->
  <div class="insc-orb" style="width:320px;height:320px;background:#4A9E2A;top:-80px;right:-80px;animation-duration:11s;"></div>
  <div class="insc-orb" style="width:200px;height:200px;background:#D4A843;bottom:-50px;left:-50px;animation-duration:9s;animation-delay:2s;opacity:0.12;"></div>
  <div class="insc-orb" style="width:140px;height:140px;background:#6ED63B;top:40%;left:8%;animation-duration:12s;animation-delay:6s;opacity:0.1;"></div>
  <!-- Confetti-like particles -->
  <div class="conf-particles" aria-hidden="true">
    <div class="conf-p" style="left:5%;animation-duration:6s;animation-delay:0s;background:#6ED63B;"></div>
    <div class="conf-p" style="left:20%;animation-duration:8s;animation-delay:0.5s;background:#D4A843;width:6px;height:6px;border-radius:2px;"></div>
    <div class="conf-p" style="left:40%;animation-duration:7s;animation-delay:1s;background:#6ED63B;"></div>
    <div class="conf-p" style="left:60%;animation-duration:9s;animation-delay:0.3s;background:#D4A843;width:5px;height:5px;"></div>
    <div class="conf-p" style="left:75%;animation-duration:6.5s;animation-delay:1.5s;background:#6ED63B;"></div>
    <div class="conf-p" style="left:90%;animation-duration:8s;animation-delay:0.8s;background:#D4A843;"></div>
  </div>

  <header class="hdr"><div class="hdr-in"><span></span><a href="#" class="hdr-logo" onclick="showView('accueil');return false;"><img src="data:image/webp;base64,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" alt="ABAE" style="height:32px;width:auto;object-fit:contain;display:block;"></a><span></span></div></header>
  <div class="success-wrap">
    <div class="success-icon"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
    <h1 class="form-title" style="text-align:center;margin-bottom:8px">Email confirmÃ© !</h1>
    <p class="form-sub" style="text-align:center;margin-bottom:28px">Votre compte ABAE est maintenant actif.<br>Bienvenue, <strong id="successName">Jean-Pierre</strong> ! ğŸŒ±</p>
    <a href="#" class="btn btn-p" style="text-decoration:none" onclick="showView('abonnement');return false;">Choisir mon abonnement <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></a>
    <div class="kyc-box" style="margin-top:16px;display:none">
      <div class="kyc-box-title"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Avant de commencerâ€¦</div>
      <p style="font-size:.82rem;color:var(--gris-700);line-height:1.55;margin-bottom:0">ComplÃ©tez votre vÃ©rification d'identitÃ© (KYC) pour publier des annonces et effectuer des paiements sur ABAE.</p>
      <div class="kyc-btns"><button class="btn btn-o btn-sm" onclick="goStep(3);showView('inscription')">ComplÃ©ter le KYC â†’</button><button class="btn btn-g btn-sm">Plus tard</button></div>
    </div>
    <div class="success-box">
      <p>ğŸ’¡ Invitez vos partenaires et gagnez des commissions sur chaque inscription.</p>
      <div class="aff-code-row">
        <div class="aff-code" id="affCode">ABAE-K7M2</div>
        <button class="copy-btn" onclick="copyCode()"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>Copier</button>
      </div>
    </div>
  </div>
  <footer class="footer-mini"><p>Â© 2026 <strong style="color:var(--or-accent)">ABAE</strong><span>Â·</span><a href="#" onclick="openSheet('cguSheet')">CGU</a></p></footer>
</div><!-- /page-email-confirmed -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : CHOISIR UN ABONNEMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-abonnement">

  <!-- Floating orbs â€” same style as inscription/login -->
  <div class="insc-orb" style="width:350px;height:350px;background:#4A9E2A;top:-100px;left:-100px;animation-duration:9s;"></div>
  <div class="insc-orb" style="width:220px;height:220px;background:#6ED63B;bottom:-60px;right:-60px;animation-duration:12s;animation-delay:3s;opacity:0.15;"></div>
  <div class="insc-orb" style="width:180px;height:180px;background:#D4A843;top:45%;right:3%;animation-duration:10s;animation-delay:5s;opacity:0.1;"></div>

<!-- Header sticky harmonisÃ© -->
<div class="abo-hdr" style="display:flex; align-items:center; justify-content:center; background:rgba(3,15,7,0.85); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-bottom:1px solid rgba(110,214,59,0.1); position:sticky; top:0; z-index:100; padding:12px 20px;">
  <button onclick="showView('marche')" style="position:absolute; left:16px; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12); border-radius:50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center; cursor:pointer; color:rgba(255,255,255,0.6); font-size:1rem; backdrop-filter:blur(4px);" title="Retour au marchÃ©">&#8592;</button>
  <div style="display:flex;align-items:center;">
    <img src="data:image/webp;base64,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" alt="ABAE" style="height:36px;width:auto;object-fit:contain;">
  </div>
</div>

<!-- Hero -->
<div class="abo-hero">
  <div class="abo-hero-badge">ğŸŒ¾ AccÃ¨s Marketplace</div>
  <h1>Choisissez votre<br>abonnement</h1>
  <p>SÃ©lectionnez le plan adaptÃ© Ã  vos activitÃ©s agro-pastorales pour accÃ©der Ã  la plateforme.</p>
</div>

<!-- Toggle mensuel / annuel -->
<div class="abo-toggle-wrap">
  <span class="abo-toggle-label active" id="toggleLabelMonth">Mensuel</span>
  <button class="abo-toggle" id="aboBillingToggle" onclick="toggleAboBilling()">
    <div class="abo-toggle-thumb"></div>
  </button>
  <span class="abo-toggle-label" id="toggleLabelYear">Annuel</span>
  <span class="abo-annual-badge">âˆ’17%</span>
</div>

<!-- Plans -->
<div class="abo-cards">

  <!-- GRATUIT -->
  <div class="abo-card gratuit selected" id="aboCard-gratuit" onclick="selectAboPlan('gratuit')">
    <div class="abo-card-top">
      <div class="abo-card-left">
        <div class="abo-card-icon">ğŸŒ±</div>
        <div>
          <div class="abo-card-name">Gratuit</div>
          <div class="abo-card-tagline">Pour dÃ©buter</div>
        </div>
      </div>
      <div class="abo-card-price">
        <div class="abo-price-amount">0 XAF</div>
        <div class="abo-price-period">Pour toujours</div>
      </div>
    </div>
    <div class="abo-card-features">
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> 2 annonces</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Prix marchÃ©</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> MÃ©tÃ©o</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> 3 requÃªtes IA/mois</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Messagerie</span>
    </div>
  </div>

  <!-- STANDARD -->
  <div class="abo-card standard" id="aboCard-standard" onclick="selectAboPlan('standard')">
    <div class="abo-card-top">
      <div class="abo-card-left">
        <div class="abo-card-icon">ğŸ“Š</div>
        <div>
          <div class="abo-card-name">Standard</div>
          <div class="abo-card-tagline">Pour les actifs</div>
        </div>
      </div>
      <div class="abo-card-price">
        <div class="abo-price-amount" id="aboPrice-standard">1 000 XAF</div>
        <div class="abo-price-period">/mois</div>
        <div class="abo-price-annual" id="aboAnnual-standard" style="display:none">10 000 XAF/an</div>
      </div>
    </div>
    <div class="abo-card-features">
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> 10 annonces</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> 30 requÃªtes IA</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> PrÃ©vision marchÃ©</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Stats basiques</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Pub rÃ©duite 50%</span>
    </div>
  </div>

  <!-- PRO -->
  <div class="abo-card pro" id="aboCard-pro" onclick="selectAboPlan('pro')">
    <div class="abo-card-top">
      <div class="abo-card-left">
        <div class="abo-card-icon">ğŸš€</div>
        <div>
          <div class="abo-card-name">Pro</div>
          <div class="abo-card-tagline">Le plus populaire</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
        <div class="abo-badge-popular">â­ Populaire</div>
        <div class="abo-card-price">
          <div class="abo-price-amount" id="aboPrice-pro">3 000 XAF</div>
          <div class="abo-price-period">/mois</div>
          <div class="abo-price-annual" id="aboAnnual-pro" style="display:none">30 000 XAF/an</div>
        </div>
      </div>
    </div>
    <div class="abo-card-features">
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Annonces illimitÃ©es</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> IA illimitÃ©e</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Factures auto</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Badge Professionnel</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Sans publicitÃ©</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Signature Ã©lectronique</span>
    </div>
  </div>

  <!-- ENTREPRISE -->
  <div class="abo-card entreprise" id="aboCard-entreprise" onclick="selectAboPlan('entreprise')">
    <div class="abo-card-top">
      <div class="abo-card-left">
        <div class="abo-card-icon">ğŸ¢</div>
        <div>
          <div class="abo-card-name">Entreprise</div>
          <div class="abo-card-tagline">Pour les structures</div>
        </div>
      </div>
      <div class="abo-card-price">
        <div class="abo-price-amount" id="aboPrice-entreprise">15 000 XAF</div>
        <div class="abo-price-period">/mois</div>
        <div class="abo-price-annual" id="aboAnnual-entreprise" style="display:none">150 000 XAF/an</div>
      </div>
    </div>
    <div class="abo-card-features">
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Tout plan Pro</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Campagnes pub</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> API inclus</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Badge Partenaire</span>
      <span class="abo-feat"><span class="abo-feat-check">âœ“</span> Support prioritaire</span>
    </div>
  </div>

</div><!-- /abo-cards -->

<!-- Scroll dots indicator -->
<div style="display:flex;align-items:center;justify-content:center;gap:6px;padding:4px 0 12px;">
  <div id="aboDot0" style="width:20px;height:4px;border-radius:2px;background:#6ED63B;transition:all 0.25s;"></div>
  <div id="aboDot1" style="width:6px;height:4px;border-radius:2px;background:rgba(255,255,255,0.2);transition:all 0.25s;"></div>
  <div id="aboDot2" style="width:6px;height:4px;border-radius:2px;background:rgba(255,255,255,0.2);transition:all 0.25s;"></div>
  <div id="aboDot3" style="width:6px;height:4px;border-radius:2px;background:rgba(255,255,255,0.2);transition:all 0.25s;"></div>
</div>
<script>
(function(){
  var cards = document.querySelector('.abo-cards');
  if(!cards) return;
  cards.addEventListener('scroll', function(){
    var idx = Math.round(cards.scrollLeft / cards.clientWidth * 0.72);
    idx = Math.max(0, Math.min(3, idx));
    [0,1,2,3].forEach(function(i){
      var d = document.getElementById('aboDot'+i);
      if(!d) return;
      d.style.width = i===idx ? '20px' : '6px';
      d.style.background = i===idx ? '#6ED63B' : 'rgba(255,255,255,0.2)';
    });
  }, {passive:true});
})();
</script>

<!-- CTA -->
<div class="abo-cta-wrap">
  <button class="abo-cta-btn gratuit" id="aboCta" onclick="handleAboSubmit()">
    ğŸŒ± Commencer gratuitement
  </button>
  <div class="abo-security">
    ğŸ”’ Paiement sÃ©curisÃ© Â· Annulation Ã  tout moment Â· AdaptÃ© au Cameroun
  </div>
</div>

<div style="height: 20px;"></div>

<!-- Payment overlay -->
<div class="abo-pay-overlay" id="aboPayOverlay">
  <div class="abo-pay-sheet">
    <div class="abo-pay-title">ğŸ’³ Paiement abonnement</div>
    <div class="abo-pay-subtitle">SÃ©curisÃ© Â· Confirmation immÃ©diate</div>
    <div class="abo-pay-summary">
      <div>
        <div class="abo-pay-plan-name" id="aboPayPlanName">Plan Pro</div>
        <div style="font-size:0.7rem;color:#9BA3AE;margin-top:2px;" id="aboPayPeriodLabel">Mensuel</div>
      </div>
      <div class="abo-pay-plan-price pro" id="aboPayPrice">3 000 XAF</div>
    </div>
    <div class="abo-pay-methods-title">Choisissez votre mode de paiement</div>
    <div class="abo-pay-methods">
      <div class="abo-pay-method sel" id="pm-mtn" onclick="selectPayMethod('mtn')">
        <div class="abo-pay-method-icon">ğŸ“±</div>
        <div class="abo-pay-method-info">
          <div class="abo-pay-method-name">MTN Mobile Money</div>
          <div class="abo-pay-method-desc">Paiement instantanÃ© Â· Cameroun</div>
        </div>
      </div>
      <div class="abo-pay-method" id="pm-orange" onclick="selectPayMethod('orange')">
        <div class="abo-pay-method-icon">ğŸŸ </div>
        <div class="abo-pay-method-info">
          <div class="abo-pay-method-name">Orange Money</div>
          <div class="abo-pay-method-desc">Paiement instantanÃ© Â· Afrique</div>
        </div>
      </div>
      <div class="abo-pay-method" id="pm-card" onclick="selectPayMethod('card')">
        <div class="abo-pay-method-icon">ğŸ’³</div>
        <div class="abo-pay-method-info">
          <div class="abo-pay-method-name">Carte bancaire</div>
          <div class="abo-pay-method-desc">Visa Â· Mastercard Â· 3D Secure</div>
        </div>
      </div>
    </div>
    <button class="abo-pay-confirm-btn" onclick="confirmAboPay()">
      âœ… Confirmer le paiement
    </button>
    <div class="abo-pay-cancel" onclick="document.getElementById('aboPayOverlay').classList.remove('show')">
      Annuler
    </div>
  </div>
</div>

</div><!-- /page-abonnement -->

<!-- Mur d'expiration abonnement (global) -->
<div class="abo-expiry-wall" id="aboExpiryWall">
  <div class="abo-expiry-icon">â³</div>
  <div class="abo-expiry-title">Abonnement expirÃ©</div>
  <div class="abo-expiry-text">
    Votre abonnement a expirÃ©.<br>
    Veuillez renouveler pour continuer<br>Ã  accÃ©der Ã  la plateforme ABAE.
  </div>
  <button class="abo-expiry-btn" onclick="showView('abonnement')">
    ğŸ”„ Renouveler maintenant
  </button>
</div>


<!-- â”€â”€ PAGE : CONNEXION â”€â”€ -->


<div class="page" id="page-login">
  <!-- Fond artistique -->
  <div id="lp-bg"></div>
  <div id="lp-grid"></div>
  <div class="lp-orb"></div>
  <div class="lp-orb"></div>
  <div class="lp-orb"></div>

  <!-- Card -->
  <div id="lp-card">

    <!-- Header -->
    <div id="lp-header">
      <img id="lp-logo-img" src="data:image/webp;base64,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" alt="ABAE">
      <div id="lp-header-text">
        <p id="lp-header-title">Bon retour ğŸ‘‹</p>
        <p id="lp-header-sub">Connectez-vous Ã  votre espace ABAE</p>
      </div>
    </div>

    <!-- Onglets Membre / AffiliÃ© -->
    <div id="lp-profile-tabs">
      <button class="lp-ptab active" data-p="membre" onclick="lpSwitchProfile('membre')">
        <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        Membre
      </button>
      <button class="lp-ptab" data-p="affilie" onclick="lpSwitchProfile('affilie')">
        <svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
        AffiliÃ© âœ¦
      </button>
    </div>

    <!-- Bandeau affiliÃ© -->
    <div id="lp-aff-banner">
      <svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
      <div>
        <div id="lp-aff-banner-title">Espace AffiliÃ© ABAE</div>
        <div id="lp-aff-banner-sub">AccÃ©dez Ã  vos filleuls, commissions et code de parrainage</div>
      </div>
    </div>

    <!-- Onglets Email / TÃ©lÃ©phone -->
    <div id="lp-method-tabs">
      <div class="lp-mtab active" onclick="lpSwitchTab('email')">ğŸ“§ Email</div>
      <div class="lp-mtab" onclick="lpSwitchTab('tel')">ğŸ“± TÃ©lÃ©phone</div>
    </div>

    <!-- Email -->
    <div id="lp-email-mode" class="lp-field" style="--d:0.45s">
      <div class="lp-field-label"><span>Adresse e-mail</span></div>
      <div class="lp-input-wrap">
        <input class="lp-input" id="lp-email" type="email" placeholder="exemple@mail.com" autocomplete="email">
      </div>
    </div>

    <!-- TÃ©lÃ©phone -->
    <div id="lp-tel-mode" class="lp-field" style="display:none;--d:0.45s">
      <div class="lp-field-label"><span>TÃ©lÃ©phone</span></div>
      <div class="lp-phone-wrap">
        <div class="lp-phone-pfx">ğŸ‡¨ğŸ‡² +237</div>
        <input class="lp-input" id="lp-tel" type="tel" inputmode="numeric" placeholder="6 XX XX XX XX">
      </div>
    </div>

    <!-- Mot de passe -->
    <div class="lp-field" style="--d:0.5s">
      <div class="lp-field-label">
        <span>Mot de passe</span>
        <a href="#" onclick="showView('forgot');return false;">OubliÃ© ?</a>
      </div>
      <div class="lp-input-wrap">
        <input class="lp-input" id="lp-pw" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" style="padding-right:44px">
        <svg class="lp-ico-r" viewBox="0 0 24 24" onclick="lpTogglePw()">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
        </svg>
      </div>
    </div>

    <!-- Rester connectÃ© -->
    <div id="lp-remember" onclick="lpToggleRemember()">
      <div id="lp-remember-chk">
        <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <span id="lp-remember-txt">Rester connectÃ© sur cet appareil</span>
    </div>

    <!-- Erreur -->
    <div id="lp-err">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
      <span>Identifiants incorrects. VÃ©rifiez votre email et mot de passe.</span>
    </div>

    <!-- Bouton connexion -->
    <button id="lp-submit" onclick="lpSubmit()">
      Se connecter
      <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </button>

    <!-- Lien inscription -->
    <div class="lp-link-row" id="lp-signup-link">
      Pas encore inscrit ? <a href="#" onclick="showView('inscription');return false;">CrÃ©er un compte</a>
    </div>
    <div class="lp-link-row" id="lp-aff-signup-link" style="display:none">
      Pas encore affiliÃ© ? <a href="#" onclick="showView('inscription-affilie');return false;" style="color:#d966b2;">Rejoindre le programme âœ¦</a>
    </div>

    <!-- Social -->
    <div class="lp-sep">ou continuer avec</div>
    <div id="lp-social">
      <button class="lp-social-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 010 20M12 2a15.3 15.3 0 000 20"/></svg>
        Google
      </button>
      <button class="lp-social-btn">
        <svg viewBox="0 0 24 24" fill="#1877F2" stroke="none"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
        Facebook
      </button>
    </div>

    <!-- Footer -->
    <div id="lp-footer">
      Â© 2026 <strong style="color:#6ED63B">ABAE</strong><span>Â·</span><a href="#" onclick="openSheet('privacySheet')">ConfidentialitÃ©</a><span>Â·</span><a href="#" onclick="openSheet('cguSheet')">CGU</a>
    </div>
    <button id="lp-admin-btn" onclick="showView('admin-login')">âš™ AccÃ¨s Administrateur</button>


    <!-- Champs cachÃ©s pour compatibilitÃ© avec loginSubmit() -->
    <input type="hidden" id="loginEmail">
    <input type="hidden" id="loginPw">
    <input type="hidden" id="loginTel">
    <div id="loginErr" style="display:none"></div>
  </div><!-- /lp-card -->
</div><!-- /page-login -->

<script>
// â”€â”€ Login page logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _lpProfile = 'membre';
let _lpMethod  = 'email';
let _lpRemember = true;

// Sync remember checkbox on load
document.getElementById('lp-remember-chk').classList.toggle('on', _lpRemember);

function lpSwitchProfile(p) {
  _lpProfile = p;
  document.querySelectorAll('.lp-ptab').forEach(t => {
    t.classList.toggle('active', t.dataset.p === p);
  });
  const isAff = p === 'affilie';
  document.getElementById('lp-aff-banner').classList.toggle('show', isAff);
  document.getElementById('lp-signup-link').style.display     = isAff ? 'none'  : '';
  document.getElementById('lp-aff-signup-link').style.display = isAff ? ''      : 'none';
  // Sync with existing switchLoginProfile if present
  if (typeof switchLoginProfile === 'function') switchLoginProfile(p);
}

function lpSwitchTab(t) {
  _lpMethod = t;
  document.querySelectorAll('.lp-mtab').forEach(el => el.classList.toggle('active', el.textContent.includes(t === 'email' ? 'Email' : 'TÃ©l')));
  document.getElementById('lp-email-mode').style.display = t === 'email' ? '' : 'none';
  document.getElementById('lp-tel-mode').style.display   = t === 'tel'   ? '' : 'none';
}

function lpTogglePw() {
  const inp = document.getElementById('lp-pw');
  inp.type = inp.type === 'password' ? 'text' : 'password';
}

function lpToggleRemember() {
  _lpRemember = !_lpRemember;
  document.getElementById('lp-remember-chk').classList.toggle('on', _lpRemember);
}

function lpSubmit() {
  // RÃ©cupÃ©rer identifiants
  const id = _lpMethod === 'email'
    ? document.getElementById('lp-email').value.trim()
    : document.getElementById('lp-tel').value.trim();
  const pw = document.getElementById('lp-pw').value;

  document.getElementById('lp-err').classList.remove('show');

  // Animer le bouton
  const btn = document.getElementById('lp-submit');
  btn.innerHTML = '<svg viewBox="0 0 24 24" style="animation:spin 0.8s linear infinite;width:18px;height:18px;stroke:#fff;stroke-width:2;fill:none"><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0"/></svg> Connexion...';
  btn.style.pointerEvents = 'none';

  // Appel Ã  la logique de login existante
  setTimeout(() => {
    btn.innerHTML = 'Se connecter <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:#fff;stroke-width:2.5;fill:none"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
    btn.style.pointerEvents = '';

    // Sync fields vers les IDs attendus par loginSubmit()
    const _em = document.getElementById('loginEmail');
    const _pw = document.getElementById('loginPw');
    const _tl = document.getElementById('loginTel');
    if (_em) _em.value = document.getElementById('lp-email').value.trim();
    if (_pw) _pw.value = document.getElementById('lp-pw').value;
    if (_tl) _tl.value = document.getElementById('lp-tel').value.trim();

    // Sync profil
    if (typeof loginCurrentProfile !== 'undefined') {
      window.loginCurrentProfile = _lpProfile;
    }

    // Afficher l'erreur sur notre UI aussi
    const origErr = document.getElementById('loginErr');
    if (origErr) {
      const observer = new MutationObserver(() => {
        if (origErr.style.display !== 'none') {
          document.getElementById('lp-err').classList.add('show');
        }
      });
      observer.observe(origErr, { attributes: true, attributeFilter: ['style'] });
      setTimeout(() => observer.disconnect(), 2000);
    }

    // Tenter le login via la fonction existante
    if (typeof loginSubmit === 'function') {
      loginSubmit();
    } else {
      document.getElementById('lp-err').classList.add('show');
    }
  }, 900);
}

// Style spin pour le loader
const _lpStyle = document.createElement('style');
_lpStyle.textContent = '@keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }';
document.head.appendChild(_lpStyle);

// Override loginSubmit pour sync avec les vrais champs (loginEmail, loginPw)
// en mappant nos nouveaux champs vers les anciens IDs attendus par loginSubmit()
document.getElementById('lp-email').addEventListener('input', function() {
  const el = document.getElementById('loginEmail');
  if (el) el.value = this.value;
});
document.getElementById('lp-pw').addEventListener('input', function() {
  const el = document.getElementById('loginPw');
  if (el) el.value = this.value;
});
document.getElementById('lp-tel').addEventListener('input', function() {
  const el = document.getElementById('loginTel');
  if (el) el.value = this.value;
});
// Sync tabs with existing tab system
function lpSwitchTab_extended(t) {
  lpSwitchTab(t);
  if (typeof switchLoginTab === 'function') switchLoginTab(t);
}
</script>





<!-- â”€â”€ PAGE : MOT DE PASSE OUBLIÃ‰ â”€â”€ -->
<div class="page" id="page-forgot">
  <header class="hdr"><div class="hdr-in"><a href="#" onclick="showView('login');return false;" class="hdr-back"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>Connexion</a><a href="#" class="hdr-logo" onclick="showView('accueil');return false;"><img src="data:image/webp;base64,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" alt="ABAE" style="height:32px;width:auto;object-fit:contain;display:block;"></a><span></span></div></header>
  <div class="fw" id="forgotForm">
    <div class="form-head">
      <div style="width:72px;height:72px;border-radius:50%;background:var(--vert-clair);display:flex;align-items:center;justify-content:center;margin-bottom:16px"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--vert-principal)" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg></div>
      <h1 class="form-title">Mot de passe oubliÃ© ?</h1>
      <p class="form-sub">Entrez votre email ou numÃ©ro pour recevoir un lien de rÃ©initialisation.</p>
    </div>
    <div class="field"><div class="field-label"><span>Email ou tÃ©lÃ©phone</span></div><input class="input" id="forgotInput" type="text" placeholder="exemple@mail.com ou +237 6XXXXXXXX" autocomplete="email"></div>
    <button class="btn btn-p" onclick="forgotSubmit()">Envoyer le lien <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
    <div class="link-center" style="margin-top:14px"><a href="#" onclick="showView('login');return false;">â† Retour Ã  la connexion</a></div>
  </div>
  <div class="fw" id="forgotSent" style="display:none">
    <div style="text-align:center;padding:20px 0">
      <div class="verify-icon" style="animation:none;margin-bottom:24px"><svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
      <h2 class="form-title" style="text-align:center;margin-bottom:8px">Lien envoyÃ© !</h2>
      <p class="form-sub" style="text-align:center;margin-bottom:24px">VÃ©rifiez votre boÃ®te email et cliquez sur le lien pour rÃ©initialiser votre mot de passe.</p>
      <button class="btn btn-g" onclick="showView('login')">â† Retour Ã  la connexion</button>
    </div>
  </div>
  <footer class="footer-mini"><p>Â© 2026 <strong style="color:var(--or-accent)">ABAE</strong><span>Â·</span><a href="#" onclick="openSheet('cguSheet')">CGU</a></p></footer>
</div><!-- /page-forgot -->


<!-- MODAL KYC -->
<div class="modal-bg hidden" id="kycModal">
  <div class="modal">
    <h3>âš  VÃ©rification requise</h3>
    <p style="font-size:.875rem;color:var(--gris-700);margin-bottom:8px">Sans vÃ©rification d'identitÃ©, vous pourrez :</p>
    <ul class="modal-list">
      <li class="yes"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>Consulter les annonces</li>
      <li class="yes"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>Contacter des vendeurs</li>
    </ul>
    <p style="font-size:.875rem;color:var(--gris-700);margin-bottom:8px">Vous ne pourrez <strong>pas</strong> :</p>
    <ul class="modal-list">
      <li class="no"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Effectuer des paiements</li>
      <li class="no"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Publier des annonces</li>
      <li class="no"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>AccÃ©der aux fonctions premium</li>
    </ul>
    <div class="modal-btns">
      <button class="btn btn-p" style="font-size:.875rem;padding:11px" onclick="document.getElementById('kycModal').classList.add('hidden')">ComplÃ©ter maintenant</button>
      <button class="btn btn-g" style="font-size:.875rem;padding:11px" onclick="goStep(4);document.getElementById('kycModal').classList.add('hidden')">Plus tard</button>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT UNIFIÃ‰ â€” Fusion des deux fichiers
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->


<!-- â•â• PAGE : ADMIN LOGIN â•â• -->
<div class="page" id="page-admin-login">
  <div class="admin-login-wrap">
    <div class="admin-login-box">
      <div style="width:52px;height:52px;border-radius:13px;background:var(--gris-900);display:flex;align-items:center;justify-content:center;margin-bottom:16px">
        <span style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;color:#fff">AD</span>
      </div>
      <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:1.4rem;color:var(--gris-900);margin-bottom:6px">Espace Administrateur</div>
      <div style="font-size:0.875rem;color:var(--gris-400);margin-bottom:8px">Entrez votre code d'accÃ¨s temporaire Ã  6 chiffres.</div>
      <div class="admin-code-hint">Code de dÃ©monstration : <strong>1 2 3 4 5 6</strong></div>
      <div class="admin-code-inputs">
        <input type="text" maxlength="1" inputmode="numeric" id="ac0" oninput="adminCodeInput(0)" onkeydown="adminCodeKey(event,0)">
        <input type="text" maxlength="1" inputmode="numeric" id="ac1" oninput="adminCodeInput(1)" onkeydown="adminCodeKey(event,1)">
        <input type="text" maxlength="1" inputmode="numeric" id="ac2" oninput="adminCodeInput(2)" onkeydown="adminCodeKey(event,2)">
        <input type="text" maxlength="1" inputmode="numeric" id="ac3" oninput="adminCodeInput(3)" onkeydown="adminCodeKey(event,3)">
        <input type="text" maxlength="1" inputmode="numeric" id="ac4" oninput="adminCodeInput(4)" onkeydown="adminCodeKey(event,4)">
        <input type="text" maxlength="1" inputmode="numeric" id="ac5" oninput="adminCodeInput(5)" onkeydown="adminCodeKey(event,5)">
      </div>
      <div class="admin-code-err" id="adminCodeErr">âŒ Code incorrect. RÃ©essayez.</div>
      <button class="btn btn-p" id="adminLoginBtn" onclick="submitAdminCode()" disabled style="margin-top:8px">AccÃ©der au tableau de bord â†’</button>
      <div style="text-align:center;margin-top:14px"><a href="#" onclick="showView('login');return false;" style="font-size:0.82rem;color:var(--gris-400)">â† Retour Ã  la connexion</a></div>
    </div>
  </div>
</div>


<!-- â•â• PAGE : ESPACE ADMIN â•â• -->
<div class="page" id="page-admin">

  <!-- â•â•â• HEADER â•â•â• -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="admin-logo-mark"><span>AB</span></div>
      <div class="admin-header-title">ABAE Admin</div>
      <span class="admin-badge" id="adminLiveBadge">â— Live</span>
    </div>
    <div class="admin-header-right">
      <span class="admin-time" id="adminClock">--:--:--</span>
      <span id="adminEventCounter" style="font-size:0.72rem;color:rgba(255,255,255,0.5);font-family:monospace;display:none;background:rgba(255,255,255,0.08);padding:3px 8px;border-radius:4px"></span>
      <button class="admin-logout-btn" onclick="showView('accueil')">â† Quitter</button>
    </div>
  </header>

  <!-- â•â•â• BARRE DE NAVIGATION â•â•â• -->
  <nav class="admin-nav-bar" id="adminNavBar">
    <button class="admin-nav-item active" onclick="adminNavTo('dashboard', this)" data-path="/admin/dashboard">
      <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
      Tableau de bord
    </button>
    <div class="admin-nav-sep"></div>
    <button class="admin-nav-item" onclick="adminNavTo('abonnements', this)" data-path="/admin/abonnements">
      <svg viewBox="0 0 24 24"><path d="M20 12V22H4V12"/><path d="M22 7H2v5h20V7z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 010-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 000-5C13 2 12 7 12 7z"/></svg>
      Abonnements
      <span class="admin-nav-badge" id="navBadgeAbo">4</span>
    </button>
    <div class="admin-nav-sep"></div>
    <button class="admin-nav-item" onclick="adminPreview('accueil', this)" data-path="/">
      <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      Accueil
    </button>
    <div class="admin-nav-sep"></div>
    <button class="admin-nav-item" onclick="adminPreview('inscription', this)" data-path="/inscription">
      <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      Inscription
    </button>
    <button class="admin-nav-item" onclick="adminPreview('inscription-affilie', this)" data-path="/inscription/affiliÃ©">
      <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>
      Inscription affiliÃ©
    </button>
    <button class="admin-nav-item" onclick="adminPreview('login', this)" data-path="/connexion">
      <svg viewBox="0 0 24 24"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
      Connexion
    </button>
    <button class="admin-nav-item" onclick="adminPreview('abonnement', this)" data-path="/abonnement">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      Page Abonnement
    </button>
    <button class="admin-nav-item" onclick="adminPreview('forgot', this)" data-path="/mot-de-passe-oubliÃ©">
      <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
      Mot de passe oubliÃ©
    </button>
    <div class="admin-nav-sep"></div>
    <button class="admin-nav-item" onclick="adminPreview('verify-email', this)" data-path="/vÃ©rification-email">
      <svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      VÃ©rif. Email
      <span class="admin-nav-badge">!</span>
    </button>
    <button class="admin-nav-item" onclick="adminPreview('email-confirmed', this)" data-path="/email-confirmÃ©">
      <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
      Email confirmÃ©
    </button>
    <div class="admin-nav-sep"></div>
    <button class="admin-nav-item" onclick="adminPreview('dashboard-affilie', this)" data-path="/espace-affiliÃ©">
      <svg viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      Espace affiliÃ©
    </button>
  </nav>

  <!-- â•â•â• CONTENUS PANNEAUX â•â•â• -->

  <!-- PANNEAU DASHBOARD -->
  <div id="adminPanelDashboard" class="admin-panel-nav active">
    <div class="admin-content">

      <div class="admin-top-bar">
        <div>
          <div class="admin-page-title">Tableau de bord</div>
          <div style="font-size:0.78rem;color:var(--gris-400);margin-top:2px;">Vue d'ensemble Â· Mise Ã  jour en temps rÃ©el</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button onclick="adminNavTo('abonnements',null)" style="display:flex;align-items:center;gap:6px;background:linear-gradient(135deg,#4A9E2A,#2A5E10);color:#fff;border:none;padding:9px 16px;border-radius:8px;font-family:'Sora',sans-serif;font-weight:700;font-size:0.8rem;cursor:pointer;">
            <svg viewBox="0 0 24 24" style="width:14px;height:14px;stroke:#fff;fill:none;stroke-width:2.5"><path d="M20 12V22H4V12"/><path d="M22 7H2v5h20V7z"/><path d="M12 22V7"/></svg>
            GÃ©rer abonnements
          </button>
          <button class="admin-refresh-btn" id="adminRefreshBtn" onclick="adminRefresh()">
            <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
            Actualiser
          </button>
        </div>
      </div>

      <!-- STATS LIGNE 1 : Utilisateurs -->
      <div style="font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gris-400);margin-bottom:10px;">ğŸ‘¥ Utilisateurs</div>
      <div class="admin-stats" style="margin-bottom:16px;">
        <div class="admin-stat-card">
          <div class="admin-stat-label">Inscriptions totales</div>
          <div class="admin-stat-value" id="statTotal">0</div>
          <div class="admin-stat-change" id="statTodayChange">+0 aujourd'hui</div>
        </div>
        <div class="admin-stat-card">
          <div class="admin-stat-label">En attente KYC</div>
          <div class="admin-stat-value" id="statAttente">0</div>
          <div class="admin-stat-change down">Ã  vÃ©rifier</div>
        </div>
        <div class="admin-stat-card">
          <div class="admin-stat-label">Profils vÃ©rifiÃ©s</div>
          <div class="admin-stat-value" id="statVerifie">0</div>
          <div class="admin-stat-change">comptes actifs</div>
        </div>
        <div class="admin-stat-card">
          <div class="admin-stat-label">Codes affiliÃ©s</div>
          <div class="admin-stat-value" id="statAffilie">0</div>
          <div class="admin-stat-change">utilisÃ©s</div>
        </div>
      </div>

      <!-- STATS LIGNE 2 : Abonnements -->
      <div style="font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gris-400);margin-bottom:10px;">ğŸ’³ Abonnements</div>
      <div class="admin-stats" style="margin-bottom:24px;">
        <div class="admin-stat-card" style="border-left:3px solid #9BA3AE;">
          <div class="admin-stat-label">Plan Gratuit</div>
          <div class="admin-stat-value" id="statPlanGratuit" style="color:#9BA3AE;">â€”</div>
          <div class="admin-stat-change" style="color:#9BA3AE;">utilisateurs actifs</div>
        </div>
        <div class="admin-stat-card" style="border-left:3px solid #3B82F6;">
          <div class="admin-stat-label">Plan Standard</div>
          <div class="admin-stat-value" id="statPlanStandard" style="color:#3B82F6;">â€”</div>
          <div class="admin-stat-change" style="color:#3B82F6;">1 000 XAF/mois</div>
        </div>
        <div class="admin-stat-card" style="border-left:3px solid #8B5CF6;">
          <div class="admin-stat-label">Plan Pro â­</div>
          <div class="admin-stat-value" id="statPlanPro" style="color:#8B5CF6;">â€”</div>
          <div class="admin-stat-change" style="color:#8B5CF6;">3 000 XAF/mois</div>
        </div>
        <div class="admin-stat-card" style="border-left:3px solid #D4A843;">
          <div class="admin-stat-label">Plan Entreprise</div>
          <div class="admin-stat-value" id="statPlanEntreprise" style="color:#D4A843;">â€”</div>
          <div class="admin-stat-change" style="color:#D4A843;">15 000 XAF/mois</div>
        </div>
      </div>

      <!-- Revenus estimÃ©s -->
      <div class="admin-section" style="margin-bottom:20px;">
        <div class="admin-section-header">
          <div class="admin-section-title">ğŸ’° Revenus abonnements (estimÃ©s)</div>
          <div id="adminRevenueMonthLabel" style="font-size:0.75rem;font-weight:600;color:var(--gris-400);"></div>
        </div>
        <div style="padding:18px 20px;display:grid;grid-template-columns:repeat(2,1fr);gap:14px;">
          <div style="background:var(--gris-100);border-radius:12px;padding:16px;">
            <div style="font-size:0.7rem;font-weight:700;color:var(--gris-400);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:6px;">Revenu mensuel</div>
            <div id="adminRevenueMensuel" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.5rem;color:var(--vert-principal);">0 XAF</div>
          </div>
          <div style="background:var(--gris-100);border-radius:12px;padding:16px;">
            <div style="font-size:0.7rem;font-weight:700;color:var(--gris-400);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:6px;">Revenu annuel (proj.)</div>
            <div id="adminRevenueAnnuel" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.5rem;color:#D4A843;">0 XAF</div>
          </div>
          <div style="background:var(--gris-100);border-radius:12px;padding:16px;">
            <div style="font-size:0.7rem;font-weight:700;color:var(--gris-400);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:6px;">AbonnÃ©s payants</div>
            <div id="adminAbonnesPay" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.5rem;color:#3B82F6;">0</div>
          </div>
          <div style="background:var(--gris-100);border-radius:12px;padding:16px;">
            <div style="font-size:0.7rem;font-weight:700;color:var(--gris-400);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:6px;">Taux conversion payant</div>
            <div id="adminTauxConv" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.5rem;color:#8B5CF6;">0%</div>
          </div>
        </div>
      </div>

      <!-- Navigation rapide -->
      <div class="admin-section" style="margin-bottom:20px">
        <div class="admin-section-header">
          <div class="admin-section-title">ğŸ—ºï¸ Navigation rapide â€” Toutes les pages</div>
        </div>
        <div style="padding:16px 20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px;">
          <button onclick="adminPreview('accueil', null)" class="admin-quicklink"><span>ğŸ </span><span>Accueil</span></button>
          <button onclick="adminPreview('inscription', null)" class="admin-quicklink"><span>ğŸ“</span><span>Inscription</span></button>
          <button onclick="adminPreview('inscription-affilie', null)" class="admin-quicklink"><span>ğŸ¤</span><span>Inscription affiliÃ©</span></button>
          <button onclick="adminPreview('login', null)" class="admin-quicklink"><span>ğŸ”‘</span><span>Connexion</span></button>
          <button onclick="adminPreview('abonnement', null)" class="admin-quicklink" style="border-color:#4A9E2A;color:#4A9E2A;"><span>ğŸ’³</span><span>Page Abonnement</span></button>
          <button onclick="adminPreview('forgot', null)" class="admin-quicklink"><span>ğŸ”’</span><span>Mot de passe</span></button>
          <button onclick="adminPreview('verify-email', null)" class="admin-quicklink"><span>ğŸ“§</span><span>VÃ©rif. email</span></button>
          <button onclick="adminPreview('email-confirmed', null)" class="admin-quicklink"><span>âœ…</span><span>Email confirmÃ©</span></button>
          <button onclick="adminPreview('dashboard-affilie', null)" class="admin-quicklink"><span>ğŸ“Š</span><span>Espace affiliÃ©</span></button>
          <button onclick="adminPreview('marche', null)" class="admin-quicklink"><span>ğŸ›’</span><span>MarchÃ©</span></button>
        </div>
      </div>

      <!-- ActivitÃ© en temps rÃ©el -->
      <div class="admin-section" style="margin-bottom:20px">
        <div class="admin-section-header">
          <div class="admin-section-title" style="display:flex;align-items:center;gap:8px">
            <span class="admin-live-dot"></span>
            ActivitÃ© en temps rÃ©el
          </div>
          <button onclick="adminActivityLog.length=0;renderActivityFeed();adminEventCount=0;document.getElementById('adminEventCounter').style.display='none';" class="admin-filter-btn" style="font-size:0.72rem">Effacer</button>
        </div>
        <div id="adminActivityEmpty" style="text-align:center;padding:28px 20px;color:var(--gris-400);font-size:0.82rem">
          <div style="font-size:1.5rem;margin-bottom:8px">ğŸ‘</div>
          En attente d'activitÃ©â€¦ Chaque action dans l'app apparaÃ®t ici instantanÃ©ment.
        </div>
        <div id="adminActivityFeed" style="display:none;max-height:240px;overflow-y:auto;padding:6px 0"></div>
      </div>

      <!-- Tableau utilisateurs -->
      <div class="admin-section">
        <div class="admin-section-header">
          <div class="admin-section-title">Inscriptions rÃ©centes</div>
          <div class="admin-filter-row">
            <button class="admin-filter-btn active" onclick="filterAdmin('tous',this)">Tous</button>
            <button class="admin-filter-btn" onclick="filterAdmin('attente',this)">En attente</button>
            <button class="admin-filter-btn" onclick="filterAdmin('verifie',this)">VÃ©rifiÃ©s</button>
            <button class="admin-filter-btn" onclick="filterAdmin('rejete',this)">RejetÃ©s</button>
          </div>
        </div>
        <div class="admin-table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Utilisateur</th>
                <th>Profil</th>
                <th>Pays</th>
                <th>Abonnement</th>
                <th>Date</th>
                <th>Statut KYC</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="adminTableBody"></tbody>
          </table>
          <div class="admin-empty" id="adminEmpty" style="display:none">Aucun utilisateur dans cette catÃ©gorie.</div>
        </div>
      </div>

    </div>
  </div>

  <!-- PANNEAU ABONNEMENTS -->
  <div id="adminPanelAbonnements" class="admin-panel-nav">
    <div class="admin-content">
      <div class="admin-top-bar">
        <div>
          <div class="admin-page-title">Gestion des Abonnements</div>
          <div style="font-size:0.78rem;color:var(--gris-400);margin-top:2px;">Tous les plans Â· Revenus Â· Expirations</div>
        </div>
        <button class="admin-refresh-btn" onclick="adminRefreshAbo()">
          <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
          Actualiser
        </button>
      </div>

      <!-- RÃ©sumÃ© plans -->
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:24px;">
        <div style="background:#fff;border-radius:14px;padding:16px;border:2px solid #9BA3AE;box-shadow:0 1px 4px rgba(0,0,0,0.06);">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
            <span style="font-size:1.2rem;">ğŸŒ±</span>
            <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:#1A1E25;">Gratuit</div>
          </div>
          <div id="aboCount-gratuit" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.8rem;color:#9BA3AE;line-height:1;">â€”</div>
          <div style="font-size:0.7rem;color:#9BA3AE;margin-top:4px;">utilisateurs Â· 0 XAF</div>
        </div>
        <div style="background:#fff;border-radius:14px;padding:16px;border:2px solid #3B82F6;box-shadow:0 1px 4px rgba(0,0,0,0.06);">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
            <span style="font-size:1.2rem;">ğŸ“Š</span>
            <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:#1A1E25;">Standard</div>
          </div>
          <div id="aboCount-standard" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.8rem;color:#3B82F6;line-height:1;">â€”</div>
          <div style="font-size:0.7rem;color:#3B82F6;margin-top:4px;">abonnÃ©s Â· 1 000 XAF/mois</div>
        </div>
        <div style="background:#fff;border-radius:14px;padding:16px;border:2px solid #8B5CF6;box-shadow:0 1px 4px rgba(0,0,0,0.06);">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
            <span style="font-size:1.2rem;">ğŸš€</span>
            <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:#1A1E25;">Pro <span style="background:#8B5CF6;color:#fff;font-size:0.55rem;padding:2px 6px;border-radius:8px;margin-left:4px;">POPULAIRE</span></div>
          </div>
          <div id="aboCount-pro" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.8rem;color:#8B5CF6;line-height:1;">â€”</div>
          <div style="font-size:0.7rem;color:#8B5CF6;margin-top:4px;">abonnÃ©s Â· 3 000 XAF/mois</div>
        </div>
        <div style="background:#fff;border-radius:14px;padding:16px;border:2px solid #D4A843;box-shadow:0 1px 4px rgba(0,0,0,0.06);">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
            <span style="font-size:1.2rem;">ğŸ¢</span>
            <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:#1A1E25;">Entreprise</div>
          </div>
          <div id="aboCount-entreprise" style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.8rem;color:#D4A843;line-height:1;">â€”</div>
          <div style="font-size:0.7rem;color:#D4A843;margin-top:4px;">abonnÃ©s Â· 15 000 XAF/mois</div>
        </div>
      </div>

      <!-- Tableau abonnements -->
      <div class="admin-section">
        <div class="admin-section-header">
          <div class="admin-section-title">ğŸ“‹ Liste des abonnÃ©s</div>
          <div class="admin-filter-row">
            <button class="admin-filter-btn active" onclick="filterAboTable('tous',this)">Tous</button>
            <button class="admin-filter-btn" onclick="filterAboTable('gratuit',this)" style="border-color:#9BA3AE;color:#9BA3AE;">ğŸŒ± Gratuit</button>
            <button class="admin-filter-btn" onclick="filterAboTable('standard',this)" style="border-color:#3B82F6;color:#3B82F6;">ğŸ“Š Standard</button>
            <button class="admin-filter-btn" onclick="filterAboTable('pro',this)" style="border-color:#8B5CF6;color:#8B5CF6;">ğŸš€ Pro</button>
            <button class="admin-filter-btn" onclick="filterAboTable('entreprise',this)" style="border-color:#D4A843;color:#D4A843;">ğŸ¢ Entreprise</button>
          </div>
        </div>
        <div class="admin-table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Utilisateur</th>
                <th>Plan</th>
                <th>Statut</th>
                <th>Date dÃ©but</th>
                <th>Expiration</th>
                <th>Paiement</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="aboTableBody"></tbody>
          </table>
          <div class="admin-empty" id="aboEmpty" style="display:none">Aucun abonnÃ© dans cette catÃ©gorie.</div>
        </div>
      </div>

      <!-- Tarification configurÃ©e -->
      <div class="admin-section" style="margin-top:20px;">
        <div class="admin-section-header">
          <div class="admin-section-title">âš™ï¸ Tarification configurÃ©e</div>
          <button onclick="adminNavTo('dashboard',null)" class="admin-filter-btn" style="font-size:0.72rem;">â† Retour dashboard</button>
        </div>
        <div style="padding:18px 20px;">
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;">
            <div style="background:#F7F8F9;border-radius:10px;padding:14px;">
              <div style="font-size:0.7rem;font-weight:700;color:#9BA3AE;text-transform:uppercase;margin-bottom:6px;">ğŸŒ± Gratuit</div>
              <div style="font-family:'Sora',sans-serif;font-weight:800;color:#1A1E25;">0 XAF</div>
              <div style="font-size:0.72rem;color:#9BA3AE;margin-top:2px;">Activation immÃ©diate Â· Sans expiration</div>
            </div>
            <div style="background:#EFF6FF;border-radius:10px;padding:14px;">
              <div style="font-size:0.7rem;font-weight:700;color:#3B82F6;text-transform:uppercase;margin-bottom:6px;">ğŸ“Š Standard</div>
              <div style="font-family:'Sora',sans-serif;font-weight:800;color:#1A1E25;">1 000 XAF/mois</div>
              <div style="font-size:0.72rem;color:#3B82F6;margin-top:2px;">10 000 XAF/an Â· âˆ’17%</div>
            </div>
            <div style="background:#F5F3FF;border-radius:10px;padding:14px;">
              <div style="font-size:0.7rem;font-weight:700;color:#8B5CF6;text-transform:uppercase;margin-bottom:6px;">ğŸš€ Pro</div>
              <div style="font-family:'Sora',sans-serif;font-weight:800;color:#1A1E25;">3 000 XAF/mois</div>
              <div style="font-size:0.72rem;color:#8B5CF6;margin-top:2px;">30 000 XAF/an Â· âˆ’17%</div>
            </div>
            <div style="background:#FFFBEB;border-radius:10px;padding:14px;">
              <div style="font-size:0.7rem;font-weight:700;color:#D4A843;text-transform:uppercase;margin-bottom:6px;">ğŸ¢ Entreprise</div>
              <div style="font-family:'Sora',sans-serif;font-weight:800;color:#1A1E25;">15 000 XAF/mois</div>
              <div style="font-size:0.72rem;color:#D4A843;margin-top:2px;">150 000 XAF/an Â· âˆ’17%</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- PANNEAU PRÃ‰VISUALISATION -->
  <div id="adminPanelPreview" class="admin-panel-nav">
    <div class="admin-preview-bar">
      <div class="admin-preview-label">AperÃ§u administrateur</div>
      <div class="admin-preview-path" id="adminPreviewPath">/</div>
      <div style="display:flex;align-items:center;gap:8px">
        <span class="editor-changes-count" id="editorChangesCount">0 modification</span>
        <button class="admin-preview-close" onclick="adminNavTo('dashboard', null)">âœ• Fermer l'aperÃ§u</button>
      </div>
    </div>

    <div class="editor-toolbar" id="editorToolbar">
      <div class="editor-toolbar-group">
        <span class="editor-toolbar-label">Ã‰dition</span>
        <button class="editor-btn editor-btn--edit" id="btnToggleEdit" onclick="toggleEditMode()">
          <svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          Activer l'Ã©dition
        </button>
        <button class="editor-btn editor-btn--undo" id="btnUndo" onclick="undoLastChange()" title="Annuler (Ctrl+Z)" style="display:none">
          <svg viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 101.85-4.05L1 10"/></svg>
          Annuler
        </button>
      </div>
      <div class="editor-toolbar-group">
        <span class="editor-toolbar-label">MÃ©tier</span>
        <button class="editor-btn editor-btn--biz" id="btnBizPanel" onclick="toggleBizPanel()">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 010 14.14M4.93 4.93a10 10 0 000 14.14"/></svg>
          Valeurs & Prix
        </button>
      </div>
      <div class="editor-toolbar-group">
        <span class="editor-toolbar-label">ThÃ¨me</span>
        <button class="editor-btn editor-btn--theme" id="btnThemePanel" onclick="toggleThemePanel()">
          <svg viewBox="0 0 24 24"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 011.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>
          Couleurs & Polices
        </button>
      </div>
      <div class="editor-toolbar-group">
        <span class="editor-toolbar-label">Export</span>
        <button class="editor-btn editor-btn--export" onclick="exportModifiedHTML()">
          <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          TÃ©lÃ©charger HTML
        </button>
      </div>
    </div>

    <div id="wordToolbar">
      <span class="wt-label">Police</span>
      <select class="wt-select" id="wtFontFamily" onchange="wtExecFont(this.value)">
        <option value="">â€” Police â€”</option>
        <optgroup label="Sans-serif">
          <option value="Sora">Sora</option><option value="DM Sans">DM Sans</option><option value="Inter">Inter</option>
          <option value="Poppins">Poppins</option><option value="Montserrat">Montserrat</option>
        </optgroup>
        <optgroup label="Serif">
          <option value="Playfair Display">Playfair Display</option><option value="Georgia">Georgia</option>
        </optgroup>
        <optgroup label="Mono"><option value="JetBrains Mono">JetBrains Mono</option></optgroup>
      </select>
      <div class="wt-sep"></div>
      <span class="wt-label">Taille</span>
      <button class="wt-size-btn" onclick="wtChangeSize(-2)">âˆ’</button>
      <input class="wt-size-num" id="wtSizeNum" type="number" value="16" min="6" max="120" onblur="wtSetSize(+this.value)">
      <button class="wt-size-btn" onclick="wtChangeSize(2)">+</button>
      <div class="wt-sep"></div>
      <span class="wt-label">Mise en forme</span>
      <button class="wt-btn" id="wtB" onclick="wtCmd('bold')"><b>G</b></button>
      <button class="wt-btn" id="wtI" onclick="wtCmd('italic')"><i>I</i></button>
      <button class="wt-btn" id="wtU" onclick="wtCmd('underline')"><u>S</u></button>
      <button class="wt-btn" id="wtS" onclick="wtCmd('strikeThrough')"><s>S</s></button>
      <div class="wt-sep"></div>
      <span class="wt-label">Couleur</span>
      <div class="wt-color-wrap">
        <div class="wt-color-btn" id="wtFgBtn">
          <span class="wt-color-letter">A</span>
          <div class="wt-color-swatch" id="wtFgSwatch" style="background:#fff"></div>
          <input type="color" value="#ffffff" id="wtFgPicker" oninput="wtApplyColor('foreColor',this.value);document.getElementById('wtFgSwatch').style.background=this.value">
        </div>
      </div>
      <div class="wt-color-wrap">
        <div class="wt-color-btn" id="wtBgBtn">
          <svg style="width:11px;height:11px;stroke:rgba(255,255,255,.65);fill:none;stroke-width:2.2" viewBox="0 0 24 24"><path d="M3 18h12"/><path d="m15.5 6-8.5 8.5-4 4L1 21l2.5-2 8.5-8.5L15.5 6z"/><path d="M18 3l3 3-3.5 3.5L14.5 6 18 3z"/></svg>
          <div class="wt-color-swatch" id="wtBgSwatch" style="background:#FFE066"></div>
          <input type="color" value="#FFE066" id="wtBgPicker" oninput="wtApplyColor('hiliteColor',this.value);document.getElementById('wtBgSwatch').style.background=this.value">
        </div>
      </div>
      <div class="wt-sep"></div>
      <span class="wt-label">Alignement</span>
      <button class="wt-btn" id="wtAL" onclick="wtCmd('justifyLeft')"><svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/></svg></button>
      <button class="wt-btn" id="wtAC" onclick="wtCmd('justifyCenter')"><svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg></button>
      <button class="wt-btn" id="wtAR" onclick="wtCmd('justifyRight')"><svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="6" y1="18" x2="21" y2="18"/></svg></button>
      <div class="wt-sep"></div>
      <span class="wt-label">Listes</span>
      <button class="wt-btn" id="wtUL" onclick="wtCmd('insertUnorderedList')"><svg viewBox="0 0 24 24"><circle cx="4" cy="7" r="1.5" fill="currentColor" stroke="none"/><circle cx="4" cy="13" r="1.5" fill="currentColor" stroke="none"/><line x1="8" y1="7" x2="21" y2="7"/><line x1="8" y1="13" x2="21" y2="13"/></svg></button>
      <button class="wt-btn" id="wtOL" onclick="wtCmd('insertOrderedList')"><svg viewBox="0 0 24 24"><line x1="10" y1="6" x2="21" y2="6"/><line x1="10" y1="12" x2="21" y2="12"/></svg></button>
      <div class="wt-sep"></div>
      <button class="wt-btn" onclick="wtClearFmt()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <div id="wtSelInfo">Aucun Ã©lÃ©ment</div>
    </div>

    <div id="wtBubble">
      <button class="wt-btn" onclick="wtCmd('bold')"><b>G</b></button>
      <button class="wt-btn" onclick="wtCmd('italic')"><i>I</i></button>
      <button class="wt-btn" onclick="wtCmd('underline')"><u>S</u></button>
      <button class="wt-btn" onclick="wtCmd('strikeThrough')"><s>S</s></button>
      <div class="wt-sep"></div>
      <button class="wt-btn" onclick="wtCmd('justifyLeft')"><svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/></svg></button>
      <button class="wt-btn" onclick="wtCmd('justifyCenter')"><svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/></svg></button>
      <button class="wt-btn" onclick="wtCmd('justifyRight')"><svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/></svg></button>
      <div class="wt-sep"></div>
      <button class="wt-btn" onclick="wtClearFmt()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>

    <div id="adminPreviewContent" style="background:var(--gris-100);min-height:calc(100vh - 180px);overflow-y:auto;position:relative;">
      <div style="position:sticky;top:0;z-index:50;background:rgba(74,158,42,0.92);backdrop-filter:blur(8px);padding:7px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <div style="font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:#fff;font-family:'Sora',sans-serif;display:flex;align-items:center;gap:8px;">
          <svg style="width:14px;height:14px;stroke:#fff;fill:none;stroke-width:2" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
          <span id="adminPreviewModeBanner">Mode AperÃ§u Admin</span>
        </div>
        <div style="font-family:monospace;font-size:0.72rem;color:rgba(255,255,255,0.7)" id="adminPreviewPathBanner">/</div>
        <button onclick="adminNavTo('dashboard', null)" style="font-size:0.72rem;color:#fff;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);padding:4px 12px;border-radius:5px;cursor:pointer;font-family:'DM Sans',sans-serif;">â† Retour admin</button>
      </div>
      <div id="adminPreviewInner"></div>
    </div>
  </div>

  <!-- PANNEAU THÃˆME -->
  <div id="themePanel">
    <div class="theme-panel-header">
      <div class="theme-panel-title">ğŸ¨ Ã‰diteur de thÃ¨me</div>
      <button class="theme-panel-close" onclick="toggleThemePanel()">âœ•</button>
    </div>
    <div class="theme-panel-body">
      <div class="biz-section-label">Couleurs principales</div>
      <div class="theme-row"><span class="theme-row-label">Vert principal</span><input type="color" value="#4A9E2A" oninput="applyThemeColor('--vert-principal', this.value)" onchange="recordThemeChange('--vert-principal', this.value)"></div>
      <div class="theme-row"><span class="theme-row-label">Vert foncÃ©</span><input type="color" value="#2A5E10" oninput="applyThemeColor('--vert-fonce', this.value)" onchange="recordThemeChange('--vert-fonce', this.value)"></div>
      <div class="theme-row"><span class="theme-row-label">Accent vert</span><input type="color" value="#6ED63B" oninput="applyThemeColor('--vert-accent', this.value)" onchange="recordThemeChange('--vert-accent', this.value)"></div>
      <div class="theme-row"><span class="theme-row-label">Or / accentuation</span><input type="color" value="#D4A843" oninput="applyThemeColor('--or-accent', this.value)" onchange="recordThemeChange('--or-accent', this.value)"></div>
      <div class="theme-row"><span class="theme-row-label">Fond clair vert</span><input type="color" value="#EDF7E5" oninput="applyThemeColor('--vert-clair', this.value)" onchange="recordThemeChange('--vert-clair', this.value)"></div>
      <div class="biz-section-label" style="margin-top:4px">Typographie</div>
      <div class="theme-row"><span class="theme-row-label">Police titres</span><select onchange="applyThemeFont('heading', this.value)"><option value="Sora" selected>Sora</option><option value="Inter">Inter</option><option value="Poppins">Poppins</option><option value="Montserrat">Montserrat</option></select></div>
      <div class="theme-row"><span class="theme-row-label">Police corps</span><select onchange="applyThemeFont('body', this.value)"><option value="DM Sans" selected>DM Sans</option><option value="Inter">Inter</option><option value="Roboto">Roboto</option></select></div>
      <div class="biz-section-label" style="margin-top:4px">Rayon des bordures</div>
      <div class="theme-row"><span class="theme-row-label">Boutons</span><select onchange="applyBorderRadius('button', this.value)"><option value="4px">CarrÃ©</option><option value="8px" selected>Arrondi</option><option value="14px">TrÃ¨s arrondi</option><option value="100px">Pill</option></select></div>
      <button class="theme-reset-btn" onclick="resetTheme()">â†º RÃ©initialiser le thÃ¨me</button>
    </div>
  </div>

  <!-- PANNEAU VALEURS MÃ‰TIER -->
  <div id="bizPanel">
    <div class="biz-panel-header">
      <div class="biz-panel-title">âš™ï¸ Valeurs mÃ©tier</div>
      <button class="theme-panel-close" onclick="toggleBizPanel()">âœ•</button>
    </div>
    <div class="biz-panel-body">
      <div class="biz-section-label">Programme d'affiliation</div>
      <div class="biz-field"><label class="biz-field-label">Taux de commission (%)</label><input type="number" id="biz-commission-rate" value="50" min="1" max="100"></div>
      <div class="biz-field"><label class="biz-field-label">DÃ©lai de sÃ©curitÃ© (jours)</label><input type="number" id="biz-security-delay" value="15" min="1"></div>
      <div class="biz-section-label" style="margin-top:8px;">Abonnements</div>
      <div class="biz-field"><label class="biz-field-label">Prix Standard mensuel (XAF)</label><input type="number" id="biz-price-standard" value="1000" min="0"></div>
      <div class="biz-field"><label class="biz-field-label">Prix Pro mensuel (XAF)</label><input type="number" id="biz-price-premium" value="3000" min="0"></div>
      <div class="biz-field"><label class="biz-field-label">Prix Entreprise mensuel (XAF)</label><input type="number" id="biz-price-entreprise" value="15000" min="0"></div>
      <div class="biz-section-label" style="margin-top:8px;">Textes clÃ©s</div>
      <div class="biz-field"><label class="biz-field-label">Nom de la plateforme</label><input type="text" id="biz-platform-name" value="ABAE"></div>
      <div class="biz-field"><label class="biz-field-label">Tagline</label><input type="text" id="biz-tagline" value="Marketplace Agro-Pastorale"></div>
      <div class="biz-field"><label class="biz-field-label">Badge affiliÃ©</label><input type="text" id="biz-aff-btn-text" value="Devenir affiliÃ©"></div>
      <div class="biz-field"><label class="biz-field-label">Trust line</label><input type="text" id="biz-trust-line" value="Inscription gratuite â€¢ Activation en 2 minutes â€¢ Transactions sÃ©curisÃ©es"></div>
      <div class="biz-section-label">Footer</div>
      <div class="biz-field"><label class="biz-field-label">Texte copyright</label><input type="text" id="biz-copyright" value="Â© 2026 ABAE"></div>
      <button class="biz-apply-btn" onclick="applyBizValues()">âœ“ Appliquer les modifications</button>
    </div>
  </div>

</div><!-- /page-admin -->


<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE SUBSCRIPTION SYSTEM â€” DÃ©clarÃ© en premier pour Ãªtre disponible partout
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ABAE_SUB = (function() {
  let state = {
    subscription_type: null,
    subscription_status: 'none',
    subscription_start_date: null,
    subscription_end_date: null,
    payment_status: null,
    billing: 'monthly',
  };
  const PLANS = {
    gratuit:    { label: 'Gratuit',    icon: 'ğŸŒ±', color: '#9BA3AE', badgeBg: '#9BA3AE',  priceM: 0,     priceA: 0,      days: null },
    standard:   { label: 'Standard',   icon: 'ğŸ“Š', color: '#3B82F6', badgeBg: '#3B82F6',  priceM: 1000,  priceA: 10000,  days: 30  },
    pro:        { label: 'Pro',        icon: 'ğŸš€', color: '#8B5CF6', badgeBg: '#8B5CF6',  priceM: 3000,  priceA: 30000,  days: 30  },
    entreprise: { label: 'Entreprise', icon: 'ğŸ¢', color: '#D4A843', badgeBg: '#D4A843',  priceM: 15000, priceA: 150000, days: 30  },
  };
  function hasActiveSubscription() { return state.subscription_status === 'active'; }
  function isExpired() {
    if (!state.subscription_end_date) return false;
    return new Date() > new Date(state.subscription_end_date);
  }
  function activate(type, billing) {
    const plan = PLANS[type]; if (!plan) return;
    const now = new Date(); let endDate = null;
    if (plan.days !== null) {
      endDate = new Date(now);
      if (billing === 'annual') { endDate.setFullYear(endDate.getFullYear() + 1); }
      else { endDate.setDate(endDate.getDate() + plan.days); }
    }
    state = { subscription_type: type, subscription_status: 'active',
      subscription_start_date: now.toISOString(),
      subscription_end_date: endDate ? endDate.toISOString() : null,
      payment_status: type === 'gratuit' ? null : 'paid', billing: billing || 'monthly' };
    updateUI();
  }
  function updateUI() {
    const type = state.subscription_type; if (!type) return;
    const plan = PLANS[type]; if (!plan) return;
    const heroBadge = document.getElementById('subBadgeHero');
    if (heroBadge) {
      const bgMap = { gratuit:'rgba(155,163,174,0.3)', standard:'rgba(59,130,246,0.25)', pro:'rgba(139,92,246,0.25)', entreprise:'rgba(212,168,67,0.25)' };
      heroBadge.style.background = bgMap[type] || 'rgba(255,255,255,0.15)';
      heroBadge.style.borderColor = plan.color + '60';
      heroBadge.textContent = plan.icon + ' ' + plan.label.toUpperCase();
    }
    const pIcon = document.getElementById('subProfileIcon');
    const pName = document.getElementById('subProfileName');
    const pExpiry = document.getElementById('subProfileExpiry');
    const pBadge = document.getElementById('subProfileBadge');
    const pCard = document.getElementById('subProfileCard');
    if (pIcon) { pIcon.textContent = plan.icon; pIcon.style.background = plan.color + '30'; }
    if (pName) pName.textContent = 'Plan ' + plan.label;
    if (pBadge) { pBadge.textContent = plan.label.toUpperCase(); pBadge.style.background = plan.badgeBg; }
    if (pCard) pCard.style.borderColor = plan.color + '50';
    if (pExpiry) {
      if (state.subscription_end_date) {
        const d = new Date(state.subscription_end_date);
        pExpiry.textContent = 'Expire le ' + d.toLocaleDateString('fr-FR', { day:'2-digit', month:'long', year:'numeric' });
        pExpiry.style.color = isExpired() ? '#E53E3E' : '#9BA3AE';
      } else { pExpiry.textContent = 'Pas d\'expiration'; }
    }
    const pill = document.getElementById('smartPlanPill');
    if (pill) {
      const labels = { gratuit:'ğŸŒ± Plan Gratuit', standard:'ğŸ“Š Plan Standard', pro:'ğŸš€ Plan Pro Â· IA AvancÃ©e', entreprise:'ğŸ¢ Plan Entreprise' };
      pill.textContent = labels[type] || 'ğŸŒ± Plan Gratuit';
    }
  }
  function getState() { return { ...state }; }
  function getPlan(type) { return PLANS[type]; }
  function getAllPlans() { return PLANS; }
  return { hasActiveSubscription, isExpired, activate, updateUI, getState, getPlan, getAllPlans };
})();

/* â”€â”€ ROUTEUR â”€â”€ */
/* â”€â”€ DÃ‰CONNEXION â€” RÃ©initialise la session et retourne Ã  l'accueil public â”€â”€ */
function deconnexion() {
  // 1. RÃ©initialiser le formulaire d'inscription
  try {
    if (typeof fd !== 'undefined') {
      fd.type = null; fd.profil = null; fd.cgu = false; fd.rester = false;
    }
    if (typeof curStep !== 'undefined') curStep = 1;
    // Vider les champs du formulaire
    ['prenom','nom','email','tel','pw1','pw2','region','ville'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = '';
    });
  } catch(e) {}

  // 2. Remettre le hero Ã  l'Ã©tat par dÃ©faut
  const nameEl  = document.getElementById('heroUserName');
  const labelEl = document.getElementById('heroProfilLabel');
  if (nameEl)  nameEl.textContent  = 'Jean-Pierre ğŸ‘‹';
  if (labelEl) labelEl.textContent = 'Acheteur';

  // 3. Retirer body.marche-mode
  document.body.classList.remove('marche-mode');
  document.documentElement.style.overflow = '';
  document.documentElement.style.height   = '';

  // 4. Naviguer vers la page d'accueil publique
  showView('accueil');

  // 5. Remonter en haut de la page
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* â”€â”€ Mise Ã  jour du profil dans le hero du marchÃ© â”€â”€ */
const PROFIL_LABELS = {
  producteur:   { label: 'Vendeur', emoji: 'ğŸŒ¾' },
  acheteur:     { label: 'Acheteur',              emoji: 'ğŸ›’' },
  transporteur: { label: 'Transporteur',          emoji: 'ğŸš›' },
  partenaire:   { label: 'Partenaire',            emoji: 'ğŸ¤' },
  affilie:      { label: 'AffiliÃ© âœ¦',             emoji: 'ğŸ”—' },
};

function updateMarcheHero(prenom, profil) {
  const nameEl   = document.getElementById('heroUserName');
  const labelEl  = document.getElementById('heroProfilLabel');
  if (nameEl && prenom)  nameEl.textContent = prenom + ' ğŸ‘‹';
  if (labelEl && profil) {
    const p = PROFIL_LABELS[profil] || { label: profil, emoji: 'ğŸ‘¤' };
    labelEl.textContent = p.emoji + ' ' + p.label;
  }
}

/* â”€â”€ Drapeaux pays (code ISO â†’ emoji) â”€â”€ */
const PAYS_FLAGS = {
  CM:'ğŸ‡¨ğŸ‡²',SN:'ğŸ‡¸ğŸ‡³',CI:'ğŸ‡¨ğŸ‡®',ML:'ğŸ‡²ğŸ‡±',BF:'ğŸ‡§ğŸ‡«',NE:'ğŸ‡³ğŸ‡ª',NG:'ğŸ‡³ğŸ‡¬',GH:'ğŸ‡¬ğŸ‡­',
  BJ:'ğŸ‡§ğŸ‡¯',TG:'ğŸ‡¹ğŸ‡¬',GN:'ğŸ‡¬ğŸ‡³',SL:'ğŸ‡¸ğŸ‡±',LR:'ğŸ‡±ğŸ‡·',MR:'ğŸ‡²ğŸ‡·',GW:'ğŸ‡¬ğŸ‡¼',GM:'ğŸ‡¬ğŸ‡²',CV:'ğŸ‡¨ğŸ‡»',
  CG:'ğŸ‡¨ğŸ‡¬',CD:'ğŸ‡¨ğŸ‡©',GA:'ğŸ‡¬ğŸ‡¦',GQ:'ğŸ‡¬ğŸ‡¶',CF:'ğŸ‡¨ğŸ‡«',TD:'ğŸ‡¹ğŸ‡©',ST:'ğŸ‡¸ğŸ‡¹',
  RW:'ğŸ‡·ğŸ‡¼',BI:'ğŸ‡§ğŸ‡®',ET:'ğŸ‡ªğŸ‡¹',ER:'ğŸ‡ªğŸ‡·',DJ:'ğŸ‡©ğŸ‡¯',SO:'ğŸ‡¸ğŸ‡´',KE:'ğŸ‡°ğŸ‡ª',UG:'ğŸ‡ºğŸ‡¬',
  TZ:'ğŸ‡¹ğŸ‡¿',MW:'ğŸ‡²ğŸ‡¼',ZM:'ğŸ‡¿ğŸ‡²',ZW:'ğŸ‡¿ğŸ‡¼',MZ:'ğŸ‡²ğŸ‡¿',MG:'ğŸ‡²ğŸ‡¬',MU:'ğŸ‡²ğŸ‡º',SC:'ğŸ‡¸ğŸ‡¨',KM:'ğŸ‡°ğŸ‡²',
  SS:'ğŸ‡¸ğŸ‡¸',SD:'ğŸ‡¸ğŸ‡©',DZ:'ğŸ‡©ğŸ‡¿',EG:'ğŸ‡ªğŸ‡¬',MA:'ğŸ‡²ğŸ‡¦',TN:'ğŸ‡¹ğŸ‡³',LY:'ğŸ‡±ğŸ‡¾',
  ZA:'ğŸ‡¿ğŸ‡¦',AO:'ğŸ‡¦ğŸ‡´',BW:'ğŸ‡§ğŸ‡¼',NA:'ğŸ‡³ğŸ‡¦',LS:'ğŸ‡±ğŸ‡¸',SZ:'ğŸ‡¸ğŸ‡¿',
  FR:'ğŸ‡«ğŸ‡·',BE:'ğŸ‡§ğŸ‡ª',CH:'ğŸ‡¨ğŸ‡­',LU:'ğŸ‡±ğŸ‡º',DE:'ğŸ‡©ğŸ‡ª',NL:'ğŸ‡³ğŸ‡±',IT:'ğŸ‡®ğŸ‡¹',ES:'ğŸ‡ªğŸ‡¸',
  PT:'ğŸ‡µğŸ‡¹',GB:'ğŸ‡¬ğŸ‡§',SE:'ğŸ‡¸ğŸ‡ª',NO:'ğŸ‡³ğŸ‡´',DK:'ğŸ‡©ğŸ‡°',FI:'ğŸ‡«ğŸ‡®',PL:'ğŸ‡µğŸ‡±',RO:'ğŸ‡·ğŸ‡´',
  RU:'ğŸ‡·ğŸ‡º',UA:'ğŸ‡ºğŸ‡¦',TR:'ğŸ‡¹ğŸ‡·',
  US:'ğŸ‡ºğŸ‡¸',CA:'ğŸ‡¨ğŸ‡¦',BR:'ğŸ‡§ğŸ‡·',MX:'ğŸ‡²ğŸ‡½',CO:'ğŸ‡¨ğŸ‡´',CL:'ğŸ‡¨ğŸ‡±',HT:'ğŸ‡­ğŸ‡¹',
  CN:'ğŸ‡¨ğŸ‡³',IN:'ğŸ‡®ğŸ‡³',JP:'ğŸ‡¯ğŸ‡µ',AU:'ğŸ‡¦ğŸ‡º',AE:'ğŸ‡¦ğŸ‡ª',SA:'ğŸ‡¸ğŸ‡¦'
};

/* â”€â”€ Noms pays (code ISO â†’ nom lisible) â”€â”€ */
const PAYS_NOMS = {
  CM:'Cameroun',SN:'SÃ©nÃ©gal',CI:"CÃ´te d'Ivoire",ML:'Mali',BF:'Burkina Faso',NE:'Niger',
  NG:'Nigeria',GH:'Ghana',BJ:'BÃ©nin',TG:'Togo',GN:'GuinÃ©e',SL:'Sierra Leone',LR:'LibÃ©ria',
  MR:'Mauritanie',GW:'GuinÃ©e-Bissau',GM:'Gambie',CV:'Cap-Vert',
  CG:'Congo',CD:'RD Congo',GA:'Gabon',GQ:'GuinÃ©e Ã‰quatoriale',CF:'Centrafrique',TD:'Tchad',ST:'SÃ£o TomÃ©',
  RW:'Rwanda',BI:'Burundi',ET:'Ã‰thiopie',ER:'Ã‰rythrÃ©e',DJ:'Djibouti',SO:'Somalie',KE:'Kenya',
  UG:'Ouganda',TZ:'Tanzanie',MW:'Malawi',ZM:'Zambie',ZW:'Zimbabwe',MZ:'Mozambique',
  MG:'Madagascar',MU:'Maurice',SC:'Seychelles',KM:'Comores',SS:'Soudan du Sud',SD:'Soudan',
  DZ:'AlgÃ©rie',EG:'Ã‰gypte',MA:'Maroc',TN:'Tunisie',LY:'Libye',
  ZA:'Afrique du Sud',AO:'Angola',BW:'Botswana',NA:'Namibie',LS:'Lesotho',SZ:'Eswatini',
  FR:'France',BE:'Belgique',CH:'Suisse',LU:'Luxembourg',DE:'Allemagne',NL:'Pays-Bas',
  IT:'Italie',ES:'Espagne',PT:'Portugal',GB:'Royaume-Uni',SE:'SuÃ¨de',NO:'NorvÃ¨ge',
  DK:'Danemark',FI:'Finlande',PL:'Pologne',RO:'Roumanie',RU:'Russie',UA:'Ukraine',TR:'Turquie',
  US:'Ã‰tats-Unis',CA:'Canada',BR:'BrÃ©sil',MX:'Mexique',CO:'Colombie',CL:'Chili',HT:'HaÃ¯ti',
  CN:'Chine',IN:'Inde',JP:'Japon',AU:'Australie',AE:'Ã‰mirats arabes unis',SA:'Arabie Saoudite'
};

/** Remplir le hero de la page Profil avec les donnÃ©es rÃ©elles de l'utilisateur */
function populateProfileHero() {
  const user = ABAE_getActiveUser();
  if (!user) return;

  const nom    = user.nom    || 'Utilisateur';
  const profil = user.profil || 'acheteur';
  const pays   = user.pays   || 'CM';

  // Initiales
  const initiales = nom.trim().split(/\s+/).map(w=>w[0]||'').join('').substring(0,2).toUpperCase() || 'U';

  // LibellÃ© profil
  const pInfo = PROFIL_LABELS[profil] || { label: profil, emoji: 'ğŸ‘¤' };

  // LibellÃ© pays
  const paysNom  = PAYS_NOMS[pays]  || pays;
  const paysFlag = PAYS_FLAGS[pays] || 'ğŸŒ';

  const avatarEl = document.getElementById('profileHeroAvatar');
  const nameEl   = document.getElementById('profileHeroName');
  const typeEl   = document.getElementById('profileHeroType');

  if (avatarEl) avatarEl.textContent = initiales;
  if (nameEl)   nameEl.textContent   = nom;
  if (typeEl)   typeEl.textContent   = pInfo.label + ' Â· ' + paysNom + ' ' + paysFlag;

  // Mettre aussi Ã  jour l'info "Pays / RÃ©gion" dans le menu paramÃ¨tres
  const paysMenuEl = document.getElementById('profileMenuPays');
  if (paysMenuEl) paysMenuEl.textContent = paysNom + ' ' + paysFlag;
}

/** PrÃ©-remplir le sheet d'Ã©dition du profil avec les donnÃ©es rÃ©elles */
function populateProfileSheet() {
  const user = ABAE_getActiveUser();
  if (!user) return;

  const nom    = user.nom    || '';
  const email  = user.email  || '';
  const tel    = user.tel    || '';
  const pays   = user.pays   || 'CM';
  const profil = user.profil || 'acheteur';

  const initiales = nom.trim().split(/\s+/).map(w=>w[0]||'').join('').substring(0,2).toUpperCase() || 'U';

  const nomEl   = document.getElementById('profileEditNom');
  const emailEl = document.getElementById('profileEditEmail');
  const telEl   = document.getElementById('profileEditTel');
  const paysEl  = document.getElementById('profilePays');
  const avatarEl= document.getElementById('profileEditAvatar');

  if (nomEl)    nomEl.value   = nom;
  if (emailEl)  emailEl.value = email;
  if (telEl)    telEl.value   = tel;
  if (paysEl)   paysEl.value  = pays;
  if (avatarEl) avatarEl.textContent = initiales;

  // Mettre Ã  jour le badge profil
  const pInfo = PROFIL_LABELS[profil] || { label: profil, emoji: 'ğŸ‘¤' };
  const badgeEl = document.getElementById('profileEditProfilBadge');
  if (badgeEl) badgeEl.textContent = pInfo.emoji + ' ' + pInfo.label;
}

/** Sauvegarder les modifications du profil dans localStorage */
function saveProfileEdit() {
  const email = localStorage.getItem('ABAE_CURRENT_EMAIL') || '';
  if (!email) { showToast('Session introuvable','err'); return; }

  const db   = ABAE_getUsersDB();
  const user = db[email] || {};

  const nom   = (document.getElementById('profileEditNom')?.value  || '').trim();
  const tel   = (document.getElementById('profileEditTel')?.value  || '').trim();
  const pays  = document.getElementById('profilePays')?.value || user.pays || 'CM';

  if (!nom) { showToast('Le nom ne peut pas Ãªtre vide','err'); return; }

  // Mettre Ã  jour la DB
  user.nom  = nom;
  user.tel  = tel;
  user.pays = pays;
  db[email] = user;
  localStorage.setItem('ABAE_USERS_DB', JSON.stringify(db));
  window.ABAE_USER_NAME = nom;

  // Mettre Ã  jour l'interface immÃ©diatement
  const prenom = nom.split(' ')[0];
  updateMarcheHero(prenom, user.profil || 'acheteur');
  populateProfileHero();

  showToast('Informations sauvegardÃ©es âœ“','ok');
  closeSheet('profileEditSheet');
}

function showView(id) {
  // â”€â”€ BYPASS TOTAL si mode admin ou visiteur â”€â”€
  if (!window.ABAE_BYPASS_AUTH && !(window.ABAE_STATE && window.ABAE_STATE.isVisitorMode)) {
    // â”€â”€ GARDE ABONNEMENT â”€â”€
    const PROTECTED_VIEWS = ['marche'];
    if (PROTECTED_VIEWS.includes(id) && !ABAE_SUB.hasActiveSubscription()) {
      showView('abonnement');
      return;
    }
    if (PROTECTED_VIEWS.includes(id) && ABAE_SUB.isExpired()) {
      document.getElementById('aboExpiryWall').classList.add('show');
      return;
    }
  }

  // GÃ©rer WelcomeScreen (ws-screen = page-accueil)
  const _ws = document.getElementById('ws-screen');
  if (id === 'accueil') {
    // Retour Ã  l'accueil = rÃ©afficher le WelcomeScreen
    if (_ws) {
      _ws.style.display = 'flex';
      _ws.style.opacity = '1';
      _ws.style.transform = 'scale(1)';
      document.body.classList.add('ws-active');
    }
    return; // Pas besoin de gÃ©rer les autres pages
  } else {
    // Sur toute autre vue, cacher le WelcomeScreen
    if (_ws) _ws.style.display = 'none';
  }
  ['inscription','inscription-affilie','verify-email','email-confirmed','abonnement','login','forgot','admin-login','admin','dashboard-affilie','marche'].forEach(p => {
    const el = document.getElementById('page-' + p);
    if (el) el.classList.remove('active');
  });
  if (id !== 'accueil') {
    const t = document.getElementById('page-' + id);
    if (t) t.classList.add('active');
  }
  window.scrollTo(0, 0);
  if (id === 'admin') { startAdminClock(); adminRefresh(); adminNavTo('dashboard', null); }
  /* Marketplace mode */
  if (id === 'marche') {
    document.body.classList.add('marche-mode');
    document.documentElement.style.overflow = 'hidden';
    document.documentElement.style.height = '100%';
    // Synchroniser le hero du marchÃ© et le profil avec les donnÃ©es rÃ©elles
    setTimeout(() => {
      const user = ABAE_getActiveUser();
      if (user && user.nom) {
        const prenom = user.nom.split(' ')[0];
        updateMarcheHero(prenom, user.profil || 'acheteur');
        populateProfileHero();
      }
    }, 50);
  } else {
    document.body.classList.remove('marche-mode');
    document.documentElement.style.overflow = '';
    document.documentElement.style.height = '';
  }
  if (id === 'email-confirmed') { AppEvents.emit('email:verified', { email: v('email') || '' }); }
}
function showPage(id) { showView(id); }

/* â”€â”€ ADMIN NAVIGATION â€” AccÃ¨s Ã  toutes les pages depuis l'espace admin â”€â”€ */

// Pages mappÃ©es par leur ID interne â†’ contenu Ã  cloner
const ADMIN_PAGE_PATHS = {
  'accueil':              '/',
  'inscription':          '/inscription',
  'inscription-affilie':  '/inscription/affiliÃ©',
  'login':                '/connexion',
  'forgot':               '/mot-de-passe-oubliÃ©',
  'verify-email':         '/vÃ©rification-email',
  'email-confirmed':      '/email-confirmÃ©',
  'abonnement':           '/abonnement',
  'dashboard-affilie':    '/espace-affiliÃ©'
};

function adminNavTo(section, btn) {
  document.querySelectorAll('.admin-nav-item').forEach(i => i.classList.remove('active'));
  if (btn) btn.classList.add('active');
  else {
    const items = document.querySelectorAll('.admin-nav-item');
    if (items.length) items[0].classList.add('active');
  }
  // Masquer tous les panneaux
  ['adminPanelDashboard','adminPanelAbonnements','adminPanelPreview'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.remove('active');
  });
  if (section === 'abonnements') {
    const p = document.getElementById('adminPanelAbonnements');
    if (p) p.classList.add('active');
    renderAboTable('tous');
    updateAboStats();
    return;
  }
  const dashEl = document.getElementById('adminPanelDashboard');
  const prevEl = document.getElementById('adminPanelPreview');
  if (section === 'dashboard') { if (dashEl) dashEl.classList.add('active'); }
  else { if (prevEl) prevEl.classList.add('active'); }
}

function adminPreview(pageId, btn) {
  // Mettre Ã  jour les nav items
  document.querySelectorAll('.admin-nav-item').forEach(i => i.classList.remove('active'));
  if (btn) btn.classList.add('active');

  const path = ADMIN_PAGE_PATHS[pageId] || '/' + pageId;
  document.getElementById('adminPreviewPath').textContent = path;
  document.getElementById('adminPreviewPathBanner').textContent = path;

  // RÃ©cupÃ©rer le contenu de la page source
  const srcEl = document.getElementById('page-' + pageId) || (pageId === 'accueil' ? (document.getElementById('page-accueil') || document.getElementById('ws-screen')) : null);
  const inner = document.getElementById('adminPreviewInner');

  if (srcEl) {
    // Cloner le contenu pour l'afficher dans le panneau
    const clone = srcEl.cloneNode(true);
    // Supprimer les attributs display:none et classes page/active du clone
    clone.removeAttribute('id');
    clone.style.display = 'block';
    clone.classList.remove('page');
    clone.classList.add('active');

    inner.innerHTML = '';
    inner.appendChild(clone);
  } else {
    inner.innerHTML = `<div style="text-align:center;padding:80px 20px;color:var(--gris-400)">
      <div style="font-size:2rem;margin-bottom:12px">ğŸ“„</div>
      <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:1rem;color:var(--gris-700);margin-bottom:6px">Page non disponible</div>
      <div style="font-size:0.85rem">La page <code style="background:var(--gris-200);padding:2px 6px;border-radius:4px">${pageId}</code> n'a pas pu Ãªtre chargÃ©e.</div>
    </div>`;
  }

  // Afficher le panneau prÃ©visualisation
  adminNavTo('preview', btn);
}

// Permet aussi de naviguer vers une vraie page depuis l'aperÃ§u admin
function adminGoToPage(pageId) {
  showView(pageId);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE EDITOR â€” Moteur d'Ã©dition en temps rÃ©el
   Architecture :
   - liveEdits{}    : dictionnaire {data-editable key â†’ {el, original, current}}
   - undoStack[]    : pile des modifications pour Ctrl+Z
   - themeEdits{}   : modifications CSS variables
   - editModeActive : Ã©tat du mode Ã©dition texte
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const liveEdits = {};
const undoStack = [];
const themeEdits = {};
let editModeActive = false;
let currentPreviewPageId = null;

// â”€â”€ Basculer le mode Ã©dition de texte â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleEditMode() {
  editModeActive = !editModeActive;
  const inner = document.getElementById('adminPreviewInner');
  const btn = document.getElementById('btnToggleEdit');
  const undoBtn = document.getElementById('btnUndo');
  const banner = document.getElementById('adminPreviewModeBanner');

  if (editModeActive) {
    inner.classList.add('edit-mode');
    btn.innerHTML = `<svg viewBox="0 0 24 24" style="width:12px;height:12px;stroke:currentColor;fill:none;stroke-width:2"><polyline points="20 6 9 17 4 12"/></svg> Ã‰dition active`;
    btn.style.background = 'rgba(46,204,113,0.35)';
    btn.style.borderColor = '#6ED63B';
    undoBtn.style.display = 'flex';
    banner.textContent = 'âœï¸ Mode Ã‰dition â€” Cliquez sur les Ã©lÃ©ments en pointillÃ©s verts pour modifier';
    document.getElementById('wordToolbar').classList.add('wt-visible');
    // Rendre Ã©ditables tous les Ã©lÃ©ments [data-editable] SAUF les formulaires auth
    inner.querySelectorAll('[data-editable]').forEach(el => {
      const pageEl = el.closest('.page');
      const isAuthPage = pageEl && ['page-inscription','page-login','page-forgot','page-inscription-affilie','page-verify-email'].some(id => pageEl.id === id);
      if (!isAuthPage) {
        el.contentEditable = 'true';
        el.dataset.originalContent = el.dataset.originalContent || el.innerHTML;
        el.addEventListener('input', onEditableInput);
        el.addEventListener('blur', onEditableBlur);
        el.addEventListener('keydown', onEditableKeydown);
      }
    });
  } else {
    inner.classList.remove('edit-mode');
    btn.innerHTML = `<svg viewBox="0 0 24 24" style="width:12px;height:12px;stroke:currentColor;fill:none;stroke-width:2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg> Activer l'Ã©dition`;
    btn.style.background = '';
    btn.style.borderColor = '';
    undoBtn.style.display = 'none';
    banner.textContent = 'Mode AperÃ§u Admin';
    document.getElementById('wordToolbar').classList.remove('wt-visible');
    document.getElementById('wtBubble').classList.remove('wt-visible');
    inner.querySelectorAll('[data-editable]').forEach(el => {
      el.contentEditable = 'false';
      el.removeEventListener('input', onEditableInput);
      el.removeEventListener('blur', onEditableBlur);
      el.removeEventListener('keydown', onEditableKeydown);
    });
  }
}

// â”€â”€ Callbacks Ã©dition â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onEditableInput(e) {
  const el = e.target;
  const key = el.dataset.editable;
  if (!key) return;
  // Marquer comme modifiÃ©
  el.style.outline = '2px solid #6ED63B';
}

function onEditableBlur(e) {
  const el = e.target;
  const key = el.dataset.editable;
  if (!key) return;

  const newContent = el.innerHTML;
  const original = el.dataset.originalContent || '';

  if (newContent === original) return; // pas de changement

  // Sauvegarder dans la pile undo
  undoStack.push({ key, el, prev: liveEdits[key]?.current || original });

  // Enregistrer la modification
  liveEdits[key] = { el, original, current: newContent };

  // Propager IMMÃ‰DIATEMENT dans le vrai DOM source
  const sourceEl = document.querySelector(`[data-editable="${key}"]`);
  if (sourceEl && sourceEl !== el) {
    sourceEl.innerHTML = newContent;
  }

  updateChangesCount();
  showToast(`âœï¸ ModifiÃ© : ${el.dataset.editLabel || key}`);
}

function onEditableKeydown(e) {
  // Ctrl+Z dans un champ Ã©ditable
  if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
    e.preventDefault();
    undoLastChange();
  }
  // EmpÃªcher EntrÃ©e de crÃ©er des <div> dans les Ã©lÃ©ments inline
  if (e.key === 'Enter' && !e.shiftKey) {
    const tag = e.target.tagName.toLowerCase();
    if (['span','p','h1','h2','h3','h4','li'].includes(tag)) {
      e.preventDefault();
    }
  }
}

// â”€â”€ Annuler la derniÃ¨re modification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function undoLastChange() {
  if (undoStack.length === 0) {
    showToast('âš  Aucune modification Ã  annuler');
    return;
  }
  const last = undoStack.pop();
  if (last.el) {
    last.el.innerHTML = last.prev;
    last.el.dataset.originalContent = last.prev;
  }
  // Propager dans la source
  const sourceEl = document.querySelector(`[data-editable="${last.key}"]`);
  if (sourceEl && sourceEl !== last.el) sourceEl.innerHTML = last.prev;

  if (liveEdits[last.key]) liveEdits[last.key].current = last.prev;
  updateChangesCount();
  showToast('â†© Modification annulÃ©e');
}

// â”€â”€ Compteur de modifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateChangesCount() {
  const n = Object.keys(liveEdits).length + Object.keys(themeEdits).length;
  const el = document.getElementById('editorChangesCount');
  if (!el) return;
  if (n === 0) {
    el.classList.remove('visible');
  } else {
    el.classList.add('visible');
    el.textContent = n + ' modification' + (n > 1 ? 's' : '') + ' en attente';
  }
}

// â”€â”€ ThÃ¨me : couleurs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyThemeColor(varName, value) {
  document.documentElement.style.setProperty(varName, value);
  // Aussi mettre Ã  jour les alias correspondants
  const aliasMap = {
    '--vert-principal': '--vp',
    '--vert-fonce': '--vf',
    '--vert-clair': '--vc',
    '--vert-accent': '--va',
    '--or-accent': '--or',
  };
  if (aliasMap[varName]) {
    document.documentElement.style.setProperty(aliasMap[varName], value);
  }
  // Mettre Ã  jour shadow-cta si couleur principale change
  if (varName === '--vert-principal') {
    const r = parseInt(value.slice(1,3),16);
    const g = parseInt(value.slice(3,5),16);
    const b = parseInt(value.slice(5,7),16);
    document.documentElement.style.setProperty('--shadow-cta', `0 4px 14px rgba(${r},${g},${b},0.35)`);
  }
}

function recordThemeChange(varName, value) {
  const original = themeEdits[varName]?.original ||
    getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
  themeEdits[varName] = { original, current: value };
  updateChangesCount();
  showToast(`ğŸ¨ Couleur mise Ã  jour`);
}

// â”€â”€ ThÃ¨me : typographie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const loadedFonts = new Set(['Sora', 'DM Sans']);
function applyThemeFont(target, fontName) {
  if (!loadedFonts.has(fontName)) {
    loadedFonts.add(fontName);
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = `https://fonts.googleapis.com/css2?family=${fontName.replace(/ /g,'+')}:wght@400;500;600;700;800&display=swap`;
    document.head.appendChild(link);
  }
  if (target === 'heading') {
    document.querySelectorAll('h1,h2,h3,h4,.sora,[style*="Sora"]').forEach(el => {
      el.style.fontFamily = `'${fontName}', sans-serif`;
    });
    document.documentElement.style.setProperty('--font-heading', `'${fontName}', sans-serif`);
    themeEdits['--font-heading'] = { current: fontName };
  } else {
    document.body.style.fontFamily = `'${fontName}', sans-serif`;
    document.querySelectorAll('[style*="DM Sans"]').forEach(el => {
      el.style.fontFamily = `'${fontName}', sans-serif`;
    });
    themeEdits['--font-body'] = { current: fontName };
  }
  updateChangesCount();
  showToast(`ğŸ”¤ Police mise Ã  jour : ${fontName}`);
}

// â”€â”€ ThÃ¨me : border-radius â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyBorderRadius(target, value) {
  document.querySelectorAll('.btn, .btn-p, .btn-o, .btn-g, .btn--primary, .btn--outline, .btn--hero, .btn--ghost, .btn--aff').forEach(el => {
    el.style.borderRadius = value;
  });
  themeEdits['--border-radius-btn'] = { current: value };
  updateChangesCount();
  showToast(`ğŸ“ Border-radius : ${value}`);
}

// â”€â”€ ThÃ¨me : reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetTheme() {
  const defaults = {
    '--vert-principal': '#4A9E2A',
    '--vert-fonce': '#2A5E10',
    '--vert-clair': '#EDF7E5',
    '--vert-accent': '#6ED63B',
    '--or-accent': '#D4A843',
  };
  Object.entries(defaults).forEach(([k, v]) => {
    document.documentElement.style.setProperty(k, v);
  });
  // Remettre les inputs couleur Ã  leur valeur par dÃ©faut
  document.querySelectorAll('#themePanel input[type=color]').forEach((inp, i) => {
    inp.value = Object.values(defaults)[i];
  });
  // Reset fonts
  document.body.style.fontFamily = "'DM Sans', sans-serif";
  // Reset border-radius
  document.querySelectorAll('.btn, .btn-p, .btn-o, .btn-g').forEach(el => el.style.borderRadius = '');
  // Vider les themeEdits
  Object.keys(themeEdits).forEach(k => delete themeEdits[k]);
  updateChangesCount();
  showToast('â†º ThÃ¨me rÃ©initialisÃ©');
}

// â”€â”€ Valeurs mÃ©tier â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyBizValues() {
  const commRate = parseFloat(document.getElementById('biz-commission-rate').value) || 50;
  const secDelay = parseInt(document.getElementById('biz-security-delay').value) || 15;
  const priceStd = parseInt(document.getElementById('biz-price-standard').value) || 1000;
  const pricePrem = parseInt(document.getElementById('biz-price-premium').value) || 3000;
  const commStd = Math.round(priceStd * commRate / 100);
  const commPrem = Math.round(pricePrem * commRate / 100);
  const platformName = document.getElementById('biz-platform-name').value.trim() || 'ABAE';
  const tagline = document.getElementById('biz-tagline').value.trim();
  const affBtnText = document.getElementById('biz-aff-btn-text').value.trim();
  const trustLine = document.getElementById('biz-trust-line').value.trim();
  const copyright = document.getElementById('biz-copyright').value.trim();

  // Appliquer partout dans le DOM
  const applyText = (selector, text) => {
    document.querySelectorAll(selector).forEach(el => { if (text) el.textContent = text; });
  };

  // Prix et commissions dans les CGU
  document.querySelectorAll('.cgu-example, .cgu-highlight strong').forEach(el => {
    const txt = el.innerHTML;
    el.innerHTML = txt
      .replace(/\d[\d\s]*FCFA.*Commission\s*=\s*<strong>\d[\d\s]*FCFA<\/strong>/gi, match => match)
      .replace(/1[\s ]000 FCFA/g, formatFCFA(priceStd))
      .replace(/3[\s ]000 FCFA/g, formatFCFA(pricePrem))
      .replace(/500 FCFA/g, formatFCFA(commStd))
      .replace(/1[\s ]500 FCFA/g, formatFCFA(commPrem));
  });

  // Remplacer dans tout le document
  replaceTextInDOM(document.body, '50%', commRate + '%', ['.admin-header', '.admin-content', '#themePanel', '#bizPanel']);
  replaceTextInDOM(document.body, '15 jours', secDelay + ' jours', ['.admin-header', '.admin-content', '#themePanel', '#bizPanel']);

  // Nom plateforme
  if (platformName) {
    document.querySelectorAll('.logo__name, .logo-name, .admin-header-title, title').forEach(el => {
      if (el.tagName === 'TITLE') { el.textContent = el.textContent.replace(/ABAE/, platformName); }
      else { el.textContent = el.textContent.replace(/ABAE/g, platformName); }
    });
  }

  // Tagline
  if (tagline) {
    document.querySelectorAll('.logo__sub').forEach(el => el.textContent = tagline);
  }

  // Bouton affiliÃ©
  if (affBtnText) {
    document.querySelectorAll('.btn--aff').forEach(el => {
      if (!el.querySelector('svg')) el.textContent = affBtnText;
    });
  }

  // Trust line
  if (trustLine) {
    document.querySelectorAll('.trust-line').forEach(el => el.innerHTML = trustLine);
  }

  // Copyright
  if (copyright) {
    document.querySelectorAll('.footer__copy, .footer-mini p').forEach(el => {
      el.innerHTML = el.innerHTML.replace(/Â©\s*\d{4}\s*<strong[^>]*>ABAE<\/strong>/gi, copyright);
    });
  }

  // Enregistrer comme modification
  Object.assign(liveEdits, {
    'biz-commission-rate': { current: commRate + '%' },
    'biz-security-delay': { current: secDelay + 'j' },
    'biz-price-standard': { current: priceStd },
    'biz-price-premium': { current: pricePrem },
  });
  updateChangesCount();
  showToast(`âœ“ ${Object.keys(liveEdits).length} valeurs mises Ã  jour dans toute l'app`);

  // Fermer le panneau
  document.getElementById('bizPanel').classList.remove('open');
  document.getElementById('btnBizPanel').classList.remove('active');
}

function formatFCFA(n) {
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ') + ' FCFA';
}

function replaceTextInDOM(root, search, replace, excludeSelectors = []) {
  const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT);
  const nodes = [];
  while (walker.nextNode()) nodes.push(walker.currentNode);
  nodes.forEach(node => {
    const parent = node.parentElement;
    if (!parent) return;
    // Exclure les zones admin
    const excluded = excludeSelectors.some(sel => parent.closest(sel));
    if (excluded) return;
    if (node.textContent.includes(search)) {
      node.textContent = node.textContent.replace(new RegExp(search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), replace);
    }
  });
}

// â”€â”€ Toggle panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleThemePanel() {
  const p = document.getElementById('themePanel');
  const btn = document.getElementById('btnThemePanel');
  const bizP = document.getElementById('bizPanel');
  bizP.classList.remove('open');
  document.getElementById('btnBizPanel').classList.remove('active');
  const isOpen = p.classList.toggle('open');
  btn.classList.toggle('active', isOpen);
}

function toggleBizPanel() {
  const p = document.getElementById('bizPanel');
  const btn = document.getElementById('btnBizPanel');
  const themeP = document.getElementById('themePanel');
  themeP.classList.remove('open');
  document.getElementById('btnThemePanel').classList.remove('active');
  const isOpen = p.classList.toggle('open');
  btn.classList.toggle('active', isOpen);
}

// â”€â”€ Export HTML modifiÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportModifiedHTML() {
  showToast('â³ GÃ©nÃ©ration du fichier HTML...');
  setTimeout(() => {
    // Cloner tout le document
    const clone = document.documentElement.cloneNode(true);

    // Appliquer les variables CSS modifiÃ©es dans le clone
    if (Object.keys(themeEdits).length > 0) {
      const styleEl = clone.querySelector('style');
      if (styleEl) {
        let css = styleEl.textContent;
        Object.entries(themeEdits).forEach(([varName, edit]) => {
          if (varName.startsWith('--') && edit.current && !varName.includes('font') && !varName.includes('border-radius')) {
            css = css.replace(
              new RegExp(`(${varName.replace('--','--')}\\s*:\\s*)[^;]+;`),
              `$1${edit.current};`
            );
          }
        });
        styleEl.textContent = css;
      }
    }

    // Supprimer les Ã©lÃ©ments admin du clone
    ['page-admin', 'page-admin-login', 'themePanel', 'bizPanel', 'toast'].forEach(id => {
      const el = clone.getElementById(id);
      if (el) el.remove();
    });

    // Supprimer les attributs data-editable et contenteditable
    clone.querySelectorAll('[data-editable]').forEach(el => {
      el.removeAttribute('contenteditable');
      el.removeAttribute('data-original-content');
      // Garder data-editable pour rÃ©fÃ©rence (optionnel, peut Ãªtre supprimÃ©)
    });

    // Supprimer les styles inline du mode Ã©dition
    clone.querySelectorAll('[style*="outline"]').forEach(el => {
      el.style.outline = '';
    });

    // Supprimer le script live-editor inline
    clone.querySelectorAll('script').forEach(s => {
      if (s.textContent.includes('LIVE EDITOR')) {
        // On garde le script mais on peut le marquer
      }
    });

    const html = '<!DOCTYPE html>\n' + clone.outerHTML;
    const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    const ts = new Date().toISOString().slice(0,19).replace(/[T:]/g,'-');
    a.download = `ABAE_modifie_${ts}.html`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    const n = Object.keys(liveEdits).length + Object.keys(themeEdits).length;
    showToast(`âœ“ Fichier exportÃ© avec ${n} modification${n > 1 ? 's' : ''} appliquÃ©e${n > 1 ? 's' : ''}`);
    AppEvents.emit('export:html', { modifications: n });
  }, 300);
}

// â”€â”€ Keyboard shortcut global Ctrl+Z hors champ Ã©ditable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'z' && editModeActive) {
    const active = document.activeElement;
    if (!active || active.contentEditable !== 'true') {
      e.preventDefault();
      undoLastChange();
    }
  }
});

/* â”€â”€ ACCUEIL â”€â”€ */
const PROFILE_ACTIONS = {
  producteur:   ['Publier une annonce','RÃ©server un transport','RÃ©server un entrepÃ´t'],
  acheteur:     ['Rechercher des produits','Contacter un producteur','Suivre une commande'],
  transporteur: ['Voir les missions disponibles','GÃ©rer mes livraisons','Publier ma disponibilitÃ©'],
  partenaire:   ['Explorer les opportunitÃ©s','Devenir partenaire stratÃ©gique','AccÃ©der au dashboard investisseur']
};
let activeProfile = null;
function selectProfile(card) {
  activeProfile = card.dataset.profile;
  document.querySelectorAll('.profile-card').forEach(c => { c.classList.remove('active','dimmed'); });
  card.classList.add('active');
  document.querySelectorAll('.profile-card').forEach(c => { if(c!==card) c.classList.add('dimmed'); });
  renderActions(activeProfile);
}
function handleCardKey(e,card){ if(e.key==='Enter'||e.key===' '){e.preventDefault();selectProfile(card);} }
function renderActions(profile) {
  const section = document.getElementById('actionsSection');
  const grid = document.getElementById('actionsGrid');
  grid.innerHTML = '';
  PROFILE_ACTIONS[profile].forEach((label,i) => {
    const div = document.createElement('div');
    div.className = 'action-card';
    div.setAttribute('tabindex','0');
    div.style.animationDelay = i*0.06+'s';
    div.style.animation = 'cardIn 0.3s var(--ease) both';
    div.innerHTML = '<span class="action-card__label">'+label+'</span><span class="action-card__arrow">â†’</span>';
    div.onclick = () => {
      document.querySelectorAll('.action-card').forEach(c=>c.style.opacity='0.5');
      div.style.opacity='1'; div.style.borderColor='var(--vert-principal)'; div.style.background='var(--vert-clair)';
    };
    grid.appendChild(div);
  });
  section.classList.remove('visible'); void section.offsetWidth; section.classList.add('visible');
  setTimeout(()=>section.scrollIntoView({behavior:'smooth',block:'nearest'}),50);
}
function continuer() {
  if (!activeProfile) {
    const g = document.getElementById('profilesGrid');
    g.classList.add('shake');
    g.addEventListener('animationend',()=>g.classList.remove('shake'),{once:true});
    document.getElementById('profils').scrollIntoView({behavior:'smooth',block:'center'});
    return;
  }
  showView('inscription');
  setTimeout(()=>{ const c=document.querySelector('#profilGrid [data-profil="'+activeProfile+'"]'); if(c)c.click(); },100);
}
function updateHeaderCtas() {
  const b=document.getElementById('btnConnecterDesktop');
  if(b) b.style.display=window.innerWidth>=768?'inline-flex':'none';
}
updateHeaderCtas(); window.addEventListener('resize',updateHeaderCtas);

/* â”€â”€ BURGER â”€â”€ */
const burgerBtn=document.getElementById('burgerBtn'), mobileNav=document.getElementById('mobileNav');
if(burgerBtn&&mobileNav){
  burgerBtn.addEventListener('click',()=>{
    const o=mobileNav.classList.toggle('open');
    burgerBtn.classList.toggle('open',o); burgerBtn.setAttribute('aria-expanded',o);
    document.body.style.overflow=o?'hidden':'';
  });
  mobileNav.querySelectorAll('a').forEach(l=>l.addEventListener('click',()=>{
    mobileNav.classList.remove('open'); burgerBtn.classList.remove('open');
    burgerBtn.setAttribute('aria-expanded','false'); document.body.style.overflow='';
  }));
}
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'&&mobileNav&&mobileNav.classList.contains('open')){
    mobileNav.classList.remove('open'); burgerBtn.classList.remove('open');
    burgerBtn.setAttribute('aria-expanded','false'); document.body.style.overflow='';
  }
});

/* â”€â”€ FORMULAIRE INSCRIPTION â”€â”€ */
const fd={type:null,profil:null,cgu:false,rester:false};
let curStep=1;
function goStep(n){
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  document.getElementById('s'+n).classList.add('active');
  updateProg(n); curStep=n;
  const fw=document.querySelector('.fw');
  if(fw) fw.scrollIntoView({behavior:'smooth',block:'start'});
  // Auto-initialiser le pays Cameroun Ã  l'Ã©tape 2 si pas encore sÃ©lectionnÃ©
  if(n === 2) {
    const paysEl = document.getElementById('pays');
    if(paysEl && !paysEl.value) {
      // SÃ©lectionner Cameroun par dÃ©faut
      paysEl.value = 'CM';
      onPaysChange(paysEl);
      // PrÃ©-sÃ©lectionner la premiÃ¨re rÃ©gion
      setTimeout(() => {
        const reg = document.getElementById('region');
        if(reg && reg.options.length > 1) {
          reg.selectedIndex = 1;
          const ville = document.getElementById('ville');
          if(ville) { ville.disabled = false; }
          // Ne pas dÃ©clencher checkS2 ici â€” l'utilisateur doit encore remplir les autres champs
        }
      }, 50);
    }
  }
}
function updateProg(active){
  for(let i=1;i<=4;i++){
    const el=document.getElementById('ps'+i); if(!el) continue;
    el.className='prog-step '+(i<active?'done':i===active?'active':'pending');
    el.querySelector('.prog-num').textContent=i<active?'âœ“':i;
  }
}
function selCard(gridId,card){
  document.getElementById(gridId).querySelectorAll('.sel-card').forEach(c=>c.classList.remove('active'));
  card.classList.add('active');
  if(gridId==='typeGrid'){
    fd.type=card.dataset.type;
    switchFormType(fd.type);
  }
  if(gridId==='profilGrid') fd.profil=card.dataset.profil;
}

// Multi-sÃ©lection des rÃ´les (sauf affiliÃ©)
function toggleProfil(card){
  const profil = card.dataset.profil;
  if(!fd.profils) fd.profils = [];
  if(card.classList.contains('active')){
    card.classList.remove('active');
    fd.profils = fd.profils.filter(p => p !== profil);
  } else {
    card.classList.add('active');
    if(!fd.profils.includes(profil)) fd.profils.push(profil);
  }
  // Conserver compatibilitÃ© fd.profil (rÃ´le principal = premier sÃ©lectionnÃ©)
  fd.profil = fd.profils[0] || null;
  updateRolesResume();
}

// AffiliÃ© = sÃ©lection toggle avec message de demande
function toggleAffilie(card){
  if(!fd.profils) fd.profils = [];
  if(card.classList.contains('active')){
    card.classList.remove('active');
    fd.affilieDemande = false;
    fd.profils = fd.profils.filter(p => p !== 'affilie');
    document.getElementById('affilieSelectedMsg').style.display = 'none';
  } else {
    card.classList.add('active');
    fd.affilieDemande = true;
    if(!fd.profils.includes('affilie')) fd.profils.push('affilie');
    document.getElementById('affilieSelectedMsg').style.display = 'block';
  }
  fd.profil = fd.profils.filter(p=>p!=='affilie')[0] || fd.profils[0] || null;
  updateRolesResume();
}

// Affiche le rÃ©sumÃ© des rÃ´les sÃ©lectionnÃ©s
function updateRolesResume(){
  const labels = {producteur:'Vendeur',acheteur:'Acheteur',transporteur:'Transporteur',partenaire:'Partenaire',affilie:'AffiliÃ© âœ¦'};
  const resume = document.getElementById('rolesResume');
  const resumeText = document.getElementById('rolesResumeText');
  if(!fd.profils || fd.profils.length===0){ resume.style.display='none'; return; }
  resumeText.textContent = fd.profils.map(p=>labels[p]||p).join(' Â· ');
  resume.style.display = 'block';
}
function switchFormType(type){
  const isStructure = type === 'structure';
  document.getElementById('form-individu').style.display  = isStructure ? 'none'  : 'block';
  document.getElementById('form-structure').style.display = isStructure ? 'block' : 'none';
  const banner = document.getElementById('s2Banner');
  if(banner) banner.textContent = isStructure
    ? '\u{1F3E2} Ã‰tape 2 sur 4 \u2014 Informations de la structure'
    : '\u{1F464} Ã‰tape 2 sur 4 \u2014 Informations personnelles';
  const btn2 = document.getElementById('btn2');
  if(btn2) btn2.disabled = true;
}
/* â”€â”€ SÃ©lecteur de profil intelligent â”€â”€ */
const PROFILS_CONFIG = {
  agriculteur: {
    label: 'ğŸŒ¾ Agriculteur',
    fields: [
      { id:'psf_culture', label:'Culture principale', type:'select', options:['MaÃ¯s','Riz','Manioc','Sorgho','Igname','Plantain','Arachide','Coton','CafÃ©','Cacao','Autre'] },
      { id:'psf_superficie', label:'Superficie cultivÃ©e (hectares)', type:'input', placeholder:'Ex : 2.5', inputmode:'decimal' },
      { id:'psf_irrigation', label:'Mode d\'irrigation', type:'select', options:['Pluvial (pluie)','Irrigation manuelle','SystÃ¨me goutte-Ã -goutte','Pompage'] }
    ]
  },
  eleveur: {
    label: 'ğŸ„ Ã‰leveur',
    fields: [
      { id:'psf_animal', label:'Type d\'animaux', type:'select', options:['Bovins (vaches)','Ovins (moutons)','Caprins (chÃ¨vres)','Porcins (cochons)','Volaille (poulets)','Lapins','Mixte','Autre'] },
      { id:'psf_effectif', label:'Effectif approximatif', type:'input', placeholder:'Ex : 50 tÃªtes', inputmode:'numeric' },
      { id:'psf_systeme', label:'SystÃ¨me d\'Ã©levage', type:'select', options:['Extensif (pÃ¢turage)','Intensif (Ã©table)','Semi-intensif','Nomade / Transhumant'] }
    ]
  },
  maraicher: {
    label: 'ğŸ¥¬ MaraÃ®cher',
    fields: [
      { id:'psf_legumes', label:'LÃ©gumes principaux', type:'input', placeholder:'Ex : Tomates, Oignons, Piment' },
      { id:'psf_superficie', label:'Superficie (mÂ² ou ha)', type:'input', placeholder:'Ex : 500 mÂ²' },
      { id:'psf_vente', label:'Lieu de vente', type:'select', options:['MarchÃ© local','Grossistes','SupermarchÃ©s','Bord champ','En ligne (ABAE)','Exportation'] }
    ]
  },
  peche: {
    label: 'ğŸŸ PÃªcheur',
    fields: [
      { id:'psf_type_peche', label:'Type de pÃªche', type:'select', options:['PÃªche artisanale','PÃªche industrielle','Aquaculture / Pisciculture','Crevetticulture'] },
      { id:'psf_milieu', label:'Milieu de pÃªche', type:'select', options:['Mer / OcÃ©an','Fleuve / RiviÃ¨re','Lac / Barrage','Ã‰tang d\'aquaculture'] },
      { id:'psf_production', label:'Production mensuelle (kg)', type:'input', placeholder:'Ex : 500', inputmode:'numeric' }
    ]
  },
  restaurant: {
    label: 'ğŸ½ï¸ Restaurant',
    fields: [
      { id:'psf_type_resto', label:'Type de restauration', type:'select', options:['Restaurant traditionnel','Fast-food / Snack','Maquis / Buvette','Traiteur / Ã‰vÃ¨nementiel','Restaurant gastronomique','Street food'] },
      { id:'psf_couverts', label:'Nombre de couverts (places assises)', type:'input', placeholder:'Ex : 30', inputmode:'numeric' },
      { id:'psf_approvisionnement', label:'S\'approvisionner sur ABAE ?', type:'select', options:['Oui, avec livraison','Oui, retrait direct','Pas encore dÃ©cidÃ©'] }
    ]
  },
  hotel: {
    label: 'ğŸ¨ HÃ´tel',
    fields: [
      { id:'psf_type_hotel', label:'CatÃ©gorie de l\'Ã©tablissement', type:'select', options:['HÃ´tel 1-2 Ã©toiles','HÃ´tel 3-4 Ã©toiles','HÃ´tel 5 Ã©toiles','Maison d\'hÃ´tes / GÃ®te','Auberge de jeunesse','RÃ©sidence hÃ´teliÃ¨re'] },
      { id:'psf_chambres', label:'Nombre de chambres', type:'input', placeholder:'Ex : 20', inputmode:'numeric' },
      { id:'psf_service_restau', label:'Restauration intÃ©grÃ©e ?', type:'select', options:['Oui, restaurant complet','Petit-dÃ©jeuner seulement','Non'] }
    ]
  },
  commerce: {
    label: 'ğŸª Commerce',
    fields: [
      { id:'psf_type_commerce', label:'Type de commerce', type:'select', options:['Boutique / Ã‰picerie','SupÃ©rette','Grossiste','MarchÃ© / Ã‰tal','Commerce en ligne','Import / Export'] },
      { id:'psf_produits', label:'Produits vendus principalement', type:'input', placeholder:'Ex : CÃ©rÃ©ales, huiles, conserves' },
      { id:'psf_besoin', label:'Besoin principal', type:'select', options:['Trouver des fournisseurs','Trouver des clients','Les deux','Autre'] }
    ]
  },
  transformation: {
    label: 'ğŸ­ Transformation',
    fields: [
      { id:'psf_type_transfo', label:'Type de transformation', type:'select', options:['Huilerie','Rizerie / DÃ©corticage','Farine / Moulin','Jus & conserves','Boucherie / Charcuterie','Laiterie / Fromagerie','Autre agroalimentaire'] },
      { id:'psf_capacite', label:'CapacitÃ© de production', type:'input', placeholder:'Ex : 500 kg/jour' },
      { id:'psf_certification', label:'Certifications / labels ?', type:'select', options:['Oui (ISO, bio, halalâ€¦)','En cours d\'obtention','Non'] }
    ]
  },
  transport: {
    label: 'ğŸš› Transport',
    fields: [
      { id:'psf_type_transport', label:'Type de transport', type:'select', options:['Transport de marchandises agricoles','Livraison dernier kilomÃ¨tre','Froid / RÃ©frigÃ©rÃ©','Transport d\'animaux vivants','Mixte'] },
      { id:'psf_vehicules', label:'Nombre de vÃ©hicules', type:'input', placeholder:'Ex : 3', inputmode:'numeric' },
      { id:'psf_zone_transport', label:'Zone de couverture', type:'input', placeholder:'Ex : Centre et Littoral' }
    ]
  },
  cooperative: {
    label: 'ğŸ¤ CoopÃ©rative / GIE',
    fields: [
      { id:'psf_nom_coop', label:'Nom de la coopÃ©rative / GIE', type:'input', placeholder:'Ex : COOP AGRO CENTRE' },
      { id:'psf_membres', label:'Nombre de membres', type:'input', placeholder:'Ex : 45', inputmode:'numeric' },
      { id:'psf_activite_coop', label:'ActivitÃ© principale du groupe', type:'select', options:['Production agricole','Ã‰levage','Transformation','Commerce groupÃ©','Ã‰pargne & crÃ©dit','Polyvalent'] }
    ]
  },
  apiculture: {
    label: 'ğŸ¯ Apiculture',
    fields: [
      { id:'psf_ruches', label:'Nombre de ruches', type:'input', placeholder:'Ex : 20', inputmode:'numeric' },
      { id:'psf_production_miel', label:'Production annuelle de miel (kg)', type:'input', placeholder:'Ex : 150', inputmode:'numeric' },
      { id:'psf_vente_miel', label:'Mode de vente', type:'select', options:['Vente directe','MarchÃ© local','En ligne (ABAE)','Exportation','Transformateurs'] }
    ]
  },
  autre: {
    label: 'â• Autre activitÃ©',
    fields: [
      { id:'psf_autre_activite', label:'DÃ©crivez votre activitÃ©', type:'input', placeholder:'Ex : Consultance agricole, pÃ©piniÃ¨reâ€¦' }
    ]
  }
};

function selectProfil(profil) {
  // Construire sous-champs
  const config = PROFILS_CONFIG[profil];
  const subfields = document.getElementById('profilSubfields');
  if (!config || !profil) { subfields.style.display = 'none'; subfields.innerHTML = ''; return; }

  let html = '<div class="psf-title"><span>' + config.label + '</span> <span style="font-size:0.7rem;font-weight:400;color:var(--vert-principal)">PrÃ©cisez votre activitÃ©</span></div>';
  config.fields.forEach(f => {
    html += '<div class="field"><div class="field-label"><span>' + f.label + '</span></div>';
    if (f.type === 'select') {
      html += '<div class="sel-wrap"><select class="sel" id="' + f.id + '"><option value="">â€” SÃ©lectionner â€”</option>';
      f.options.forEach(o => { html += '<option value="' + o + '">' + o + '</option>'; });
      html += '</select></div>';
    } else {
      html += '<input class="input" type="text" id="' + f.id + '" placeholder="' + (f.placeholder||'') + '"' + (f.inputmode ? ' inputmode="' + f.inputmode + '"' : '') + '>';
    }
    html += '</div>';
  });

  subfields.innerHTML = html;
  subfields.style.display = 'block';
}

function checkS1(){ 
  const hasProfil = fd.profils && fd.profils.length > 0;
  // Si UNIQUEMENT affiliÃ© est sÃ©lectionnÃ© (sans profil marchÃ©) â†’ bouton redirige vers inscription-affilie
  const onlyAffilie = fd.profils && fd.profils.length === 1 && fd.profils[0] === 'affilie';
  const btn = document.getElementById('btn1');
  btn.disabled = !(fd.type && hasProfil);
  if (onlyAffilie && !btn.disabled) {
    btn.textContent = '';
    btn.innerHTML = 'ğŸ”— Continuer en tant qu\'AffiliÃ© <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
    btn.style.background = 'linear-gradient(135deg,#4A0E6B,#9B1B6A)';
    btn.onclick = function(e){ e.preventDefault(); showView('inscription-affilie'); };
  } else {
    btn.innerHTML = 'Suivant <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
    btn.style.background = '';
    btn.onclick = null;
  }
}

const urlP=new URLSearchParams(window.location.search).get('profil');
if(urlP){ const c=document.querySelector('[data-profil="'+urlP+'"]'); if(c) c.click(); }

const REGIONS={
  CM:['Adamaoua','Centre','Est','ExtrÃªme-Nord','Littoral','Nord','Nord-Ouest','Ouest','Sud','Sud-Ouest'],
  SN:['Dakar','ThiÃ¨s','Saint-Louis','Diourbel','Kaolack','Fatick','Kolda','Tambacounda','Ziguinchor','Louga'],
  CI:['Abidjan','Bas-Sassandra','ComoÃ©','DenguÃ©lÃ©','GÃ´h-Djiboua','Lacs','Lagunes','Montagnes','Sassandra-MarahouÃ©'],
  BF:['Boucle du Mouhoun','Cascades','Centre','Centre-Est','Centre-Nord','Hauts-Bassins','Nord','Sahel'],
  ML:['Bamako','Gao','Kayes','Kidal','Koulikoro','Mopti','SÃ©gou','Sikasso'],
  NG:['Abuja FCT','Lagos','Kano','Rivers','Oyo','Kaduna','Delta'],
  GA:['Estuaire','Haut-OgoouÃ©','Moyen-OgoouÃ©','NgouniÃ©','Nyanga','OgoouÃ©-Ivindo'],
  GH:['Ashanti','Greater Accra','Northern','Western','Eastern','Central'],
  FR:['Ãle-de-France','Auvergne-RhÃ´ne-Alpes','Provence-Alpes-CÃ´te d\'Azur','Nouvelle-Aquitaine'],
  BE:['Bruxelles','Flandre','Wallonie'],
};
function onPaysChange(sel){
  const opt=sel.options[sel.selectedIndex];
  // Mettre Ã  jour le prÃ©fixe tÃ©lÃ©phonique selon le formulaire actif
  const suffix = fd.type === 'structure' ? 'S' : '';
  const flagEl = document.getElementById('phoneFlag' + suffix);
  const codeEl = document.getElementById('phoneCode' + suffix);
  if (flagEl) flagEl.textContent = opt.getAttribute('data-flag') || 'ğŸŒ';
  if (codeEl) codeEl.textContent = opt.getAttribute('data-code') || '+';
  const reg=document.getElementById('region'), ville=document.getElementById('ville');
  reg.innerHTML='<option value="">â€” RÃ©gion â€”</option>';
  const regions=REGIONS[sel.value];
  reg.disabled=false;
  if(regions) regions.forEach(r=>{const o=document.createElement('option');o.value=r;o.textContent=r;reg.appendChild(o);});
  else { const o=document.createElement('option');o.value='autre';o.textContent='Autre rÃ©gion';reg.appendChild(o); }
  ville.disabled=true; ville.value='';
}
document.getElementById('region').addEventListener('change',function(){
  const v=document.getElementById('ville'); v.disabled=!this.value; if(!this.value) v.value=''; checkS2();
});
function checkS2(){
  const pays=v('pays'), region=v('region'), ville=v('ville');
  let ok = false;
  if(fd.type === 'structure'){
    // Pour structure : utiliser les IDs uniques du formulaire structure
    ok = v('nomStructure') && v('typeStructure') && v('secteurStructure')
      && v('prenomS') && v('nomS') && pays && region && ville && v('telS');
  } else {
    ok = v('prenom') && v('nom') && pays && region && ville && v('tel');
  }
  document.getElementById('btn2').disabled = !ok;
  const ew=document.getElementById('emailWarn'); if(ew) ew.style.display='none';
}
function v(id){ return document.getElementById(id)?.value?.trim()||''; }

let phoneDrop=null;
function togglePhoneDrop(suffix){
  suffix = suffix || '';
  const pfxId = 'phonePfx' + suffix;
  if(phoneDrop){phoneDrop.remove();phoneDrop=null;return;}
  const pfx=document.getElementById(pfxId), drop=document.createElement('div');
  drop.className='country-drop';
  [{f:'ğŸ‡¨ğŸ‡²',c:'+237',n:'Cameroun'},{f:'ğŸ‡³ğŸ‡¬',c:'+234',n:'Nigeria'},{f:'ğŸ‡¨ğŸ‡¬',c:'+242',n:'Congo'},{f:'ğŸ‡¨ğŸ‡©',c:'+243',n:'RD Congo'},{f:'ğŸ‡¬ğŸ‡¦',c:'+241',n:'Gabon'},{f:'ğŸ‡¸ğŸ‡³',c:'+221',n:'SÃ©nÃ©gal'},{f:'ğŸ‡¨ğŸ‡®',c:'+225',n:"CÃ´te d'Ivoire"},{f:'ğŸ‡²ğŸ‡±',c:'+223',n:'Mali'},{f:'ğŸ‡«ğŸ‡·',c:'+33',n:'France'},{f:'ğŸ‡§ğŸ‡ª',c:'+32',n:'Belgique'},{f:'ğŸ‡¬ğŸ‡§',c:'+44',n:'UK'},{f:'ğŸ‡ºğŸ‡¸',c:'+1',n:'USA'}].forEach(i=>{
    const d=document.createElement('div'); d.className='country-drop-item';
    d.innerHTML='<span>'+i.f+'</span><span>'+i.c+'</span><span>'+i.n+'</span>';
    d.onclick=()=>{
      document.getElementById('phoneFlag'+suffix).textContent=i.f;
      document.getElementById('phoneCode'+suffix).textContent=i.c;
      drop.remove();phoneDrop=null;
    };
    drop.appendChild(d);
  });
  if(pfx){ pfx.style.position='relative'; pfx.appendChild(drop); }
  phoneDrop=drop;
  setTimeout(()=>document.addEventListener('click',closeDrop,{once:true}),50);
}
function closeDrop(e){ if(phoneDrop&&!phoneDrop.contains(e.target)){phoneDrop.remove();phoneDrop=null;} }

let affT;
function checkAffiliate(val){
  clearTimeout(affT);
  const ok=document.getElementById('affOk'),inp=document.getElementById('parrainage');
  ok.style.display='none'; inp.classList.remove('ok','err');
  if(val.length<4) return;
  affT=setTimeout(()=>{ const valid=/^ABAE-[A-Z0-9]{4,}$/i.test(val); ok.style.display=valid?'flex':'none'; inp.classList.toggle('ok',valid); inp.classList.toggle('err',!valid); },500);
}
function triggerUpload(id){ document.getElementById(id).click(); }
function handleUpload(input,zoneId){
  if(!input.files[0]) return;
  const zone=document.getElementById(zoneId); zone.classList.add('loaded');
  zone.querySelector('.upload-title').textContent=input.files[0].name.length>20?input.files[0].name.substring(0,17)+'...':input.files[0].name;
  zone.querySelector('.upload-sub').textContent=(input.files[0].size/1024/1024).toFixed(2)+' Mo';
}
function togglePw(id,icon){ const inp=document.getElementById(id); inp.type=inp.type==='password'?'text':'password'; icon.style.opacity=inp.type==='text'?'0.5':'1'; }
function updatePwStr(pw){
  const wrap=document.getElementById('pwWrap'); if(!pw){wrap.style.display='none';return;} wrap.style.display='block';
  const h8=/\S{8}/.test(pw),hU=/[A-Z]/.test(pw),hN=/[\d\W]/.test(pw),h12=pw.length>=12;
  const score=[h8,hU,hN,h12].filter(Boolean).length;
  setRule('r1',h8);setRule('r2',hU);setRule('r3',hN);
  for(let i=1;i<=4;i++){const b=document.getElementById('b'+i);b.className='pw-bar'+(i<=score?' s'+score:'');}
}
function setRule(id,ok){ document.getElementById(id).classList.toggle('ok',ok); }
function checkPwMatch(){
  const pw1=v('pw1'),pw2=v('pw2'),err=document.getElementById('pwErr'),i2=document.getElementById('pw2');
  if(!pw2){err.style.display='none';i2.classList.remove('err','ok');return;}
  const match=pw1===pw2; err.style.display=match?'none':'flex'; i2.classList.toggle('err',!match); i2.classList.toggle('ok',match);
}
function checkS4(){ document.getElementById('btn4').disabled=!(v('pw1').length>=8&&v('pw1')===v('pw2')&&fd.cgu); }
function toggleCgu(){ fd.cgu=!fd.cgu; document.getElementById('cguChk').classList.toggle('on',fd.cgu); checkS4(); }
function toggleResterCo(){ fd.rester=!fd.rester; document.getElementById('resterChk').classList.toggle('on',fd.rester); }

function submitForm(){
  const btn=document.getElementById('btn4'); btn.disabled=true;
  btn.innerHTML='<svg class="btn-spinner" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" opacity=".25"/><path d="M12 3a9 9 0 019 9"/></svg>CrÃ©ation en coursâ€¦';
  setTimeout(()=>{
    // Lire les bons champs selon le type de compte
    const isStruct = fd.type === 'structure';
    const prenomVal = isStruct ? v('prenomS') : v('prenom');
    const nomVal    = isStruct ? v('nomS')    : v('nom');
    const telVal    = isStruct ? v('telS')    : v('tel');
    const emailVal  = isStruct ? v('emailS')  : v('email');
    const nom=(isStruct ? v('nomStructure') : prenomVal+' '+nomVal).trim()||'Utilisateur';
    document.getElementById('successName').textContent=nom;
    document.getElementById('verifyEmailDisplay').textContent=emailVal||'votre@email.com';
    const code='ABAE-'+Math.random().toString(36).substring(2,6).toUpperCase();
    document.getElementById('affCode').textContent=code;
    // Si la sÃ©lection inclut affiliÃ© mais aussi d'autres profils, le profil principal = le premier profil marchÃ©
    const profilFinal = (fd.profils && fd.profils.filter(p=>p!=='affilie')[0]) || fd.profil || 'acheteur';
    const isAffilieDemande = fd.profils && fd.profils.includes('affilie');
    addAdminUser({nom:nom+' '+nomVal,email:emailVal||'',pays:v('pays')||'CM',profil:profilFinal,code,affilieDemande:isAffilieDemande});

    // â”€â”€ PERSISTANCE PROFIL : sauvegarder l'utilisateur inscrit â”€â”€
    const email = (emailVal || '').toLowerCase().trim();
    if (email) {
      const db = ABAE_getUsersDB();
      db[email] = {
        nom:     nom,
        email:   email,
        profil:  profilFinal,
        profils: fd.profils ? [...fd.profils] : [profilFinal],
        type:    fd.type || 'particulier',
        pays:    v('pays') || 'CM',
        code:    code
      };
      localStorage.setItem('ABAE_USERS_DB', JSON.stringify(db));
      localStorage.setItem('ABAE_CURRENT_EMAIL', email);
    }

    showView('verify-email');
  },1800);
}

function showKycModal(){ document.getElementById('kycModal').classList.remove('hidden'); }
function startResend(){
  const link=document.getElementById('resendLink'); link.classList.add('disabled'); let t=60;
  const iv=setInterval(()=>{ link.textContent='Renvoyer dans '+t+'s'; t--; if(t<0){clearInterval(iv);link.textContent="Renvoyer l'email";link.classList.remove('disabled');} },1000);
}
function switchLoginTab(mode){
  document.getElementById('loginEmailMode').style.display=mode==='email'?'block':'none';
  document.getElementById('loginTelMode').style.display=mode==='tel'?'block':'none';
  document.getElementById('tabEmail').classList.toggle('active',mode==='email');
  document.getElementById('tabTel').classList.toggle('active',mode==='tel');
}

let loginCurrentProfile = 'membre';
function switchLoginProfile(profile) {
  loginCurrentProfile = profile;
  const isAff = profile === 'affilie';
  // Tabs styling
  document.getElementById('lpt-membre').classList.toggle('active', !isAff);
  document.getElementById('lpt-affilie').classList.toggle('active', isAff);
  // Show/hide banner
  document.getElementById('loginAffBanner').style.display = isAff ? 'flex' : 'none';
  // Toggle inscription links
  document.getElementById('loginSignupLink').style.display = isAff ? 'none' : 'block';
  document.getElementById('loginAffSignupLink').style.display = isAff ? 'block' : 'none';
  // Update button color
  const btn = document.getElementById('loginBtn');
  if (isAff) {
    btn.style.background = 'linear-gradient(135deg,#4A0E6B,#9B1B6A)';
    btn.style.boxShadow = '0 4px 14px rgba(155,27,106,0.35)';
  } else {
    btn.style.background = '';
    btn.style.boxShadow = '';
  }
}

function loginSubmit(){
  const err=document.getElementById('loginErr'); err.style.display='none';
  setTimeout(()=>{
    if(v('loginPw').length<6){err.style.display='flex';return;}

    // â”€â”€ RECONNAISSANCE PROFIL : chercher l'utilisateur par email â”€â”€
    const loginEmail = (v('loginEmail') || v('loginTel') || '').toLowerCase().trim();
    const savedUser  = ABAE_getUserByEmail(loginEmail);
    const profilRestored = savedUser ? savedUser.profil : 'acheteur';
    const nomRestored    = savedUser ? savedUser.nom    : (loginEmail.split('@')[0] || 'Utilisateur');

    // MÃ©moriser l'utilisateur courant pour cette session
    if (loginEmail) localStorage.setItem('ABAE_CURRENT_EMAIL', loginEmail);
    window.ABAE_USER_NAME = nomRestored;

    AppEvents.emit('login:success', { profil: loginCurrentProfile === 'affilie' ? 'affilie' : profilRestored });

    if(loginCurrentProfile === 'affilie'){
      showView('dashboard-affilie');
    } else {
      if (!window.ABAE_BYPASS_AUTH && !ABAE_SUB.hasActiveSubscription()) {
        showView('abonnement');
      } else if (!window.ABAE_BYPASS_AUTH && ABAE_SUB.isExpired()) {
        document.getElementById('aboExpiryWall').classList.add('show');
      } else {
        showView('marche');
        updateMarcheHero(nomRestored, profilRestored);
      }
    }
  },800);
}
function forgotSubmit(){ document.getElementById('forgotForm').style.display='none'; document.getElementById('forgotSent').style.display='block'; }

// â”€â”€ BYPASS ADMIN â€” VÃ©rification email â”€â”€
const ADMIN_BYPASS_CODE = '1234'; // Code admin configurable
let _bypassVisible = false;

function toggleAdminBypass() {
  _bypassVisible = !_bypassVisible;
  const area = document.getElementById('adminBypassArea');
  const toggle = document.getElementById('adminBypassToggle');
  if (area) area.style.display = _bypassVisible ? 'block' : 'none';
  if (toggle) toggle.textContent = _bypassVisible ? 'âœ• Annuler' : 'âš™ Passer la vÃ©rification (admin)';
  if (_bypassVisible) {
    setTimeout(() => { const inp = document.getElementById('adminBypassCode'); if(inp) inp.focus(); }, 100);
  }
  const err = document.getElementById('adminBypassErr');
  if (err) err.style.display = 'none';
}

function checkAdminBypassCode(val) {
  const err = document.getElementById('adminBypassErr');
  if (err) err.style.display = 'none';
  if (val === ADMIN_BYPASS_CODE) adminBypassConfirm();
}

function adminBypassConfirm() {
  const inp = document.getElementById('adminBypassCode');
  const err = document.getElementById('adminBypassErr');
  const code = inp ? inp.value : '';
  if (code !== ADMIN_BYPASS_CODE) {
    if (err) err.style.display = 'block';
    if (inp) { inp.style.borderColor = 'var(--err)'; setTimeout(() => inp.style.borderColor = 'var(--gris-200)', 1200); }
    return;
  }
  // Bypass validÃ© â†’ aller vers email-confirmed
  showToast('âœ… Email validÃ© par admin', 'ok');
  showView('email-confirmed');
  AppEvents.emit('email:verified', { email: document.getElementById('verifyEmailDisplay')?.textContent || '', byAdmin: true });
  // Reset
  _bypassVisible = false;
  if (inp) inp.value = '';
  const area = document.getElementById('adminBypassArea');
  if (area) area.style.display = 'none';
}
function copyCode(){
  const code=document.getElementById('affCode').textContent;
  navigator.clipboard.writeText(code).then(()=>showToast('âœ“ Code copiÃ© : '+code)).catch(()=>showToast('Code : '+code));
}
function showToast(msg){
  const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2800);
}

document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click',e=>{
    const href=a.getAttribute('href'); if(href==='#') return;
    const target=document.querySelector(href);
    if(target){e.preventDefault();target.scrollIntoView({behavior:'smooth',block:'start'});}
  });
});

/* â”€â”€ ADMIN LOGIN â”€â”€ */
const ADMIN_CODE='123456';
function adminCodeInput(idx){
  const inp=document.getElementById('ac'+idx);
  inp.value=inp.value.replace(/\D/g,'');
  inp.classList.toggle('filled',!!inp.value);
  if(inp.value&&idx<5) document.getElementById('ac'+(idx+1)).focus();
  checkAdminCodeReady();
}
function adminCodeKey(e,idx){
  if(e.key==='Backspace'&&!document.getElementById('ac'+idx).value&&idx>0)
    document.getElementById('ac'+(idx-1)).focus();
}
function getAdminCode(){ return Array.from({length:6},(_,i)=>document.getElementById('ac'+i).value).join(''); }
function checkAdminCodeReady(){ document.getElementById('adminLoginBtn').disabled=getAdminCode().length<6; }
function submitAdminCode(){
  const code=getAdminCode();
  if(code===ADMIN_CODE){ document.getElementById('adminCodeErr').style.display='none'; showView('admin'); }
  else {
    document.getElementById('adminCodeErr').style.display='block';
    Array.from({length:6},(_,i)=>{const inp=document.getElementById('ac'+i);inp.value='';inp.classList.remove('filled');});
    document.getElementById('ac0').focus(); checkAdminCodeReady();
  }
}

/* â”€â”€ ADMIN DASHBOARD â”€â”€ */
const FLAGS={CM:'ğŸ‡¨ğŸ‡²',SN:'ğŸ‡¸ğŸ‡³',CI:'ğŸ‡¨ğŸ‡®',BF:'ğŸ‡§ğŸ‡«',ML:'ğŸ‡²ğŸ‡±',NG:'ğŸ‡³ğŸ‡¬',GA:'ğŸ‡¬ğŸ‡¦',GH:'ğŸ‡¬ğŸ‡­',FR:'ğŸ‡«ğŸ‡·',BE:'ğŸ‡§ğŸ‡ª',CH:'ğŸ‡¨ğŸ‡­',GB:'ğŸ‡¬ğŸ‡§',US:'ğŸ‡ºğŸ‡¸'};
let adminUsers=[
  {id:1,nom:'Amina KonÃ©',email:'amina@mail.com',pays:'CI',profil:'producteur',statut:'verifie',date:'24/02/2026',aff:'ABAE-K7M2',plan:'pro',planStart:'01/02/2026',planEnd:'01/03/2026',payStatus:'paid'},
  {id:2,nom:'Ibrahim Diallo',email:'ibrahim@mail.com',pays:'SN',profil:'acheteur',statut:'attente',date:'24/02/2026',aff:'',plan:'gratuit',planStart:'24/02/2026',planEnd:null,payStatus:null},
  {id:3,nom:'CÃ©lestin Mba',email:'celestin@mail.com',pays:'CM',profil:'transporteur',statut:'verifie',date:'23/02/2026',aff:'ABAE-XR4T',plan:'standard',planStart:'23/01/2026',planEnd:'23/03/2026',payStatus:'paid'},
  {id:4,nom:'Fatou TraorÃ©',email:'fatou@mail.com',pays:'BF',profil:'partenaire',statut:'attente',date:'23/02/2026',aff:'',plan:'gratuit',planStart:'23/02/2026',planEnd:null,payStatus:null},
  {id:5,nom:'Kofi Asante',email:'kofi@mail.com',pays:'GH',profil:'producteur',statut:'rejete',date:'22/02/2026',aff:'',plan:'gratuit',planStart:'22/02/2026',planEnd:null,payStatus:null},
  {id:6,nom:'Marie-Claire Ndong',email:'marie@mail.com',pays:'GA',profil:'acheteur',statut:'verifie',date:'22/02/2026',aff:'ABAE-P9W1',plan:'entreprise',planStart:'01/01/2026',planEnd:'01/01/2027',payStatus:'paid'},
  {id:7,nom:'Oumar Sy',email:'oumar@mail.com',pays:'SN',profil:'transporteur',statut:'attente',date:'21/02/2026',aff:'',plan:'gratuit',planStart:'21/02/2026',planEnd:null,payStatus:null},
  {id:8,nom:'Nadia Kamara',email:'nadia@mail.com',pays:'CI',profil:'affilie',statut:'verifie',date:'24/02/2026',aff:'ABAE-N3Z8',plan:'pro',planStart:'01/02/2026',planEnd:'01/03/2026',payStatus:'paid'},
];
let currentFilter='tous';

function addAdminUser(data){
  const d=new Date();
  const date=String(d.getDate()).padStart(2,'0')+'/'+String(d.getMonth()+1).padStart(2,'0')+'/'+d.getFullYear();
  const newUser = {id:Date.now(),nom:data.nom.trim()||'Nouvel utilisateur',email:data.email||'',pays:data.pays||'CM',profil:data.profil||'producteur',statut:'attente',date,aff:data.code||''};
  adminUsers.unshift(newUser);
  // Ã‰mettre selon le type
  const eventType = data.profil === 'affilie' ? 'affiliate:registered' : 'user:registered';
  AppEvents.emit(eventType, newUser);
  return newUser;
}
function renderAdminTable(filter){
  const list=filter==='tous'?adminUsers:adminUsers.filter(u=>u.statut===filter);
  const tbody=document.getElementById('adminTableBody');
  const empty=document.getElementById('adminEmpty');
  if(list.length===0){tbody.innerHTML='';empty.style.display='block';return;}
  empty.style.display='none';
  tbody.innerHTML=list.map(u=>{
    const init=u.nom.split(' ').map(w=>w[0]||'').join('').substring(0,2).toUpperCase();
    const flag=FLAGS[u.pays]||'ğŸŒ';
    const sb=u.statut==='verifie'?'<span class="badge badge-verifie">VÃ©rifiÃ©</span>':u.statut==='rejete'?'<span class="badge badge-rejete">RejetÃ©</span>':'<span class="badge badge-attente">En attente</span>';
    const pb='<span class="badge badge-'+u.profil+'">'+u.profil+'</span>';
    const planColors = {gratuit:'#9BA3AE',standard:'#3B82F6',pro:'#8B5CF6',entreprise:'#D4A843'};
    const planIcons = {gratuit:'ğŸŒ±',standard:'ğŸ“Š',pro:'ğŸš€',entreprise:'ğŸ¢'};
    const planLabel = u.plan || 'gratuit';
    const planBadge = '<span style="display:inline-flex;align-items:center;gap:4px;font-size:0.68rem;font-weight:700;padding:3px 8px;border-radius:10px;background:'+planColors[planLabel]+'22;color:'+planColors[planLabel]+';border:1px solid '+planColors[planLabel]+'44;">'+planIcons[planLabel]+' '+planLabel.charAt(0).toUpperCase()+planLabel.slice(1)+'</span>';
    return '<tr><td><div class="admin-user-cell"><div class="admin-avatar">'+init+'</div><div><div class="admin-user-name">'+u.nom+'</div><div class="admin-user-email">'+(u.email||'â€”')+'</div></div></div></td><td>'+pb+'</td><td>'+flag+' '+u.pays+'</td><td>'+planBadge+'</td><td style="color:var(--gris-400);font-size:0.8rem;white-space:nowrap">'+u.date+'</td><td>'+sb+'</td><td>'+(u.statut==='attente'?'<button class="admin-btn" onclick="adminVerify('+u.id+')">âœ“ VÃ©rifier</button>':'')+'<button class="admin-btn danger" onclick="adminReject('+u.id+')">âœ• Rejeter</button></td></tr>';
  }).join('');
}
function updateAdminStats(){
  const today=new Date();
  const ds=String(today.getDate()).padStart(2,'0')+'/'+String(today.getMonth()+1).padStart(2,'0')+'/'+today.getFullYear();
  document.getElementById('statTotal').textContent=adminUsers.length;
  document.getElementById('statAttente').textContent=adminUsers.filter(u=>u.statut==='attente').length;
  document.getElementById('statVerifie').textContent=adminUsers.filter(u=>u.statut==='verifie').length;
  document.getElementById('statAffilie').textContent=adminUsers.filter(u=>u.aff).length;
  document.getElementById('statTodayChange').textContent='+'+adminUsers.filter(u=>u.date===ds).length+' aujourd\'hui';
}
function filterAdmin(filter,btn){
  currentFilter=filter;
  document.querySelectorAll('.admin-filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderAdminTable(filter);
}
function adminVerify(id){ const u=adminUsers.find(u=>u.id===id); if(u){u.statut='verifie'; AppEvents.emit('user:verified', u); showToast('âœ“ VÃ©rifiÃ© : '+u.nom);} }
function adminReject(id){ const u=adminUsers.find(u=>u.id===id); if(u){u.statut='rejete'; AppEvents.emit('user:rejected', u); showToast('âš  RejetÃ© : '+u.nom);} }
function adminRefresh(){
  const btn=document.getElementById('adminRefreshBtn'); btn.classList.add('spinning');
  setTimeout(()=>{ adminLiveUpdate(); btn.classList.remove('spinning'); showToast('âœ“ DonnÃ©es actualisÃ©es'); },700);
}
let adminClockInterval=null;
function startAdminClock(){
  if(adminClockInterval) return;
  adminClockInterval=setInterval(()=>{
    const n=new Date();
    const el=document.getElementById('adminClock');
    if(el) el.textContent=String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0')+':'+String(n.getSeconds()).padStart(2,'0');
  },1000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUS D'Ã‰VÃ‰NEMENTS â€” RÃ©activitÃ© en temps rÃ©el
   Toute action dans l'app Ã©met un Ã©vÃ©nement â†’ l'admin se met Ã  jour
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AppEvents = (() => {
  const listeners = {};
  return {
    on(event, cb) {
      if (!listeners[event]) listeners[event] = [];
      listeners[event].push(cb);
    },
    emit(event, data) {
      (listeners[event] || []).forEach(cb => cb(data));
      // Toujours notifier les Ã©couteurs "*" (wildcard)
      (listeners['*'] || []).forEach(cb => cb(event, data));
    }
  };
})();

// Mise Ã  jour immÃ©diate du dashboard admin Ã  chaque Ã©vÃ©nement
function adminLiveUpdate(highlightId) {
  updateAdminStats();
  renderAdminTable(currentFilter);
  // Pulser les stats cards pour signaler la mise Ã  jour
  document.querySelectorAll('.admin-stat-card').forEach(c => {
    c.classList.remove('admin-stat-pulse');
    void c.offsetWidth;
    c.classList.add('admin-stat-pulse');
  });
  // Highlight la nouvelle ligne si fournie
  if (highlightId) {
    setTimeout(() => {
      const rows = document.querySelectorAll('#adminTableBody tr');
      if (rows[0]) {
        rows[0].classList.add('admin-row-new');
        setTimeout(() => rows[0]?.classList.remove('admin-row-new'), 3000);
      }
    }, 50);
  }
  // Mettre Ã  jour le badge "Live" avec l'heure
  const badge = document.querySelector('.admin-badge');
  if (badge) {
    const n = new Date();
    badge.textContent = 'Live Â· ' + String(n.getHours()).padStart(2,'0') + ':' + String(n.getMinutes()).padStart(2,'0') + ':' + String(n.getSeconds()).padStart(2,'0');
  }
}

// Abonner l'admin Ã  tous les Ã©vÃ©nements applicatifs
let adminEventCount = 0;
const adminActivityLog = [];

function adminTrackEvent(eventName, data) {
  adminEventCount++;
  const counter = document.getElementById('adminEventCounter');
  if (counter) {
    counter.style.display = 'inline';
    counter.textContent = adminEventCount + ' Ã©vÃ©nement' + (adminEventCount > 1 ? 's' : '');
  }
  // Ajouter au flux d'activitÃ©
  const n = new Date();
  const time = String(n.getHours()).padStart(2,'0') + ':' + String(n.getMinutes()).padStart(2,'0') + ':' + String(n.getSeconds()).padStart(2,'0');
  const eventLabels = {
    'user:registered':    { icon: 'ğŸ†•', label: 'Nouvelle inscription', color: '#4A9E2A' },
    'affiliate:registered':{ icon: 'ğŸ¤', label: 'Nouvel affiliÃ©', color: '#9B1B6A' },
    'user:verified':      { icon: 'âœ…', label: 'Profil vÃ©rifiÃ©', color: '#6ED63B' },
    'user:rejected':      { icon: 'â›”', label: 'Profil rejetÃ©', color: '#E53E3E' },
    'login:success':      { icon: 'ğŸ”‘', label: 'Connexion rÃ©ussie', color: '#3b82f6' },
    'email:verified':     { icon: 'ğŸ“§', label: 'Email vÃ©rifiÃ©', color: '#0891b2' },
  };
  const meta = eventLabels[eventName] || { icon: 'ğŸ“Œ', label: eventName, color: '#9BA3AE' };
  const desc = data?.nom ? data.nom : (data?.email || data?.profil || '');
  adminActivityLog.unshift({ time, icon: meta.icon, label: meta.label, desc, color: meta.color, eventName });
  if (adminActivityLog.length > 50) adminActivityLog.pop();
  renderActivityFeed();
}

function renderActivityFeed() {
  const feed = document.getElementById('adminActivityFeed');
  const empty = document.getElementById('adminActivityEmpty');
  if (!feed) return;
  if (adminActivityLog.length === 0) {
    feed.style.display = 'none';
    if (empty) empty.style.display = 'block';
    return;
  }
  feed.style.display = 'block';
  if (empty) empty.style.display = 'none';
  feed.innerHTML = adminActivityLog.slice(0, 20).map((e, i) => `
    <div class="admin-activity-item${i === 0 ? ' admin-activity-new' : ''}">
      <div class="admin-activity-icon" style="background:${e.color}15;color:${e.color}">${e.icon}</div>
      <div class="admin-activity-body">
        <div class="admin-activity-label">${e.label}${e.desc ? ' Â· <span style="font-weight:400;color:var(--gris-400)">' + e.desc + '</span>' : ''}</div>
      </div>
      <div class="admin-activity-time">${e.time}</div>
    </div>
  `).join('');
}

// Wildcard : toute action dÃ©clenche le tracking dans le flux d'activitÃ©
AppEvents.on('*', (eventName, data) => {
  adminTrackEvent(eventName, data);
});

// Listeners spÃ©cifiques pour les mises Ã  jour du tableau et les notifications
AppEvents.on('user:registered', data => {
  adminLiveUpdate(data?.id);
  if (document.getElementById('page-admin').classList.contains('active'))
    adminShowNotif('ğŸ†• Nouvel utilisateur inscrit : ' + (data?.nom || 'Inconnu'), 'success');
});
AppEvents.on('affiliate:registered', data => {
  adminLiveUpdate(data?.id);
  if (document.getElementById('page-admin').classList.contains('active'))
    adminShowNotif('ğŸ¤ Nouvel affiliÃ© : ' + (data?.nom || '') + ' Â· ' + (data?.code || ''), 'success');
});
AppEvents.on('user:verified', data => {
  adminLiveUpdate();
  if (document.getElementById('page-admin').classList.contains('active'))
    adminShowNotif('âœ… Profil vÃ©rifiÃ© : ' + (data?.nom || ''), 'success');
});
AppEvents.on('user:rejected', data => {
  adminLiveUpdate();
  if (document.getElementById('page-admin').classList.contains('active'))
    adminShowNotif('â›” Profil rejetÃ© : ' + (data?.nom || ''), 'warn');
});
AppEvents.on('login:success', data => {
  if (document.getElementById('page-admin').classList.contains('active'))
    adminShowNotif('ğŸ”‘ Connexion : ' + (data?.profil || 'membre'), 'info');
});
AppEvents.on('email:verified', data => {
  if (document.getElementById('page-admin').classList.contains('active'))
    adminShowNotif('ğŸ“§ Email vÃ©rifiÃ© : ' + (data?.email || ''), 'info');
});

// Notification toast flottante dans l'admin (distinct du toast global)
function adminShowNotif(msg, type = 'info') {
  const colors = { success: '#4A9E2A', warn: '#DD6B20', info: '#3b82f6', err: '#E53E3E' };
  const notif = document.createElement('div');
  notif.style.cssText = `
    position:fixed; bottom:80px; right:20px; z-index:9999;
    background:${colors[type]||colors.info}; color:#fff;
    padding:10px 16px; border-radius:10px; font-size:0.82rem;
    font-family:'DM Sans',sans-serif; font-weight:500;
    box-shadow:0 4px 20px rgba(0,0,0,0.25);
    max-width:320px; line-height:1.4;
    display:flex; align-items:center; gap:8px;
    animation:slideInRight 0.3s cubic-bezier(0.4,0,0.2,1) both;
    transition:opacity 0.3s, transform 0.3s;
  `;
  // IcÃ´ne pulsante
  const dot = document.createElement('div');
  dot.style.cssText = 'width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.8);flex-shrink:0;animation:pulse 1s ease-in-out 3;';
  notif.appendChild(dot);
  const txt = document.createElement('span');
  txt.textContent = msg;
  notif.appendChild(txt);
  document.body.appendChild(notif);
  setTimeout(() => { notif.style.opacity = '0'; notif.style.transform = 'translateX(20px)'; setTimeout(() => notif.remove(), 300); }, 3500);
}

// Injecter l'animation slideInRight dans le <style>
(function() {
  const s = document.createElement('style');
  s.textContent = `
    @keyframes slideInRight { from { opacity:0; transform:translateX(40px); } to { opacity:1; transform:translateX(0); } }
    .admin-stat-pulse { animation: adminStatPulse 0.5s ease-out; }
    @keyframes adminStatPulse { 0%,100% { box-shadow:0 1px 4px rgba(0,0,0,0.06); } 50% { box-shadow:0 0 0 4px rgba(46,204,113,0.25), 0 1px 4px rgba(0,0,0,0.06); transform:scale(1.01); } }
    .admin-row-new { background:linear-gradient(90deg, rgba(46,204,113,0.12), transparent) !important; transition:background 2s ease; }
    .admin-row-new td { background:transparent !important; }
    .admin-live-dot { width:8px;height:8px;border-radius:50%;background:var(--vert-accent);display:inline-block;animation:pulse 1.2s ease-in-out infinite;margin-right:4px; }
  `;
  document.head.appendChild(s);
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AFFILIÃ‰ â€” Parcours d'inscription dÃ©diÃ©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let affFd = { type: 'individu', cgu: false, cguProg: false };
let affCurrentStep = 1;

// selAffilie remplacÃ© par toggleAffilie dans le nouveau systÃ¨me multi-rÃ´les

function selAffType(type) {
  affFd.type = type;
  document.querySelectorAll('.aff-type-card').forEach(c => c.classList.remove('active'));
  document.getElementById('affType-' + type).classList.add('active');
  // Toggle form fields
  const isAgence = type === 'agence';
  document.getElementById('aff-form-agence').style.display = isAgence ? 'block' : 'none';
  document.getElementById('aff-form-individu').style.display = isAgence ? 'none' : 'block';
}

function affGoStep(n) {
  const steps = document.querySelectorAll('#page-inscription-affilie .step');
  steps.forEach(s => s.classList.remove('active'));
  const target = document.getElementById('as' + n);
  if (target) { target.classList.add('active'); affCurrentStep = n; }
  // Update progress
  for (let i = 1; i <= 4; i++) {
    const ps = document.getElementById('aps' + i);
    if (!ps) continue;
    ps.className = 'prog-step ' + (i < n ? 'done' : i === n ? 'active' : 'pending');
  }
  // Generate code preview on step 4
  if (n === 4) {
    const raw = Math.random().toString(36).substring(2, 6).toUpperCase();
    const code = 'ABAE-' + raw;
    document.getElementById('affCodePreview').textContent = code;
    affFd.previewCode = code;
  }
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function checkAffS2() {
  const pays = document.getElementById('affPays')?.value;
  const tel = document.getElementById('affTel')?.value?.trim();
  const email = document.getElementById('affEmail')?.value?.trim();
  let ok = false;
  if (affFd.type === 'agence') {
    const ns = document.getElementById('affNomStructure')?.value?.trim();
    const ts = document.getElementById('affTypeStructure')?.value;
    const prenom = document.getElementById('affPrenom2')?.value?.trim();
    const nom = document.getElementById('affNom2')?.value?.trim();
    ok = !!(ns && ts && prenom && nom && pays && tel && email);
  } else {
    const prenom = document.getElementById('affPrenom')?.value?.trim();
    const nom = document.getElementById('affNom')?.value?.trim();
    ok = !!(prenom && nom && pays && tel && email);
  }
  document.getElementById('abtn2').disabled = !ok;
}

function onAffPaysChange(sel) {
  const opt = sel.options[sel.selectedIndex];
  document.getElementById('affPhoneFlag').textContent = opt.getAttribute('data-flag') || 'ğŸŒ';
  document.getElementById('affPhoneCode').textContent = opt.getAttribute('data-code') || '+';
}

let affPhoneDrop = null;
function toggleAffPhoneDrop() {
  if (affPhoneDrop) { affPhoneDrop.remove(); affPhoneDrop = null; return; }
  const pfx = document.getElementById('affPhonePfx'), drop = document.createElement('div');
  drop.className = 'country-drop';
  [{f:'ğŸ‡¨ğŸ‡²',c:'+237',n:'Cameroun'},{f:'ğŸ‡³ğŸ‡¬',c:'+234',n:'Nigeria'},{f:'ğŸ‡¨ğŸ‡¬',c:'+242',n:'Congo'},{f:'ğŸ‡¸ğŸ‡³',c:'+221',n:'SÃ©nÃ©gal'},{f:'ğŸ‡¨ğŸ‡®',c:'+225',n:"CÃ´te d'Ivoire"},{f:'ğŸ‡«ğŸ‡·',c:'+33',n:'France'},{f:'ğŸ‡§ğŸ‡ª',c:'+32',n:'Belgique'},{f:'ğŸ‡ºğŸ‡¸',c:'+1',n:'USA'}].forEach(i => {
    const d = document.createElement('div'); d.className = 'country-drop-item';
    d.innerHTML = '<span>' + i.f + '</span><span>' + i.c + '</span><span>' + i.n + '</span>';
    d.onclick = () => { document.getElementById('affPhoneFlag').textContent = i.f; document.getElementById('affPhoneCode').textContent = i.c; drop.remove(); affPhoneDrop = null; };
    drop.appendChild(d);
  });
  pfx.style.position = 'relative'; pfx.appendChild(drop); affPhoneDrop = drop;
  setTimeout(() => document.addEventListener('click', closeAffDrop, { once: true }), 50);
}
function closeAffDrop(e) { if (affPhoneDrop && !affPhoneDrop.contains(e.target)) { affPhoneDrop.remove(); affPhoneDrop = null; } }

function updateAffPwStr(pw) {
  const wrap = document.getElementById('affPwWrap');
  if (!pw) { wrap.style.display = 'none'; return; }
  wrap.style.display = 'block';
  const h8 = /\S{8}/.test(pw), hU = /[A-Z]/.test(pw), hN = /[\d\W]/.test(pw), h12 = pw.length >= 12;
  const score = [h8, hU, hN, h12].filter(Boolean).length;
  document.getElementById('ar1').classList.toggle('ok', h8);
  document.getElementById('ar2').classList.toggle('ok', hU);
  document.getElementById('ar3').classList.toggle('ok', hN);
  for (let i = 1; i <= 4; i++) { const b = document.getElementById('ab' + i); b.className = 'pw-bar' + (i <= score ? ' s' + score : ''); }
}

function checkAffPwMatch() {
  const pw1 = document.getElementById('affPw1').value;
  const pw2 = document.getElementById('affPw2').value;
  const err = document.getElementById('affPwErr');
  const i2 = document.getElementById('affPw2');
  if (!pw2) { err.style.display = 'none'; i2.classList.remove('err', 'ok'); return; }
  const match = pw1 === pw2;
  err.style.display = match ? 'none' : 'flex';
  i2.classList.toggle('err', !match);
  i2.classList.toggle('ok', match);
}

function checkAffS4() {
  const pw1 = document.getElementById('affPw1').value;
  const pw2 = document.getElementById('affPw2').value;
  document.getElementById('abtn4').disabled = !(pw1.length >= 8 && pw1 === pw2 && affFd.cgu && affFd.cguProg);
}

function toggleAffCgu() {
  affFd.cgu = !affFd.cgu;
  document.getElementById('affCguChk').classList.toggle('on', affFd.cgu);
  checkAffS4();
}

function toggleAffCguProg() {
  if (!affFd.cguProg) {
    // If not yet accepted, open the modal to read first
    openCguAffModal();
  } else {
    // Allow unchecking
    affFd.cguProg = false;
    document.getElementById('affCguProgChk').classList.remove('on');
    checkAffS4();
  }
}

function submitAffForm() {
  if (!affFd.cguProg) {
    document.getElementById('affCguProgErr').style.display = 'block';
    return;
  }
  const btn = document.getElementById('abtn4');
  btn.disabled = true;
  btn.innerHTML = '<svg class="btn-spinner" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" opacity=".25"/><path d="M12 3a9 9 0 019 9"/></svg>CrÃ©ation en coursâ€¦';
  setTimeout(() => {
    const prenom = affFd.type === 'agence'
      ? (document.getElementById('affPrenom2')?.value?.trim() || '')
      : (document.getElementById('affPrenom')?.value?.trim() || '');
    const nom = affFd.type === 'agence'
      ? (document.getElementById('affNom2')?.value?.trim() || '')
      : (document.getElementById('affNom')?.value?.trim() || '');
    const nom_structure = document.getElementById('affNomStructure')?.value?.trim() || '';
    const nom_display = affFd.type === 'agence' ? nom_structure || (prenom + ' ' + nom) : prenom + ' ' + nom;
    const email = document.getElementById('affEmail')?.value?.trim() || '';
    const pays = document.getElementById('affPays')?.value || 'CM';
    const code = affFd.previewCode || ('ABAE-' + Math.random().toString(36).substring(2, 6).toUpperCase());
    // Update dashboard
    const initials = (prenom[0] || '') + (nom[0] || '');
    document.getElementById('affDashAvatar').textContent = initials.toUpperCase() || 'AF';
    document.getElementById('affDashName').textContent = nom_display.trim() || 'AffiliÃ©';
    document.getElementById('affDashCode').textContent = code;
    document.getElementById('affLienRecrutement').textContent = 'https://abae.com/s?ref=' + code;
    // Add to admin
    addAdminUser({ nom: nom_display, email, pays, profil: 'affilie', code });
    // Show dashboard
    showView('dashboard-affilie');
  }, 1800);
}

function copyAffDashCode() {
  const code = document.getElementById('affDashCode').textContent;
  navigator.clipboard.writeText(code).then(() => showToast('âœ“ Code copiÃ© : ' + code)).catch(() => showToast('Code : ' + code));
}

function shareAffCode() {
  const code = document.getElementById('affDashCode').textContent;
  const url = 'https://abae.com/s?ref=' + code;
  if (navigator.share) {
    navigator.share({ title: 'Rejoignez ABAE', text: 'Inscrivez-vous sur ABAE avec mon code : ' + code, url });
  } else {
    navigator.clipboard.writeText(url).then(() => showToast('âœ“ Lien copiÃ© !')).catch(() => showToast('Lien : ' + url));
  }
}

function copyAffLink() {
  const link = document.getElementById('affLienRecrutement').textContent;
  navigator.clipboard.writeText(link).then(() => showToast('âœ“ Lien copiÃ© !')).catch(() => showToast('Lien : ' + link));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CGU PROGRAMME AFFILIATION â€” Modal & Accordion
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openCguAffModal() {
  document.getElementById('cguAffModal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}
function closeCguAffModal() {
  document.getElementById('cguAffModal').classList.add('hidden');
  document.body.style.overflow = '';
}
function acceptCguAff() {
  affFd.cguProg = true;
  document.getElementById('affCguProgChk').classList.add('on');
  document.getElementById('affCguProgErr').style.display = 'none';
  closeCguAffModal();
  checkAffS4();
  showToast('âœ“ Conditions du programme acceptÃ©es');
}
function toggleCguSection(hd) {
  const bd = hd.nextElementSibling;
  const isOpen = hd.classList.contains('open');
  hd.classList.toggle('open', !isOpen);
  bd.classList.toggle('open', !isOpen);
}
// Close modal on backdrop click
document.getElementById('cguAffModal')?.addEventListener('click', function(e) {
  if (e.target === this) closeCguAffModal();
});


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORD TOOLBAR â€” Moteur JS de mise en forme
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let wtActive = null;          // dernier Ã©lÃ©ment Ã©ditable focalisÃ©
let wtPainterOn = false;
let wtPainterData = null;
const wtFontCache = new Set(['Sora', 'DM Sans']);

// â”€â”€ ExÃ©cuter une commande â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtCmd(cmd, val) {
  if (wtActive) wtActive.focus();
  document.execCommand(cmd, false, val || null);
  wtSync(); wtSave();
}

// â”€â”€ Police â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtExecFont(name) {
  if (!name) return;
  if (!wtFontCache.has(name)) {
    wtFontCache.add(name);
    const l = document.createElement('link');
    l.rel = 'stylesheet';
    l.href = `https://fonts.googleapis.com/css2?family=${encodeURIComponent(name)}:wght@300;400;500;600;700;800&display=swap`;
    document.head.appendChild(l);
  }
  document.execCommand('fontName', false, name);
  wtSync(); wtSave();
}

// â”€â”€ Taille â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtSetSize(px) {
  if (!px || px < 4 || px > 200) return;
  const numEl = document.getElementById('wtSizeNum');
  if (numEl) numEl.value = px;
  const sel = window.getSelection();
  if (sel && sel.rangeCount && !sel.isCollapsed) {
    document.execCommand('fontSize', false, '7');
    const root = wtActive || document.getElementById('adminPreviewInner');
    if (root) root.querySelectorAll('font[size="7"]').forEach(f => { f.removeAttribute('size'); f.style.fontSize = px + 'px'; });
  } else if (wtActive) {
    wtActive.style.fontSize = px + 'px';
  }
  wtSave();
}
function wtChangeSize(d) {
  const n = document.getElementById('wtSizeNum');
  wtSetSize(Math.max(6, Math.min(200, (parseInt(n?.value) || 16) + d)));
}

// â”€â”€ Couleur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtApplyColor(cmd, val) {
  if (wtActive) wtActive.focus();
  document.execCommand(cmd, false, val);
  wtSave();
}

// â”€â”€ Interligne â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtSetLineHeight(val) {
  const sel = window.getSelection();
  let target = wtActive;
  if (sel && sel.rangeCount && !sel.isCollapsed) {
    const a = sel.getRangeAt(0).commonAncestorContainer;
    target = a.nodeType === 3 ? a.parentElement : a;
  }
  if (target) target.style.lineHeight = val;
  wtSave();
}

// â”€â”€ Effacer mise en forme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtClearFmt() {
  if (wtActive) wtActive.focus();
  document.execCommand('removeFormat', false, null);
  if (wtActive) {
    ['fontFamily','fontSize','fontWeight','fontStyle','textDecoration','color','backgroundColor','lineHeight'].forEach(p => { wtActive.style[p] = ''; });
  }
  wtSync(); showToast('âœ“ Mise en forme effacÃ©e'); wtSave();
}

// â”€â”€ Pinceau â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtTogglePainter() {
  const btn = document.getElementById('wtPainter');
  wtPainterOn = !wtPainterOn;
  if (wtPainterOn && wtActive) {
    wtPainterData = { fontFamily:wtActive.style.fontFamily, fontSize:wtActive.style.fontSize, fontWeight:wtActive.style.fontWeight, fontStyle:wtActive.style.fontStyle, color:wtActive.style.color };
    btn.classList.add('wt-on');
    document.getElementById('adminPreviewInner').style.cursor = 'crosshair';
    showToast('ğŸ–Œ Pinceau â€” cliquez sur un Ã©lÃ©ment');
  } else {
    btn?.classList.remove('wt-on');
    wtPainterData = null;
    const inner = document.getElementById('adminPreviewInner');
    if (inner) inner.style.cursor = '';
  }
}

// Appliquer le pinceau au clic
document.addEventListener('click', e => {
  if (!wtPainterOn || !wtPainterData) return;
  const t = e.target.closest('[data-editable]');
  if (!t) return;
  e.preventDefault(); e.stopPropagation();
  Object.assign(t.style, wtPainterData);
  wtPainterOn = false; wtPainterData = null;
  document.getElementById('wtPainter')?.classList.remove('wt-on');
  const inner = document.getElementById('adminPreviewInner');
  if (inner) inner.style.cursor = '';
  showToast('ğŸ–Œ Style collÃ© !'); wtSave();
}, true);

// â”€â”€ Synchroniser l'Ã©tat visuel des boutons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtSync() {
  const map = { wtB:'bold', wtI:'italic', wtU:'underline', wtS:'strikeThrough', wtSup:'superscript', wtSub:'subscript', wtAL:'justifyLeft', wtAC:'justifyCenter', wtAR:'justifyRight', wtAJ:'justifyFull', wtUL:'insertUnorderedList', wtOL:'insertOrderedList' };
  Object.entries(map).forEach(([id, cmd]) => {
    try { document.getElementById(id)?.classList.toggle('wt-on', document.queryCommandState(cmd)); } catch(e) {}
  });
  try {
    const fn = document.queryCommandValue('fontName').replace(/['"]/g,'').trim();
    const sel = document.getElementById('wtFontFamily');
    if (sel && fn) { for (const o of sel.options) { if (o.value.toLowerCase() === fn.toLowerCase()) { sel.value = o.value; break; } } }
  } catch(e) {}
  try {
    const a = window.getSelection()?.anchorNode?.parentElement;
    if (a) {
      const sz = parseFloat(getComputedStyle(a).fontSize);
      const n = document.getElementById('wtSizeNum');
      if (n && sz) n.value = Math.round(sz);
    }
  } catch(e) {}
  if (wtActive) {
    const tag = wtActive.tagName.toLowerCase();
    const lbl = wtActive.dataset.editLabel || tag;
    const info = document.getElementById('wtSelInfo');
    if (info) info.textContent = `<${tag}> Â· ${lbl}`;
  }
}

// â”€â”€ Enregistrer la modification dans liveEdits â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wtSave() {
  if (!wtActive) return;
  const key = wtActive.dataset.editable;
  if (!key) return;
  const html = wtActive.innerHTML;
  liveEdits[key] = { el: wtActive, original: wtActive.dataset.originalContent || html, current: html };
  const src = document.querySelector(`[data-editable="${key}"]`);
  if (src && src !== wtActive) src.innerHTML = html;
  updateChangesCount();
}

// â”€â”€ Bubble flottante sur sÃ©lection de texte â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let wtBubTimer = null;
document.addEventListener('mouseup', e => {
  if (!editModeActive) return;
  const inner = document.getElementById('adminPreviewInner');
  if (!inner?.contains(e.target) && !document.getElementById('wtBubble')?.contains(e.target)) return;
  clearTimeout(wtBubTimer);
  wtBubTimer = setTimeout(() => {
    const sel = window.getSelection();
    if (!sel || sel.isCollapsed || !sel.toString().trim()) { wtHideBubble(); return; }
    const rect = sel.getRangeAt(0).getBoundingClientRect();
    wtShowBubble(rect); wtSync();
  }, 70);
});
document.addEventListener('mousedown', e => {
  if (!document.getElementById('wtBubble')?.contains(e.target)) wtHideBubble();
});
function wtShowBubble(rect) {
  const b = document.getElementById('wtBubble'); if (!b) return;
  b.classList.add('wt-visible');
  const bw = b.offsetWidth || 300;
  let left = Math.max(6, Math.min(rect.left + rect.width/2 - bw/2, window.innerWidth - bw - 6));
  let top = rect.top - (b.offsetHeight || 44) - 8;
  if (top < 6) top = rect.bottom + 8;
  b.style.left = left + 'px'; b.style.top = top + 'px';
}
function wtHideBubble() { document.getElementById('wtBubble')?.classList.remove('wt-visible'); }

// â”€â”€ Focus sur Ã©lÃ©ment Ã©ditable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('focusin', e => {
  const el = e.target.closest('[contenteditable="true"]');
  if (el?.closest('#adminPreviewInner')) { wtActive = el; wtSync(); }
});
document.addEventListener('selectionchange', () => { if (editModeActive) wtSync(); });

// â”€â”€ Raccourcis clavier â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  if (!editModeActive || document.activeElement?.contentEditable !== 'true') return;
  if (!(e.ctrlKey || e.metaKey)) return;
  const k = e.key.toLowerCase();
  const map = { b:'bold', i:'italic', u:'underline', e:'justifyCenter', l:'justifyLeft', r:'justifyRight', j:'justifyFull' };
  if (map[k]) { e.preventDefault(); wtCmd(map[k]); return; }
  if (k === ']') { e.preventDefault(); wtChangeSize(2); }
  if (k === '[') { e.preventDefault(); wtChangeSize(-2); }
});

</script>
<!-- MODAL CGU PROGRAMME AFFILIATION -->
<div class="cgu-aff-modal-bg hidden" id="cguAffModal">
  <div class="cgu-aff-modal">
    <div class="cgu-aff-modal-header">
      <div>
        <div class="cgu-aff-modal-title">ğŸ“‹ Conditions du Programme d'Affiliation ABAE</div>
        <div class="cgu-aff-modal-subtitle">Lisez attentivement avant d'accepter Â· DerniÃ¨re mise Ã  jour : 2026</div>
      </div>
      <button class="cgu-aff-close" onclick="closeCguAffModal()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>

    <div class="cgu-aff-body" id="cguAffBody">

      <!-- Art. 1 -->
      <div class="cgu-section">
        <div class="cgu-section-hd open" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">1</span>
          <span class="cgu-section-ttl">Objet du Programme</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd open">
          <p>Les prÃ©sentes Conditions GÃ©nÃ©rales dÃ©finissent les rÃ¨gles encadrant la participation au Programme d'Affiliation de la plateforme ABAE.</p>
          <p>Le programme permet aux utilisateurs inscrits de recommander la plateforme et de percevoir une <strong>commission sur les abonnements payants</strong> gÃ©nÃ©rÃ©s via leur lien de parrainage.</p>
        </div>
      </div>

      <!-- Art. 2 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">2</span>
          <span class="cgu-section-ttl">Conditions d'Ã‰ligibilitÃ©</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Pour devenir affiliÃ©, l'utilisateur doit :</p>
          <ul>
            <li>ÃŠtre inscrit sur la plateforme ABAE</li>
            <li>Disposer d'un compte actif</li>
            <li>Avoir une adresse email vÃ©rifiÃ©e</li>
            <li>Avoir validÃ© son identitÃ© (KYC), si requis</li>
            <li>Accepter expressÃ©ment les prÃ©sentes conditions</li>
          </ul>
          <p>ABAE se rÃ©serve le droit d'accepter ou refuser toute demande d'adhÃ©sion au programme d'affiliation.</p>
        </div>
      </div>

      <!-- Art. 3 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">3</span>
          <span class="cgu-section-ttl">Fonctionnement du Programme</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>3.1 Lien de parrainage</strong><br>Chaque affiliÃ© dispose d'un lien ou code de parrainage unique gÃ©nÃ©rÃ© automatiquement Ã  l'inscription.</p>
          <p><strong>3.2 Attribution</strong><br>Un parrainage est validÃ© lorsque :</p>
          <ul>
            <li>Un nouvel utilisateur s'inscrit via le lien de l'affiliÃ©</li>
            <li>Souscrit Ã  un abonnement payant</li>
            <li>Effectue un paiement confirmÃ©</li>
          </ul>
        </div>
      </div>

      <!-- Art. 4 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">4</span>
          <span class="cgu-section-ttl">Commission</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>4.1 Montant</strong></p>
          <div class="cgu-highlight">
            <strong>50% du montant du 1er mois d'abonnement uniquement</strong><br>
            MÃªme en cas d'abonnement annuel, la commission est calculÃ©e sur la base du tarif mensuel.
          </div>
          <div class="cgu-example">
            <strong>Exemples :</strong><br>
            Abonnement Standard (1 000 FCFA) â†’ Commission = <strong>500 FCFA</strong><br>
            Abonnement Premium (3 000 FCFA) â†’ Commission = <strong>1 500 FCFA</strong>
          </div>
          <p><strong>4.2 Paiement unique</strong><br>La commission est versÃ©e une seule fois par utilisateur parrainÃ©. Aucune commission n'est due sur :</p>
          <ul>
            <li>Les renouvellements</li>
            <li>Les paiements ultÃ©rieurs</li>
            <li>Les changements de plan</li>
          </ul>
        </div>
      </div>

      <!-- Art. 5 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">5</span>
          <span class="cgu-section-ttl">Validation et DÃ©lai</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Les commissions sont enregistrÃ©es en statut <em>"en attente"</em>, validÃ©es aprÃ¨s confirmation du paiement, puis soumises Ã  un dÃ©lai de sÃ©curitÃ© de <strong>15 jours</strong>.</p>
          <p>ABAE peut annuler toute commission en cas de :</p>
          <ul>
            <li>Remboursement du filleul</li>
            <li>Fraude avÃ©rÃ©e</li>
            <li>Non-respect des prÃ©sentes rÃ¨gles</li>
          </ul>
        </div>
      </div>

      <!-- Art. 6 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">6</span>
          <span class="cgu-section-ttl">Interdictions et Fraude</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Il est strictement interdit de :</p>
          <ul>
            <li>S'auto-parrainer</li>
            <li>CrÃ©er de faux comptes</li>
            <li>Utiliser de fausses identitÃ©s</li>
            <li>Utiliser la mÃªme carte bancaire pour plusieurs comptes</li>
            <li>Utiliser des pratiques trompeuses ou du spam</li>
            <li>Usurper l'identitÃ© d'ABAE</li>
          </ul>
          <div class="cgu-warn">
            En cas de fraude : suspension immÃ©diate, annulation des commissions, blocage dÃ©finitif et actions lÃ©gales possibles.
          </div>
        </div>
      </div>

      <!-- Art. 7 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">7</span>
          <span class="cgu-section-ttl">Paiement des Commissions</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Les commissions sont versÃ©es sur demande de retrait, Ã  partir d'un seuil minimum dÃ©fini par ABAE, par les moyens disponibles (Mobile Money, virement bancaire, etc.).</p>
          <p>Les dÃ©lais de traitement peuvent varier selon les opÃ©rateurs.</p>
        </div>
      </div>

      <!-- Art. 8 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">8</span>
          <span class="cgu-section-ttl">Suspension et RÃ©siliation</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE se rÃ©serve le droit de suspendre un affiliÃ©, rÃ©silier son statut ou annuler ses commissions en cas de non-respect des prÃ©sentes conditions.</p>
          <p>L'affiliÃ© peut se retirer du programme Ã  tout moment via son espace personnel.</p>
        </div>
      </div>

      <!-- Art. 9 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">9</span>
          <span class="cgu-section-ttl">ResponsabilitÃ©</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>L'affiliÃ© agit de maniÃ¨re entiÃ¨rement indÃ©pendante. Il n'existe aucune relation de salariat, de partenariat juridique ou de reprÃ©sentation lÃ©gale entre l'affiliÃ© et ABAE.</p>
          <p>L'affiliÃ© ne peut en aucun cas engager la responsabilitÃ© d'ABAE dans le cadre de ses actions de promotion.</p>
        </div>
      </div>

      <!-- Art. 10 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">10</span>
          <span class="cgu-section-ttl">Modification du Programme</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE se rÃ©serve le droit de modifier les conditions, d'ajuster le taux de commission, ou de suspendre/arrÃªter le programme Ã  tout moment.</p>
          <p>Toute modification sera notifiÃ©e aux affiliÃ©s par email dans un dÃ©lai raisonnable.</p>
        </div>
      </div>

      <!-- Art. 11 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">11</span>
          <span class="cgu-section-ttl">Acceptation</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>La participation au programme implique l'acceptation totale et sans rÃ©serve des prÃ©sentes conditions.</p>
          <div class="cgu-highlight">
            <strong>Sans validation de ces conditions, l'affiliation ne peut Ãªtre activÃ©e.</strong>
          </div>
        </div>
      </div>

    </div><!-- /cgu-aff-body -->

    <div class="cgu-aff-footer">
      <button class="cgu-aff-accept-btn" onclick="acceptCguAff()">
        <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        J'accepte les Conditions du Programme d'Affiliation
      </button>
      <div class="cgu-aff-read-hint">Fermer pour refuser Â· L'acceptation est obligatoire pour activer votre affiliation</div>
    </div>
  </div>
</div>
<!-- /MODAL CGU PROGRAMME AFFILIATION -->




<style>
.toast-marche{
  position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);
  background:#1A1E1A;color:#fff;padding:10px 18px;border-radius:24px;
  font-size:0.82rem;font-family:'DM Sans',sans-serif;
  opacity:0;transition:all 0.25s;pointer-events:none;z-index:9999;
  white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.4);
}
.toast-marche.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast-marche.ok{background:#4A9E2A;}
.toast-marche.err{background:#C0392B;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MÃ‰TÃ‰O & GÃ‰OLOCALISATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Barre mÃ©tÃ©o compacte â€” toutes les pages marchÃ© */
.wx-bar {
  background: #FFF9C4;
  border-bottom: 1px solid #F9E84A;
  padding: 8px 14px 10px;
  cursor: pointer;
  flex-shrink: 0;
  transition: background 0.2s;
}
.wx-bar:active { background: #FFF176; }
.wx-bar-top {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 6px;
}
.wx-bar .wx-icon { font-size: 1rem; line-height: 1; }
.wx-bar .wx-temp { font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 0.88rem; color: #5D4037; }
.wx-bar .wx-desc { font-size: 0.58rem; color: #8D6E63; text-transform: capitalize; }
.wx-bar .wx-hum, .wx-bar .wx-wind { font-size: 0.58rem; color: #8D6E63; font-weight: 700; }
.wx-bar .wx-city { color: #6D4C41 !important; }
.wx-bar .wx-city svg { stroke: #A1887F !important; }
.wx-bar-advice {
  display: flex; align-items: center; gap: 6px;
  padding-top: 6px; border-top: 1px solid #FFF176;
}
.wx-bar-advice .wx-advice-icon { font-size: 0.85rem; flex-shrink: 0; }
.wx-bar-advice .wx-advice-text { font-size: 0.63rem; font-weight: 700; color: #4E342E; line-height: 1.35; }

.weather-strip {
  display:flex; flex-direction:column; align-items:stretch; gap:10px;
  background:linear-gradient(135deg, rgba(30,60,20,0.88) 0%, rgba(20,50,15,0.95) 100%);
  border:1.5px solid rgba(249,232,74,0.55);
  border-radius:16px; padding:13px 14px; margin-top:10px;
  backdrop-filter:blur(12px); cursor:pointer;
  box-shadow: 0 4px 20px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.08);
  transition:all 0.2s ease;
  -webkit-tap-highlight-color:transparent;
}
.weather-strip:hover { background:linear-gradient(135deg, rgba(35,70,25,0.92) 0%, rgba(25,58,18,0.97) 100%); transform:translateY(-1px); }
.weather-strip:active { transform:translateY(0); }
.weather-left { display:flex; align-items:center; gap:12px; }
.weather-icon { font-size:2rem; line-height:1; filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
.weather-temp { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:1.45rem; color:#fff; line-height:1; letter-spacing:-0.5px; text-shadow:0 1px 4px rgba(0,0,0,0.4); }
.weather-desc { font-size:0.72rem; color:rgba(255,235,100,0.9); margin-top:3px; text-transform:capitalize; font-weight:600; letter-spacing:0.2px; }
.weather-location {
  display:flex; align-items:center; gap:4px;
  font-size:0.7rem; font-weight:700; color:rgba(255,255,255,0.95);
  font-family:'Sora',sans-serif; margin-top:2px;
}
.weather-location svg { width:12px; height:12px; stroke:rgba(249,232,74,0.9); fill:none; stroke-width:2.5; }
.weather-right { display:flex; flex-direction:column; align-items:flex-end; gap:5px; }
.weather-details { display:flex; gap:10px; }
.weather-detail { display:flex; align-items:center; gap:4px; font-size:0.72rem; color:rgba(255,255,255,0.9); font-weight:700; }
.weather-detail svg { width:13px; height:13px; stroke:rgba(249,232,74,0.85); fill:none; stroke-width:2; }

/* Alerte agro mÃ©tÃ©o */
.agro-weather-alert {
  display:none; align-items:flex-start; gap:10px;
  margin-top:8px; padding:11px 14px; border-radius:12px;
  font-size:0.75rem; font-weight:700; line-height:1.45;
  animation:alertSlideIn 0.4s cubic-bezier(0.4,0,0.2,1) both;
  position:relative; overflow:hidden;
}
.agro-weather-alert::before {
  content:'ğŸ¤– Conseil IA';
  position:absolute; top:7px; right:10px;
  font-size:0.58rem; font-weight:700; font-family:'Sora',sans-serif;
  opacity:0.75; letter-spacing:0.4px; text-transform:uppercase;
}
.agro-weather-alert.rain    { background:rgba(52,152,219,0.28); border:1.5px solid rgba(52,152,219,0.5); color:#D6EAF8; }
.agro-weather-alert.sun     { background:rgba(241,196,15,0.22); border:1.5px solid rgba(241,196,15,0.45); color:#FEF9E7; }
.agro-weather-alert.wind    { background:rgba(189,195,199,0.22); border:1.5px solid rgba(189,195,199,0.45); color:#EBEDEF; }
.agro-weather-alert.heat    { background:rgba(231,76,60,0.22); border:1.5px solid rgba(231,76,60,0.45); color:#FADBD8; }
.agro-weather-alert.good    { background:rgba(46,204,113,0.22); border:1.5px solid rgba(46,204,113,0.45); color:#D5F5E3; }
.agro-weather-alert-icon    { font-size:1.25rem; flex-shrink:0; margin-top:1px; }
@keyframes alertSlideIn { from{opacity:0;transform:translateY(-8px);}to{opacity:1;transform:translateY(0);} }

/* Skeleton mÃ©tÃ©o */
.weather-skeleton {
  background:rgba(255,255,255,0.08); border-radius:12px; margin-top:10px;
  height:52px; animation:shimmerW 1.5s ease-in-out infinite;
}
@keyframes shimmerW {
  0%,100%{opacity:0.5;} 50%{opacity:0.9;}
}

/* Pill localisation dans le header rÃ©sultats */
.loc-pill {
  display:inline-flex; align-items:center; gap:5px;
  font-size:0.78rem; font-weight:700;
  background: rgba(74,158,42,0.1); color: #2E7D32;
  border: 1.5px solid rgba(74,158,42,0.25);
  border-radius: 20px; padding: 3px 10px 3px 7px;
}
.loc-pill svg { width:13px; height:13px; stroke:currentColor; fill:none; stroke-width:2.5; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION EMPLOIS â€” STYLES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â• NEW EMPLOIS DESIGN v47 â•â• */
/* Topbar */
.ej-topbar {
  display: flex; align-items: center; gap: 12px;
  background: #fff; padding: 0 14px;
  height: 54px; flex-shrink: 0;
  border-bottom: 1px solid #EAECEF;
}
.ej-back-btn {
  width: 34px; height: 34px; border-radius: 10px; border: none;
  background: #F7F8F9; display: flex; align-items: center; justify-content: center;
  cursor: pointer; flex-shrink: 0;
}
.ej-topbar-title {
  flex: 1; font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.95rem; color: #1A1E25;
}
.ej-notif-btn {
  position: relative; width: 36px; height: 36px; border-radius: 10px;
  border: none; background: #F7F8F9; cursor: pointer;
  display: flex; align-items: center; justify-content: center; font-size: 1rem; flex-shrink: 0;
}
.ej-notif-badge {
  position: absolute; top: -3px; right: -3px;
  width: 16px; height: 16px; border-radius: 50%; background: #E53E3E;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Sora', sans-serif; font-size: 0.5rem; font-weight: 800; color: #fff;
  border: 2px solid #fff;
}
/* Stats bar */
.ej-stats-bar {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 14px; background: #fff; border-bottom: 1px solid #EAECEF; flex-shrink: 0;
}
.ej-stat-pill {
  display: flex; align-items: center; gap: 5px;
  padding: 5px 10px; border-radius: 20px; background: #F7F8F9;
  border: 1.5px solid #EAECEF;
}
.ej-stat-pill-val {
  font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 0.82rem; color: #1A1E25;
}
.ej-stat-pill-val.gold { color: #D4A843; }
.ej-stat-pill-lbl { font-size: 0.6rem; color: #9BA3AE; font-weight: 600; }
/* Search */
.ej-search-bar {
  display: flex; align-items: center; gap: 10px;
  background: #F7F8F9; border-radius: 12px; padding: 10px 12px;
  border: 1.5px solid #EAECEF; margin: 10px 14px 0;
}
/* Legacy compat */
.ej-hero { display: none; }
.ej-hero-toprow { display: none; }
.ej-hero-pill { display: none; }
.ej-pill-dot { display: none; }
@keyframes ejPulse { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:0.6;transform:scale(1.3);} }
.ej-hero-h1 { display: none; }
.ej-hero-stats { display: none; }
.ej-stat { display: none; }
.ej-stat-val { display: none; }
.ej-stat-lbl { display: none; }
/* Tabs */
.ej-tabs {
  display: flex; gap: 0; overflow-x: auto; scrollbar-width: none;
  background: #fff; border-bottom: 2px solid #EAECEF;
  padding: 0 12px; flex-shrink: 0;
}
.ej-tabs::-webkit-scrollbar { display: none; }
.ej-tab {
  display: flex; align-items: center; gap: 5px;
  padding: 11px 12px; cursor: pointer; white-space: nowrap;
  font-family: 'Sora', sans-serif; font-size: 0.7rem; font-weight: 600;
  color: #9BA3AE; border-bottom: 2.5px solid transparent; margin-bottom: -2px;
  transition: all 0.2s;
}
.ej-tab.active { color: #4A9E2A; border-bottom-color: #4A9E2A; font-weight: 800; }
.ej-tab-count {
  background: #EDF7E5; color: #2A5E10; border-radius: 20px;
  padding: 1px 6px; font-size: 0.58rem; font-weight: 800;
}
.ej-tab.active .ej-tab-count { background: #4A9E2A; color: #fff; }
/* Smart filters */
.ej-smart-filters {
  display: flex; gap: 7px; overflow-x: auto; scrollbar-width: none;
  padding: 10px 14px 8px; background: #fff; flex-shrink: 0;
}
.ej-smart-filters::-webkit-scrollbar { display: none; }
.ej-sf-chip {
  white-space: nowrap; padding: 5px 12px; border-radius: 20px;
  background: #F7F8F9; border: 1.5px solid #EAECEF;
  font-family: 'Sora', sans-serif; font-size: 0.67rem; font-weight: 700;
  color: #3D4550; cursor: pointer; transition: all 0.18s;
}
.ej-sf-chip.active { background: #EDF7E5; border-color: #4A9E2A; color: #2A5E10; }
.ej-sf-chip.ej-sf-or { border-color: #FFE0B2; background: #FFF3E0; color: #E65100; }
.ej-sf-chip.ej-sf-or.active { background: #E65100; color: #fff; border-color: #E65100; }
/* Jobs list scroll */
.ej-jobs-scroll { flex: 1; overflow-y: auto; padding: 10px 14px 80px; background: #F7F8F9; }
/* IA match banner â€” new style */
.ej-ia-banner {
  display: flex; align-items: center; gap: 12px;
  background: linear-gradient(135deg, #1D5C2E, #2A5E10);
  border-radius: 14px; padding: 14px; margin-bottom: 12px;
}
.ej-ia-glow { font-size: 1.8rem; filter: drop-shadow(0 0 8px rgba(110,214,59,0.5)); }
.ej-ia-text { flex: 1; }
.ej-ia-title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.82rem; color: #fff; }
.ej-ia-sub { font-size: 0.65rem; color: rgba(255,255,255,0.65); margin-top: 2px; }
.ej-ia-score-val { font-family: 'JetBrains Mono', monospace; font-weight: 900; font-size: 1.2rem; color: #A8F077; }
.ej-ia-score-lbl { font-size: 0.58rem; color: rgba(255,255,255,0.55); text-align: center; }
/* Section header */
.ej-section-hdr { display: flex; align-items: center; justify-content: space-between; margin: 12px 0 8px; }
.ej-section-title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.78rem; color: #1A1E25; }
.ej-section-action { font-size: 0.72rem; font-weight: 700; color: #4A9E2A; cursor: pointer; }
/* NEW Job card â€” left accent bar design */
.ej-job-card {
  background: #fff; border-radius: 14px; padding: 14px 14px 14px 16px;
  margin-bottom: 9px; border: 1.5px solid #EAECEF;
  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
  cursor: pointer; transition: all 0.2s;
  position: relative; overflow: hidden;
}
.ej-job-card::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0;
  width: 4px; background: #9BA3AE; border-radius: 14px 0 0 14px;
}
.ej-job-card.match-high::before { background: linear-gradient(to bottom, #4A9E2A, #6ED63B); }
.ej-job-card.match-mid::before { background: linear-gradient(to bottom, #D4A843, #F0C040); }
.ej-job-card.featured { border-color: rgba(212,168,67,0.35); }
.ej-job-card:active { transform: scale(0.98); }
.ej-featured-badge {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 7px; border-radius: 6px; margin-bottom: 9px;
  background: linear-gradient(135deg, #D4A843, #B8860B);
  font-family: 'Sora', sans-serif; font-size: 0.55rem; font-weight: 800; color: #fff;
  letter-spacing: 0.06em;
}
.ej-jc-header { display: flex; align-items: flex-start; gap: 10px; }
.ej-jc-logo {
  width: 40px; height: 40px; border-radius: 11px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; font-size: 1.3rem;
  background: #EDF7E5;
}
.ej-jc-logo.dark { background: #E3E8F0; }
.ej-jc-info { flex: 1; min-width: 0; }
.ej-jc-title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.85rem; color: #1A1E25; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ej-jc-company { display: flex; align-items: center; gap: 4px; font-size: 0.7rem; color: #9BA3AE; }
.ej-jc-verified { color: #4A9E2A; font-weight: 800; font-size: 0.68rem; }
.ej-bookmark {
  width: 30px; height: 30px; border-radius: 9px; border: none;
  background: #F7F8F9; cursor: pointer; display: flex; align-items: center;
  justify-content: center; flex-shrink: 0; transition: all 0.2s;
}
.ej-bookmark.saved { background: #EDF7E5; }
.ej-bookmark.saved svg { stroke: #4A9E2A; fill: #4A9E2A; }
.ej-jc-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 9px; }
.ej-jc-tag {
  padding: 3px 7px; border-radius: 6px; font-family: 'Sora', sans-serif;
  font-size: 0.6rem; font-weight: 700; background: #F7F8F9; color: #3D4550;
}
.ej-jc-tag.lieu { background: #EBF5FF; color: #1A5C8A; }
.ej-jc-tag.niveau { background: #FFF5EB; color: #7A4A1A; }
.ej-jc-tag.secteur { background: #EDF7E5; color: #2A6A0A; }
.ej-jc-tag.urgent { background: #FFF0E8; color: #C23A00; }
.ej-jc-tag.contrat { background: #EDF7E5; color: #2A5E10; }
.ej-jc-bottom { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; padding-top: 9px; border-top: 1px solid #EAECEF; }
.ej-jc-salary { font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 0.85rem; color: #1A1E25; }
.ej-jc-salary-lbl { font-family: 'DM Sans', sans-serif; font-size: 0.62rem; font-weight: 500; color: #9BA3AE; }
.ej-jc-meta { display: flex; align-items: center; gap: 8px; }
.ej-jc-time { font-size: 0.63rem; color: #9BA3AE; }
.ej-match-pill {
  display: flex; align-items: center; gap: 3px; padding: 3px 7px; border-radius: 20px;
  font-family: 'Sora', sans-serif; font-size: 0.6rem; font-weight: 800; color: #fff;
}
/* Quick apply card */
.ej-quick-apply {
  display: flex; align-items: center; gap: 12px;
  background: linear-gradient(135deg, #2A5E10, #4A9E2A);
  border-radius: 14px; padding: 14px; margin-bottom: 10px; cursor: pointer;
}
.ej-quick-icon {
  width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.2);
  display: flex; align-items: center; justify-content: center; font-size: 1.3rem; flex-shrink: 0;
}
.ej-quick-title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.82rem; color: #fff; }
.ej-quick-sub { font-size: 0.63rem; color: rgba(255,255,255,0.65); margin-top: 2px; }
.ej-quick-arrow {
  width: 32px; height: 32px; border-radius: 50%; background: rgba(255,255,255,0.2);
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
/* Detail view */
.ej-detail-header {
  background: linear-gradient(148deg, #1D5C2E, #3A8A18);
  padding: 14px 16px 16px; flex-shrink: 0;
}
.ej-dh-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.ej-dh-back {
  width: 34px; height: 34px; border-radius: 50%; background: rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center; cursor: pointer; border: none;
}
.ej-dh-actions { display: flex; gap: 8px; }
.ej-dh-action {
  width: 34px; height: 34px; border-radius: 50%; background: rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center; cursor: pointer; border: none;
}
.ej-dh-company { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.ej-dh-logo {
  width: 52px; height: 52px; border-radius: 16px; background: rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center; font-size: 1.6rem; flex-shrink: 0;
}
.ej-dh-company-name { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 1rem; color: #fff; }
.ej-dh-company-meta { font-size: 0.65rem; color: rgba(255,255,255,0.65); margin-top: 3px; display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
.ej-dh-verified { background: rgba(110,214,59,0.25); color: #A8F077; padding: 2px 8px; border-radius: 20px; font-weight: 700; font-size: 0.62rem; }
.ej-dh-role { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 1.05rem; color: #fff; line-height: 1.3; margin-bottom: 10px; }
.ej-dh-tags { display: flex; flex-wrap: wrap; gap: 6px; }
.ej-dh-tag {
  padding: 4px 10px; border-radius: 20px; background: rgba(255,255,255,0.15);
  font-family: 'Sora', sans-serif; font-size: 0.65rem; font-weight: 700; color: rgba(255,255,255,0.9);
}
/* Detail body sections */
.ej-detail-body { flex: 1; overflow-y: auto; padding: 0 0 20px; }
.ej-salary-block {
  display: flex; align-items: center; gap: 12px;
  background: #fff; padding: 14px 16px; border-bottom: 1px solid var(--g100);
}
.ej-salary-val { font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 1.05rem; color: var(--vp); }
.ej-salary-type { font-size: 0.65rem; color: var(--g400); margin-top: 2px; }
.ej-ds { padding: 14px 16px; background: #fff; border-bottom: 8px solid var(--g50); }
.ej-ds-title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.82rem; color: var(--g900); margin-bottom: 10px; }
.ej-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.ej-info-cell { background: var(--g50); border-radius: 12px; padding: 10px 12px; }
.ej-info-cell-icon { font-size: 1rem; margin-bottom: 4px; }
.ej-info-cell-lbl { font-size: 0.6rem; color: var(--g400); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 3px; }
.ej-info-cell-val { font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.75rem; color: var(--g900); }
/* Match IA section */
.ej-match-block {
  background: linear-gradient(135deg, #1D5C2E, #2A5E10);
  border-radius: 14px; padding: 14px; margin: 14px 16px;
}
.ej-match-hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
.ej-match-title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.85rem; color: #fff; }
.ej-match-pct { font-family: 'Sora', sans-serif; font-weight: 900; font-size: 1.4rem; color: #A8F077; }
.ej-match-bar-row { margin-bottom: 8px; }
.ej-match-bar-lbl { display: flex; justify-content: space-between; font-size: 0.65rem; color: rgba(255,255,255,0.7); margin-bottom: 4px; }
.ej-match-bar-lbl span:last-child { font-weight: 800; color: #A8F077; }
.ej-match-bar-track { background: rgba(255,255,255,0.1); border-radius: 6px; height: 6px; overflow: hidden; }
.ej-match-bar-fill { height: 100%; border-radius: 6px; background: linear-gradient(90deg, #6ED63B, #A8F077); width: 0; transition: width 1s cubic-bezier(0.4,0,0.2,1); }
.ej-desc-text { font-size: 0.8rem; color: var(--g700); line-height: 1.65; }
/* Detail footer */
.ej-detail-footer {
  padding: 12px 14px; background: #fff; border-top: 1px solid var(--g100);
  display: flex; gap: 10px; flex-shrink: 0;
}
.ej-btn-save {
  width: 48px; height: 48px; border-radius: 14px; border: 1.5px solid var(--g200);
  background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; flex-shrink: 0;
}
.ej-btn-save.saved { background: var(--vc); border-color: var(--vp); }
.ej-btn-apply {
  flex: 1; padding: 14px; border-radius: 14px; border: none; cursor: pointer;
  background: linear-gradient(135deg, #4A9E2A, #2A5E10); color: #fff;
  font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.9rem;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  box-shadow: 0 4px 16px rgba(74,158,42,0.35); transition: all 0.2s;
}
.ej-btn-apply:hover { transform: translateY(-2px); }
/* Apply view */
.ej-apply-header {
  background: linear-gradient(148deg, #1D5C2E, #3A8A18);
  padding: 12px 16px 16px; display: flex; align-items: center; gap: 12px; flex-shrink: 0;
}
.ej-apply-steps { display: flex; align-items: center; gap: 6px; }
.ej-apply-step {
  width: 28px; height: 28px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.72rem;
  background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.6);
}
.ej-apply-step.done { background: #6ED63B; color: #1D5C2E; }
.ej-apply-step.active { background: #fff; color: var(--vp); }
.ej-apply-step-line { width: 18px; height: 2px; background: rgba(255,255,255,0.2); border-radius: 2px; }
.ej-apply-step-line.done { background: #6ED63B; }
.ej-apply-title { font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.95rem; color: #fff; }
.ej-apply-sub { font-size: 0.65rem; color: rgba(255,255,255,0.65); margin-top: 2px; }
/* Apply form */
.ej-pre-score {
  background: #fff; border: 1.5px solid var(--g100); border-radius: 14px;
  padding: 12px 14px; display: flex; align-items: center; gap: 12px; margin-bottom: 12px;
}
.ej-score-ring {
  width: 54px; height: 54px; border-radius: 50%; flex-shrink: 0;
  background: conic-gradient(var(--vp) 0deg 280deg, var(--vc) 280deg 360deg);
  display: flex; align-items: center; justify-content: center; position: relative;
}
.ej-score-ring::before { content:'';position:absolute;width:40px;height:40px;border-radius:50%;background:#fff; }
.ej-score-inner { position:relative;z-index:1;font-family:'Sora',sans-serif;font-weight:800;font-size:0.82rem;color:var(--vp); }
.ej-score-title { font-family:'Sora',sans-serif;font-weight:800;font-size:0.82rem;color:var(--g900); }
.ej-score-desc { font-size:0.65rem;color:var(--g400);margin-top:2px;line-height:1.45; }
.ej-cv-block {
  background: linear-gradient(135deg, #1D5C2E, #2A5E10);
  border-radius: 14px; padding: 14px; margin-bottom: 12px;
}
.ej-cv-title { font-family:'Sora',sans-serif;font-weight:800;font-size:0.85rem;color:#fff;margin-bottom:6px; }
.ej-cv-desc { font-size:0.68rem;color:rgba(255,255,255,0.65);margin-bottom:12px;line-height:1.5; }
.ej-cv-opts { display:grid;grid-template-columns:1fr 1fr;gap:8px; }
.ej-cv-opt {
  background:rgba(255,255,255,0.1);border:1.5px solid rgba(255,255,255,0.18);
  border-radius:12px;padding:12px 10px;cursor:pointer;text-align:center;transition:all 0.18s;
}
.ej-cv-opt:hover { background:rgba(255,255,255,0.2); }
.ej-cv-opt-icon { font-size:1.4rem;margin-bottom:5px; }
.ej-cv-opt-lbl { font-family:'Sora',sans-serif;font-size:0.65rem;font-weight:700;color:rgba(255,255,255,0.85); }
.ej-form-section { margin-bottom:14px; }
.ej-form-title { font-family:'Sora',sans-serif;font-weight:800;font-size:0.8rem;color:var(--g900);margin-bottom:10px; }
.ej-form-row { margin-bottom:10px; }
.ej-form-label { font-size:0.72rem;font-weight:700;color:var(--g700);margin-bottom:5px;display:block; }
.ej-form-label span { color:var(--red); }
.ej-form-input {
  width:100%;padding:11px 14px;border-radius:12px;
  border:1.5px solid var(--g200);outline:none;
  font-family:'DM Sans',sans-serif;font-size:0.85rem;color:var(--g900);
  background:#fff;transition:border-color 0.2s;
}
.ej-form-input:focus { border-color:var(--vp);box-shadow:0 0 0 3px rgba(74,158,42,0.08); }
.ej-form-input.prefilled { border-color:var(--va);background:var(--vc); }
.ej-apply-footer {
  padding:14px;background:#fff;border-top:1px solid var(--g100);flex-shrink:0;
}
.ej-btn-submit {
  width:100%;padding:15px;border-radius:14px;border:none;cursor:pointer;
  background:linear-gradient(135deg,#4A9E2A,#2A5E10);
  color:#fff;font-family:'Sora',sans-serif;font-weight:800;font-size:0.95rem;
  display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 4px 20px rgba(74,158,42,0.4);transition:all 0.2s;
}
.ej-btn-submit:hover { transform:translateY(-2px); }
.ej-upload-grid { display:grid;grid-template-columns:1fr 1fr;gap:8px; }
.ej-upload-cell {
  border:2px dashed var(--g200);border-radius:12px;padding:14px;text-align:center;cursor:pointer;
  transition:all 0.2s;
}
.ej-upload-cell.has-file { border-color:var(--va);background:var(--vc); }
.ej-upload-cell:hover { border-color:var(--vp); }
/* Empty state */
.ej-empty { text-align:center;padding:40px 20px;color:var(--g400); }
.ej-empty-icon { font-size:3rem;margin-bottom:12px; }
.ej-empty-title { font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:var(--g700);margin-bottom:4px; }
.ej-empty-sub { font-size:0.75rem; }
</style>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE MARCHÃ‰ MOBILE â€” intÃ©grÃ©e depuis abae-mobile.html (sans modification)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-marche">
  <!-- Toast dÃ©diÃ© marketplace -->
  <div id="toast-marche" class="toast-marche"></div>
<div class="phone" id="app">

  <!-- â•â•â• TOAST â•â•â• -->
  <div class="toast" id="toast"></div>

  <!-- â•â•â• BOTTOM SHEET OVERLAY â•â•â• -->
  <div class="sheet-overlay" id="sheetOverlay" onclick="closeAllSheets()"></div>

  <!-- â•â•â• SCREENS â•â•â• -->
  <div class="screens" id="screens">

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 1 : MARCHÃ‰
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen active" id="screen-marche">

      <!-- â•â• TICKER PRIX MARCHÃ‰ EN TEMPS RÃ‰EL â•â• -->
      <div class="market-ticker" id="marketTicker">
        <div class="ticker-label">ğŸ“Š LIVE</div>
        <div class="ticker-track" id="tickerTrack">
          <!-- Rempli dynamiquement par JS -->
        </div>
      </div>

      <!-- Hero banner -->
      <div class="hero-banner">
        <div class="hero-top">
          <div>
            <div class="hero-greeting">Bonjour,</div>
            <div class="hero-name" id="heroUserName">Utilisateur ğŸ‘‹</div>
            <div class="hero-profil" id="heroUserProfil">
              <span class="hero-profil-dot"></span>
              <span id="heroProfilLabel">Acheteur</span>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
            <button class="wallet-pill" onclick="navTo('portefeuille')">
              <svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg>
              <span id="heroWalletBalance">â€” XAF</span>
            </button>
            <!-- BADGE ABONNEMENT -->
            <div id="subBadgeHero" onclick="openAboFromDashboard()" style="cursor:pointer;display:flex;align-items:center;gap:5px;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);border-radius:20px;padding:4px 10px;font-size:0.65rem;font-family:'Sora',sans-serif;font-weight:700;color:#fff;white-space:nowrap;">
              ğŸŒ± GRATUIT
            </div>
          </div>
        </div>

        <!-- BANNIÃˆRE VENDEUR â€” visible uniquement si rÃ´le peut vendre -->
        <!-- BANNIÃˆRE ACHETEUR â€” visible uniquement pour les acheteurs purs -->
        <div class="hero-buyer-banner" id="heroBuyerBanner" style="display:none;" onclick="if(!abaeCanDo('service')) return; openSheet('requestSheet')">
          <div class="hero-seller-banner-icon">ğŸ”</div>
          <div style="flex:1;">
            <div class="hero-seller-banner-title">Vous ne trouvez pas ?</div>
            <div class="hero-seller-banner-sub">Faites une demande Â· Les vendeurs vous contactent</div>
          </div>
          <button class="hero-seller-banner-cta" style="background:rgba(212,168,67,0.9);" onclick="event.stopPropagation();if(!abaeCanDo('service')) return; openSheet('requestSheet')">+ Demande</button>
        </div>

        <!-- STATS VENDEUR â€” visible uniquement si rÃ´le peut vendre -->
        <div class="hero-search" onclick="document.getElementById('heroSearchInput').focus()">
          <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
          <input type="text" id="heroSearchInput" placeholder="MaÃ¯s, bÅ“ufs, transportâ€¦" oninput="filterCards()" autocomplete="off"/>
          <button onclick="openSheet('filterSheet')" style="display:flex;align-items:center;gap:3px;padding:0;">
            <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:var(--vert-principal);fill:none;stroke-width:2;"><line x1="4" y1="6" x2="20" y2="6"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="11" y1="18" x2="13" y2="18"/></svg>
          </button>
        </div>

        <!-- WIDGET MÃ‰TÃ‰O & GÃ‰O -->
        <div class="weather-skeleton" id="weatherSkeleton" style="display:none;"></div>
        <div class="weather-strip" id="weatherStrip" onclick="refreshWeather()" style="flex-direction:column;align-items:stretch;gap:7px;">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div class="weather-left">
              <div class="weather-icon" id="weatherIcon">â›…</div>
              <div>
                <div style="display:flex;align-items:baseline;gap:5px;">
                  <div class="weather-temp" id="weatherTemp">--Â°C</div>
                  <div class="weather-desc" id="weatherDesc">Chargementâ€¦</div>
                </div>
                <div class="weather-location" id="weatherLocation">
                  <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
                  <span id="weatherCity">Localisationâ€¦</span>
                </div>
              </div>
            </div>
            <div class="weather-right">
              <div class="weather-details">
                <div class="weather-detail">
                  <svg viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
                  <span id="weatherHumidity">--%</span>
                </div>
                <div class="weather-detail">
                  <svg viewBox="0 0 24 24"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>
                  <span id="weatherWind">-- km/h</span>
                </div>
              </div>
              <div style="font-size:0.64rem;color:rgba(249,232,74,0.75);margin-top:3px;font-weight:700;letter-spacing:0.3px;">â†» actualiser</div>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;padding-top:10px;border-top:1.5px solid rgba(249,232,74,0.35);background:rgba(249,232,74,0.06);border-radius:10px;margin:0 -2px;padding:10px 10px 8px;">
            <span id="agroAlertIcon" style="font-size:1.1rem;flex-shrink:0;">ğŸŒ±</span>
            <span id="agroAlertText" style="font-size:0.76rem;font-weight:700;color:rgba(255,253,231,1);line-height:1.4;letter-spacing:0.1px;">Conseil agropastoral en coursâ€¦</span>
          </div>
          <!-- PrÃ©visions 7 jours â€” Open-Meteo gratuit -->
          <div class="wx-forecast-strip" id="wxForecastStrip" style="display:none;">
            <!-- rempli dynamiquement par renderForecast() -->
          </div>
        </div>

      </div>

      <!-- Chips filtres -->
      <div class="chips-scroll" id="chipsScroll">
        <div class="chips-track" id="chipsTrack">
        <div class="chip active" data-filter="all" onclick="setChip(this,'all')">ğŸŒ Tout</div>
        <div class="chip" data-filter="agricole" onclick="setChip(this,'agricole')">ğŸŒ¾ Agricole</div>
        <div class="chip" data-filter="elevage" onclick="setChip(this,'elevage')">ğŸ„ Ã‰levage</div>
        <div class="chip" data-filter="piscicole" onclick="setChip(this,'piscicole')">ğŸŸ Piscicole</div>
        <div class="chip" data-filter="transport" onclick="setChip(this,'transport')">ğŸš› Transport</div>
        <div class="chip" data-filter="stockage" onclick="setChip(this,'stockage')">ğŸ­ Stockage</div>
        <div class="chip" data-filter="phytosanitaires" onclick="setChip(this,'phytosanitaires')">ğŸŒ¿ Phytosanitaires</div>
        <div class="chip" data-filter="digital" onclick="setChip(this,'digital')">ğŸ’» Digital</div>
        <div class="chip" data-filter="financement" onclick="setChip(this,'financement')">ğŸ’° Financement</div>
        <div class="chip" data-filter="services" onclick="setChip(this,'services')">ğŸ”§ Conseil</div>
        <div class="chip" data-filter="equipements" onclick="setChip(this,'equipements')">âš™ï¸ Ã‰quipements</div>
        <div class="chip" data-filter="machines" onclick="setChip(this,'machines')">ğŸšœ Machines</div>
        <div class="chip" data-filter="agroalimentaire" onclick="setChip(this,'agroalimentaire')">ğŸ½ï¸ Agroalimentaire</div>
        <div class="chip" data-filter="emplois" onclick="openEmploisScreen()">ğŸ’¼ Emplois</div>
        <div class="chip" data-filter="formation" onclick="setChip(this,'formation')">ğŸ“š Formation</div>
        <div class="chip" data-filter="intrants" onclick="setChip(this,'intrants')">ğŸŒ± Intrants</div>
        <div class="chip" data-filter="assurance" onclick="setChip(this,'assurance')">ğŸ›¡ï¸ Assurance</div>
        <!-- Duplicate pour boucle infinie -->
        <div class="chip active" data-filter="all" onclick="setChip(this,'all')">ğŸŒ Tout</div>
        <div class="chip" data-filter="agricole" onclick="setChip(this,'agricole')">ğŸŒ¾ Agricole</div>
        <div class="chip" data-filter="elevage" onclick="setChip(this,'elevage')">ğŸ„ Ã‰levage</div>
        <div class="chip" data-filter="piscicole" onclick="setChip(this,'piscicole')">ğŸŸ Piscicole</div>
        <div class="chip" data-filter="transport" onclick="setChip(this,'transport')">ğŸš› Transport</div>
        <div class="chip" data-filter="stockage" onclick="setChip(this,'stockage')">ğŸ­ Stockage</div>
        <div class="chip" data-filter="phytosanitaires" onclick="setChip(this,'phytosanitaires')">ğŸŒ¿ Phytosanitaires</div>
        <div class="chip" data-filter="digital" onclick="setChip(this,'digital')">ğŸ’» Digital</div>
        <div class="chip" data-filter="financement" onclick="setChip(this,'financement')">ğŸ’° Financement</div>
        <div class="chip" data-filter="services" onclick="setChip(this,'services')">ğŸ”§ Conseil</div>
        <div class="chip" data-filter="equipements" onclick="setChip(this,'equipements')">âš™ï¸ Ã‰quipements</div>
        <div class="chip" data-filter="machines" onclick="setChip(this,'machines')">ğŸšœ Machines</div>
        <div class="chip" data-filter="agroalimentaire" onclick="setChip(this,'agroalimentaire')">ğŸ½ï¸ Agroalimentaire</div>
        <div class="chip" data-filter="emplois" onclick="openEmploisScreen()">ğŸ’¼ Emplois</div>
        <div class="chip" data-filter="formation" onclick="setChip(this,'formation')">ğŸ“š Formation</div>
        <div class="chip" data-filter="intrants" onclick="setChip(this,'intrants')">ğŸŒ± Intrants</div>
        <div class="chip" data-filter="assurance" onclick="setChip(this,'assurance')">ğŸ›¡ï¸ Assurance</div>
        </div>
      </div>





      <!-- Section header -->
      <div class="section-hd">
        <h2><span id="resultCount">9</span> offres Â· <span id="locationLabel"><span class="loc-pill">ğŸŒ Cameroun</span></span></h2>
        <a onclick="openSheet('filterSheet')">Filtrer âš™</a>
      </div>

      <!-- MES OFFRES â€” visible si l'utilisateur peut vendre -->
      <div class="mes-offres-section" id="mesOffresSection" style="padding-bottom:4px;">
        <div class="mes-offres-header" onclick="toggleMesOffres()" style="cursor:pointer;user-select:none;">
          <div class="mes-offres-title">ğŸ“¦ Mes offres publiÃ©es</div>
          <div style="display:flex;align-items:center;gap:8px;">
            <div class="mes-offres-badge" id="mesOffresBadge">3 actives</div>
            <svg id="mesOffresChevron" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#4A9E2A" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="transition:transform 0.3s ease;flex-shrink:0;"><polyline points="6 9 12 15 18 9"/></svg>
          </div>
        </div>
        <div id="mesOffresBody" style="overflow:hidden;max-height:0;transition:max-height 0.35s ease;">
          <div style="padding-top:8px;display:flex;flex-direction:column;">
            <div id="mesOffresCards" style="display:flex;flex-direction:column;gap:6px;max-height:240px;overflow-y:auto;padding-right:2px;scrollbar-width:thin;scrollbar-color:rgba(74,158,42,0.3) transparent;"></div>
            <button onclick="if(!abaeCanDo('publier')) return; openSheet('publishSheet')" style="width:100%;margin-top:8px;padding:10px;border:none;border-radius:12px;background:linear-gradient(135deg,#D4A843,#B8860B);color:#fff;font-family:'Sora',sans-serif;font-weight:800;font-size:0.82rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 16px rgba(212,168,67,0.35);flex-shrink:0;">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Publier une nouvelle offre
            </button>
          </div>
        </div>
      </div>

      <!-- MES DEMANDES â€” visible pour les acheteurs (et aussi pour les autres profils) -->
      <div class="mes-offres-section" id="mesDemandesSection" style="display:none;background:linear-gradient(135deg,rgba(212,168,67,0.08),rgba(212,168,67,0.04));border:1.5px solid rgba(212,168,67,0.25);padding:8px 10px 6px;">
        <div class="mes-offres-header" style="margin-bottom:0;cursor:pointer;user-select:none;" onclick="toggleMesDemandes()">
          <div class="mes-offres-title" style="color:#7A5A00;">ğŸ” Mes demandes</div>
          <div style="display:flex;align-items:center;gap:8px;">
            <div class="mes-offres-badge" id="mesDemandesBadge" style="background:#D4A843;">0 actives</div>
            <svg id="mesDemandesChevron" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#7A5A00" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="transition:transform 0.3s ease;flex-shrink:0;"><polyline points="6 9 12 15 18 9"/></svg>
          </div>
        </div>
        <div id="mesDemandesBody" style="overflow:hidden;max-height:0;transition:max-height 0.35s ease;">
          <div style="padding-top:8px;display:flex;flex-direction:column;">
            <div id="mesDemandesCards" style="display:flex;flex-direction:column;gap:6px;max-height:220px;overflow-y:auto;padding-right:2px;scrollbar-width:thin;scrollbar-color:rgba(212,168,67,0.4) transparent;"></div>
            <button onclick="if(!abaeCanDo('service')) return; openSheet('requestSheet')" style="width:100%;margin-top:6px;padding:7px 10px;border:1.5px dashed rgba(212,168,67,0.4);border-radius:10px;background:rgba(212,168,67,0.07);color:#7A5A00;font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:5px;flex-shrink:0;">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Faire une nouvelle demande
            </button>
          </div>
        </div>
      </div>

      <!-- Cards list -->
      <div class="cards-list" id="cardsGrid"></div>

      <!-- â”€â”€ Barre de raccourcis rapides (masquÃ©e) â”€â”€ -->
      <div class="market-shortcuts" id="marketShortcuts" style="display:none;">
        <!-- Remplie dynamiquement par updateMarketShortcuts() selon le rÃ´le -->
      </div>

      <!-- Spacer bottom -->
      <div style="height:8px;flex-shrink:0;"></div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 2 : DÃ‰TAIL PRODUIT
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen" id="screen-detail">
      <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;">
        <button class="topbar-back" onclick="goBack()" style="background:rgba(255,255,255,0.15);">
          <svg viewBox="0 0 24 24" style="stroke:#fff;"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
        <div class="topbar-title" id="detailTopTitle" style="color:#fff;">Produit</div>
        <button class="topbar-icon" onclick="showToast('PartagÃ© !')" style="background:rgba(255,255,255,0.15);">
          <svg viewBox="0 0 24 24" style="stroke:#fff;"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        </button>
      </div>
      <div id="detailContent" style="flex:1;overflow-y:auto;display:flex;flex-direction:column;"></div>
    </div>


    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 3 : TUNNEL COMMANDE
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen" id="screen-order">
      <div class="topbar" style="flex-direction:column;height:auto;padding:0;gap:0;background:linear-gradient(135deg,#2A5E10 0%,#4A9E2A 100%);">
        <div style="display:flex;align-items:center;width:100%;padding:14px 20px;gap:12px;">
          <button class="topbar-back" id="orderBackBtn" onclick="orderBack()" style="width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
            <svg viewBox="0 0 24 24" width="22" height="22" style="stroke:#fff;fill:none;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round;"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <div class="topbar-title" id="orderTopTitle" style="flex:1;text-align:center;font-family:'Sora',sans-serif;font-size:1.1rem;font-weight:800;color:#fff;letter-spacing:-0.2px;">Commander</div>
          <div style="width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;">
            <span style="font-size:1.1rem;">ğŸ”’</span>
          </div>
        </div>
        <div id="orderStepsInHeader" style="display:flex;gap:4px;padding:0 20px 14px;width:100%;"></div>
      </div>
      <div id="orderContent" style="flex:1;overflow-y:auto;display:flex;flex-direction:column;"></div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 4 : COMMANDES
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen" id="screen-commandes">
      <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;">
        <div class="topbar-logo">
          <img src="data:image/webp;base64,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" alt="ABAE" style="height:26px;width:auto;object-fit:contain;display:block;">
          <span class="logo-name" style="color:#fff;">Mes Commandes</span>
        </div>
        <div style="flex:1;"></div>
        <button class="topbar-icon" onclick="openSheet('commandesFilterSheet')" title="Filtrer commandes" style="background:rgba(255,255,255,0.15);">
          <svg viewBox="0 0 24 24" style="stroke:#fff;"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        </button>
</div>

      <div class="section-hd" style="padding-top:14px;">
        <h2>En cours</h2>
      </div>

      <div class="order-card" onclick="goToDocViewer('bc')">
        <div class="order-card-top">
          <div>
            <div class="order-num">BC-2026-001547</div>
            <div class="order-name">5 BÅ“ufs de race FoulbÃ©</div>
          </div>
          <div class="order-status status-transit">ğŸš› En livraison</div>
        </div>
        <div class="order-meta">
          <span>ğŸ“ NgaoundÃ©rÃ© â†’ YaoundÃ©</span>
          <span>ğŸ“… 28 fÃ©v. 2026</span>
        </div>
        <div class="order-price">345 000 XAF <span style="font-family:'DM Sans',sans-serif;font-size:0.7rem;font-weight:400;color:var(--g400);">Â· Commission ABAE 5% incluse</span></div>
        <div class="order-progress"><div class="order-progress-fill" style="width:65%;"></div></div>
        <div class="order-steps-labels">
          <span class="order-step-lbl done">Commande</span>
          <span class="order-step-lbl done">Paiement</span>
          <span class="order-step-lbl done">Envoi</span>
          <span class="order-step-lbl">Livraison</span>
          <span class="order-step-lbl">ConfirmÃ©</span>
        </div>
      </div>

      <div class="order-card" onclick="goToDocViewer('bc')">
        <div class="order-card-top">
          <div>
            <div class="order-num">BC-2026-001412</div>
            <div class="order-name">Sacs de maÃ¯s blanc Ã— 20</div>
          </div>
          <div class="order-status status-pending">â³ En attente</div>
        </div>
        <div class="order-meta">
          <span>ğŸ“ YaoundÃ©</span>
          <span>ğŸ“… 22 fÃ©v. 2026</span>
        </div>
        <div class="order-price">370 000 XAF</div>
        <div class="order-progress"><div class="order-progress-fill" style="width:30%;"></div></div>
        <div class="order-steps-labels">
          <span class="order-step-lbl done">Commande</span>
          <span class="order-step-lbl done">Paiement</span>
          <span class="order-step-lbl">Envoi</span>
          <span class="order-step-lbl">Livraison</span>
          <span class="order-step-lbl">ConfirmÃ©</span>
        </div>
      </div>

      <div class="section-hd"><h2>TerminÃ©es</h2></div>

      <div class="order-card" onclick="goToDocViewer('dec')">
        </div>
        <div class="order-meta"><span>ğŸ“… 15 fÃ©v. 2026</span></div>
        <div class="order-price">95 000 XAF</div>
      </div>

      <div style="height:8px;"></div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 5 : DOCUMENTS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen" id="screen-documents">
      <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;">
        <div class="topbar-logo">
          <img src="data:image/webp;base64,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" alt="ABAE" style="height:26px;width:auto;object-fit:contain;display:block;">
          <span class="logo-name" style="color:#fff;">Documents</span>
        </div>
        <div style="flex:1;"></div>
        <button class="topbar-icon" onclick="showToast('Tous documents exportÃ©s !')" style="background:rgba(255,255,255,0.15);">
          <svg viewBox="0 0 24 24" style="stroke:#fff;"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        </button>
</div>

      <div class="section-hd" style="padding-top:14px;"><h2>Commande BC-2026-001547</h2></div>

      <div class="doc-item" onclick="goToDocViewer('bc')">
        <div class="doc-icon green">ğŸ“‹</div>
        <div class="doc-info">
          <div class="doc-name">Bon de commande</div>
          <div class="doc-meta">BC-2026-001547 Â· 25 fÃ©v. 2026</div>
        </div>
        <div class="doc-badge signed">SignÃ© âœ“</div>
        <div class="doc-action"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
      </div>

      <div class="doc-item" onclick="goToDocViewer('bl')">
        <div class="doc-icon blue">ğŸšš</div>
        <div class="doc-info">
          <div class="doc-name">Bon de livraison</div>
          <div class="doc-meta">BL-2026-001547 Â· 28 fÃ©v. 2026</div>
        </div>
        <div class="doc-badge pending">Ã€ signer</div>
        <div class="doc-action"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
      </div>

      <div class="doc-item" onclick="goToDocViewer('fac')">
        <div class="doc-icon orange">ğŸ§¾</div>
        <div class="doc-info">
          <div class="doc-name">Facture vendeur</div>
          <div class="doc-meta">FAC-2026-001547 Â· 28 fÃ©v. 2026</div>
        </div>
        <div class="doc-badge paid">PayÃ©e</div>
        <div class="doc-action"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
      </div>

      <div class="doc-item" onclick="goToDocViewer('recu')">
        <div class="doc-icon green">ğŸŸ¢</div>
        <div class="doc-info">
          <div class="doc-name">ReÃ§u de paiement</div>
          <div class="doc-meta">RECU-2026-001547 Â· 28 fÃ©v. 2026</div>
        </div>
        <div class="doc-badge signed">Ã‰mis</div>
        <div class="doc-action"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
      </div>

      <div class="section-hd"><h2>Transactions portefeuille</h2></div>

      <div class="doc-item" onclick="goToDocViewer('dep')">
        <div class="doc-icon green">ğŸ¦</div>
        <div class="doc-info">
          <div class="doc-name">ReÃ§u de dÃ©pÃ´t</div>
          <div class="doc-meta">DEP-2026-000389 Â· 20 fÃ©v. 2026</div>
        </div>
        <div class="doc-badge signed">âœ“</div>
        <div class="doc-action"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
      </div>

      <div class="doc-item" onclick="goToDocViewer('dec')">
        <div class="doc-icon blue">ğŸ’¸</div>
        <div class="doc-info">
          <div class="doc-name">ReÃ§u de dÃ©caissement</div>
          <div class="doc-meta">DEC-2026-001547 Â· 28 fÃ©v. 2026</div>
        </div>
        <div class="doc-badge paid">VersÃ©</div>
        <div class="doc-action"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
      </div>

      <div style="height:8px;"></div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 5b : DOCUMENT VIEWER
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen" id="screen-docviewer">
      <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;">
        <button class="topbar-back" onclick="goBack()" style="background:rgba(255,255,255,0.15);">
          <svg viewBox="0 0 24 24" style="stroke:#fff;"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
        <div class="topbar-title" id="docViewerTitle" style="color:#fff;">Document</div>
        <span style="width:36px;"></span>
</div>
      <div style="flex:1;overflow-y:auto;" id="docViewerContent"></div>
      <div class="doc-actions-strip">
        <button class="btn btn-primary" style="flex:1;font-size:0.8rem;padding:10px;" onclick="doPrint()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          TÃ©lÃ©charger PDF
        </button>
        <button class="btn btn-outline" style="flex:1;font-size:0.8rem;padding:10px;" onclick="openSheet('signSheet')">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
          Signer
        </button>
        <button class="btn btn-ghost" style="padding:10px;aspect-ratio:1;" onclick="showToast('PartagÃ© par email !')">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        </button>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 6 : PORTEFEUILLE
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen" id="screen-portefeuille">
      <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;">
        <button onclick="navTo('marche')" style="background:rgba(255,255,255,0.15);border:none;border-radius:10px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff;font-size:1.2rem;flex-shrink:0;margin-right:8px;" title="Retour au marchÃ©">&#8592;</button>
        <div class="topbar-logo">
          <img src="data:image/webp;base64,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" alt="ABAE" style="height:26px;width:auto;object-fit:contain;display:block;">
          <span class="logo-name" style="color:#fff;">Portefeuille</span>
        </div>
        <div style="flex:1;"></div>
        <button class="topbar-icon" style="background:rgba(255,255,255,0.15);">
          <svg viewBox="0 0 24 24" style="stroke:#fff;"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
        </button>
</div>

      <div class="wallet-hero">
        <div class="wallet-balance-label">Solde disponible</div>
        <div class="wallet-balance" id="walletMainBalance">â€” XAF</div>
        <div class="wallet-escrow">En escrow (bloquÃ©) : <span id="walletEscrowBalance">â€” XAF</span></div>
        <div class="wallet-actions">
          <button class="wallet-action-btn" onclick="openSheet('depositSheet')">
            <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
            <span>DÃ©poser</span>
          </button>
          <button class="wallet-action-btn" onclick="openSheet('withdrawSheet')">
            <svg viewBox="0 0 24 24"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
            <span>Retirer</span>
          </button>
          <button class="wallet-action-btn" onclick="openSheet('txSheet')">
            <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            <span>RelevÃ©</span>
          </button>
        </div>
      </div>

      <div class="section-hd"><h2>DerniÃ¨res transactions</h2></div>

      <div class="tx-item">
        <div class="tx-icon out">ğŸ’¸</div>
        <div class="tx-info"><div class="tx-name">Commande BC-001547</div><div class="tx-date">28 fÃ©v. Â· Escrow bloquÃ©</div></div>
        <div><div class="tx-amount out">-345 000</div><div class="tx-comm">Commission: -17 250</div></div>
      </div>
      <div class="tx-item">
        <div class="tx-icon in">ğŸ“±</div>
        <div class="tx-info"><div class="tx-name">DÃ©pÃ´t MTN MoMo</div><div class="tx-date">20 fÃ©v. Â· ConfirmÃ©</div></div>
        <div class="tx-amount in">+200 000</div>
      </div>
      <div class="tx-item">
        <div class="tx-icon in">ğŸ’¼</div>
        <div class="tx-info"><div class="tx-name">Versement BC-001289</div><div class="tx-date">16 fÃ©v. Â· LibÃ©rÃ© par ABAE</div></div>
        <div><div class="tx-amount in">+285 000</div><div class="tx-comm">Comm. -15 000 XAF</div></div>
      </div>
      <div class="tx-item">
        <div class="tx-icon out">ğŸ¦</div>
        <div class="tx-info"><div class="tx-name">Retrait vers MTN MoMo</div><div class="tx-date">14 fÃ©v. Â· VersÃ©</div></div>
        <div class="tx-amount out">-100 000</div>
      </div>

      <div style="height:8px;"></div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         SCREEN 7 : PROFIL
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="screen" id="screen-profil">
      <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;">
        <div style="flex:1;"></div>
        <button class="topbar-icon" style="background:rgba(255,255,255,0.15);" onclick="openSheet('profileEditSheet')">
          <svg viewBox="0 0 24 24" style="stroke:#fff;"><path d="M18 20.75H6a2.25 2.25 0 01-2.25-2.25v-2.5a2.25 2.25 0 012.25-2.25h12a2.25 2.25 0 012.25 2.25v2.5A2.25 2.25 0 0118 20.75z"/><circle cx="12" cy="8" r="3"/></svg>
        </button>
      </div>


      <div class="profile-hero" style="margin-top:-56px;padding-top:72px;">
        <div class="avatar" id="profileHeroAvatar">JP</div>
        <div class="profile-name" id="profileHeroName">Utilisateur ABAE</div>
        <div class="profile-type" id="profileHeroType">Acheteur Â· Cameroun ğŸ‡¨ğŸ‡²</div>
        <div class="profile-badge">âœ… Profil vÃ©rifiÃ© ABAE</div>
      </div>

      <div style="padding:14px 12px;">
        <div class="menu-group">
          <div class="menu-group-title">Mon abonnement</div>
          <div id="subProfileCard" style="background:linear-gradient(135deg,#F7F8F9,#fff);border:1.5px solid #EAECEF;border-radius:14px;padding:14px;margin-bottom:2px;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <div style="display:flex;align-items:center;gap:8px;">
                <div id="subProfileIcon" style="width:36px;height:36px;border-radius:10px;background:#9BA3AE;display:flex;align-items:center;justify-content:center;font-size:1rem;">ğŸŒ±</div>
                <div>
                  <div id="subProfileName" style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:#1A1E25;">Plan Gratuit</div>
                  <div id="subProfileExpiry" style="font-size:0.68rem;color:#9BA3AE;margin-top:1px;">Pas d'expiration</div>
                </div>
              </div>
              <div id="subProfileBadge" style="background:#9BA3AE;color:#fff;font-size:0.6rem;font-weight:700;font-family:'Sora',sans-serif;padding:3px 9px;border-radius:12px;">GRATUIT</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">
              <button onclick="openAboFromDashboard()" style="padding:8px;border-radius:10px;border:1.5px solid #4A9E2A;background:transparent;color:#4A9E2A;font-family:'Sora',sans-serif;font-weight:700;font-size:0.72rem;cursor:pointer;">ğŸ”„ Changer</button>
              <button onclick="openAboFromDashboard()" style="padding:8px;border-radius:10px;border:none;background:linear-gradient(135deg,#4A9E2A,#2A5E10);color:#fff;font-family:'Sora',sans-serif;font-weight:700;font-size:0.72rem;cursor:pointer;">â¬†ï¸ Renouveler</button>
            </div>
          </div>
        </div>

        <div class="menu-group">
          <div class="menu-group-title">Mon compte</div>
          <div class="menu-item" onclick="openSheet('profileEditSheet')">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
            <div class="menu-info"><h4>Informations personnelles</h4><p>Nom, tÃ©lÃ©phone, email, pays</p></div>
            <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
          <div class="menu-item" onclick="navTo('portefeuille')">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg></div>
            <div class="menu-info"><h4>Portefeuille ABAE</h4><p>Solde : 125 000 XAF</p></div>
            <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>

        <!-- Mes Gains -->
        <div class="menu-group" id="mesGainsGroup">
          <div class="menu-group-title">ğŸ’° Mes Gains & Revenus</div>
          <div class="gains-stat-grid">
            <div class="gains-stat-card">
              <div class="gains-stat-val" id="gainsTotalVal">47 500</div>
              <div class="gains-stat-label">XAF gagnÃ©s (30j)</div>
            </div>
            <div class="gains-stat-card">
              <div class="gains-stat-val" id="gainsOffresVal">3</div>
              <div class="gains-stat-label">Offres actives</div>
            </div>
            <div class="gains-stat-card">
              <div class="gains-stat-val" id="gainsCommandesVal">7</div>
              <div class="gains-stat-label">Commandes livrÃ©es</div>
            </div>
            <div class="gains-stat-card">
              <div class="gains-stat-val" id="gainsNoteVal">4.8 â˜…</div>
              <div class="gains-stat-label">Note vendeur</div>
            </div>
          </div>
        </div>

        <div class="menu-group">
          <div class="menu-group-title">Plateforme</div>
          <div class="menu-item" onclick="openSheet('howSheet')">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
            <div class="menu-info"><h4>Comment Ã§a marche</h4><p>Escrow, commissions, sÃ©curitÃ©</p></div>
            <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
          <div class="menu-item" onclick="openSheet('affiliationSheet')">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
            <div class="menu-info"><h4>Programme d'affiliation</h4><p>Invitez, gagnez des commissions</p></div>
            <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
          <div class="menu-item" onclick="openSheet('supportSheet')">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></div>
            <div class="menu-info"><h4>Support ABAE</h4><p>WhatsApp Â· 7j/7</p></div>
            <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
          <div class="menu-item" onclick="openSheet('diffSheet')" style="border-left:3px solid #E53E3E;padding-left:11px;">
            <div class="menu-icon" style="color:#E53E3E;">ğŸ†˜</div>
            <div class="menu-info"><h4 style="color:#E53E3E;">J'ai un problÃ¨me</h4><p>RÃ©solution rapide Â· IA + Ã©quipe ABAE</p></div>
            <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>

        <button class="btn btn-ghost btn-block" style="margin:4px 0;color:var(--err);border:1.5px solid rgba(192,57,43,0.2);background:rgba(192,57,43,0.05);" onclick="deconnexion()">Se dÃ©connecter</button>
      </div>
    </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SCREEN 8 : ABAE SMART â€” Tableau de bord IA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-smart" style="flex-direction:column;">
    <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;flex-shrink:0;">
      <div class="topbar-logo">
        <span style="font-size:1.6rem;line-height:1;filter:hue-rotate(300deg) saturate(2);">ğŸ§ </span>
        <span class="logo-name" style="color:#fff;">ABAE Smart IA</span>
      </div>
      <div style="flex:1;"></div>
      <div class="certified-badge" id="certifiedBadgeHeader">ğŸ… IA CertifiÃ©</div>
    </div>
    <div style="overflow-y:auto;flex:1;">
    <!-- Hero Smart -->
    <div class="smart-hero">
      <div class="smart-hero-title">ğŸ§  ABAE Smart</div>
      <div class="smart-hero-sub">Intelligence artificielle agro-pastorale Â· Votre avantage concurrentiel</div>
      <div class="smart-plan-pill" id="smartPlanPill">âœ¨ Plan Pro Â· IA AvancÃ©e</div>
    </div>

    <!-- CrÃ©dits IA -->
    <div class="ia-credits-bar">
      <div class="ia-credits-icon">âš¡</div>
      <div class="ia-credits-info">
        <div class="ia-credits-label">CrÃ©dits IA disponibles ce mois</div>
        <div class="ia-credits-val" id="smartCreditsVal">47 / 100 crÃ©dits utilisÃ©s</div>
        <div class="ia-credits-track"><div class="ia-credits-fill" id="smartCreditsBar" style="width:47%;"></div></div>
      </div>
      <button class="ai-mini-btn gold-btn" onclick="openSheet('creditsSheet')">Recharger</button>
    </div>

    <!-- Stats rÃ©sumÃ© -->
    <div class="smart-section-title">ğŸ“Š RÃ©sumÃ© Performances <span>Ce mois</span></div>
    <div class="smart-stats">
      <div class="smart-stat-card">
        <div class="smart-stat-icon">ğŸ’°</div>
        <div class="smart-stat-val">+12%</div>
        <div class="smart-stat-lbl">RentabilitÃ© estimÃ©e</div>
      </div>
      <div class="smart-stat-card">
        <div class="smart-stat-icon">ğŸ¯</div>
        <div class="smart-stat-val" id="smartAnalysisCount">8</div>
        <div class="smart-stat-lbl">Analyses IA rÃ©alisÃ©es</div>
      </div>
      <div class="smart-stat-card">
        <div class="smart-stat-icon">â­</div>
        <div class="smart-stat-val">92/100</div>
        <div class="smart-stat-lbl">Score fiabilitÃ©</div>
      </div>
      <div class="smart-stat-card">
        <div class="smart-stat-icon">ğŸ”</div>
        <div class="smart-stat-val">3</div>
        <div class="smart-stat-lbl">OpportunitÃ©s dÃ©tectÃ©es</div>
      </div>
    </div>

    <!-- Alertes MarchÃ© -->
    <!-- â•â• PANEL PRIX DU MARCHÃ‰ â•â• -->
    <div class="smart-section-title">ğŸ“ˆ Prix du MarchÃ© <span id="priceLastUpdate">Chargement...</span></div>
    <div class="market-price-panel" id="marketPricePanel">
      <div class="market-price-header">
        <div class="market-price-header-title">
          <div class="live-dot"></div>
          Cotations en temps rÃ©el Â· XAF
        </div>
        <button onclick="refreshMarketPrices()" style="background:rgba(255,255,255,0.15);border:none;color:#fff;font-size:0.62rem;font-family:'Sora',sans-serif;font-weight:700;padding:4px 10px;border-radius:20px;cursor:pointer;">â†» Actualiser</button>
      </div>
      <div id="marketPriceRows">
        <!-- Rempli dynamiquement -->
        <div style="padding:16px;text-align:center;"><div class="price-loading" style="width:80%;margin:0 auto 8px;"></div><div class="price-loading" style="width:60%;margin:0 auto;"></div></div>
      </div>
    </div>

    <div class="smart-section-title">ğŸš¨ Alertes MarchÃ© IA <span>Mis Ã  jour aujourd'hui</span></div>
    <div style="padding:0 12px;">
      <div class="market-alert up">
        <div class="market-alert-icon">ğŸ“ˆ</div>
        <div>
          <div class="market-alert-title">MaÃ¯s blanc â€” Hausse dÃ©tectÃ©e +18%</div>
          <div class="market-alert-desc">Prix prÃ©vu Ã  la hausse d'ici 2 semaines. Achetez maintenant ou attendez la prochaine rÃ©colte selon votre stratÃ©gie.</div>
        </div>
      </div>
      <div class="market-alert down">
        <div class="market-alert-icon">ğŸ“‰</div>
        <div>
          <div class="market-alert-title">Transport Douala â€” PÃ©nurie dÃ©tectÃ©e</div>
          <div class="market-alert-desc">Forte demande de camions frigorifiques. RÃ©servez en avance pour garantir votre approvisionnement.</div>
        </div>
      </div>
      <div class="market-alert neutral">
        <div class="market-alert-icon">ğŸ’¡</div>
        <div>
          <div class="market-alert-title">Cacao grade A â€” 3 acheteurs identifiÃ©s</div>
          <div class="market-alert-desc">L'IA a trouvÃ© des acheteurs potentiels correspondant Ã  votre profil vendeur. Consultez les matchings.</div>
        </div>
      </div>
    </div>

    <!-- Modules IA -->
    <div class="smart-section-title">ğŸ”§ Modules IA Disponibles</div>

    <div class="ai-feature-card" onclick="navTo('marche')">
      <div class="ai-feature-card-icon green">ğŸ›’</div>
      <div class="ai-feature-card-body">
        <div class="ai-feature-card-title">IA Marketplace</div>
        <div class="ai-feature-card-desc">Estimation prix intelligente Â· Matching acheteur/vendeur Â· Score fiabilitÃ© Â· DÃ©tection offres suspectes Â· PrÃ©vision demande</div>
        <div class="ai-feature-card-action"><button class="ai-mini-btn" onclick="event.stopPropagation();navTo('marche')">Ouvrir â†’</button></div>
      </div>
    </div>

    <div class="ai-feature-card" onclick="openSheet('aiLogisticsSheet')">
      <div class="ai-feature-card-icon blue">ğŸš›</div>
      <div class="ai-feature-card-body">
        <div class="ai-feature-card-title">IA Logistique</div>
        <div class="ai-feature-card-desc">Optimisation des trajets Â· Estimation dÃ©lais Â· Calcul coÃ»ts intelligents Â· Regroupement de cargaisons</div>
        <div class="ai-feature-card-action"><button class="ai-mini-btn" onclick="event.stopPropagation();openSheet('aiLogisticsSheet')">Analyser â†’</button></div>
      </div>
    </div>

    <div class="ai-feature-card" onclick="openSheet('aiFinanceSheet')">
      <div class="ai-feature-card-icon gold">ğŸ’°</div>
      <div class="ai-feature-card-body">
        <div class="ai-feature-card-title">IA Finance & Assurance</div>
        <div class="ai-feature-card-desc">Scoring crÃ©dit agricole Â· Simulation financement Â· Analyse rentabilitÃ© Â· DÃ©tection risque assurance</div>
        <div class="ai-feature-card-action"><button class="ai-mini-btn" onclick="event.stopPropagation();openSheet('aiFinanceSheet')">Simuler â†’</button></div>
      </div>
    </div>

    <div class="ai-feature-card" onclick="openSheet('aiAgriSheet')">
      <div class="ai-feature-card-icon" style="background:#F0FFF4;">ğŸŒ¾</div>
      <div class="ai-feature-card-body">
        <div class="ai-feature-card-title">IA Services Agricoles</div>
        <div class="ai-feature-card-desc">PrÃ©vision rendement Â· Recommandation intrants Â· Analyse mÃ©tÃ©o simplifiÃ©e Â· Planification rÃ©colte intelligente</div>
        <div class="ai-feature-card-action"><button class="ai-mini-btn" onclick="event.stopPropagation();openSheet('aiAgriSheet')">Planifier â†’</button></div>
      </div>
    </div>

    <!-- MODULE RH AGRIBUSINESS -->
    <div class="smart-section-title">ğŸ’¼ Services Premium ABAE <span style="background:#D4A843;color:#fff;padding:2px 8px;border-radius:10px;font-size:0.6rem;">MONÃ‰TISÃ‰</span></div>

    <div class="ai-feature-card" onclick="openSheet('aiHRSheet')" style="border:1.5px solid rgba(212,168,67,0.35);background:linear-gradient(135deg,#FFFBF0,#fff);">
      <div class="ai-feature-card-icon" style="background:linear-gradient(135deg,#FFF3CD,#FFE69C);">ğŸ§‘â€ğŸ’¼</div>
      <div class="ai-feature-card-body">
        <div class="ai-feature-card-title" style="color:#7A5A00;">RH Agribusiness IA</div>
        <div class="ai-feature-card-desc">Recrutement Â· Fiches de poste Â· Grilles salariales Â· Contrats Â· Ã‰valuation Â· Formation â€” Gestion complÃ¨te des ressources humaines du secteur agro-pastoral</div>
        <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
          <span style="background:#FFF3CD;color:#7A5A00;font-size:0.6rem;font-weight:700;padding:2px 8px;border-radius:10px;border:1px solid rgba(212,168,67,0.4);">Ã€ partir de 5 000 XAF</span>
          <span style="background:#EDF7E5;color:#4A9E2A;font-size:0.6rem;font-weight:700;padding:2px 8px;border-radius:10px;">IA Powered</span>
        </div>
        <div class="ai-feature-card-action"><button class="ai-mini-btn gold-btn" onclick="event.stopPropagation();openSheet('aiHRSheet')">AccÃ©der â†’</button></div>
      </div>
    </div>

    <!-- MODULE MONTAGE DE PROJETS -->
    <div class="ai-feature-card" onclick="openSheet('aiProjectSheet')" style="border:1.5px solid rgba(212,168,67,0.35);background:linear-gradient(135deg,#FFFBF0,#fff);">
      <div class="ai-feature-card-icon" style="background:linear-gradient(135deg,#FFF3CD,#FFE69C);">ğŸ“‹</div>
      <div class="ai-feature-card-body">
        <div class="ai-feature-card-title" style="color:#7A5A00;">Montage de Projets IA</div>
        <div class="ai-feature-card-desc">Business plan Â· Budget prÃ©visionnel Â· Pitch deck Â· Dossier financement Â· Recherche partenaires â€” De l'idÃ©e au projet finanÃ§able en quelques minutes</div>
        <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
          <span style="background:#FFF3CD;color:#7A5A00;font-size:0.6rem;font-weight:700;padding:2px 8px;border-radius:10px;border:1px solid rgba(212,168,67,0.4);">Ã€ partir de 10 000 XAF</span>
          <span style="background:#EDF7E5;color:#4A9E2A;font-size:0.6rem;font-weight:700;padding:2px 8px;border-radius:10px;">IA Powered</span>
        </div>
        <div class="ai-feature-card-action"><button class="ai-mini-btn gold-btn" onclick="event.stopPropagation();openSheet('aiProjectSheet')">Lancer â†’</button></div>
      </div>
    </div>

    <div style="height:80px;"></div>
    </div><!-- /scroll -->
  </div><!-- /screen-smart -->

  <!-- â•â•â• SCREEN : PARAMÃˆTRES â•â•â• -->
  <div class="screen" id="screen-parametres">
    <div class="topbar" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-bottom-color:transparent;">
      <div class="topbar-logo">
        <div class="logo-mark" style="background:rgba(255,255,255,0.2);"><span style="color:#fff;">âš™</span></div>
        <span class="logo-name" style="color:#fff;">ParamÃ¨tres</span>
      </div>
    </div>
    <div style="padding:14px 12px;overflow-y:auto;flex:1;">

      <!-- Compte -->
      <div class="menu-group">
        <div class="menu-group-title">ğŸ‘¤ Compte</div>
        <div class="menu-item" onclick="openSheet('profileEditSheet')">
          <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
          <div class="menu-info"><h4>Informations personnelles</h4><p>Nom, tÃ©lÃ©phone, email, pays</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
        <div class="menu-item">
          <div class="menu-icon"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg></div>
          <div class="menu-info"><h4>SÃ©curitÃ© & Mot de passe</h4><p>Changer le mot de passe, 2FA</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
        <div class="menu-item">
          <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6A19.79 19.79 0 012.12 4.18 2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></div>
          <div class="menu-info"><h4>NumÃ©ro de tÃ©lÃ©phone</h4><p>+237 6XX XXX XXX</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
      </div>

      <!-- Apparence -->
      <div class="menu-group" id="theme-menu-group">
        <div class="menu-group-title">ğŸ¨ Apparence</div>
        <div class="menu-item" style="flex-direction:column;align-items:flex-start;gap:12px;padding:14px 16px;">
          <div style="display:flex;align-items:center;gap:10px;width:100%;">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg></div>
            <div class="menu-info"><h4>ThÃ¨me de l'interface</h4><p>Choisissez votre apparence</p></div>
          </div>
          <div style="display:flex;gap:10px;width:100%;padding:0 0 2px;">
            <button class="theme-btn active" id="theme-btn-light" onclick="setTheme('light')"
              style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;padding:10px 6px;border-radius:12px;border:2px solid var(--vp);background:rgba(74,158,42,0.08);cursor:pointer;transition:all .2s;">
              <div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#F2F4F2,#FFFFFF);border:1.5px solid #DDE0DC;"></div>
              <span style="font-size:0.68rem;font-weight:700;color:var(--vp);font-family:'Sora',sans-serif;">Clair</span>
            </button>
            <button class="theme-btn" id="theme-btn-dark" onclick="setTheme('dark')"
              style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;padding:10px 6px;border-radius:12px;border:2px solid var(--g200);background:transparent;cursor:pointer;transition:all .2s;">
              <div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#0D0F0D,#1A1C1A);border:1.5px solid #2E302E;"></div>
              <span style="font-size:0.68rem;font-weight:700;color:var(--g600);font-family:'Sora',sans-serif;">Sombre</span>
            </button>
            <button class="theme-btn" id="theme-btn-blue" onclick="setTheme('blue')"
              style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;padding:10px 6px;border-radius:12px;border:2px solid var(--g200);background:transparent;cursor:pointer;transition:all .2s;">
              <div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#1E2C3A,#2C3E50);border:1.5px solid #384D62;"></div>
              <span style="font-size:0.68rem;font-weight:700;color:var(--g600);font-family:'Sora',sans-serif;">Bleu</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Notifications -->
      <div class="menu-group">
        <div class="menu-group-title">ğŸ”” Notifications</div>
        <div class="menu-item" style="justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div>
            <div class="menu-info"><h4>Notifications push</h4><p>Commandes, messages, offres</p></div>
          </div>
          <label style="position:relative;display:inline-block;width:42px;height:24px;flex-shrink:0;">
            <input type="checkbox" checked style="opacity:0;width:0;height:0;" onchange="this.parentNode.querySelector('span').style.background=this.checked?'var(--vp)':'#ccc';this.parentNode.querySelector('span::before')">
            <span id="toggle-notif" style="position:absolute;cursor:pointer;inset:0;background:var(--vp);border-radius:24px;transition:.3s;"><span style="position:absolute;left:3px;top:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:.3s;display:block;"></span></span>
          </label>
        </div>
        <div class="menu-item" style="justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
            <div class="menu-info"><h4>Notifications email</h4><p>RÃ©sumÃ©s hebdomadaires</p></div>
          </div>
          <label style="position:relative;display:inline-block;width:42px;height:24px;flex-shrink:0;">
            <input type="checkbox" style="opacity:0;width:0;height:0;">
            <span style="position:absolute;cursor:pointer;inset:0;background:#ccc;border-radius:24px;transition:.3s;"><span style="position:absolute;left:3px;top:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:.3s;display:block;"></span></span>
          </label>
        </div>
        <div class="menu-item" style="justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <div class="menu-icon">ğŸ“£</div>
            <div class="menu-info"><h4>Alertes boosts</h4><p>Boost expirÃ©, renouvellement</p></div>
          </div>
          <label style="position:relative;display:inline-block;width:42px;height:24px;flex-shrink:0;">
            <input type="checkbox" checked style="opacity:0;width:0;height:0;">
            <span style="position:absolute;cursor:pointer;inset:0;background:var(--vp);border-radius:24px;transition:.3s;"><span style="position:absolute;left:3px;top:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:.3s;display:block;"></span></span>
          </label>
        </div>
      </div>

      <!-- Langue & RÃ©gion -->
      <div class="menu-group">
        <div class="menu-group-title">ğŸŒ Langue & RÃ©gion</div>
        <div class="menu-item">
          <div class="menu-icon">ğŸ—£ï¸</div>
          <div class="menu-info"><h4>Langue</h4><p>FranÃ§ais</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
        <div class="menu-item">
          <div class="menu-icon">ğŸ’±</div>
          <div class="menu-info"><h4>Devise</h4><p>XAF â€” Franc CFA</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
        <div class="menu-item">
          <div class="menu-icon">ğŸ“</div>
          <div class="menu-info"><h4>Pays / RÃ©gion</h4><p id="profileMenuPays">Cameroun ğŸ‡¨ğŸ‡²</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
      </div>

      <!-- ConfidentialitÃ© -->
      <div class="menu-group">
        <div class="menu-group-title">ğŸ”’ ConfidentialitÃ©</div>
        <div class="menu-item" onclick="openSheet('privacySheet')">
          <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
          <div class="menu-info"><h4>Politique de confidentialitÃ©</h4><p>Comment ABAE utilise vos donnÃ©es</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
        <div class="menu-item" onclick="openSheet('cguSheet')">
          <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
          <div class="menu-info"><h4>Conditions d'utilisation</h4><p>RÃ¨gles de la plateforme ABAE</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
        <div class="menu-item">
          <div class="menu-icon"><svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"/></svg></div>
          <div class="menu-info"><h4 style="color:var(--err);">Supprimer mon compte</h4><p>Action irrÃ©versible</p></div>
          <div class="menu-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
        </div>
      </div>

      <!-- Version -->
      <div style="text-align:center;padding:20px 0 80px;color:#9BA3AE;font-size:0.72rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.8rem;color:var(--vp);margin-bottom:4px;">ABAE AI v17</div>
        Version 17.0.0 Â· Â© 2025 ABAE Platform<br>
        <span style="font-size:0.65rem;">Agro-Pastorale Intelligence Â· YaoundÃ©, Cameroun</span>
      </div>
    </div>
  </div><!-- /screen-parametres -->

  </div><!-- /screens -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET : POLITIQUE DE CONFIDENTIALITÃ‰
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="privacySheet" style="max-height:94%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ”’ Politique de ConfidentialitÃ©</div>
      <button class="sheet-close" onclick="closeSheet('privacySheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="overflow-y:auto;padding-bottom:40px;">

      <!-- En-tÃªte -->
      <div style="background:linear-gradient(135deg,#1D5C2E,#4A9E2A);border-radius:14px;padding:16px;margin-bottom:18px;color:#fff;">
        <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:1rem;margin-bottom:4px;">ABAE â€” Politique de ConfidentialitÃ©</div>
        <div style="font-size:0.72rem;opacity:0.85;line-height:1.5;">DerniÃ¨re mise Ã  jour : 1er mars 2026 Â· Version 1.0<br>Applicable Ã  tous les utilisateurs de la plateforme ABAE</div>
      </div>

      <!-- Introduction -->
      <div style="background:rgba(74,158,42,0.06);border:1px solid rgba(74,158,42,0.2);border-radius:12px;padding:14px;margin-bottom:14px;font-size:0.8rem;color:#2A5E10;line-height:1.65;">
        La sociÃ©tÃ© <strong>ABAE</strong> (Agro-Business Africa Entreprise), opÃ©rateur de la plateforme marketplace agro-pastorale intelligente, s'engage Ã  protÃ©ger la vie privÃ©e de ses utilisateurs. La prÃ©sente Politique de ConfidentialitÃ© dÃ©crit la nature des donnÃ©es collectÃ©es, leur utilisation, leur protection et vos droits.
      </div>

      <!-- Art. 1 -->
      <div class="cgu-section">
        <div class="cgu-section-hd open" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">1</span>
          <span class="cgu-section-ttl">Responsable du Traitement</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd open">
          <p>Le responsable du traitement de vos donnÃ©es personnelles est :</p>
          <div class="cgu-highlight">
            <strong>ABAE â€” Agro-Business Africa Entreprise</strong><br>
            SiÃ¨ge social : YaoundÃ©, Cameroun<br>
            Email : <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="08787a617e696b7148696a696d26696e7a616b69">[email&#160;protected]</a><br>
            Plateforme : abae.africa
          </div>
          <p>Toute question relative Ã  vos donnÃ©es peut Ãªtre adressÃ©e Ã  notre DÃ©lÃ©guÃ© Ã  la Protection des DonnÃ©es (DPD) Ã  l'adresse ci-dessus.</p>
        </div>
      </div>

      <!-- Art. 2 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">2</span>
          <span class="cgu-section-ttl">DonnÃ©es CollectÃ©es</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>2.1 DonnÃ©es d'identification</strong></p>
          <ul>
            <li>Nom complet, prÃ©nom, date de naissance</li>
            <li>Adresse email et numÃ©ro de tÃ©lÃ©phone</li>
            <li>Photo de profil (optionnelle)</li>
            <li>Type de profil (Vendeur, Acheteur, Transporteur, Partenaire)</li>
          </ul>
          <p><strong>2.2 DonnÃ©es commerciales</strong></p>
          <ul>
            <li>Annonces publiÃ©es, produits et services proposÃ©s</li>
            <li>Historique des transactions et commandes</li>
            <li>Ã‰valuations et avis reÃ§us ou laissÃ©s</li>
            <li>DonnÃ©es de portefeuille numÃ©rique et opÃ©rations financiÃ¨res</li>
          </ul>
          <p><strong>2.3 DonnÃ©es techniques</strong></p>
          <ul>
            <li>Adresse IP, type d'appareil et version du systÃ¨me</li>
            <li>DonnÃ©es de localisation (ville, rÃ©gion â€” avec votre consentement)</li>
            <li>Logs de connexion et d'activitÃ© sur la plateforme</li>
            <li>PrÃ©fÃ©rences et paramÃ¨tres enregistrÃ©s</li>
          </ul>
          <p><strong>2.4 DonnÃ©es financiÃ¨res</strong></p>
          <ul>
            <li>NumÃ©ro de compte Mobile Money (MTN / Orange) â€” chiffrÃ©</li>
            <li>CoordonnÃ©es bancaires pour les virements â€” chiffrÃ©es</li>
            <li>Montants des transactions (non transmis aux tiers)</li>
          </ul>
        </div>
      </div>

      <!-- Art. 3 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">3</span>
          <span class="cgu-section-ttl">FinalitÃ©s du Traitement</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE collecte et traite vos donnÃ©es pour les finalitÃ©s suivantes :</p>
          <ul>
            <li><strong>Gestion de votre compte</strong> â€” crÃ©ation, authentification, sÃ©curisation</li>
            <li><strong>ExÃ©cution des transactions</strong> â€” commandes, paiements, escrow, livraison</li>
            <li><strong>Mise en relation</strong> â€” matching acheteurs/vendeurs/transporteurs via IA</li>
            <li><strong>ConformitÃ© rÃ©glementaire</strong> â€” lutte anti-blanchiment (LAB), KYC, obligations fiscales camerounaises</li>
            <li><strong>Service client</strong> â€” rÃ©solution de litiges, support technique</li>
            <li><strong>AmÃ©lioration de la plateforme</strong> â€” analyses statistiques anonymisÃ©es</li>
            <li><strong>Communication</strong> â€” notifications transactionnelles, alertes marchÃ© (avec consentement)</li>
          </ul>
          <div class="cgu-warn">
            ABAE ne vend jamais vos donnÃ©es personnelles Ã  des tiers Ã  des fins commerciales.
          </div>
        </div>
      </div>

      <!-- Art. 4 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">4</span>
          <span class="cgu-section-ttl">Base LÃ©gale du Traitement</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Le traitement de vos donnÃ©es repose sur les bases lÃ©gales suivantes :</p>
          <ul>
            <li><strong>ExÃ©cution du contrat</strong> â€” nÃ©cessaire Ã  la fourniture des services ABAE</li>
            <li><strong>Obligation lÃ©gale</strong> â€” conformitÃ© aux lois camerounaises (Loi nÂ°2010/012 sur la cybersÃ©curitÃ©, rÃ©glementations BEAC / COBAC)</li>
            <li><strong>Consentement</strong> â€” pour les communications marketing et la gÃ©olocalisation</li>
            <li><strong>IntÃ©rÃªt lÃ©gitime</strong> â€” prÃ©vention des fraudes, amÃ©lioration des services</li>
          </ul>
        </div>
      </div>

      <!-- Art. 5 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">5</span>
          <span class="cgu-section-ttl">Partage des DonnÃ©es</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Vos donnÃ©es peuvent Ãªtre partagÃ©es uniquement avec :</p>
          <ul>
            <li><strong>Partenaires de paiement</strong> â€” MTN Mobile Money, Orange Money, Ã©tablissements bancaires (uniquement les donnÃ©es nÃ©cessaires Ã  la transaction)</li>
            <li><strong>AutoritÃ©s compÃ©tentes</strong> â€” sur rÃ©quisition judiciaire ou lÃ©gale</li>
            <li><strong>Prestataires techniques</strong> â€” hÃ©bergement, sÃ©curitÃ© (soumis Ã  des obligations contractuelles strictes de confidentialitÃ©)</li>
            <li><strong>Autres utilisateurs ABAE</strong> â€” uniquement les informations de votre profil public (nom, localisation, catÃ©gorie)</li>
          </ul>
          <p>Vos numÃ©ros de Mobile Money, coordonnÃ©es bancaires et donnÃ©es financiÃ¨res ne sont jamais transmis Ã  d'autres utilisateurs.</p>
        </div>
      </div>

      <!-- Art. 6 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">6</span>
          <span class="cgu-section-ttl">SÃ©curitÃ© des DonnÃ©es</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE met en Å“uvre des mesures techniques et organisationnelles appropriÃ©es pour protÃ©ger vos donnÃ©es :</p>
          <ul>
            <li>Chiffrement des donnÃ©es sensibles (SSL/TLS, AES-256)</li>
            <li>SystÃ¨me d'escrow sÃ©curisÃ© pour tous les paiements</li>
            <li>Authentification renforcÃ©e (code OTP Ã  usage unique)</li>
            <li>Surveillance continue et dÃ©tection des intrusions</li>
            <li>AccÃ¨s limitÃ© aux donnÃ©es par le personnel autorisÃ© uniquement</li>
            <li>Sauvegardes rÃ©guliÃ¨res et plan de continuitÃ© d'activitÃ©</li>
          </ul>
          <div class="cgu-warn">
            En cas de violation de donnÃ©es susceptible d'affecter vos droits, ABAE vous en informera dans un dÃ©lai de 72 heures.
          </div>
        </div>
      </div>

      <!-- Art. 7 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">7</span>
          <span class="cgu-section-ttl">Conservation des DonnÃ©es</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <ul>
            <li><strong>DonnÃ©es de compte actif</strong> â€” conservÃ©es pendant toute la durÃ©e d'utilisation</li>
            <li><strong>DonnÃ©es de transactions</strong> â€” 10 ans (obligation lÃ©gale et fiscale)</li>
            <li><strong>DonnÃ©es de connexion</strong> â€” 12 mois</li>
            <li><strong>AprÃ¨s suppression du compte</strong> â€” anonymisation sous 30 jours, donnÃ©es financiÃ¨res conservÃ©es 10 ans</li>
          </ul>
        </div>
      </div>

      <!-- Art. 8 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">8</span>
          <span class="cgu-section-ttl">Vos Droits</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ConformÃ©ment Ã  la lÃ©gislation applicable, vous disposez des droits suivants :</p>
          <ul>
            <li><strong>Droit d'accÃ¨s</strong> â€” consulter toutes les donnÃ©es vous concernant</li>
            <li><strong>Droit de rectification</strong> â€” corriger des donnÃ©es inexactes</li>
            <li><strong>Droit Ã  l'effacement</strong> â€” demander la suppression de votre compte et donnÃ©es</li>
            <li><strong>Droit d'opposition</strong> â€” vous opposer au traitement Ã  des fins marketing</li>
            <li><strong>Droit Ã  la portabilitÃ©</strong> â€” recevoir vos donnÃ©es dans un format structurÃ©</li>
            <li><strong>Droit de retirer votre consentement</strong> â€” Ã  tout moment, sans effet rÃ©troactif</li>
          </ul>
          <div class="cgu-highlight">
            <strong>Pour exercer vos droits :</strong><br>
            Rendez-vous dans ParamÃ¨tres â†’ Mon Profil â†’ ou Ã©crivez Ã  <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="58282a312e393b2118393a393d76393e2a313b39">[email&#160;protected]</a><br>
            DÃ©lai de rÃ©ponse : 30 jours maximum.
          </div>
        </div>
      </div>

      <!-- Art. 9 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">9</span>
          <span class="cgu-section-ttl">Cookies et Technologies Similaires</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE utilise le stockage local (localStorage) pour :</p>
          <ul>
            <li>Maintenir votre session de connexion</li>
            <li>MÃ©moriser vos prÃ©fÃ©rences d'affichage</li>
            <li>Stocker temporairement votre panier et brouillons</li>
          </ul>
          <p>Ces donnÃ©es restent sur votre appareil et ne sont pas transmises Ã  des tiers. Vous pouvez les effacer en vidant le cache de votre navigateur ou en supprimant l'application.</p>
        </div>
      </div>

      <!-- Art. 10 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">10</span>
          <span class="cgu-section-ttl">Modifications de la Politique</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE se rÃ©serve le droit de modifier la prÃ©sente Politique de ConfidentialitÃ© Ã  tout moment. En cas de modification substantielle, vous serez notifiÃ© par :</p>
          <ul>
            <li>Une notification dans l'application</li>
            <li>Un email Ã  l'adresse enregistrÃ©e sur votre compte</li>
          </ul>
          <p>La poursuite de l'utilisation de la plateforme aprÃ¨s notification vaut acceptation des modifications.</p>
        </div>
      </div>

      <!-- Pied de page -->
      <div style="margin-top:20px;padding:14px;background:var(--g100);border-radius:12px;text-align:center;font-size:0.72rem;color:var(--g400);line-height:1.7;">
        Â© 2026 ABAE â€” Agro-Business Africa Entreprise Â· YaoundÃ©, Cameroun<br>
        <span style="color:var(--vp);font-weight:700;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fe8e8c97889f9d87be9f9c9f9bd09f988c979d9f">[email&#160;protected]</a></span> Â· abae.africa
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET : CONDITIONS GÃ‰NÃ‰RALES D'UTILISATION (CGU)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="cguSheet" style="max-height:94%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ“‹ Conditions GÃ©nÃ©rales d'Utilisation</div>
      <button class="sheet-close" onclick="closeSheet('cguSheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="overflow-y:auto;padding-bottom:40px;">

      <!-- En-tÃªte -->
      <div style="background:linear-gradient(135deg,#1D5C2E,#4A9E2A);border-radius:14px;padding:16px;margin-bottom:18px;color:#fff;">
        <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:1rem;margin-bottom:4px;">ABAE â€” Conditions GÃ©nÃ©rales d'Utilisation</div>
        <div style="font-size:0.72rem;opacity:0.85;line-height:1.5;">DerniÃ¨re mise Ã  jour : 1er mars 2026 Â· Version 1.0<br>En utilisant ABAE, vous acceptez les prÃ©sentes conditions dans leur intÃ©gralitÃ©.</div>
      </div>

      <!-- Introduction -->
      <div style="background:rgba(74,158,42,0.06);border:1px solid rgba(74,158,42,0.2);border-radius:12px;padding:14px;margin-bottom:14px;font-size:0.8rem;color:#2A5E10;line-height:1.65;">
        Les prÃ©sentes Conditions GÃ©nÃ©rales d'Utilisation (CGU) rÃ©gissent l'accÃ¨s et l'utilisation de la plateforme ABAE, marketplace agro-pastorale intelligente disponible sur application mobile et web. Elles constituent un contrat juridiquement contraignant entre ABAE et tout utilisateur inscrit.
      </div>

      <!-- Art. 1 -->
      <div class="cgu-section">
        <div class="cgu-section-hd open" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">1</span>
          <span class="cgu-section-ttl">PrÃ©sentation de la Plateforme</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd open">
          <p>ABAE est une marketplace numÃ©rique dÃ©diÃ©e au secteur agro-pastoral en Afrique centrale. La plateforme met en relation :</p>
          <ul>
            <li><strong>Vendeurs</strong> â€” agriculteurs, Ã©leveurs, transformateurs, coopÃ©ratives</li>
            <li><strong>Acheteurs</strong> â€” particuliers, entreprises, exportateurs</li>
            <li><strong>Transporteurs</strong> â€” prestataires de logistique et de fret</li>
            <li><strong>Partenaires</strong> â€” fournisseurs d'intrants, conseillers, organismes financiers</li>
          </ul>
          <p>ABAE fournit en outre des services Ã  valeur ajoutÃ©e : paiement sÃ©curisÃ© par escrow, intelligence artificielle, documents PDF automatisÃ©s, simulation de financement et alertes marchÃ©.</p>
        </div>
      </div>

      <!-- Art. 2 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">2</span>
          <span class="cgu-section-ttl">Inscription et Compte Utilisateur</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>2.1 Conditions d'accÃ¨s</strong><br>L'utilisation des services ABAE est rÃ©servÃ©e aux personnes physiques majeures (18 ans ou plus) ou aux personnes morales lÃ©galement constituÃ©es.</p>
          <p><strong>2.2 CrÃ©ation du compte</strong><br>L'inscription requiert la fourniture d'informations exactes, complÃ¨tes et Ã  jour. L'utilisateur s'engage Ã  les maintenir actualisÃ©es.</p>
          <p><strong>2.3 SÃ©curitÃ© du compte</strong><br>L'utilisateur est seul responsable de la confidentialitÃ© de ses identifiants. Tout accÃ¨s rÃ©alisÃ© depuis son compte lui est imputable. En cas de compromission, il doit contacter immÃ©diatement ABAE.</p>
          <p><strong>2.4 Un compte par personne</strong><br>La crÃ©ation de plusieurs comptes pour une mÃªme personne est interdite sauf autorisation expresse d'ABAE.</p>
        </div>
      </div>

      <!-- Art. 3 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">3</span>
          <span class="cgu-section-ttl">RÃ¨gles de Publication des Annonces</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>3.1 Obligations du vendeur</strong></p>
          <ul>
            <li>DÃ©crire honnÃªtement le produit ou service proposÃ©</li>
            <li>Indiquer un prix rÃ©el et dÃ©finitif (hors nÃ©gociation clairement indiquÃ©e)</li>
            <li>Disposer lÃ©galement du bien ou du service mis en vente</li>
            <li>Respecter les rÃ©glementations en vigueur (phytosanitaire, vÃ©tÃ©rinaire, douaniÃ¨re)</li>
          </ul>
          <p><strong>3.2 Contenus interdits</strong></p>
          <ul>
            <li>Produits contrefaits, volÃ©s ou illicites</li>
            <li>Substances vÃ©tÃ©rinaires ou phytosanitaires non homologuÃ©es</li>
            <li>EspÃ¨ces animales ou vÃ©gÃ©tales protÃ©gÃ©es</li>
            <li>Annonces frauduleuses ou trompeuses</li>
            <li>Contenus Ã  caractÃ¨re offensant, discriminatoire ou illÃ©gal</li>
          </ul>
          <div class="cgu-warn">
            ABAE se rÃ©serve le droit de supprimer sans prÃ©avis toute annonce ne respectant pas ces rÃ¨gles et de suspendre le compte concernÃ©.
          </div>
        </div>
      </div>

      <!-- Art. 4 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">4</span>
          <span class="cgu-section-ttl">SystÃ¨me de Paiement et Escrow</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>4.1 Principe de l'escrow</strong><br>Toute transaction sur ABAE est sÃ©curisÃ©e par un systÃ¨me d'escrow (sÃ©questre) : le paiement de l'acheteur est bloquÃ© sur un compte ABAE sÃ©curisÃ© jusqu'Ã  confirmation de rÃ©ception ou livraison satisfaisante.</p>
          <p><strong>4.2 LibÃ©ration des fonds</strong></p>
          <ul>
            <li>L'acheteur confirme la rÃ©ception â†’ fonds libÃ©rÃ©s au vendeur sous 24h</li>
            <li>Absence de confirmation sous 72h â†’ libÃ©ration automatique sauf litige dÃ©clarÃ©</li>
            <li>Litige dÃ©clarÃ© â†’ fonds maintenus bloquÃ©s pendant l'instruction</li>
          </ul>
          <p><strong>4.3 Commission ABAE</strong><br>ABAE prÃ©lÃ¨ve automatiquement une commission dÃ©gressive au moment de la libÃ©ration des fonds :</p>
          <div class="cgu-highlight">
            <strong>Grille tarifaire ABAE :</strong><br>
            0 â€” 25 000 XAF â†’ 5% Â· 25 001 â€” 100 000 XAF â†’ 4%<br>
            100 001 â€” 500 000 XAF â†’ 3% Â· 500 001 â€” 2 000 000 XAF â†’ 2%<br>
            Au-delÃ  de 2 000 000 XAF â†’ 1,5% <strong>(plafonnÃ© Ã  75 000 XAF)</strong>
          </div>
          <p><strong>4.4 Moyens de paiement acceptÃ©s</strong></p>
          <ul>
            <li>MTN Mobile Money</li>
            <li>Orange Money</li>
            <li>Virement bancaire (BEAC, BICEC, SCB)</li>
            <li>Portefeuille ABAE (solde disponible)</li>
          </ul>
        </div>
      </div>

      <!-- Art. 5 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">5</span>
          <span class="cgu-section-ttl">Portefeuille NumÃ©rique ABAE</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Chaque utilisateur dispose d'un portefeuille numÃ©rique ABAE permettant :</p>
          <ul>
            <li>Le dÃ©pÃ´t de fonds via Mobile Money ou virement</li>
            <li>Le paiement de transactions sur la plateforme</li>
            <li>La rÃ©ception des fonds dÃ©bloquÃ©s aprÃ¨s livraison</li>
            <li>Le retrait vers un compte Mobile Money ou bancaire</li>
          </ul>
          <p>Le portefeuille ABAE n'est pas un compte bancaire et ne produit pas d'intÃ©rÃªts. Les fonds dÃ©posÃ©s sont garantis et sÃ©grÃ©guÃ©s des fonds propres d'ABAE.</p>
          <div class="cgu-warn">
            Le solde du portefeuille n'est pas assurable. ABAE recommande de ne pas y laisser des montants importants au-delÃ  des besoins transactionnels immÃ©diats.
          </div>
        </div>
      </div>

      <!-- Art. 6 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">6</span>
          <span class="cgu-section-ttl">Litiges et MÃ©diation</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>6.1 DÃ©claration d'un litige</strong><br>Tout litige liÃ© Ã  une transaction doit Ãªtre dÃ©clarÃ© via la plateforme dans un dÃ©lai de <strong>72 heures</strong> suivant la date de livraison prÃ©vue ou rÃ©elle.</p>
          <p><strong>6.2 ProcÃ©dure</strong></p>
          <ul>
            <li>DÃ©claration du litige par l'acheteur ou le vendeur</li>
            <li>Blocage des fonds escrow pendant l'instruction</li>
            <li>MÃ©diation par l'Ã©quipe ABAE sous 5 jours ouvrÃ©s</li>
            <li>DÃ©cision contraignante notifiÃ©e aux deux parties</li>
            <li>LibÃ©ration ou remboursement des fonds selon dÃ©cision</li>
          </ul>
          <p><strong>6.3 Recours externe</strong><br>En cas de dÃ©saccord avec la dÃ©cision ABAE, l'utilisateur peut saisir les juridictions compÃ©tentes de YaoundÃ©, Cameroun.</p>
        </div>
      </div>

      <!-- Art. 7 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">7</span>
          <span class="cgu-section-ttl">Abonnements et AccÃ¨s Premium</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE propose diffÃ©rents niveaux d'abonnement :</p>
          <ul>
            <li><strong>Gratuit</strong> â€” accÃ¨s limitÃ©, annonces basiques</li>
            <li><strong>Standard</strong> â€” accÃ¨s Ã©tendu, IA de base, prioritÃ© modÃ©ration</li>
            <li><strong>Premium</strong> â€” accÃ¨s complet, IA avancÃ©e, badge vÃ©rifiÃ©, support dÃ©diÃ©</li>
            <li><strong>Business</strong> â€” solutions entreprise, API, tableau de bord analytique</li>
          </ul>
          <p>Les abonnements sont renouvelÃ©s automatiquement sauf rÃ©siliation avant la date d'Ã©chÃ©ance. Aucun remboursement n'est accordÃ© pour les pÃ©riodes entamÃ©es.</p>
        </div>
      </div>

      <!-- Art. 8 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">8</span>
          <span class="cgu-section-ttl">ResponsabilitÃ©s d'ABAE</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>8.1 RÃ´le d'intermÃ©diaire</strong><br>ABAE est un intermÃ©diaire de mise en relation. Elle n'est pas partie aux contrats conclus entre utilisateurs et ne garantit pas la qualitÃ©, la conformitÃ© ou la livraison des biens et services.</p>
          <p><strong>8.2 DisponibilitÃ©</strong><br>ABAE s'engage Ã  maintenir la plateforme disponible 24h/24, 7j/7, sous rÃ©serve des opÃ©rations de maintenance planifiÃ©es notifiÃ©es Ã  l'avance.</p>
          <p><strong>8.3 Limitation de responsabilitÃ©</strong><br>ABAE ne peut Ãªtre tenue responsable des dommages indirects rÃ©sultant de l'utilisation de la plateforme, des dÃ©faillances rÃ©seau ou de cas de force majeure.</p>
        </div>
      </div>

      <!-- Art. 9 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">9</span>
          <span class="cgu-section-ttl">PropriÃ©tÃ© Intellectuelle</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>L'ensemble des Ã©lÃ©ments constituant la plateforme ABAE â€” logo, interface, algorithmes IA, contenus Ã©ditoriaux, marque â€” sont la propriÃ©tÃ© exclusive d'ABAE et protÃ©gÃ©s par les droits de propriÃ©tÃ© intellectuelle applicables.</p>
          <p>Toute reproduction, reprÃ©sentation ou exploitation non autorisÃ©e est strictement interdite et poursuivie.</p>
          <p>L'utilisateur conserve la propriÃ©tÃ© des contenus qu'il publie (photos, descriptions) et concÃ¨de Ã  ABAE une licence d'utilisation non exclusive pour les afficher sur la plateforme.</p>
        </div>
      </div>

      <!-- Art. 10 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">10</span>
          <span class="cgu-section-ttl">Suspension et RÃ©siliation</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p><strong>10.1 Par l'utilisateur</strong><br>L'utilisateur peut supprimer son compte Ã  tout moment depuis ParamÃ¨tres â†’ Supprimer mon compte. Les transactions en cours doivent Ãªtre soldÃ©es prÃ©alablement.</p>
          <p><strong>10.2 Par ABAE</strong><br>ABAE peut suspendre ou rÃ©silier un compte en cas de :</p>
          <ul>
            <li>Violation des prÃ©sentes CGU</li>
            <li>Fraude avÃ©rÃ©e ou tentative de fraude</li>
            <li>Fausse identitÃ© ou usurpation</li>
            <li>Comportement prÃ©judiciable Ã  la communautÃ© ABAE</li>
            <li>DÃ©cision judiciaire ou rÃ©quisition lÃ©gale</li>
          </ul>
          <div class="cgu-warn">
            En cas de rÃ©siliation pour faute, les fonds en escrow sont gelÃ©s le temps de l'instruction. Les soldes non litigieux restent restituables sur demande.
          </div>
        </div>
      </div>

      <!-- Art. 11 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">11</span>
          <span class="cgu-section-ttl">Droit Applicable et Juridiction</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>Les prÃ©sentes CGU sont rÃ©gies par le droit camerounais, notamment :</p>
          <ul>
            <li>Loi nÂ°2010/012 du 21 dÃ©cembre 2010 relative Ã  la cybersÃ©curitÃ© et cybercriminalitÃ©</li>
            <li>Acte uniforme OHADA sur le droit commercial gÃ©nÃ©ral</li>
            <li>RÃ©glementations BEAC et COBAC applicables aux paiements Ã©lectroniques</li>
          </ul>
          <p>Tout litige non rÃ©solu Ã  l'amiable sera soumis Ã  la compÃ©tence exclusive des tribunaux de YaoundÃ©, Cameroun.</p>
        </div>
      </div>

      <!-- Art. 12 -->
      <div class="cgu-section">
        <div class="cgu-section-hd" onclick="toggleCguSection(this)">
          <span class="cgu-section-num">12</span>
          <span class="cgu-section-ttl">Modifications des CGU</span>
          <svg class="cgu-section-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cgu-section-bd">
          <p>ABAE peut modifier les prÃ©sentes CGU Ã  tout moment. Les modifications entrent en vigueur dÃ¨s leur publication sur la plateforme. En cas de modification substantielle, les utilisateurs sont notifiÃ©s par email et notification in-app avec un prÃ©avis de 15 jours.</p>
          <p>La poursuite de l'utilisation de la plateforme aprÃ¨s ce dÃ©lai vaut acceptation des nouvelles CGU. En cas de refus, l'utilisateur peut clÃ´turer son compte sans frais.</p>
        </div>
      </div>

      <!-- Acceptation -->
      <div style="margin-top:20px;background:linear-gradient(135deg,rgba(74,158,42,0.08),rgba(74,158,42,0.04));border:1.5px solid rgba(74,158,42,0.25);border-radius:14px;padding:16px;text-align:center;">
        <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.85rem;color:var(--vf);margin-bottom:6px;">âœ… Acceptation des CGU</div>
        <div style="font-size:0.75rem;color:#3D4550;line-height:1.6;">En vous inscrivant sur ABAE, vous dÃ©clarez avoir lu, compris et acceptÃ© l'intÃ©gralitÃ© des prÃ©sentes Conditions GÃ©nÃ©rales d'Utilisation ainsi que la Politique de ConfidentialitÃ©.</div>
      </div>

      <!-- Pied de page -->
      <div style="margin-top:16px;padding:14px;background:var(--g100);border-radius:12px;text-align:center;font-size:0.72rem;color:var(--g400);line-height:1.7;">
        Â© 2026 ABAE â€” Agro-Business Africa Entreprise Â· YaoundÃ©, Cameroun<br>
        <span style="color:var(--vp);font-weight:700;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ed81888a8c81ad8c8f8c88c38c8b9f848e8c">[email&#160;protected]</a></span> Â· abae.africa
      </div>
    </div>
  </div>

  <!-- â•â•â• BOTTOM NAVIGATION â•â•â• -->
  <nav class="bottomnav">
    <div class="nav-item active" id="nav-marche" onclick="navTo('marche')" role="button" aria-label="MarchÃ©" tabindex="0">
      <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span class="nav-label">MarchÃ©</span>
    </div>
    <div class="nav-item" id="nav-commandes" data-visitor-locked="1" onclick="navTo('commandes')" role="button" aria-label="Commandes" tabindex="0">
      <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
      <span class="nav-label">Commandes</span>
      <span class="nav-badge">2</span>
    </div>
    <div class="nav-item" id="nav-documents" data-visitor-locked="1" onclick="navTo('documents')" role="button" aria-label="Documents" tabindex="0">
      <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      <span class="nav-label">Documents</span>
    </div>
    <div class="nav-item" id="nav-portefeuille" data-visitor-locked="1" onclick="navTo('portefeuille')" role="button" aria-label="Portefeuille" tabindex="0">
      <svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg>
      <span class="nav-label">Portefeuille</span>
    </div>
    <div class="nav-item" id="nav-smart" data-visitor-locked="1" onclick="navTo('smart')" role="button" aria-label="ABAE Smart IA" tabindex="0">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 0110 10c0 4-2.5 7.5-6 9.2"/><path d="M12 2C6.5 2 2 6.5 2 12c0 4 2.5 7.5 6 9.2"/><circle cx="12" cy="12" r="3"/><path d="M12 9V7M12 17v-2M9 12H7M17 12h-2"/></svg>
      <span class="nav-label">Smart IA</span>
    </div>
    <div class="nav-item" id="nav-profil" data-visitor-locked="1" onclick="navTo('profil')" role="button" aria-label="Profil" tabindex="0">
      <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span class="nav-label">Profil</span>
    </div>
    <div class="nav-item" id="nav-parametres" data-visitor-locked="1" onclick="navTo('parametres')" role="button" aria-label="ParamÃ¨tres" tabindex="0">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      <span class="nav-label">ParamÃ¨tres</span>
    </div>
  </nav>


  <!-- FILTRES -->
  <div class="sheet" id="filterSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">âš™ Filtrer les offres</div><button class="sheet-close" onclick="closeSheet('filterSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="form-row">
        <div class="form-label">CatÃ©gorie</div>
        <select class="form-select" id="filterCat" onchange="filterCards()">
          <option value="">Toutes catÃ©gories</option>
          <option value="agro">ğŸŒ¾ Produits agricoles</option>
          <option value="transport">ğŸš› Transport</option>
          <option value="stockage">ğŸ­ Stockage</option>
          <option value="digital">ğŸ’» Services digitaux</option>
          <option value="financement">ğŸ’° Financement</option>
          <option value="services">ğŸ”§ Conseil agro</option>
          <option value="emplois">ğŸ’¼ Emplois</option>
          <option value="formation">ğŸ“š Formation</option>
          <option value="intrants">ğŸŒ± Intrants agricoles</option>
          <option value="assurance">ğŸ›¡ï¸ Assurance</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">Pays</div>
        <select class="form-select" id="filterPays" onchange="filterCards()">
          <option value="">ğŸŒ Tous les pays</option>
          <optgroup label="â”€â”€ Afrique de l'Ouest â”€â”€">
          <option value="BJ">ğŸ‡§ğŸ‡¯ BÃ©nin</option>
          <option value="BF">ğŸ‡§ğŸ‡« Burkina Faso</option>
          <option value="CV">ğŸ‡¨ğŸ‡» Cap-Vert</option>
          <option value="CI">ğŸ‡¨ğŸ‡® CÃ´te d'Ivoire</option>
          <option value="GM">ğŸ‡¬ğŸ‡² Gambie</option>
          <option value="GH">ğŸ‡¬ğŸ‡­ Ghana</option>
          <option value="GN">ğŸ‡¬ğŸ‡³ GuinÃ©e</option>
          <option value="GW">ğŸ‡¬ğŸ‡¼ GuinÃ©e-Bissau</option>
          <option value="LR">ğŸ‡±ğŸ‡· LibÃ©ria</option>
          <option value="ML">ğŸ‡²ğŸ‡± Mali</option>
          <option value="MR">ğŸ‡²ğŸ‡· Mauritanie</option>
          <option value="NE">ğŸ‡³ğŸ‡ª Niger</option>
          <option value="NG">ğŸ‡³ğŸ‡¬ Nigeria</option>
          <option value="SN">ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal</option>
          <option value="SL">ğŸ‡¸ğŸ‡± Sierra Leone</option>
          <option value="TG">ğŸ‡¹ğŸ‡¬ Togo</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique Centrale â”€â”€">
          <option value="CM">ğŸ‡¨ğŸ‡² Cameroun</option>
          <option value="CF">ğŸ‡¨ğŸ‡« Centrafrique</option>
          <option value="TD">ğŸ‡¹ğŸ‡© Tchad</option>
          <option value="CG">ğŸ‡¨ğŸ‡¬ Congo</option>
          <option value="CD">ğŸ‡¨ğŸ‡© RD Congo</option>
          <option value="GQ">ğŸ‡¬ğŸ‡¶ GuinÃ©e Ã‰quatoriale</option>
          <option value="GA">ğŸ‡¬ğŸ‡¦ Gabon</option>
          <option value="ST">ğŸ‡¸ğŸ‡¹ SÃ£o TomÃ©-et-PrÃ­ncipe</option>
          <option value="BI">ğŸ‡§ğŸ‡® Burundi</option>
          <option value="RW">ğŸ‡·ğŸ‡¼ Rwanda</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique de l'Est â”€â”€">
          <option value="KM">ğŸ‡°ğŸ‡² Comores</option>
          <option value="DJ">ğŸ‡©ğŸ‡¯ Djibouti</option>
          <option value="ER">ğŸ‡ªğŸ‡· Ã‰rythrÃ©e</option>
          <option value="ET">ğŸ‡ªğŸ‡¹ Ã‰thiopie</option>
          <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
          <option value="MG">ğŸ‡²ğŸ‡¬ Madagascar</option>
          <option value="MW">ğŸ‡²ğŸ‡¼ Malawi</option>
          <option value="MU">ğŸ‡²ğŸ‡º Maurice</option>
          <option value="MZ">ğŸ‡²ğŸ‡¿ Mozambique</option>
          <option value="SC">ğŸ‡¸ğŸ‡¨ Seychelles</option>
          <option value="SO">ğŸ‡¸ğŸ‡´ Somalie</option>
          <option value="SS">ğŸ‡¸ğŸ‡¸ Soudan du Sud</option>
          <option value="SD">ğŸ‡¸ğŸ‡© Soudan</option>
          <option value="TZ">ğŸ‡¹ğŸ‡¿ Tanzanie</option>
          <option value="UG">ğŸ‡ºğŸ‡¬ Ouganda</option>
          <option value="ZM">ğŸ‡¿ğŸ‡² Zambie</option>
          <option value="ZW">ğŸ‡¿ğŸ‡¼ Zimbabwe</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique du Nord â”€â”€">
          <option value="DZ">ğŸ‡©ğŸ‡¿ AlgÃ©rie</option>
          <option value="EG">ğŸ‡ªğŸ‡¬ Ã‰gypte</option>
          <option value="LY">ğŸ‡±ğŸ‡¾ Libye</option>
          <option value="MA">ğŸ‡²ğŸ‡¦ Maroc</option>
          <option value="TN">ğŸ‡¹ğŸ‡³ Tunisie</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique Australe â”€â”€">
          <option value="AO">ğŸ‡¦ğŸ‡´ Angola</option>
          <option value="BW">ğŸ‡§ğŸ‡¼ Botswana</option>
          <option value="LS">ğŸ‡±ğŸ‡¸ Lesotho</option>
          <option value="NA">ğŸ‡³ğŸ‡¦ Namibie</option>
          <option value="ZA">ğŸ‡¿ğŸ‡¦ Afrique du Sud</option>
          <option value="SZ">ğŸ‡¸ğŸ‡¿ Eswatini</option>
          </optgroup>
          <optgroup label="â”€â”€ Europe â”€â”€">
          <option value="BE">ğŸ‡§ğŸ‡ª Belgique</option>
          <option value="CH">ğŸ‡¨ğŸ‡­ Suisse</option>
          <option value="DE">ğŸ‡©ğŸ‡ª Allemagne</option>
          <option value="ES">ğŸ‡ªğŸ‡¸ Espagne</option>
          <option value="FR">ğŸ‡«ğŸ‡· France</option>
          <option value="GB">ğŸ‡¬ğŸ‡§ Royaume-Uni</option>
          <option value="IT">ğŸ‡®ğŸ‡¹ Italie</option>
          <option value="LU">ğŸ‡±ğŸ‡º Luxembourg</option>
          <option value="NL">ğŸ‡³ğŸ‡± Pays-Bas</option>
          <option value="PT">ğŸ‡µğŸ‡¹ Portugal</option>
          <option value="SE">ğŸ‡¸ğŸ‡ª SuÃ¨de</option>
          <option value="NO">ğŸ‡³ğŸ‡´ NorvÃ¨ge</option>
          <option value="FI">ğŸ‡«ğŸ‡® Finlande</option>
          <option value="DK">ğŸ‡©ğŸ‡° Danemark</option>
          <option value="PL">ğŸ‡µğŸ‡± Pologne</option>
          <option value="RO">ğŸ‡·ğŸ‡´ Roumanie</option>
          <option value="RU">ğŸ‡·ğŸ‡º Russie</option>
          <option value="TR">ğŸ‡¹ğŸ‡· Turquie</option>
          <option value="UA">ğŸ‡ºğŸ‡¦ Ukraine</option>
          </optgroup>
          <optgroup label="â”€â”€ AmÃ©riques â”€â”€">
          <option value="BR">ğŸ‡§ğŸ‡· BrÃ©sil</option>
          <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
          <option value="CL">ğŸ‡¨ğŸ‡± Chili</option>
          <option value="CO">ğŸ‡¨ğŸ‡´ Colombie</option>
          <option value="HT">ğŸ‡­ğŸ‡¹ HaÃ¯ti</option>
          <option value="MX">ğŸ‡²ğŸ‡½ Mexique</option>
          <option value="US">ğŸ‡ºğŸ‡¸ Ã‰tats-Unis</option>
          </optgroup>
          <optgroup label="â”€â”€ Asie / OcÃ©anie â”€â”€">
          <option value="CN">ğŸ‡¨ğŸ‡³ Chine</option>
          <option value="IN">ğŸ‡®ğŸ‡³ Inde</option>
          <option value="JP">ğŸ‡¯ğŸ‡µ Japon</option>
          <option value="AU">ğŸ‡¦ğŸ‡º Australie</option>
          <option value="AE">ğŸ‡¦ğŸ‡ª Ã‰mirats arabes unis</option>
          <option value="SA">ğŸ‡¸ğŸ‡¦ Arabie Saoudite</option>
          </optgroup>
        </select>
      </div>
      <div class="filter-row">
        <div class="filter-row-label">âœ… Profils vÃ©rifiÃ©s uniquement</div>
        <label class="toggle"><input type="checkbox" id="filterVerified" onchange="filterCards()"/><div class="toggle-track"></div></label>
      </div>
      <div class="filter-row">
        <div class="filter-row-label">ğŸ”’ Paiement sÃ©curisÃ© (escrow)</div>
        <label class="toggle"><input type="checkbox" checked/><div class="toggle-track"></div></label>
      </div>
      <button class="btn btn-primary btn-block" style="margin-top:16px;" onclick="closeSheet('filterSheet');filterCards()">Appliquer les filtres</button>
      <button class="btn btn-ghost btn-block" style="margin-top:8px;" onclick="resetFilters();closeSheet('filterSheet')">RÃ©initialiser</button>
    </div>
  </div>

  <!-- DÃ‰PÃ”T -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET DÃ‰PÃ”T â€” 3 Ã©tapes
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="depositSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ“² DÃ©poser des fonds</div>
      <button class="sheet-close" onclick="closeSheet('depositSheet')">âœ•</button>
    </div>
    <div class="sheet-body">

      <!-- Ã‰tape 1 : MÃ©thode -->
      <div id="dep-step1">
        <div style="font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--g400);margin-bottom:10px;">1 Â· Choisissez la mÃ©thode</div>
        <div class="pay-method sel" id="dep-mtn" onclick="selDepMethod(this,'MTN Mobile Money','ğŸ“±')">
          <div class="pay-method-icon">ğŸ“±</div><div><h4>MTN Mobile Money</h4><p>DÃ©pÃ´t instantanÃ© Â· 0 frais</p></div>
        </div>
        <div class="pay-method" id="dep-orange" onclick="selDepMethod(this,'Orange Money','ğŸŸ ')">
          <div class="pay-method-icon">ğŸŸ </div><div><h4>Orange Money</h4><p>DÃ©pÃ´t instantanÃ© Â· 0 frais</p></div>
        </div>
        <div class="pay-method" id="dep-bank" onclick="selDepMethod(this,'Virement bancaire','ğŸ¦')">
          <div class="pay-method-icon">ğŸ¦</div><div><h4>Virement bancaire</h4><p>BEAC, BICEC, SCB â€” 24h</p></div>
        </div>
        <div class="form-row" style="margin-top:14px;">
          <div class="form-label">Montant Ã  dÃ©poser (XAF) <span class="req">*</span></div>
          <input class="form-input" id="depAmount" type="number" placeholder="Ex : 50 000" inputmode="numeric" oninput="checkDepStep1()"/>
          <div id="depAmountErr" style="font-size:0.72rem;color:var(--err);margin-top:4px;display:none;">Montant minimum : 1 000 XAF</div>
        </div>
        <div class="form-row" id="depPhoneRow">
          <div class="form-label">NumÃ©ro Mobile Money <span class="req">*</span></div>
          <input class="form-input" id="depPhone" type="tel" placeholder="Ex : 6 77 00 00 00" inputmode="numeric" oninput="checkDepStep1()"/>
        </div>
        <button class="btn btn-primary btn-block" id="depBtn1" disabled onclick="goDepStep2()">Continuer â†’</button>
      </div>

      <!-- Ã‰tape 2 : RÃ©capitulatif -->
      <div id="dep-step2" style="display:none;">
        <div style="font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--g400);margin-bottom:12px;">2 Â· RÃ©capitulatif</div>
        <div style="background:var(--g100);border-radius:12px;padding:16px;margin-bottom:16px;">
          <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:0.82rem;border-bottom:1px solid var(--g200);"><span style="color:var(--g400);">MÃ©thode</span><span id="depSummMethod" style="font-weight:600;">â€”</span></div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:0.82rem;border-bottom:1px solid var(--g200);"><span style="color:var(--g400);">NumÃ©ro</span><span id="depSummPhone" style="font-weight:600;">â€”</span></div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:0.82rem;border-bottom:1px solid var(--g200);"><span style="color:var(--g400);">Frais</span><span style="font-weight:600;color:var(--ok);">0 XAF</span></div>
          <div style="display:flex;justify-content:space-between;padding:8px 0 0;font-size:1rem;"><span style="font-weight:700;">Total crÃ©ditÃ©</span><span id="depSummAmount" style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);">â€”</span></div>
        </div>
        <div style="background:rgba(74,158,42,0.07);border:1px solid rgba(74,158,42,0.15);border-radius:8px;padding:10px 12px;font-size:0.72rem;color:var(--vf);margin-bottom:16px;">
          ğŸ”’ Votre solde ABAE sera crÃ©ditÃ© dÃ¨s confirmation du paiement par l'opÃ©rateur.
        </div>
        <button class="btn btn-primary btn-block" id="depBtn2" onclick="confirmDeposit()">âœ… Confirmer le dÃ©pÃ´t</button>
        <button class="btn btn-ghost btn-block" style="margin-top:8px;" onclick="goDepStep1()">â† Modifier</button>
      </div>

      <!-- Ã‰tape 3 : SuccÃ¨s -->
      <div id="dep-step3" style="display:none;text-align:center;padding:20px 0;">
        <div style="font-size:3.5rem;margin-bottom:12px;">âœ…</div>
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;color:var(--ok);margin-bottom:6px;">DÃ©pÃ´t confirmÃ© !</div>
        <div id="depSuccessMsg" style="font-size:0.82rem;color:var(--g400);margin-bottom:20px;">Votre solde a Ã©tÃ© mis Ã  jour.</div>
        <div style="background:var(--vc);border-radius:12px;padding:14px;margin-bottom:20px;">
          <div style="font-size:0.72rem;color:var(--g400);margin-bottom:4px;">Nouveau solde disponible</div>
          <div id="depNewBalance" style="font-family:'JetBrains Mono',monospace;font-size:1.8rem;font-weight:700;color:var(--vp);">â€”</div>
        </div>
        <button class="btn btn-primary btn-block" onclick="closeSheet('depositSheet')">Fermer</button>
      </div>

    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET RETRAIT â€” 3 Ã©tapes
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="withdrawSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">â†©ï¸ Retirer des fonds</div>
      <button class="sheet-close" onclick="closeSheet('withdrawSheet')">âœ•</button>
    </div>
    <div class="sheet-body">

      <!-- Ã‰tape 1 : Saisie -->
      <div id="with-step1">
        <div style="background:var(--vc);border-radius:10px;padding:12px;text-align:center;margin-bottom:14px;">
          <div style="font-size:0.72rem;color:var(--g400);">Solde disponible</div>
          <div id="withAvailableBalance" style="font-family:'JetBrains Mono',monospace;font-size:1.6rem;font-weight:700;color:var(--vp);">125 000 XAF</div>
        </div>
        <div style="font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--g400);margin-bottom:10px;">Vers quel compte ?</div>
        <div class="pay-method sel" id="with-mtn" onclick="selWithMethod(this,'MTN Mobile Money','ğŸ“±')">
          <div class="pay-method-icon">ğŸ“±</div><div><h4>MTN Mobile Money</h4><p>Virement immÃ©diat</p></div>
        </div>
        <div class="pay-method" id="with-orange" onclick="selWithMethod(this,'Orange Money','ğŸŸ ')">
          <div class="pay-method-icon">ğŸŸ </div><div><h4>Orange Money</h4><p>Virement immÃ©diat</p></div>
        </div>
        <div class="pay-method" id="with-bank" onclick="selWithMethod(this,'Virement bancaire','ğŸ¦')">
          <div class="pay-method-icon">ğŸ¦</div><div><h4>Virement bancaire</h4><p>BEAC, BICEC â€” 24â€“48h</p></div>
        </div>
        <div class="form-row" style="margin-top:14px;">
          <div class="form-label">NumÃ©ro destinataire <span class="req">*</span></div>
          <input class="form-input" id="withPhone" type="tel" placeholder="Ex : 6 77 00 00 00" inputmode="numeric" oninput="checkWithStep1()"/>
        </div>
        <div class="form-row">
          <div class="form-label">Montant (XAF) <span class="req">*</span></div>
          <input class="form-input" id="withAmount" type="number" placeholder="Ex : 50 000" inputmode="numeric" oninput="checkWithStep1()"/>
          <div id="withAmountErr" style="font-size:0.72rem;color:var(--err);margin-top:4px;display:none;"></div>
        </div>
        <button class="btn btn-primary btn-block" id="withBtn1" disabled onclick="goWithStep2()">Continuer â†’</button>
      </div>

      <!-- Ã‰tape 2 : RÃ©capitulatif + code PIN -->
      <div id="with-step2" style="display:none;">
        <div style="font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--g400);margin-bottom:12px;">2 Â· VÃ©rification</div>
        <div style="background:var(--g100);border-radius:12px;padding:16px;margin-bottom:16px;">
          <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:0.82rem;border-bottom:1px solid var(--g200);"><span style="color:var(--g400);">MÃ©thode</span><span id="withSummMethod" style="font-weight:600;">â€”</span></div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:0.82rem;border-bottom:1px solid var(--g200);"><span style="color:var(--g400);">Vers</span><span id="withSummPhone" style="font-weight:600;">â€”</span></div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:0.82rem;border-bottom:1px solid var(--g200);"><span style="color:var(--g400);">Montant</span><span id="withSummAmount" style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--err);">â€”</span></div>
          <div style="display:flex;justify-content:space-between;padding:8px 0 0;font-size:0.82rem;"><span style="color:var(--g400);">Solde aprÃ¨s</span><span id="withSummAfter" style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);">â€”</span></div>
        </div>
        <div class="form-row">
          <div class="form-label">Code PIN ABAE (4 chiffres) <span class="req">*</span></div>
          <input class="form-input" id="withPin" type="password" inputmode="numeric" maxlength="4" placeholder="â€¢ â€¢ â€¢ â€¢" oninput="checkWithPin()"/>
          <div style="font-size:0.7rem;color:var(--g400);margin-top:4px;">ğŸ’¡ Code dÃ©mo : 1234</div>
          <div id="withPinErr" style="font-size:0.72rem;color:var(--err);margin-top:4px;display:none;">Code PIN incorrect</div>
        </div>
        <button class="btn btn-primary btn-block" id="withBtn2" disabled onclick="confirmWithdraw()">âœ… Valider le retrait</button>
        <button class="btn btn-ghost btn-block" style="margin-top:8px;" onclick="goWithStep1()">â† Modifier</button>
      </div>

      <!-- Ã‰tape 3 : SuccÃ¨s -->
      <div id="with-step3" style="display:none;text-align:center;padding:20px 0;">
        <div style="font-size:3.5rem;margin-bottom:12px;">ğŸ‰</div>
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;color:var(--ok);margin-bottom:6px;">Retrait validÃ© !</div>
        <div id="withSuccessMsg" style="font-size:0.82rem;color:var(--g400);margin-bottom:20px;"></div>
        <div style="background:var(--vc);border-radius:12px;padding:14px;margin-bottom:20px;">
          <div style="font-size:0.72rem;color:var(--g400);margin-bottom:4px;">Nouveau solde disponible</div>
          <div id="withNewBalance" style="font-family:'JetBrains Mono',monospace;font-size:1.8rem;font-weight:700;color:var(--vp);">â€”</div>
        </div>
        <button class="btn btn-primary btn-block" onclick="closeSheet('withdrawSheet')">Fermer</button>
      </div>

    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET RELEVÃ‰ â€” Historique complet
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="txSheet" style="max-height:90%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ“„ RelevÃ© de compte</div>
      <button class="sheet-close" onclick="closeSheet('txSheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="padding-bottom:20px;">
      <!-- EntÃªte relevÃ© -->
      <div style="background:linear-gradient(135deg,#1A6635,#4FAB2D);border-radius:12px;padding:14px 16px;margin-bottom:16px;">
        <div style="font-size:0.7rem;color:rgba(255,255,255,0.6);margin-bottom:2px;">AB-CM-8834 Â· Jean-Pierre Mbida</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1.5rem;font-weight:700;color:#fff;" id="releveBalanceHeader">125 000 XAF</div>
        <div style="font-size:0.68rem;color:rgba(255,255,255,0.55);margin-top:3px;">Escrow bloquÃ© : <span id="releveEscrow">45 000 XAF</span></div>
      </div>

      <!-- Filtres pÃ©riode -->
      <div style="display:flex;gap:6px;margin-bottom:14px;overflow-x:auto;padding-bottom:2px;">
        <button class="chip active" id="releve-all" onclick="filtrerReleve('all',this)">Tout</button>
        <button class="chip" id="releve-in" onclick="filtrerReleve('in',this)">EntrÃ©es</button>
        <button class="chip" id="releve-out" onclick="filtrerReleve('out',this)">Sorties</button>
        <button class="chip" id="releve-escrow" onclick="filtrerReleve('escrow',this)">Escrow</button>
      </div>

      <!-- RÃ©sumÃ© -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px;">
        <div style="background:rgba(33,145,80,0.08);border:1px solid rgba(33,145,80,0.2);border-radius:10px;padding:10px;text-align:center;">
          <div style="font-size:0.65rem;color:var(--g400);margin-bottom:3px;">ENTRÃ‰ES</div>
          <div id="releveTotal-in" style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--ok);font-size:0.95rem;">+485 000</div>
        </div>
        <div style="background:rgba(192,57,43,0.07);border:1px solid rgba(192,57,43,0.15);border-radius:10px;padding:10px;text-align:center;">
          <div style="font-size:0.65rem;color:var(--g400);margin-bottom:3px;">SORTIES</div>
          <div id="releveTotal-out" style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--err);font-size:0.95rem;">-445 000</div>
        </div>
      </div>

      <!-- Liste transactions -->
      <div id="releveList" style="display:flex;flex-direction:column;gap:8px;"></div>

      <!-- Bouton export -->
      <button class="btn btn-outline btn-block" style="margin-top:16px;" onclick="exportReleve()">
        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2;"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        TÃ©lÃ©charger le relevÃ© PDF
      </button>
    </div>
  </div>

  <!-- SIGNATURE -->
  <div class="sheet" id="signSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">âœï¸ Signer le document</div><button class="sheet-close" onclick="closeSheet('signSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sig-help">Signez ci-dessous avec votre doigt</div>
      <div class="sig-canvas-wrap">
        <canvas id="sigCanvas" height="150"></canvas>
      </div>
      <div class="sig-footer">
        <button class="btn btn-ghost" onclick="clearSig()">ğŸ—‘ Effacer</button>
        <button class="btn btn-primary" style="flex:1;" onclick="applySig()">âœ“ Appliquer la signature</button>
      </div>
    </div>
  </div>

  <!-- â•â• SHEET : DIFFICULTÃ‰S â•â• -->
  <div class="sheet" id="diffSheet" style="max-height:92%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ†˜ J'ai un problÃ¨me</div>
      <button class="sheet-close" onclick="closeSheet('diffSheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="overflow-y:auto;">
      <div id="diffCatView">
        <div style="font-size:0.82rem;color:#6B7280;margin-bottom:14px;line-height:1.55;">SÃ©lectionnez votre problÃ¨me. Notre IA + Ã©quipe ABAE vous rÃ©pond en moins de <strong>2h</strong>.</div>

        <div class="diff-category" onclick="showDiffSolution('paiement')">
          <div class="diff-category__icon" style="background:#FFF5F5;">ğŸ’³</div>
          <div style="flex:1;"><div style="font-weight:700;font-size:0.88rem;">ProblÃ¨me de paiement</div><div style="font-size:0.75rem;color:#9BA3AE;margin-top:2px;">Transaction bloquÃ©e, dÃ©bit non reÃ§uâ€¦</div></div>
          <svg viewBox="0 0 24 24" width="16" style="stroke:#9BA3AE;fill:none;stroke-width:2;flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
        </div>
        <div class="diff-category" onclick="showDiffSolution('commande')">
          <div class="diff-category__icon" style="background:#FFF8F0;">ğŸ“¦</div>
          <div style="flex:1;"><div style="font-weight:700;font-size:0.88rem;">Commande non livrÃ©e</div><div style="font-size:0.75rem;color:#9BA3AE;margin-top:2px;">Vendeur injoignable, livraison tardiveâ€¦</div></div>
          <svg viewBox="0 0 24 24" width="16" style="stroke:#9BA3AE;fill:none;stroke-width:2;flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
        </div>
        <div class="diff-category" onclick="showDiffSolution('escrow')">
          <div class="diff-category__icon" style="background:#F4FDE8;">ğŸ”’</div>
          <div style="flex:1;"><div style="font-weight:700;font-size:0.88rem;">Fonds bloquÃ©s en escrow</div><div style="font-size:0.75rem;color:#9BA3AE;margin-top:2px;">LibÃ©ration en attente, litige acheteurâ€¦</div></div>
          <svg viewBox="0 0 24 24" width="16" style="stroke:#9BA3AE;fill:none;stroke-width:2;flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
        </div>
        <div class="diff-category" onclick="showDiffSolution('offre')">
          <div class="diff-category__icon" style="background:#F5F3FF;">ğŸ“¢</div>
          <div style="flex:1;"><div style="font-weight:700;font-size:0.88rem;">Offre refusÃ©e / non visible</div><div style="font-size:0.75rem;color:#9BA3AE;margin-top:2px;">Publication rejetÃ©e, offre invisibleâ€¦</div></div>
          <svg viewBox="0 0 24 24" width="16" style="stroke:#9BA3AE;fill:none;stroke-width:2;flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
        </div>
        <div class="diff-category" onclick="showDiffSolution('compte')">
          <div class="diff-category__icon" style="background:#F0F9FF;">ğŸ‘¤</div>
          <div style="flex:1;"><div style="font-weight:700;font-size:0.88rem;">ProblÃ¨me de compte</div><div style="font-size:0.75rem;color:#9BA3AE;margin-top:2px;">Connexion, vÃ©rification KYC, accÃ¨sâ€¦</div></div>
          <svg viewBox="0 0 24 24" width="16" style="stroke:#9BA3AE;fill:none;stroke-width:2;flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
        </div>
        <div class="diff-category" onclick="showDiffSolution('fraude')">
          <div class="diff-category__icon" style="background:#FFF0F0;">ğŸš¨</div>
          <div style="flex:1;"><div style="font-weight:700;font-size:0.88rem;">Signaler une fraude</div><div style="font-size:0.75rem;color:#9BA3AE;margin-top:2px;">Vendeur frauduleux, arnaque dÃ©tectÃ©eâ€¦</div></div>
          <svg viewBox="0 0 24 24" width="16" style="stroke:#9BA3AE;fill:none;stroke-width:2;flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
        </div>

        <div style="border-top:1px solid #F0F0F0;margin-top:12px;padding-top:12px;">
          <button class="btn btn-ghost btn-block" style="font-size:0.82rem;" onclick="window.open('https://wa.me/237600000000?text=Bonjour ABAE')">
            ğŸ’¬ Contacter directement via WhatsApp
          </button>
        </div>
      </div>

      <div id="diffSolView" style="display:none;">
        <button onclick="document.getElementById('diffCatView').style.display='';document.getElementById('diffSolView').style.display='none';" style="background:none;border:none;color:var(--vp);font-weight:700;font-size:0.82rem;cursor:pointer;padding:0;margin-bottom:14px;display:flex;align-items:center;gap:5px;">â† Retour</button>
        <div id="diffSolContent"></div>
        <div style="margin-top:14px;">
          <button class="btn btn-primary btn-block" onclick="closeSheet('diffSheet');showToast('Ticket #ABAE-'+Math.floor(Math.random()*9000+1000)+' crÃ©Ã©. RÃ©ponse sous 2h âœ“','ok')">
            âœ… CrÃ©er un ticket d'assistance
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- COMMENT Ã‡A MARCHE -->
  <div class="sheet" id="howSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ’¡ Comment Ã§a marche</div><button class="sheet-close" onclick="closeSheet('howSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px;">
        <div style="background:var(--g100);border-radius:10px;padding:14px;border-left:3px solid var(--vp);">
          <div style="font-size:1.3rem;margin-bottom:4px;">1ï¸âƒ£</div>
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;margin-bottom:3px;">Inscrivez-vous gratuitement</div>
          <div style="font-size:0.75rem;color:var(--g400);line-height:1.55;">Choisissez votre profil Â· VÃ©rification rapide</div>
        </div>
        <div style="background:var(--g100);border-radius:10px;padding:14px;border-left:3px solid var(--vp);">
          <div style="font-size:1.3rem;margin-bottom:4px;">2ï¸âƒ£</div>
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;margin-bottom:3px;">Trouvez ou publiez une offre</div>
          <div style="font-size:0.75rem;color:var(--g400);line-height:1.55;">Contacts masquÃ©s Â· tout passe par ABAE</div>
        </div>
        <div style="background:var(--g100);border-radius:10px;padding:14px;border-left:3px solid var(--vp);">
          <div style="font-size:1.3rem;margin-bottom:4px;">3ï¸âƒ£</div>
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;margin-bottom:3px;">Payez via ABAE (Escrow)</div>
          <div style="font-size:0.75rem;color:var(--g400);line-height:1.55;">L'argent est bloquÃ© Â· libÃ©rÃ© Ã  la livraison confirmÃ©e</div>
        </div>
        <div style="background:var(--g100);border-radius:10px;padding:14px;border-left:3px solid var(--vp);">
          <div style="font-size:1.3rem;margin-bottom:4px;">4ï¸âƒ£</div>
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;margin-bottom:3px;">Documents PDF + signature</div>
          <div style="font-size:0.75rem;color:var(--g400);line-height:1.55;">Bons, factures, reÃ§us auto-gÃ©nÃ©rÃ©s Â· signables dans l'app</div>
        </div>
      </div>
      <div style="background:var(--vc);border-radius:14px;padding:16px;border:1px solid rgba(74,158,42,0.2);">
        <div style="font-family:'Sora',sans-serif;font-weight:700;color:var(--vf);font-size:0.88rem;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
          <span>ğŸ’°</span> Grille tarifaire ABAE
          <span style="font-size:0.62rem;font-weight:600;color:var(--g400);background:var(--g100);padding:2px 7px;border-radius:8px;margin-left:auto;">PrÃ©lÃ¨vement automatique</span>
        </div>
        <!-- En-tÃªte tableau -->
        <div style="display:grid;grid-template-columns:1fr auto auto;gap:4px;font-size:0.62rem;font-weight:700;color:var(--g400);text-transform:uppercase;letter-spacing:0.04em;padding:0 4px 6px;border-bottom:1.5px solid rgba(74,158,42,0.15);">
          <span>Montant transaction</span><span style="text-align:center;">Taux</span><span style="text-align:right;">Exemple</span>
        </div>
        <!-- Lignes -->
        <div style="display:grid;grid-template-columns:1fr auto auto;gap:4px;align-items:center;padding:7px 4px;border-bottom:1px solid var(--g100);">
          <span style="font-size:0.78rem;color:#3D4550;">0 â€” 25 000 XAF</span>
          <span style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);font-size:0.82rem;text-align:center;">5%</span>
          <span style="font-size:0.7rem;color:var(--g400);text-align:right;">= 1 250 XAF max</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr auto auto;gap:4px;align-items:center;padding:7px 4px;border-bottom:1px solid var(--g100);">
          <span style="font-size:0.78rem;color:#3D4550;">25 001 â€” 100 000 XAF</span>
          <span style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);font-size:0.82rem;text-align:center;">4%</span>
          <span style="font-size:0.7rem;color:var(--g400);text-align:right;">= 4 000 XAF max</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr auto auto;gap:4px;align-items:center;padding:7px 4px;border-bottom:1px solid var(--g100);background:rgba(74,158,42,0.04);border-radius:6px;">
          <span style="font-size:0.78rem;color:#3D4550;">100 001 â€” 500 000 XAF</span>
          <span style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);font-size:0.82rem;text-align:center;">3%</span>
          <span style="font-size:0.7rem;color:var(--g400);text-align:right;">= 15 000 XAF max</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr auto auto;gap:4px;align-items:center;padding:7px 4px;border-bottom:1px solid var(--g100);">
          <span style="font-size:0.78rem;color:#3D4550;">500 001 â€” 2 000 000 XAF</span>
          <span style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);font-size:0.82rem;text-align:center;">2%</span>
          <span style="font-size:0.7rem;color:var(--g400);text-align:right;">= 40 000 XAF max</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr auto auto;gap:4px;align-items:center;padding:7px 4px;">
          <span style="font-size:0.78rem;color:#3D4550;">Au-delÃ  de 2 000 000 XAF</span>
          <span style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);font-size:0.82rem;text-align:center;">1,5%</span>
          <span style="font-size:0.7rem;color:var(--g400);text-align:right;">plafonnÃ© 75 000</span>
        </div>
        <!-- Simulateur interactif -->
        <div style="margin-top:14px;background:#fff;border-radius:14px;padding:14px 16px;border:1.5px solid var(--g200);">
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;color:var(--g700);margin-bottom:10px;display:flex;align-items:center;gap:6px;">
            ğŸ§® Simulateur â€” Calculez votre commission
          </div>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;">
            <input type="number" id="commSimInput" placeholder="Ex : 150 000" inputmode="numeric"
              style="flex:1;padding:10px 12px;border:1.5px solid var(--g200);border-radius:10px;font-family:'DM Sans',sans-serif;font-weight:700;font-size:0.9rem;color:var(--g900);"
              oninput="simulerCommission()"/>
            <span style="font-size:0.78rem;font-weight:700;color:var(--g400);flex-shrink:0;">XAF</span>
          </div>
          <div id="commSimResult" style="display:none;background:var(--vc);border-radius:10px;padding:12px 14px;">
            <div style="display:flex;justify-content:space-between;font-size:0.8rem;color:#3D4550;padding:4px 0;border-bottom:1px solid rgba(74,158,42,0.15);">
              <span>Montant de la transaction</span>
              <span id="commSimMontant" style="font-family:'JetBrains Mono',monospace;font-weight:700;"></span>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:0.8rem;color:#3D4550;padding:4px 0;border-bottom:1px solid rgba(74,158,42,0.15);">
              <span>Taux appliquÃ©</span>
              <span id="commSimTaux" style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);"></span>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:0.8rem;color:#3D4550;padding:4px 0;border-bottom:1px solid rgba(74,158,42,0.15);">
              <span>Commission ABAE</span>
              <span id="commSimComm" style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--or);"></span>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:0.88rem;font-weight:700;padding:6px 0 0;">
              <span>Le vendeur reÃ§oit</span>
              <span id="commSimNet" style="font-family:'JetBrains Mono',monospace;font-size:1rem;color:var(--vf);"></span>
            </div>
          </div>
        </div>
        <div style="margin-top:10px;padding:8px 10px;background:rgba(212,168,67,0.1);border:1px solid rgba(212,168,67,0.3);border-radius:8px;font-size:0.7rem;color:#7A5A00;line-height:1.5;">
          ğŸ† <strong>Plafond absolu : 75 000 XAF</strong> â€” Quelle que soit la taille de la transaction, vous ne paierez jamais plus de 75 000 XAF de commission ABAE.
        </div>
        <div style="margin-top:8px;font-size:0.68rem;color:var(--g400);line-height:1.5;">
          âœ¦ La commission est prÃ©levÃ©e <strong>automatiquement</strong> sur les fonds escrow Ã  la confirmation de livraison. Aucun virement manuel requis.
        </div>
      </div>
    </div>
  </div>

  <!-- AFFILIATION -->
  <div class="sheet" id="affiliationSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ¤ Programme d'Affiliation</div><button class="sheet-close" onclick="closeSheet('affiliationSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div style="text-align:center;background:var(--vc);border-radius:12px;padding:20px;margin-bottom:16px;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:1.8rem;font-weight:700;color:var(--vp);">250 000 XAF/mois</div>
        <div style="font-size:0.72rem;color:var(--g400);margin-top:4px;">avec 50 professionnels actifs parrainÃ©s</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
        <div style="display:flex;gap:10px;align-items:flex-start;padding:10px;background:var(--g100);border-radius:8px;"><span style="font-size:1.1rem;">ğŸ’°</span><div><div style="font-weight:600;font-size:0.82rem;">5 Ã  15% par transaction</div><div style="font-size:0.72rem;color:var(--g400);">de vos filleuls</div></div></div>
        <div style="display:flex;gap:10px;align-items:flex-start;padding:10px;background:var(--g100);border-radius:8px;"><span style="font-size:1.1rem;">ğŸ“±</span><div><div style="font-weight:600;font-size:0.82rem;">Lien WhatsApp unique</div><div style="font-size:0.72rem;color:var(--g400);">Partagez en 1 clic</div></div></div>
        <div style="display:flex;gap:10px;align-items:flex-start;padding:10px;background:var(--g100);border-radius:8px;"><span style="font-size:1.1rem;">ğŸ”„</span><div><div style="font-weight:600;font-size:0.82rem;">Paiement mensuel auto</div><div style="font-size:0.72rem;color:var(--g400);">MTN MoMo ou Orange Money</div></div></div>
      </div>
      <button class="btn btn-gold btn-block" onclick="closeSheet('affiliationSheet');showToast('Programme affiliÃ© rejoint ! âœ“','ok')">Rejoindre le programme â†’</button>
    </div>
  </div>


  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET IA PRIX â€” Estimation intelligente
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="aiPriceSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ’° Estimation IA du Prix</div><button class="sheet-close" onclick="closeSheet('aiPriceSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header">
        <h3>ğŸ’° Estimateur de Prix Intelligent</h3>
        <p>L'IA analyse les prix du marchÃ© en temps rÃ©el pour votre produit</p>
      </div>
      <div class="form-row">
        <div class="form-label">Produit Ã  estimer</div>
        <select class="form-select" id="priceProductType">
          <option value="mais">ğŸŒ¾ MaÃ¯s blanc (50kg)</option>
          <option value="boeufs">ğŸ„ BÅ“ufs de race</option>
          <option value="cacao">ğŸ« Cacao grade A</option>
          <option value="ignames">ğŸ¥” Ignames fraÃ®ches</option>
          <option value="transport">ğŸš› Transport frigorifique</option>
          <option value="stockage">ğŸ­ Stockage froid</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">QuantitÃ© / Volume</div>
        <input class="form-input" id="priceQty" type="number" placeholder="Ex : 100 sacs, 5 bÅ“ufs, 1 tonneâ€¦" inputmode="numeric"/>
      </div>
      <div class="form-row">
        <div class="form-label">RÃ©gion</div>
        <select class="form-select" id="priceRegion">
          <option>YaoundÃ©</option><option>Douala</option><option>Bafoussam</option>
          <option>NgaoundÃ©rÃ©</option><option>Garoua</option>
        </select>
      </div>
      <button class="btn-ia" onclick="runPriceEstimation()">
        <span>ğŸ§ </span> Estimer avec ABAE Smart IA
      </button>
      <div class="ai-result-zone" id="priceResult">
        <div class="ai-result-header">ğŸ“Š Analyse Prix ABAE Smart</div>
        <div class="ai-result-row"><span class="ai-result-label">Prix estimÃ© min</span><span class="ai-result-value" id="priceMin">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Prix estimÃ© max</span><span class="ai-result-value good" id="priceMax">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Prix moyen marchÃ©</span><span class="ai-result-value good" id="priceMoy">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Tendance</span><span class="ai-result-value" id="priceTrend">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Conseil IA</span><span class="ai-result-value good" id="priceAdvice">â€”</span></div>
        <div id="priceCommCalcul" style="margin-top:10px;background:#f2fae8;border-radius:8px;padding:10px;font-size:0.72rem;display:none;">
          <div style="font-weight:700;color:#4A9E2A;margin-bottom:6px;">ğŸ’° Calcul Commission ABAE Automatique</div>
          <div class="commission-row"><span>Montant transaction</span><span id="priceCommTotal" style="font-family:'JetBrains Mono',monospace;">â€”</span></div>
          <div class="commission-row"><span>Commission ABAE (5%)</span><span id="priceCommABAE" style="font-family:'JetBrains Mono',monospace;color:#E53E3E;">â€”</span></div>
          <div class="commission-row"><span style="font-weight:700;">Net vendeur</span><span id="priceCommNet" style="font-family:'JetBrains Mono',monospace;color:#4A9E2A;font-weight:700;">â€”</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SHEET IA MATCHING -->
  <div class="sheet" id="aiMatchSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ¯ Matching IA Acheteur/Vendeur</div><button class="sheet-close" onclick="closeSheet('aiMatchSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header"><h3>ğŸ¯ Matching Automatique IA</h3><p>Trouvez automatiquement les meilleurs partenaires commerciaux</p></div>
      <div class="form-row">
        <div class="form-label">Vous Ãªtes</div>
        <select class="form-select" id="matchRole">
          <option value="acheteur">ğŸ›’ Acheteur â€” je cherche Ã  acheter</option>
          <option value="vendeur">ğŸ“¦ Vendeur â€” je cherche des acheteurs</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">Produit / Service</div>
        <select class="form-select" id="matchProduct">
          <option value="mais">ğŸŒ¾ MaÃ¯s blanc</option><option value="boeufs">ğŸ„ BÅ“ufs</option>
          <option value="cacao">ğŸ« Cacao</option><option value="transport">ğŸš› Transport</option>
          <option value="financement">ğŸ’° Financement</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">Budget / Volume estimÃ© (XAF)</div>
        <input class="form-input" id="matchBudget" type="number" placeholder="Ex : 500 000" inputmode="numeric"/>
      </div>
      <button class="btn-ia" onclick="runMatching()"><span>ğŸ¯</span> Trouver des matchings IA</button>
      <div class="ai-result-zone" id="matchResult">
        <div class="ai-result-header">ğŸ¯ Profils Correspondants DÃ©tectÃ©s</div>
        <div id="matchList" style="display:flex;flex-direction:column;gap:10px;margin-top:8px;"></div>
      </div>
    </div>
  </div>

  <!-- SHEET IA SCORE FIABILITE -->
  <div class="sheet" id="aiScoreSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">â­ Score FiabilitÃ© IA</div><button class="sheet-close" onclick="closeSheet('aiScoreSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header"><h3>â­ Analyse FiabilitÃ© Acteur</h3><p>L'IA Ã©value la crÃ©dibilitÃ© des vendeurs et acheteurs</p></div>
      <div class="form-row">
        <div class="form-label">SÃ©lectionner un acteur</div>
        <select class="form-select" id="scoreActorSelect">
          <option value="coop">Coop. Mvog-Be (MaÃ¯s)</option>
          <option value="ali">Ã‰leveur Ali Hamidou (BÅ“ufs)</option>
          <option value="transcold">TransCold Sarl (Transport)</option>
          <option value="microagro">MicroAgro Finance</option>
          <option value="exportateurs">Exportateurs du Sud (Cacao)</option>
        </select>
      </div>
      <button class="btn-ia" onclick="runScoreAnalysis()"><span>â­</span> Analyser la fiabilitÃ© IA</button>
      <div class="ai-result-zone" id="scoreResult">
        <div class="ai-result-header">ğŸ“Š Score FiabilitÃ© ABAE Smart</div>
        <div style="text-align:center;padding:12px 0;">
          <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:2.5rem;color:#4A9E2A;" id="scoreCircleVal">â€”</div>
          <div style="font-size:0.72rem;color:#9BA3AE;" id="scoreLabel">/ 100</div>
        </div>
        <div class="ai-result-row"><span class="ai-result-label">Transactions rÃ©ussies</span><span class="ai-result-value good" id="scoreTx">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Note moyenne</span><span class="ai-result-value good" id="scoreRating">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">DÃ©lais respectÃ©s</span><span class="ai-result-value" id="scoreDelays">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Profil vÃ©rifiÃ© KYC</span><span class="ai-result-value good" id="scoreKyc">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Recommandation IA</span><span class="ai-result-value good" id="scoreReco">â€”</span></div>
        <div class="phone-masked" style="margin-top:12px;" id="maskedContact">
          <div class="phone-masked-icon">ğŸ“µ</div>
          <div class="phone-masked-text">
            <strong>Contact disponible aprÃ¨s validation</strong>
            Effectuez un paiement sÃ©curisÃ© ABAE pour accÃ©der aux coordonnÃ©es
          </div>
          <button class="phone-unlock-btn" onclick="unlockContact()">Payer & DÃ©bloquer</button>
        </div>
        <div id="unlockedContact" style="display:none;background:#f2fae8;border-radius:8px;padding:10px;margin-top:8px;font-size:0.78rem;color:#4A9E2A;text-align:center;">
          âœ… Contact dÃ©bloquÃ© : <strong id="contactPhone">+237 6XX XXX XXX</strong>
        </div>
      </div>
    </div>
  </div>

  <!-- SHEET IA DETECTION FRAUDE -->
  <div class="sheet" id="aiDetectSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ” DÃ©tection Offres Suspectes</div><button class="sheet-close" onclick="closeSheet('aiDetectSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header"><h3>ğŸ” DÃ©tection IA Fraudes & Anomalies</h3><p>L'IA analyse les signaux d'alerte pour protÃ©ger vos transactions</p></div>
      <div class="form-row">
        <div class="form-label">Description de l'offre Ã  analyser</div>
        <textarea class="form-input" id="detectDescription" rows="3" placeholder="DÃ©crivez l'offre ou ce qui vous semble suspectâ€¦" style="resize:none;line-height:1.5;"></textarea>
      </div>
      <div class="form-row">
        <div class="form-label">Prix proposÃ© (XAF)</div>
        <input class="form-input" id="detectPrice" type="number" placeholder="Ex : 5 000" inputmode="numeric"/>
      </div>
      <button class="btn-ia" onclick="runDetection()"><span>ğŸ”</span> Analyser avec ABAE Smart IA</button>
      <div class="ai-result-zone" id="detectResult">
        <div class="ai-result-header">ğŸ” RÃ©sultats Analyse SÃ©curitÃ©</div>
        <div style="text-align:center;padding:10px 0 14px;">
          <div id="detectRiskLevel" style="font-size:1.8rem;">â€”</div>
          <div id="detectRiskText" style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.9rem;">Chargementâ€¦</div>
        </div>
        <div class="ai-result-row"><span class="ai-result-label">Prix cohÃ©rent avec marchÃ©</span><span class="ai-result-value" id="detectPriceOk">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Signaux d'alerte dÃ©tectÃ©s</span><span class="ai-result-value" id="detectAlerts">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">ProbabilitÃ© fraude</span><span class="ai-result-value" id="detectFraudProb">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Recommandation IA</span><span class="ai-result-value good" id="detectReco">â€”</span></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NOUVEAUX SHEETS IA CONTEXTUELS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

  <!-- SHEET IA EMPLOIS â€” Analyser le poste -->
  <div class="sheet" id="aiJobSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ§  Analyse IA du Poste</div><button class="sheet-close" onclick="closeSheet('aiJobSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header">
        <h3>ğŸ§  DÃ©cryptage Intelligent du Poste</h3>
        <p>L'IA analyse l'offre et vous dit si elle correspond Ã  votre profil</p>
      </div>
      <div class="form-row">
        <div class="form-label">Votre niveau d'expÃ©rience</div>
        <select class="form-select" id="jobNiveau">
          <option value="debutant">DÃ©butant (0â€“1 an)</option>
          <option value="junior">Junior (1â€“3 ans)</option>
          <option value="confirme">ConfirmÃ© (3â€“5 ans)</option>
          <option value="senior">Senior (5+ ans)</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">Votre domaine principal</div>
        <select class="form-select" id="jobDomaine">
          <option>ğŸŒ¾ Production agricole</option>
          <option>ğŸ„ Ã‰levage</option>
          <option>ğŸš› Transport & logistique</option>
          <option>ğŸ­ Transformation agroalim.</option>
          <option>ğŸ’» Digital & Tech Agri</option>
          <option>ğŸ“Š Gestion & finance</option>
        </select>
      </div>
      <button class="btn-ia" onclick="runJobAnalysis()"><span>ğŸ§ </span> Analyser ce poste avec l'IA</button>
      <div class="ai-result-zone" id="jobAnalysisResult">
        <div class="ai-result-header">ğŸ“‹ Analyse du Poste ABAE Smart</div>
        <div style="text-align:center;padding:12px 0;">
          <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:2rem;color:#1A5C8A;" id="jobMatchScore">â€”</div>
          <div style="font-size:0.72rem;color:#9BA3AE;">CompatibilitÃ© profil / poste</div>
        </div>
        <div class="ai-result-row"><span class="ai-result-label">Salaire estimÃ© marchÃ©</span><span class="ai-result-value good" id="jobSalaire">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">CompÃ©tences clÃ©s requises</span><span class="ai-result-value" id="jobCompetences">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Niveau de concurrence</span><span class="ai-result-value" id="jobConcurrence">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Conseil IA</span><span class="ai-result-value good" id="jobConseil">â€”</span></div>
      </div>
    </div>
  </div>

  <!-- SHEET IA EMPLOIS â€” PrÃ©parer entretien -->
  <div class="sheet" id="aiInterviewSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ¤ PrÃ©paration Entretien IA</div><button class="sheet-close" onclick="closeSheet('aiInterviewSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header">
        <h3>ğŸ¤ Coach Entretien IA ABAE</h3>
        <p>L'IA gÃ©nÃ¨re des questions types et des conseils personnalisÃ©s pour maximiser vos chances</p>
      </div>
      <div class="form-row">
        <div class="form-label">Type de poste visÃ©</div>
        <select class="form-select" id="interviewPoste">
          <option>Technicien agricole</option>
          <option>Responsable d'exploitation</option>
          <option>Chauffeur / Logisticien</option>
          <option>Comptable / Gestionnaire</option>
          <option>Commercial / Agent terrain</option>
          <option>VÃ©tÃ©rinaire / Agronome</option>
        </select>
      </div>
      <button class="btn-ia" onclick="runInterviewPrep()"><span>ğŸ¤</span> GÃ©nÃ©rer mon kit d'entretien</button>
      <div class="ai-result-zone" id="interviewResult">
        <div class="ai-result-header">ğŸ¯ Kit Entretien PersonnalisÃ©</div>
        <div id="interviewQuestions" style="margin-top:8px;display:flex;flex-direction:column;gap:8px;"></div>
        <div class="ai-result-row" style="margin-top:10px;"><span class="ai-result-label">Conseil clÃ©</span><span class="ai-result-value good" id="interviewTip">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Erreur Ã  Ã©viter</span><span class="ai-result-value warn" id="interviewWarn">â€”</span></div>
      </div>
    </div>
  </div>

  <!-- SHEET IA FORMATION â€” Programme & Analyse -->
  <div class="sheet" id="aiFormationSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ“‹ Programme & Analyse IA</div><button class="sheet-close" onclick="closeSheet('aiFormationSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header">
        <h3>ğŸ“‹ Analyse IA de la Formation</h3>
        <p>L'IA Ã©value le programme, le rapport qualitÃ©/prix et l'adÃ©quation Ã  votre activitÃ©</p>
      </div>
      <div class="form-row">
        <div class="form-label">Votre activitÃ© principale</div>
        <select class="form-select" id="formActivite">
          <option>ğŸŒ¾ Agriculteur / Ã‰leveur</option>
          <option>ğŸ¤ Responsable coopÃ©rative</option>
          <option>ğŸ­ Transformateur</option>
          <option>ğŸš› Transporteur / Logisticien</option>
          <option>ğŸ’° Acteur financier</option>
          <option>ğŸ§‘â€ğŸ“ Ã‰tudiant / DÃ©butant</option>
        </select>
      </div>
      <button class="btn-ia" onclick="runFormationAnalysis()"><span>ğŸ“‹</span> Analyser cette formation</button>
      <div class="ai-result-zone" id="formationResult">
        <div class="ai-result-header">ğŸ“Š Analyse Formation ABAE Smart</div>
        <div style="text-align:center;padding:10px 0;">
          <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:2rem;color:#4A9E2A;" id="formScore">â€”</div>
          <div style="font-size:0.72rem;color:#9BA3AE;">Score formation / 100</div>
        </div>
        <div class="ai-result-row"><span class="ai-result-label">Rapport qualitÃ©/prix</span><span class="ai-result-value good" id="formQP">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">AdÃ©quation Ã  votre profil</span><span class="ai-result-value good" id="formAdeq">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Points forts</span><span class="ai-result-value good" id="formPlus">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Points de vigilance</span><span class="ai-result-value warn" id="formMinus">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Recommandation IA</span><span class="ai-result-value good" id="formReco">â€”</span></div>
      </div>
    </div>
  </div>

  <!-- SHEET IA ASSURANCE â€” Simuler prime -->
  <div class="sheet" id="aiAssuranceSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ’° Simulation de Prime IA</div><button class="sheet-close" onclick="closeSheet('aiAssuranceSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header">
        <h3>ğŸ’° Simulateur de Prime ABAE</h3>
        <p>L'IA estime votre prime d'assurance selon votre activitÃ© et votre zone</p>
      </div>
      <div class="form-row">
        <div class="form-label">Ce que vous souhaitez assurer</div>
        <select class="form-select" id="assurType">
          <option value="recolte">ğŸŒ¾ RÃ©colte / Culture</option>
          <option value="betail">ğŸ„ Cheptel / BÃ©tail</option>
          <option value="infra">ğŸšï¸ Infrastructure agricole</option>
          <option value="equip">âš™ï¸ Ã‰quipements & machines</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">Surface (ha) ou nombre de tÃªtes</div>
        <input class="form-input" id="assurSurface" type="number" placeholder="Ex : 5 (ha) ou 50 (tÃªtes)" inputmode="numeric"/>
      </div>
      <div class="form-row">
        <div class="form-label">RÃ©gion</div>
        <select class="form-select" id="assurRegion">
          <option>YaoundÃ© / Centre</option><option>Douala / Littoral</option>
          <option>Bafoussam / Ouest</option><option>Nord / ExtrÃªme-Nord</option>
          <option>Est / Adamaoua</option>
        </select>
      </div>
      <button class="btn-ia" onclick="runAssuranceSimulation()"><span>ğŸ’°</span> Simuler ma prime IA</button>
      <div class="ai-result-zone" id="assuranceResult">
        <div class="ai-result-header">ğŸ›¡ï¸ Simulation Prime ABAE Smart</div>
        <div class="ai-result-row"><span class="ai-result-label">Prime annuelle estimÃ©e</span><span class="ai-result-value good" id="assurPrime">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Couverture maximale</span><span class="ai-result-value good" id="assurCouv">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Niveau de risque zone</span><span class="ai-result-value" id="assurRisque">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Conseil IA</span><span class="ai-result-value good" id="assurConseil">â€”</span></div>
      </div>
    </div>
  </div>

  <!-- SHEET IA FINANCEMENT â€” Simuler prÃªt -->
  <div class="sheet" id="aiFinancementSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ“Š Simulateur de PrÃªt IA</div><button class="sheet-close" onclick="closeSheet('aiFinancementSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="sheet-ai-header">
        <h3>ğŸ“Š Simulateur de Financement ABAE</h3>
        <p>L'IA calcule vos mensualitÃ©s et votre Ã©ligibilitÃ© en temps rÃ©el</p>
      </div>
      <div class="form-row">
        <div class="form-label">Montant souhaitÃ© (XAF)</div>
        <input class="form-input" id="finMontant" type="number" placeholder="Ex : 3 000 000" inputmode="numeric"/>
      </div>
      <div class="form-row">
        <div class="form-label">DurÃ©e de remboursement</div>
        <select class="form-select" id="finDuree">
          <option value="6">6 mois</option><option value="12">12 mois</option>
          <option value="24">24 mois</option><option value="36">36 mois</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">Votre revenu mensuel estimÃ© (XAF)</div>
        <input class="form-input" id="finRevenu" type="number" placeholder="Ex : 250 000" inputmode="numeric"/>
      </div>
      <button class="btn-ia" onclick="runFinancementSimulation()"><span>ğŸ“Š</span> Simuler mon financement</button>
      <div class="ai-result-zone" id="financementResult">
        <div class="ai-result-header">ğŸ’° RÃ©sultats Simulation ABAE Smart</div>
        <div class="ai-result-row"><span class="ai-result-label">MensualitÃ© estimÃ©e</span><span class="ai-result-value good" id="finMensual">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">CoÃ»t total du crÃ©dit</span><span class="ai-result-value" id="finTotal">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Taux d'effort</span><span class="ai-result-value" id="finEffort">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Ã‰ligibilitÃ© estimÃ©e</span><span class="ai-result-value good" id="finElig">â€”</span></div>
        <div class="ai-result-row"><span class="ai-result-label">Conseil IA</span><span class="ai-result-value good" id="finConseil">â€”</span></div>
      </div>
    </div>
  </div>

  <!-- SHEET IA LOGISTIQUE -->
  <div class="sheet" id="aiLogisticsSheet" style="max-height:90%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸš› IA Logistique Intelligente</div><button class="sheet-close" onclick="closeSheet('aiLogisticsSheet')">âœ•</button></div>
    <div class="sheet-body" style="padding-bottom:20px;">
      <div class="sheet-ai-header"><h3>ğŸš› Optimisation Logistique IA</h3><p>Trajet optimal Â· DÃ©lais estimÃ©s Â· CoÃ»ts calculÃ©s Â· Cargaisons regroupÃ©es</p></div>
      <div class="tabs" style="margin-bottom:14px;">
        <div class="tab active" id="logTab1" onclick="switchLogTab(1)">Trajet</div>
        <div class="tab" id="logTab2" onclick="switchLogTab(2)">CoÃ»ts</div>
        <div class="tab" id="logTab3" onclick="switchLogTab(3)">Groupage</div>
      </div>
      <div id="logTabContent1">
        <div class="form-row"><div class="form-label">Ville de dÃ©part</div><select class="form-select" id="logFrom"><option>YaoundÃ©</option><option>Douala</option><option>Bafoussam</option><option>NgaoundÃ©rÃ©</option><option>Garoua</option></select></div>
        <div class="form-row"><div class="form-label">Ville d'arrivÃ©e</div><select class="form-select" id="logTo"><option>Douala</option><option>YaoundÃ©</option><option>Bafoussam</option><option>NgaoundÃ©rÃ©</option><option>Garoua</option></select></div>
        <div class="form-row"><div class="form-label">Type marchandise</div><select class="form-select" id="logGoodsType"><option value="agro">ğŸŒ¾ Produits agricoles</option><option value="frigo">â„ï¸ Produits frais</option><option value="betail">ğŸ„ BÃ©tail vivant</option><option value="vrac">ğŸ“¦ Vrac gÃ©nÃ©ral</option></select></div>
        <div class="form-row"><div class="form-label">Poids estimÃ© (kg)</div><input class="form-input" id="logWeight" type="number" placeholder="Ex : 5000" inputmode="numeric"/></div>
        <button class="btn-ia" onclick="runLogisticsOptimization()"><span>ğŸš›</span> Optimiser le trajet IA</button>
        <div class="ai-result-zone" id="logisticsResult">
          <div class="ai-result-header">ğŸ—ºï¸ Plan de Transport OptimisÃ©</div>
          <div class="ai-result-row"><span class="ai-result-label">Distance estimÃ©e</span><span class="ai-result-value" id="logDistance">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">DÃ©lai estimÃ©</span><span class="ai-result-value good" id="logDuration">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Type vÃ©hicule recommandÃ©</span><span class="ai-result-value" id="logVehicle">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">CoÃ»t transport estimÃ©</span><span class="ai-result-value good" id="logCost">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Route optimale IA</span><span class="ai-result-value good" id="logRoute">â€”</span></div>
        </div>
      </div>
      <div id="logTabContent2" style="display:none;">
        <div class="form-row"><div class="form-label">Valeur marchandise (XAF)</div><input class="form-input" id="logGoodsValue" type="number" placeholder="Ex : 500 000" inputmode="numeric"/></div>
        <div class="form-row"><div class="form-label">Distance (km)</div><input class="form-input" id="logDistKm" type="number" placeholder="Ex : 350" inputmode="numeric"/></div>
        <div class="form-row"><div class="form-label">Assurance</div><select class="form-select" id="logInsurance"><option value="none">Sans assurance</option><option value="basic">Assurance basique (1%)</option><option value="full">Assurance complÃ¨te (2.5%)</option></select></div>
        <button class="btn-ia" onclick="runCostCalculation()"><span>ğŸ’°</span> Calculer les coÃ»ts complets</button>
        <div class="ai-result-zone" id="costResult">
          <div class="ai-result-header">ğŸ’° DÃ©tail des CoÃ»ts Logistiques</div>
          <div class="ai-result-row"><span class="ai-result-label">Transport</span><span class="ai-result-value" id="costTransport">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Chargement/DÃ©chargement</span><span class="ai-result-value" id="costHandling">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Assurance</span><span class="ai-result-value" id="costInsurance">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Commission ABAE (auto)</span><span class="ai-result-value warn" id="costAbae">â€”</span></div>
          <div class="ai-result-row" style="border-top:2px solid #4A9E2A;margin-top:4px;"><span class="ai-result-label" style="font-weight:700;">Total estimÃ©</span><span class="ai-result-value good" id="costTotal" style="font-size:1rem;">â€”</span></div>
        </div>
      </div>
      <div id="logTabContent3" style="display:none;">
        <div style="background:#f2fae8;border-radius:10px;padding:12px;margin-bottom:12px;font-size:0.75rem;color:#4A9E2A;">ğŸ”— <strong>Groupage IA :</strong> Partagez un camion avec d'autres expÃ©diteurs â€” Ã©conomies jusqu'Ã  40%.</div>
        <div class="form-row"><div class="form-label">Votre trajet</div><input class="form-input" id="groupageRoute" placeholder="Ex : YaoundÃ© â†’ Douala"/></div>
        <div class="form-row"><div class="form-label">Volume disponible (mÂ³)</div><input class="form-input" id="groupageVolume" type="number" placeholder="Ex : 5" inputmode="numeric"/></div>
        <button class="btn-ia" onclick="runGroupage()"><span>ğŸ”—</span> Trouver des partenaires de groupage</button>
        <div class="ai-result-zone" id="groupageResult">
          <div class="ai-result-header">ğŸ”— OpportunitÃ©s de Groupage DÃ©tectÃ©es</div>
          <div id="groupageList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SHEET IA FINANCE -->
  <div class="sheet" id="aiFinanceSheet" style="max-height:90%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ’° IA Finance & Assurance</div><button class="sheet-close" onclick="closeSheet('aiFinanceSheet')">âœ•</button></div>
    <div class="sheet-body" style="padding-bottom:20px;">
      <div class="sheet-ai-header"><h3>ğŸ’° Intelligence FinanciÃ¨re Agricole</h3><p>Scoring crÃ©dit Â· Financement Â· RentabilitÃ© Â· Risque</p></div>
      <div class="tabs" style="margin-bottom:14px;">
        <div class="tab active" id="finTab1" onclick="switchFinTab(1)">CrÃ©dit</div>
        <div class="tab" id="finTab2" onclick="switchFinTab(2)">Financement</div>
        <div class="tab" id="finTab3" onclick="switchFinTab(3)">RentabilitÃ©</div>
      </div>
      <div id="finTabContent1">
        <div class="form-row"><div class="form-label">Type d'activitÃ©</div><select class="form-select" id="creditActivity"><option value="culture">ğŸŒ¾ Culture vivriÃ¨re</option><option value="elevage">ğŸ„ Ã‰levage</option><option value="transport">ğŸš› Transport agricole</option><option value="coop">ğŸ¤ CoopÃ©rative</option><option value="export">ğŸ“¦ Export agricole</option></select></div>
        <div class="form-row"><div class="form-label">AnciennetÃ© (annÃ©es)</div><input class="form-input" id="creditAge" type="number" placeholder="Ex : 5" inputmode="numeric"/></div>
        <div class="form-row"><div class="form-label">CA annuel (XAF)</div><input class="form-input" id="creditCA" type="number" placeholder="Ex : 5 000 000" inputmode="numeric"/></div>
        <div class="form-row"><div class="form-label">Nb transactions ABAE</div><input class="form-input" id="creditTx" type="number" placeholder="Ex : 12" inputmode="numeric"/></div>
        <button class="btn-ia" onclick="runCreditScoring()"><span>ğŸ“Š</span> Calculer mon Score CrÃ©dit IA</button>
        <div class="ai-result-zone" id="creditResult">
          <div class="ai-result-header">ğŸ¦ Score CrÃ©dit Agricole ABAE</div>
          <div style="text-align:center;padding:12px 0;"><div id="creditScoreVal" style="font-family:'Sora',sans-serif;font-weight:800;font-size:2rem;color:#4A9E2A;">â€”</div><div id="creditScoreLabel" style="font-size:0.72rem;color:#9BA3AE;">Score sur 850</div></div>
          <div class="ai-result-row"><span class="ai-result-label">Montant finanÃ§able</span><span class="ai-result-value good" id="creditAmount">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Taux estimÃ©</span><span class="ai-result-value" id="creditRate">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Partenaires financiers</span><span class="ai-result-value good" id="creditPartners">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Recommandation IA</span><span class="ai-result-value good" id="creditReco">â€”</span></div>
        </div>
      </div>
      <div id="finTabContent2" style="display:none;">
        <div class="form-row"><div class="form-label">Montant souhaitÃ© (XAF)</div><input class="form-input" id="finAmount" type="number" placeholder="Ex : 2 000 000" inputmode="numeric"/></div>
        <div class="form-row"><div class="form-label">DurÃ©e (mois)</div><select class="form-select" id="finDuration"><option value="6">6 mois</option><option value="12">12 mois</option><option value="18">18 mois</option><option value="24">24 mois</option></select></div>
        <div class="form-row"><div class="form-label">Objet du financement</div><select class="form-select" id="finPurpose"><option value="equipement">ğŸ”§ Ã‰quipement</option><option value="intrants">ğŸŒ± Intrants</option><option value="terrain">ğŸï¸ Foncier</option><option value="fonds">ğŸ’° Fonds de roulement</option></select></div>
        <button class="btn-ia" onclick="runFinancingSimulation()"><span>ğŸ’°</span> Simuler le financement</button>
        <div class="ai-result-zone" id="finSimResult">
          <div class="ai-result-header">ğŸ’° Simulation Financement</div>
          <div class="ai-result-row"><span class="ai-result-label">Montant empruntÃ©</span><span class="ai-result-value" id="finSimAmount">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Taux appliquÃ© (IA)</span><span class="ai-result-value warn" id="finSimRate">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">MensualitÃ© estimÃ©e</span><span class="ai-result-value good" id="finSimMonthly">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">CoÃ»t total crÃ©dit</span><span class="ai-result-value warn" id="finSimTotalCost">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Organisme recommandÃ©</span><span class="ai-result-value good" id="finSimOrg">â€”</span></div>
        </div>
      </div>
      <div id="finTabContent3" style="display:none;">
        <div class="form-row"><div class="form-label">Investissement total (XAF)</div><input class="form-input" id="rentInvest" type="number" placeholder="Ex : 1 000 000" inputmode="numeric"/></div>
        <div class="form-row"><div class="form-label">CA prÃ©vu (XAF/an)</div><input class="form-input" id="rentCA" type="number" placeholder="Ex : 2 500 000" inputmode="numeric"/></div>
        <div class="form-row"><div class="form-label">Charges fixes annuelles (XAF)</div><input class="form-input" id="rentCharges" type="number" placeholder="Ex : 800 000" inputmode="numeric"/></div>
        <button class="btn-ia" onclick="runRentabilityAnalysis()"><span>ğŸ“ˆ</span> Analyser la rentabilitÃ©</button>
        <div class="ai-result-zone" id="rentResult">
          <div class="ai-result-header">ğŸ“ˆ Analyse RentabilitÃ©</div>
          <div class="ai-result-row"><span class="ai-result-label">Marge brute estimÃ©e</span><span class="ai-result-value good" id="rentMargin">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">RÃ©sultat net estimÃ©</span><span class="ai-result-value good" id="rentNet">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Taux de rentabilitÃ©</span><span class="ai-result-value good" id="rentRate">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Seuil de rentabilitÃ©</span><span class="ai-result-value" id="rentBreakeven">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Retour sur investissement</span><span class="ai-result-value good" id="rentPayback">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Avis IA</span><span class="ai-result-value good" id="rentAvis">â€”</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET RH AGRIBUSINESS IA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="aiHRSheet" style="max-height:95%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ§‘â€ğŸ’¼ RH Agribusiness IA</div>
      <button class="sheet-close" onclick="closeSheet('aiHRSheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="padding-bottom:24px;">
      <div class="sheet-ai-header" style="background:linear-gradient(135deg,#7A5A00,#D4A843);">
        <h3>ğŸ§‘â€ğŸ’¼ Gestion RH Agro-Pastorale</h3>
        <p>Recrutement intelligent Â· Contrats Â· Paie Â· Formation Â· Ã‰valuation</p>
      </div>

      <!-- Tarifs -->
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px;">
        <div style="background:#FFFBF0;border:1.5px solid rgba(212,168,67,0.35);border-radius:12px;padding:8px;text-align:center;">
          <div style="font-size:0.65rem;font-weight:700;color:#7A5A00;">STARTER</div>
          <div style="font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.85rem;color:#D4A843;margin:3px 0;">5 000</div>
          <div style="font-size:0.55rem;color:#9BA3AE;">XAF / doc</div>
        </div>
        <div style="background:linear-gradient(135deg,#FFF3CD,#FFFBF0);border:2px solid #D4A843;border-radius:12px;padding:8px;text-align:center;position:relative;">
          <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:#D4A843;color:#fff;font-size:0.5rem;font-weight:700;padding:1px 7px;border-radius:10px;white-space:nowrap;">POPULAIRE</div>
          <div style="font-size:0.65rem;font-weight:700;color:#7A5A00;">PRO</div>
          <div style="font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.85rem;color:#D4A843;margin:3px 0;">25 000</div>
          <div style="font-size:0.55rem;color:#9BA3AE;">XAF / mois</div>
        </div>
        <div style="background:#F0FFF4;border:1.5px solid rgba(74,158,42,0.3);border-radius:12px;padding:8px;text-align:center;">
          <div style="font-size:0.65rem;font-weight:700;color:#4A9E2A;">ENTREPRISE</div>
          <div style="font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.85rem;color:#4A9E2A;margin:3px 0;">Sur devis</div>
          <div style="font-size:0.55rem;color:#9BA3AE;">illimitÃ©</div>
        </div>
      </div>

      <div class="tabs" style="margin-bottom:14px;">
        <div class="tab active" id="hrTab1" onclick="switchHRTab(1)">Recruter</div>
        <div class="tab" id="hrTab2" onclick="switchHRTab(2)">Contrats</div>
        <div class="tab" id="hrTab3" onclick="switchHRTab(3)">Paie</div>
        <div class="tab" id="hrTab4" onclick="switchHRTab(4)">Formation</div>
      </div>

      <!-- TAB 1 : RECRUTEMENT -->
      <div id="hrTabContent1">
        <div style="background:#F0FFF4;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.72rem;color:#1A4A2B;border:1px solid rgba(74,158,42,0.15);">
          ğŸ¤– <strong>L'IA gÃ©nÃ¨re votre fiche de poste complÃ¨te</strong> avec profil candidat, compÃ©tences requises, grille salariale et questions d'entretien adaptÃ©es au secteur agro-pastoral camerounais.
        </div>
        <div class="form-row"><div class="form-label">Poste Ã  pourvoir</div>
          <select class="form-select" id="hrPoste">
            <option value="agronome">ğŸŒ¾ Agronome / Conseiller agricole</option>
            <option value="technicien">ğŸ”§ Technicien agricole</option>
            <option value="eleveur">ğŸ„ Chef d'Ã©levage</option>
            <option value="commercial">ğŸ’¼ Commercial agribusiness</option>
            <option value="logisticien">ğŸš› Responsable logistique</option>
            <option value="comptable">ğŸ“Š Comptable / Gestionnaire</option>
            <option value="ouvrier">ğŸ‘· Ouvrier agricole</option>
            <option value="directeur">ğŸ¢ Directeur d'exploitation</option>
            <option value="autre">âœï¸ Autre poste</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Niveau d'expÃ©rience requis</div>
          <select class="form-select" id="hrNiveau">
            <option value="debutant">DÃ©butant (0â€“2 ans)</option>
            <option value="confirme">ConfirmÃ© (3â€“5 ans)</option>
            <option value="senior">Senior (5+ ans)</option>
            <option value="expert">Expert / Cadre supÃ©rieur</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">RÃ©gion d'activitÃ©</div>
          <select class="form-select" id="hrRegion">
            <option>YaoundÃ© / Centre</option><option>Douala / Littoral</option>
            <option>Ouest / Bafoussam</option><option>Nord / Garoua</option>
            <option>ExtrÃªme-Nord</option><option>Adamaoua</option>
            <option>Sud-Ouest</option><option>Nord-Ouest</option>
            <option>Est</option><option>Sud</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Type de structure</div>
          <select class="form-select" id="hrStructure">
            <option value="exploitation">Exploitation agricole</option>
            <option value="coop">CoopÃ©rative agricole</option>
            <option value="pme">PME agribusiness</option>
            <option value="ong">ONG / Projet de dÃ©veloppement</option>
            <option value="export">SociÃ©tÃ© d'export</option>
          </select>
        </div>
        <button class="btn-ia" style="background:linear-gradient(135deg,#D4A843,#B8860B);" onclick="runHRRecrutement()">
          <span>ğŸ¤–</span> GÃ©nÃ©rer la Fiche de Poste IA
        </button>
        <div class="ai-result-zone" id="hrRecrutResult">
          <div class="ai-result-header">ğŸ“„ Fiche de Poste GÃ©nÃ©rÃ©e</div>
          <div id="hrRecrutContent" style="font-size:0.78rem;line-height:1.6;color:#3D4550;margin-top:8px;white-space:pre-wrap;"></div>
          <button id="hrDownloadBtn" class="btn-ia-outline" style="margin-top:10px;display:none;" onclick="downloadHRDoc()">
            ğŸ“¥ TÃ©lÃ©charger en PDF
          </button>
        </div>
      </div>

      <!-- TAB 2 : CONTRATS -->
      <div id="hrTabContent2" style="display:none;">
        <div style="background:#FFF5E8;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.72rem;color:#7A5A00;border:1px solid rgba(212,168,67,0.25);">
          âš ï¸ Documents gÃ©nÃ©rÃ©s conformes au <strong>Code du Travail camerounais</strong>. Validez avec un juriste avant signature.
        </div>
        <div class="form-row"><div class="form-label">Type de contrat</div>
          <select class="form-select" id="hrContratType">
            <option value="cdi">CDI â€” Contrat Ã  DurÃ©e IndÃ©terminÃ©e</option>
            <option value="cdd">CDD â€” Contrat Ã  DurÃ©e DÃ©terminÃ©e</option>
            <option value="saisonnier">Contrat Saisonnier Agricole</option>
            <option value="journalier">Contrat Journalier / Prestation</option>
            <option value="apprentissage">Contrat d'Apprentissage</option>
            <option value="stage">Convention de Stage</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Poste / Fonction</div>
          <input class="form-input" id="hrContratPoste" placeholder="Ex : Technicien agricole" />
        </div>
        <div class="form-row"><div class="form-label">Salaire brut mensuel (XAF)</div>
          <input class="form-input" id="hrContratSalaire" type="number" placeholder="Ex : 80 000" inputmode="numeric" />
        </div>
        <div class="form-row"><div class="form-label">DurÃ©e (pour CDD/Saisonnier)</div>
          <select class="form-select" id="hrContratDuree">
            <option value="">Non applicable (CDI)</option>
            <option value="1 mois">1 mois</option><option value="3 mois">3 mois</option>
            <option value="6 mois">6 mois</option><option value="1 an">1 an</option>
            <option value="Campagne agricole">Campagne agricole</option>
          </select>
        </div>
        <button class="btn-ia" style="background:linear-gradient(135deg,#D4A843,#B8860B);" onclick="runHRContrat()">
          <span>ğŸ“„</span> GÃ©nÃ©rer le Contrat IA
        </button>
        <div class="ai-result-zone" id="hrContratResult">
          <div class="ai-result-header">ğŸ“ Contrat de Travail GÃ©nÃ©rÃ©</div>
          <div id="hrContratContent" style="font-size:0.75rem;line-height:1.6;color:#3D4550;margin-top:8px;white-space:pre-wrap;"></div>
          <button id="hrContratDownloadBtn" class="btn-ia-outline" style="margin-top:10px;display:none;" onclick="downloadHRContrat()">
            ğŸ“¥ TÃ©lÃ©charger le contrat
          </button>
        </div>
      </div>

      <!-- TAB 3 : PAIE & GRILLES SALARIALES -->
      <div id="hrTabContent3" style="display:none;">
        <div style="background:#EDF7E5;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.72rem;color:#1A4A2B;border:1px solid rgba(74,158,42,0.15);">
          ğŸ’¡ Calculs basÃ©s sur le <strong>SMIG camerounais</strong> (36 270 XAF) et les conventions collectives du secteur agricole.
        </div>
        <div class="form-row"><div class="form-label">Salaire brut (XAF/mois)</div>
          <input class="form-input" id="hrPaieSalaire" type="number" placeholder="Ex : 120 000" inputmode="numeric" />
        </div>
        <div class="form-row"><div class="form-label">Nombre d'employÃ©s</div>
          <input class="form-input" id="hrNbEmployes" type="number" placeholder="Ex : 5" inputmode="numeric" value="1" />
        </div>
        <div class="form-row"><div class="form-label">Avantages en nature</div>
          <select class="form-select" id="hrAvantages">
            <option value="0">Aucun</option>
            <option value="5000">Logement fourni (+5 000 XAF/mois)</option>
            <option value="10000">Repas fournis (+10 000 XAF/mois)</option>
            <option value="15000">Logement + Repas (+15 000 XAF/mois)</option>
          </select>
        </div>
        <button class="btn-ia" style="background:linear-gradient(135deg,#D4A843,#B8860B);" onclick="runHRPaie()">
          <span>ğŸ’°</span> Calculer la Fiche de Paie IA
        </button>
        <div class="ai-result-zone" id="hrPaieResult">
          <div class="ai-result-header">ğŸ’° Bulletin de Paie CalculÃ©</div>
          <div class="ai-result-row"><span class="ai-result-label">Salaire brut</span><span class="ai-result-value" id="hrPaieGross">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">CNPS employÃ© (4.2%)</span><span class="ai-result-value warn" id="hrCNPSemp">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">IRPP estimÃ©</span><span class="ai-result-value warn" id="hrIRPP">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label" style="font-weight:700;">Salaire net</span><span class="ai-result-value good" id="hrPaieNet" style="font-size:1rem;">â€”</span></div>
          <div style="border-top:1px dashed #E0E0E0;margin:8px 0;"></div>
          <div class="ai-result-row"><span class="ai-result-label">CNPS employeur (13.95%)</span><span class="ai-result-value warn" id="hrCNPSemp2">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label" style="font-weight:700;">CoÃ»t total employeur</span><span class="ai-result-value" id="hrCoutTotal">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Masse salariale totale</span><span class="ai-result-value good" id="hrMasseSalariale">â€”</span></div>
        </div>
      </div>

      <!-- TAB 4 : FORMATION & DÃ‰VELOPPEMENT -->
      <div id="hrTabContent4" style="display:none;">
        <div style="background:#EDF7E5;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.72rem;color:#1A4A2B;">
          ğŸ“ Plan de formation personnalisÃ© pour le dÃ©veloppement des compÃ©tences agro-pastorales de votre Ã©quipe.
        </div>
        <div class="form-row"><div class="form-label">Profil Ã  former</div>
          <select class="form-select" id="hrFormationProfil">
            <option value="ouvrier">Ouvriers agricoles</option>
            <option value="technicien">Techniciens de terrain</option>
            <option value="cadre">Cadres intermÃ©diaires</option>
            <option value="dirigeant">Dirigeants / Managers</option>
            <option value="commercial">Ã‰quipe commerciale</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Domaine de formation prioritaire</div>
          <select class="form-select" id="hrFormationDomaine">
            <option value="technique">ğŸŒ¾ Techniques agricoles modernes</option>
            <option value="numerique">ğŸ’» Digitalisation / Outils numÃ©riques</option>
            <option value="gestion">ğŸ“Š Gestion financiÃ¨re & comptabilitÃ©</option>
            <option value="leadership">ğŸ§‘â€ğŸ’¼ Leadership & management d'Ã©quipe</option>
            <option value="qualite">âœ… QualitÃ©, hygiÃ¨ne & certifications</option>
            <option value="export">ğŸ“¦ Export & commerce international</option>
            <option value="securite">ğŸ¦º SÃ©curitÃ© & prÃ©vention des risques</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Budget formation disponible (XAF)</div>
          <input class="form-input" id="hrFormationBudget" type="number" placeholder="Ex : 500 000" inputmode="numeric" />
        </div>
        <button class="btn-ia" style="background:linear-gradient(135deg,#D4A843,#B8860B);" onclick="runHRFormation()">
          <span>ğŸ“</span> GÃ©nÃ©rer le Plan de Formation IA
        </button>
        <div class="ai-result-zone" id="hrFormationResult">
          <div class="ai-result-header">ğŸ“ Plan de Formation PersonnalisÃ©</div>
          <div id="hrFormationContent" style="font-size:0.78rem;line-height:1.6;color:#3D4550;margin-top:8px;white-space:pre-wrap;"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHEET MONTAGE DE PROJETS IA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="sheet" id="aiProjectSheet" style="max-height:95%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ“‹ Montage de Projets IA</div>
      <button class="sheet-close" onclick="closeSheet('aiProjectSheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="padding-bottom:24px;">
      <div class="sheet-ai-header" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);">
        <h3>ğŸ“‹ Montage de Projets Agribusiness</h3>
        <p>Business plan Â· Budget Â· Pitch Â· Financement Â· Partenaires</p>
      </div>

      <!-- Tarifs projets -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;">
        <div style="background:#FFFBF0;border:1.5px solid rgba(212,168,67,0.35);border-radius:12px;padding:10px;text-align:center;">
          <div style="font-size:0.6rem;font-weight:700;color:#7A5A00;">BUSINESS PLAN</div>
          <div style="font-family:'JetBrains Mono',monospace;font-weight:700;font-size:1rem;color:#D4A843;margin:4px 0;">10 000</div>
          <div style="font-size:0.58rem;color:#9BA3AE;">XAF / document complet</div>
        </div>
        <div style="background:#F0FFF4;border:1.5px solid rgba(74,158,42,0.3);border-radius:12px;padding:10px;text-align:center;">
          <div style="font-size:0.6rem;font-weight:700;color:#4A9E2A;">DOSSIER COMPLET</div>
          <div style="font-family:'JetBrains Mono',monospace;font-weight:700;font-size:1rem;color:#4A9E2A;margin:4px 0;">35 000</div>
          <div style="font-size:0.58rem;color:#9BA3AE;">XAF / pack financement</div>
        </div>
      </div>

      <div class="tabs" style="margin-bottom:14px;overflow-x:auto;white-space:nowrap;">
        <div class="tab active" id="projTab1" onclick="switchProjTab(1)">Business Plan</div>
        <div class="tab" id="projTab2" onclick="switchProjTab(2)">Budget</div>
        <div class="tab" id="projTab3" onclick="switchProjTab(3)">Financement</div>
        <div class="tab" id="projTab4" onclick="switchProjTab(4)">Partenaires</div>
      </div>

      <!-- TAB 1 : BUSINESS PLAN -->
      <div id="projTabContent1">
        <div style="background:#EDF7E5;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.72rem;color:#1A4A2B;">
          ğŸš€ L'IA gÃ©nÃ¨re un <strong>business plan structurÃ©</strong> : rÃ©sumÃ© exÃ©cutif, analyse de marchÃ©, stratÃ©gie, prÃ©visions financiÃ¨res sur 3 ans.
        </div>
        <div class="form-row"><div class="form-label">Type de projet</div>
          <select class="form-select" id="projType">
            <option value="ferme">ğŸŒ¾ CrÃ©ation d'exploitation agricole</option>
            <option value="elevage">ğŸ„ Projet d'Ã©levage</option>
            <option value="transformation">ğŸ­ UnitÃ© de transformation agro-alimentaire</option>
            <option value="coop">ğŸ¤ CrÃ©ation de coopÃ©rative</option>
            <option value="export">ğŸ“¦ Projet d'exportation</option>
            <option value="irrigation">ğŸ’§ Projet d'irrigation / amÃ©nagement</option>
            <option value="serre">ğŸ¡ Culture sous serre</option>
            <option value="pisciculture">ğŸŸ Pisciculture / Aquaculture</option>
            <option value="agro-industrie">ğŸ¢ Agro-industrie</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Superficie / CapacitÃ©</div>
          <input class="form-input" id="projSuperficie" placeholder="Ex : 5 ha, 200 tÃªtes, 2 tonnes/jour" />
        </div>
        <div class="form-row"><div class="form-label">Localisation du projet</div>
          <select class="form-select" id="projLocalisation">
            <option>Centre (YaoundÃ©)</option><option>Littoral (Douala)</option>
            <option>Ouest (Bafoussam)</option><option>Nord (Garoua)</option>
            <option>Adamaoua (NgaoundÃ©rÃ©)</option><option>ExtrÃªme-Nord</option>
            <option>Sud-Ouest</option><option>Est</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Investissement initial estimÃ© (XAF)</div>
          <input class="form-input" id="projInvest" type="number" placeholder="Ex : 5 000 000" inputmode="numeric" />
        </div>
        <button class="btn-ia" onclick="runBusinessPlan()">
          <span>ğŸ“‹</span> GÃ©nÃ©rer le Business Plan IA
        </button>
        <div class="ai-result-zone" id="projBizResult">
          <div class="ai-result-header">ğŸ“‹ Business Plan â€” RÃ©sumÃ© ExÃ©cutif</div>
          <div id="projBizContent" style="font-size:0.78rem;line-height:1.65;color:#3D4550;margin-top:8px;white-space:pre-wrap;"></div>
          <button id="projBizDownloadBtn" class="btn-ia-outline" style="margin-top:10px;display:none;" onclick="downloadBusinessPlan()">
            ğŸ“¥ TÃ©lÃ©charger le Business Plan
          </button>
        </div>
      </div>

      <!-- TAB 2 : BUDGET PRÃ‰VISIONNEL -->
      <div id="projTabContent2" style="display:none;">
        <div class="form-row"><div class="form-label">Type de projet</div>
          <select class="form-select" id="budgetProjType">
            <option value="ferme">Exploitation agricole</option>
            <option value="elevage">Ã‰levage bovin / ovin</option>
            <option value="aviculture">Aviculture (poulets / pondeuses)</option>
            <option value="transformation">Transformation agro-alimentaire</option>
            <option value="pisciculture">Pisciculture</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Superficie / Effectif</div>
          <input class="form-input" id="budgetTaille" placeholder="Ex : 3 ha ou 500 poulets" />
        </div>
        <div class="form-row"><div class="form-label">Horizon prÃ©visionnel</div>
          <select class="form-select" id="budgetHorizon">
            <option value="1">1 an</option><option value="3" selected>3 ans</option><option value="5">5 ans</option>
          </select>
        </div>
        <button class="btn-ia" onclick="runBudgetPrevisionnel()">
          <span>ğŸ“Š</span> GÃ©nÃ©rer le Budget IA
        </button>
        <div class="ai-result-zone" id="budgetResult">
          <div class="ai-result-header">ğŸ“Š Budget PrÃ©visionnel</div>
          <div class="ai-result-row"><span class="ai-result-label">Investissements (CAPEX)</span><span class="ai-result-value" id="budCapex">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Charges d'exploitation (OPEX/an)</span><span class="ai-result-value warn" id="budOpex">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">CA prÃ©visionnel an 1</span><span class="ai-result-value good" id="budCA1">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">CA prÃ©visionnel an 3</span><span class="ai-result-value good" id="budCA3">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">RÃ©sultat net an 1</span><span class="ai-result-value" id="budNet1">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Point mort (mois)</span><span class="ai-result-value good" id="budBreakeven">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">ROI sur 3 ans</span><span class="ai-result-value good" id="budROI">â€”</span></div>
          <div id="budgetDetailLines" style="margin-top:10px;font-size:0.72rem;line-height:1.6;color:#3D4550;"></div>
        </div>
      </div>

      <!-- TAB 3 : DOSSIER FINANCEMENT -->
      <div id="projTabContent3" style="display:none;">
        <div style="background:#EDF7E5;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.72rem;color:#1A4A2B;">
          ğŸ¦ Identifiez les <strong>sources de financement adaptÃ©es</strong> Ã  votre projet et gÃ©nÃ©rez votre dossier de demande.
        </div>
        <div class="form-row"><div class="form-label">Montant recherchÃ© (XAF)</div>
          <input class="form-input" id="finProjMontant" type="number" placeholder="Ex : 10 000 000" inputmode="numeric" />
        </div>
        <div class="form-row"><div class="form-label">Type de financement souhaitÃ©</div>
          <select class="form-select" id="finProjType">
            <option value="credit">CrÃ©dit bancaire classique</option>
            <option value="microfinance">Microfinance / IMF</option>
            <option value="subvention">Subvention / Don (ONG/Ã‰tat)</option>
            <option value="investisseur">Investisseur / Capital-risque</option>
            <option value="mixte">Financement mixte</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Garanties disponibles</div>
          <select class="form-select" id="finProjGarantie">
            <option value="foncier">Titre foncier</option>
            <option value="equipement">Ã‰quipements agricoles</option>
            <option value="caution">Caution solidaire (coopÃ©rative)</option>
            <option value="aucune">Aucune garantie formelle</option>
          </select>
        </div>
        <button class="btn-ia" onclick="runDossierFinancement()">
          <span>ğŸ¦</span> GÃ©nÃ©rer le Dossier de Financement
        </button>
        <div class="ai-result-zone" id="finProjResult">
          <div class="ai-result-header">ğŸ¦ Dossier de Financement</div>
          <div class="ai-result-row"><span class="ai-result-label">Organisme recommandÃ© nÂ°1</span><span class="ai-result-value good" id="finOrg1">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Organisme recommandÃ© nÂ°2</span><span class="ai-result-value good" id="finOrg2">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Taux estimÃ©</span><span class="ai-result-value warn" id="finTaux">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Documents requis</span><span class="ai-result-value" id="finDocs">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">DÃ©lai de traitement</span><span class="ai-result-value" id="finDelai">â€”</span></div>
          <div id="finProjTips" style="margin-top:10px;font-size:0.72rem;line-height:1.6;color:#1A4A2B;background:#EDF7E5;padding:10px;border-radius:8px;"></div>
        </div>
      </div>

      <!-- TAB 4 : RECHERCHE PARTENAIRES -->
      <div id="projTabContent4" style="display:none;">
        <div style="background:#F0F8FF;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.72rem;color:#1A3A5A;border:1px solid rgba(26,82,164,0.15);">
          ğŸ¤ Identifiez les <strong>partenaires stratÃ©giques</strong> adaptÃ©s Ã  votre projet : fournisseurs, acheteurs, ONG, institutions, coopÃ©ratives.
        </div>
        <div class="form-row"><div class="form-label">FiliÃ¨re / Secteur</div>
          <select class="form-select" id="partFiliere">
            <option value="cereales">ğŸŒ½ CÃ©rÃ©ales (maÃ¯s, sorgho, mil)</option>
            <option value="cacao">ğŸ« Cacao / CafÃ©</option>
            <option value="elevage">ğŸ„ Ã‰levage bovin</option>
            <option value="maraicher">ğŸ¥¬ MaraÃ®chage</option>
            <option value="fruitier">ğŸŒ Cultures fruitiÃ¨res</option>
            <option value="pisciculture">ğŸŸ Pisciculture</option>
            <option value="transformation">ğŸ­ Transformation agro-alimentaire</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">Type de partenariat recherchÃ©</div>
          <select class="form-select" id="partType">
            <option value="acheteur">ğŸ›’ Acheteur / DÃ©bouchÃ© commercial</option>
            <option value="fournisseur">ğŸ“¦ Fournisseur d'intrants</option>
            <option value="technique">ğŸ”§ Partenaire technique / Appui</option>
            <option value="financier">ğŸ’° Partenaire financier</option>
            <option value="logistique">ğŸš› Partenaire logistique</option>
            <option value="formation">ğŸ“ Centre de formation</option>
          </select>
        </div>
        <div class="form-row"><div class="form-label">CapacitÃ© de production</div>
          <input class="form-input" id="partCapacite" placeholder="Ex : 50 tonnes/an, 1000 litres/semaine" />
        </div>
        <button class="btn-ia" onclick="runRecherchePartenaires()">
          <span>ğŸ¤</span> Identifier les Partenaires IA
        </button>
        <div class="ai-result-zone" id="partResult">
          <div class="ai-result-header">ğŸ¤ Partenaires IdentifiÃ©s</div>
          <div id="partContent" style="font-size:0.78rem;line-height:1.65;color:#3D4550;margin-top:8px;white-space:pre-wrap;"></div>
        </div>
      </div>

    </div>
  </div>
  <div class="sheet" id="aiAgriSheet" style="max-height:90%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸŒ¾ IA Services Agricoles</div><button class="sheet-close" onclick="closeSheet('aiAgriSheet')">âœ•</button></div>
    <div class="sheet-body" style="padding-bottom:20px;">
      <div class="sheet-ai-header"><h3>ğŸŒ¾ Intelligence Agro-Pastorale</h3><p>PrÃ©vision rendement Â· Intrants Â· MÃ©tÃ©o Â· Planification rÃ©colte</p></div>
      <div class="tabs" style="margin-bottom:14px;">
        <div class="tab active" id="agriTab1" onclick="switchAgriTab(1)">Rendement</div>
        <div class="tab" id="agriTab2" onclick="switchAgriTab(2)">Intrants</div>
        <div class="tab" id="agriTab3" onclick="switchAgriTab(3)">RÃ©colte</div>
      </div>
      <div id="agriTabContent1">
        <div class="form-row"><div class="form-label">Culture principale</div><select class="form-select" id="agriCulture"><option value="mais">ğŸŒ¾ MaÃ¯s</option><option value="manioc">ğŸ¥” Manioc</option><option value="cacao">ğŸ« Cacao</option><option value="cafe">â˜• CafÃ©</option><option value="arachide">ğŸ¥œ Arachides</option><option value="plantain">ğŸŒ Plantain</option></select></div>
        <div class="form-row"><div class="form-label">Superficie (hectares)</div><input class="form-input" id="agriHectares" type="number" placeholder="Ex : 5" inputmode="decimal"/></div>
        <div class="form-row"><div class="form-label">RÃ©gion</div><select class="form-select" id="agriRegion"><option value="centre">Centre (YaoundÃ©)</option><option value="littoral">Littoral (Douala)</option><option value="ouest">Ouest (Bafoussam)</option><option value="adamaoua">Adamaoua</option><option value="nord">Nord (Garoua)</option></select></div>
        <div class="form-row"><div class="form-label">Saison</div><select class="form-select" id="agriSeason"><option value="grande">Grande saison (Marsâ€“Juillet)</option><option value="petite">Petite saison (Augâ€“DÃ©c)</option><option value="seche">Contre-saison (irriguÃ©)</option></select></div>
        <button class="btn-ia" onclick="runYieldPrediction()"><span>ğŸŒ¾</span> PrÃ©voir mon rendement IA</button>
        <div class="ai-result-zone" id="yieldResult">
          <div class="ai-result-header">ğŸŒ¾ PrÃ©vision Rendement ABAE Smart</div>
          <div class="ai-result-row"><span class="ai-result-label">Rendement prÃ©vu (min)</span><span class="ai-result-value" id="yieldMin">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Rendement prÃ©vu (max)</span><span class="ai-result-value good" id="yieldMax">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Production totale estimÃ©e</span><span class="ai-result-value good" id="yieldTotal">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Valeur marchande estimÃ©e</span><span class="ai-result-value good" id="yieldValue">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Risques mÃ©tÃ©o</span><span class="ai-result-value warn" id="yieldRisk">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Conseil IA</span><span class="ai-result-value good" id="yieldAdvice">â€”</span></div>
        </div>
      </div>
      <div id="agriTabContent2" style="display:none;">
        <div class="form-row"><div class="form-label">Culture</div><select class="form-select" id="intrantCulture"><option value="mais">ğŸŒ¾ MaÃ¯s</option><option value="manioc">ğŸ¥” Manioc</option><option value="cacao">ğŸ« Cacao</option><option value="arachide">ğŸ¥œ Arachides</option></select></div>
        <div class="form-row"><div class="form-label">Superficie (ha)</div><input class="form-input" id="intrantHa" type="number" placeholder="Ex : 3" inputmode="decimal"/></div>
        <div class="form-row"><div class="form-label">Type de sol</div><select class="form-select" id="intrantSol"><option value="argileux">Argileux</option><option value="limoneux">Limoneux</option><option value="sableux">Sableux</option><option value="latÃ©ritique">LatÃ©ritique</option></select></div>
        <button class="btn-ia" onclick="runIntrantRecommendation()"><span>ğŸŒ±</span> Recommandation intrants IA</button>
        <div class="ai-result-zone" id="intrantResult">
          <div class="ai-result-header">ğŸŒ± Plan d'Intrants RecommandÃ©</div>
          <div class="ai-result-row"><span class="ai-result-label">Semences recommandÃ©es</span><span class="ai-result-value good" id="intrantSemences">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Engrais (NPK)</span><span class="ai-result-value" id="intrantEngrais">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">QuantitÃ© engrais</span><span class="ai-result-value" id="intrantQtyEngrais">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Pesticides prÃ©ventifs</span><span class="ai-result-value warn" id="intrantPesticides">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">CoÃ»t intrants total</span><span class="ai-result-value good" id="intrantCost">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Fournisseurs locaux</span><span class="ai-result-value good" id="intrantSuppliers">â€”</span></div>
        </div>
      </div>
      <div id="agriTabContent3" style="display:none;">
        <div class="form-row"><div class="form-label">Culture</div><select class="form-select" id="recolteCulture"><option value="mais">ğŸŒ¾ MaÃ¯s</option><option value="manioc">ğŸ¥” Manioc</option><option value="cacao">ğŸ« Cacao</option></select></div>
        <div class="form-row"><div class="form-label">Date de semis</div><input class="form-input" id="recolteDate" type="month"/></div>
        <div class="form-row"><div class="form-label">RÃ©gion</div><select class="form-select" id="recolteRegion"><option>Centre</option><option>Ouest</option><option>Adamaoua</option><option>Nord</option></select></div>
        <button class="btn-ia" onclick="runHarvestPlanning()"><span>ğŸ—“ï¸</span> Planifier ma rÃ©colte IA</button>
        <div class="ai-result-zone" id="recolteResult">
          <div class="ai-result-header">ğŸ—“ï¸ Plan de RÃ©colte Optimal</div>
          <div class="ai-result-row"><span class="ai-result-label">Date rÃ©colte recommandÃ©e</span><span class="ai-result-value good" id="recolteDate2">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">DurÃ©e rÃ©colte estimÃ©e</span><span class="ai-result-value" id="recolteDuration">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Conditions mÃ©tÃ©o prÃ©vues</span><span class="ai-result-value good" id="recolteMeteo">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Main d'Å“uvre nÃ©cessaire</span><span class="ai-result-value" id="recolteMainOeuvre">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Prix marchÃ© prÃ©vu</span><span class="ai-result-value good" id="recoltePrix">â€”</span></div>
          <div class="ai-result-row"><span class="ai-result-label">Conseil stockage/vente</span><span class="ai-result-value good" id="recolteConseil">â€”</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SHEET UPGRADE -->
  <div class="sheet" id="upgradeSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ‘‘ Upgrader mon Abonnement</div><button class="sheet-close" onclick="closeSheet('upgradeSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div style="text-align:center;padding:16px 0;">
        <div style="font-size:2.5rem;margin-bottom:8px;">ğŸ‘‘</div>
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;color:#1A1E25;margin-bottom:5px;">Passez au Plan Premium</div>
        <div style="font-size:0.75rem;color:#9BA3AE;margin-bottom:16px;line-height:1.5;">DÃ©bloquez l'IA complÃ¨te et illimitÃ©e pour maximiser vos performances</div>
        <div style="font-family:'JetBrains Mono',monospace;font-weight:800;font-size:1.5rem;color:#D4A843;">25 000 XAF</div>
        <div style="font-size:0.7rem;color:#9BA3AE;">par mois Â· rÃ©siliable Ã  tout moment</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
        <div style="display:flex;gap:8px;align-items:center;padding:8px;background:#fffbf0;border-radius:8px;border:1px solid rgba(212,168,67,0.2);"><span>âœ…</span><span style="font-size:0.78rem;">IA ComplÃ¨te illimitÃ©e dans toutes les rubriques</span></div>
        <div style="display:flex;gap:8px;align-items:center;padding:8px;background:#fffbf0;border-radius:8px;border:1px solid rgba(212,168,67,0.2);"><span>âœ…</span><span style="font-size:0.78rem;">500 crÃ©dits IA / mois (vs 100 en Pro)</span></div>
        <div style="display:flex;gap:8px;align-items:center;padding:8px;background:#fffbf0;border-radius:8px;border:1px solid rgba(212,168,67,0.2);"><span>âœ…</span><span style="font-size:0.78rem;">Badge Utilisateur IA CertifiÃ© visible</span></div>
        <div style="display:flex;gap:8px;align-items:center;padding:8px;background:#fffbf0;border-radius:8px;border:1px solid rgba(212,168,67,0.2);"><span>âœ…</span><span style="font-size:0.78rem;">Support IA prioritaire 24h/7j</span></div>
      </div>
      <div style="background:rgba(74,158,42,0.07);border:1px solid rgba(74,158,42,0.15);border-radius:8px;padding:10px;font-size:0.7rem;color:#4A9E2A;margin-bottom:16px;">ğŸ”’ <strong>Paiement 100% sÃ©curisÃ© via ABAE.</strong> Commissions prÃ©levÃ©es automatiquement. Aucun paiement hors plateforme autorisÃ©.</div>
      <div class="pay-method sel" id="upg-mtn" onclick="selUpgMethod(this,'MTN Mobile Money')">
        <div class="pay-method-icon">ğŸ“±</div><div><h4>MTN Mobile Money</h4><p>DÃ©bit immÃ©diat Â· 0 frais</p></div>
      </div>
      <div class="pay-method" id="upg-orange" onclick="selUpgMethod(this,'Orange Money')">
        <div class="pay-method-icon">ğŸŸ </div><div><h4>Orange Money</h4><p>DÃ©bit immÃ©diat Â· 0 frais</p></div>
      </div>
      <button class="btn-upgrade" style="margin-top:16px;" onclick="confirmUpgrade()">ğŸ‘‘ Activer le Plan Premium â€” 25 000 XAF/mois</button>
      <button class="btn btn-ghost btn-block" style="margin-top:8px;" onclick="closeSheet('upgradeSheet')">Plus tard</button>
    </div>
  </div>

  <!-- SHEET CRÃ‰DITS IA -->
  <div class="sheet" id="creditsSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">âš¡ CrÃ©dits IA ABAE</div><button class="sheet-close" onclick="closeSheet('creditsSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);border-radius:12px;padding:16px;text-align:center;margin-bottom:16px;">
        <div style="font-size:0.7rem;color:rgba(255,255,255,0.7);margin-bottom:4px;">CrÃ©dits disponibles</div>
        <div style="font-family:'JetBrains Mono',monospace;font-weight:800;font-size:2rem;color:#fff;" id="creditsDisplayVal">53</div>
        <div style="font-size:0.68rem;color:rgba(255,255,255,0.55);">crÃ©dits restants ce mois</div>
      </div>
      <div style="font-size:0.72rem;color:#9BA3AE;margin-bottom:12px;">ğŸ’¡ Chaque analyse IA consomme 1 Ã  5 crÃ©dits selon la complexitÃ©.</div>
      <div class="pay-method" onclick="selectCreditPack(this,'pack50',50,5000)" id="pack-50">
        <div class="pay-method-icon">âš¡</div><div><h4>Pack 50 crÃ©dits</h4><p>5 000 XAF Â· IdÃ©al dÃ©marrage</p></div>
      </div>
      <div class="pay-method sel" onclick="selectCreditPack(this,'pack150',150,12000)" id="pack-150">
        <div class="pay-method-icon">âš¡âš¡</div><div><h4>Pack 150 crÃ©dits <span style="background:#4A9E2A;color:#fff;font-size:0.58rem;padding:2px 6px;border-radius:10px;margin-left:4px;">Populaire</span></h4><p>12 000 XAF Â· Meilleur rapport qualitÃ©/prix</p></div>
      </div>
      <div class="pay-method" onclick="selectCreditPack(this,'pack500',500,30000)" id="pack-500">
        <div class="pay-method-icon">âš¡âš¡âš¡</div><div><h4>Pack 500 crÃ©dits</h4><p>30 000 XAF Â· Usage intensif</p></div>
      </div>
      <button class="btn-ia" style="margin-top:16px;" onclick="purchaseCredits()"><span>âš¡</span> Acheter des crÃ©dits â€” In-App</button>
      <div style="font-size:0.68rem;color:#9BA3AE;text-align:center;margin-top:8px;">ğŸ”’ Paiement sÃ©curisÃ© 100% via ABAE Â· Aucun paiement externe autorisÃ©</div>
    </div>
  </div>

  <!-- PRINT AREA (hidden) -->
  <div id="printArea" style="display:none;position:absolute;inset:0;background:#fff;z-index:9999;padding:16px;overflow-y:auto;"></div>


  <!-- â•â• SHEET : PUBLIER UNE OFFRE (multi-Ã©tapes) â•â• -->
  <div class="sheet" id="publishSheet" style="max-height:92%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ“¦ Publier une offre</div>
      <button class="sheet-close" onclick="closeSheet('publishSheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="overflow-y:auto;">

      <!-- Indicateur Ã©tapes -->
      <div class="pub-step-bar" id="pubStepBar">
        <div class="pub-step-dot active" id="pubDot0"></div>
        <div class="pub-step-dot" id="pubDot1"></div>
        <div class="pub-step-dot" id="pubDot2"></div>
        <div class="pub-step-dot" id="pubDot3"></div>
      </div>

      <!-- Ã‰TAPE 1 : CatÃ©gorie -->
      <div class="pub-step active" id="pubStep0">
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;color:var(--gris-900);margin-bottom:4px;">Quel type d'offre ?</div>
        <div style="font-size:0.82rem;color:var(--gris-400);margin-bottom:14px;">Choisissez la catÃ©gorie qui correspond Ã  votre offre</div>
        <div class="pub-cat-grid" id="pubCatGrid">
          <div class="pub-cat-card" data-cat="agro" onclick="pubSelectCat(this,'agro')">
            <div class="pub-cat-card-icon">ğŸŒ¾</div>
            <div class="pub-cat-card-label">Agricole / Ã‰levage</div>
          </div>
          <div class="pub-cat-card" data-cat="transport" onclick="pubSelectCat(this,'transport')">
            <div class="pub-cat-card-icon">ğŸš›</div>
            <div class="pub-cat-card-label">Transport & Logistique</div>
          </div>
          <div class="pub-cat-card" data-cat="stockage" onclick="pubSelectCat(this,'stockage')">
            <div class="pub-cat-card-icon">ğŸ­</div>
            <div class="pub-cat-card-label">Stockage & EntrepÃ´t</div>
          </div>
          <div class="pub-cat-card" data-cat="digital" onclick="pubSelectCat(this,'digital')">
            <div class="pub-cat-card-icon">ğŸ’»</div>
            <div class="pub-cat-card-label">Services Digitaux</div>
          </div>
          <div class="pub-cat-card" data-cat="financement" onclick="pubSelectCat(this,'financement')">
            <div class="pub-cat-card-icon">ğŸ’°</div>
            <div class="pub-cat-card-label">Financement</div>
          </div>
          <div class="pub-cat-card" data-cat="services" onclick="pubSelectCat(this,'services')">
            <div class="pub-cat-card-icon">ğŸ”§</div>
            <div class="pub-cat-card-label">Conseil & Services</div>
          </div>
          <div class="pub-cat-card" data-cat="emplois" onclick="pubSelectCat(this,'emplois')">
            <div class="pub-cat-card-icon">ğŸ’¼</div>
            <div class="pub-cat-card-label">Offres d'emploi</div>
          </div>
          <div class="pub-cat-card" data-cat="formation" onclick="pubSelectCat(this,'formation')">
            <div class="pub-cat-card-icon">ğŸ“š</div>
            <div class="pub-cat-card-label">Formation</div>
          </div>
          <div class="pub-cat-card" data-cat="intrants" onclick="pubSelectCat(this,'intrants')">
            <div class="pub-cat-card-icon">ğŸŒ±</div>
            <div class="pub-cat-card-label">Intrants agricoles</div>
          </div>
          <div class="pub-cat-card" data-cat="assurance" onclick="pubSelectCat(this,'assurance')">
            <div class="pub-cat-card-icon">ğŸ›¡ï¸</div>
            <div class="pub-cat-card-label">Assurance</div>
          </div>
        </div>
        <button class="btn btn-primary btn-block" id="pubNext0" onclick="pubGoStep(1)" disabled>Continuer â†’</button>
      </div>

      <!-- Ã‰TAPE 2 : DÃ©tails â€” contenu dynamique selon catÃ©gorie -->
      <div class="pub-step" id="pubStep1">
        <!-- Bandeau catÃ©gorie sÃ©lectionnÃ©e -->
        <div id="pubCatBanner" style="display:flex;align-items:center;gap:10px;background:linear-gradient(135deg,rgba(74,158,42,0.1),rgba(74,158,42,0.05));border:1px solid rgba(74,158,42,0.2);border-radius:12px;padding:10px 12px;margin-bottom:14px;">
          <span id="pubCatBannerIcon" style="font-size:1.6rem;"></span>
          <div>
            <div id="pubCatBannerLabel" style="font-family:'Sora',sans-serif;font-weight:800;font-size:0.88rem;color:var(--vert-fonce);"></div>
            <div id="pubCatBannerHint" style="font-size:0.72rem;color:var(--g400);margin-top:1px;"></div>
          </div>
        </div>
        <!-- Champs dynamiques injectÃ©s par renderPubFields() -->
        <div id="pubFieldsContainer"></div>
        <div style="display:flex;gap:8px;margin-top:4px;">
          <button class="btn btn-ghost" onclick="pubGoStep(0)" style="flex:0.4;">â† Retour</button>
          <button class="btn btn-primary" id="pubNext1" onclick="pubGoStep(2)" disabled style="flex:1;">Continuer â†’</button>
        </div>
      </div>

      <!-- Ã‰TAPE 3 : RÃ©capitulatif & Confirmation -->
      <div class="pub-step" id="pubStep2">
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;color:var(--gris-900);margin-bottom:4px;">VÃ©rifier & Publier</div>
        <div style="font-size:0.82rem;color:var(--gris-400);margin-bottom:14px;">RÃ©capitulatif avant publication</div>
        <div class="pub-preview-card" id="pubPreview">
          <div class="pub-preview-row"><span class="pub-preview-label">CatÃ©gorie</span><span class="pub-preview-val" id="prevCat">â€”</span></div>
          <div class="pub-preview-row"><span class="pub-preview-label">Titre</span><span class="pub-preview-val" id="prevTitle">â€”</span></div>
          <div class="pub-preview-row"><span class="pub-preview-label">Prix</span><span class="pub-preview-val" id="prevPrice">â€”</span></div>
          <div class="pub-preview-row"><span class="pub-preview-label">Localisation</span><span class="pub-preview-val" id="prevLoc">â€”</span></div>
          <div id="pubPreviewExtras"></div>
          <div class="pub-preview-row"><span class="pub-preview-label">Commission ABAE</span><span class="pub-preview-val" id="prevComm" style="color:var(--vp);">â€”</span></div>
        </div>
        <div style="background:rgba(74,158,42,0.07);border:1px solid rgba(74,158,42,0.18);border-radius:12px;padding:12px;font-size:0.8rem;color:var(--vert-fonce);line-height:1.6;margin-bottom:14px;">
          ğŸ”’ <strong>Escrow ABAE actif.</strong> Vos paiements sont sÃ©curisÃ©s. La commission sera prÃ©levÃ©e automatiquement Ã  la confirmation de la livraison.
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-ghost" onclick="pubGoStep(1)" style="flex:0.4;">â† Retour</button>
          <button class="btn btn-primary" onclick="pubGoStep(3)" style="flex:1;">
            Continuer â†’
          </button>
        </div>
      </div>


      <!-- Ã‰TAPE 4 : Boost & Options -->
      <div class="pub-step" id="pubStep3">
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;color:var(--gris-900);margin-bottom:4px;">Boostez votre offre ğŸš€</div>
        <div style="font-size:0.82rem;color:var(--gris-400);margin-bottom:14px;">Augmentez votre visibilitÃ© et vendez plus vite</div>

        <div class="boost-option sel" id="boost-free" onclick="selBoost(this,'free')">
          <div class="boost-option__icon" style="background:#F4FDE8;">ğŸŒ¿</div>
          <div class="boost-option__body">
            <div class="boost-option__title">Publication standard</div>
            <div class="boost-option__desc">Visible sur le marchÃ© Â· DurÃ©e 30 jours</div>
          </div>
          <div class="boost-option__price">Gratuit</div>
        </div>

        <div class="boost-option" id="boost-vedette" onclick="selBoost(this,'vedette')">
          <div class="boost-option__icon" style="background:#FFFBF0;">â­</div>
          <div class="boost-option__body">
            <div class="boost-option__title">En vedette</div>
            <div class="boost-option__desc">Bandeau dorÃ© Â· AffichÃ© en premier Â· 7 jours</div>
          </div>
          <div class="boost-option__price">1 500 XAF</div>
        </div>

        <div class="boost-option" id="boost-urgent" onclick="selBoost(this,'urgent')">
          <div class="boost-option__icon" style="background:#FFF5F5;">ğŸ”´</div>
          <div class="boost-option__body">
            <div class="boost-option__title">Urgent</div>
            <div class="boost-option__desc">Badge rouge visible Â· PrioritÃ© dans les rÃ©sultats</div>
          </div>
          <div class="boost-option__price">800 XAF</div>
        </div>

        <div class="boost-option" id="boost-pro" onclick="selBoost(this,'pro')">
          <div class="boost-option__icon" style="background:linear-gradient(135deg,rgba(74,158,42,0.12),rgba(13,74,43,0.06));">ğŸ’</div>
          <div class="boost-option__body">
            <div class="boost-option__title">Pack Pro</div>
            <div class="boost-option__desc">Vedette + Urgent + Notification push acheteurs</div>
          </div>
          <div class="boost-option__price">2 500 XAF</div>
        </div>

        <div style="background:#F8FAFB;border:1px solid #E5E7EB;border-radius:12px;padding:11px 13px;margin-bottom:14px;font-size:0.78rem;color:#374151;">
          ğŸ’¡ <strong>Astuce :</strong> Les offres boostÃ©es reÃ§oivent <strong>3Ã— plus de contacts</strong> que les publications standards. CoÃ»t dÃ©bitÃ© du Portefeuille ABAE.
        </div>

        <div style="display:flex;gap:8px;">
          <button class="btn btn-ghost" onclick="pubGoStep(2)" style="flex:0.4;">â† Retour</button>
          <button class="btn btn-primary" onclick="pubSubmit()" style="flex:1;background:linear-gradient(135deg,#D4A843,#B8860B);">
            ğŸš€ Publier l'offre
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- â•â• SHEET : FAIRE UNE DEMANDE (ACHETEUR) â•â• -->
  <div class="sheet" id="requestSheet" style="max-height:92%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title">ğŸ” Faire une demande</div>
      <button class="sheet-close" onclick="closeSheet('requestSheet')">âœ•</button>
    </div>
    <div class="sheet-body" style="overflow-y:auto;">
      <!-- Info contextuelle -->
      <div style="background:linear-gradient(135deg,rgba(212,168,67,0.12),rgba(212,168,67,0.06));border:1px solid rgba(212,168,67,0.3);border-radius:14px;padding:14px 12px;margin-bottom:16px;display:flex;gap:10px;align-items:flex-start;">
        <span style="font-size:1.4rem;flex-shrink:0;">ğŸ’¡</span>
        <div>
          <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:#7A5A00;">Vous ne trouvez pas ce que vous cherchez ?</div>
          <div style="font-size:0.78rem;color:#9B7E00;margin-top:3px;line-height:1.5;">Publiez votre demande et les vendeurs, transporteurs et partenaires qui peuvent vous aider vous contacteront directement.</div>
        </div>
      </div>

      <!-- CatÃ©gorie -->
      <div class="form-row">
        <div class="form-label">CatÃ©gorie recherchÃ©e <span class="req">*</span></div>
        <select class="form-select" id="reqCatSelect" onchange="reqSelectCatFromDropdown(this.value)" style="width:100%;padding:14px 16px;border-radius:14px;border:1.5px solid var(--gris-200);font-family:'DM Sans',sans-serif;font-size:0.95rem;font-weight:700;color:var(--gris-900);background:var(--blanc);appearance:none;-webkit-appearance:none;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%234A9E2A' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:right 14px center;cursor:pointer;transition:border-color 0.2s;">
          <option value="">â€” SÃ©lectionnez une catÃ©gorie â€”</option>
          <option value="agro">ğŸŒ¾ Agricole / Ã‰levage</option>
          <option value="transport">ğŸš› Transport & Logistique</option>
          <option value="stockage">ğŸ­ Stockage & EntrepÃ´t</option>
          <option value="digital">ğŸ’» Digital & Tech Agri</option>
          <option value="financement">ğŸ’° Financement & CrÃ©dit</option>
          <option value="services">ğŸ”§ Conseil & Services</option>
          <option value="intrants">ğŸŒ± Intrants Agricoles</option>
          <option value="emplois">ğŸ’¼ Emplois & Recrutement</option>
          <option value="formation">ğŸ“š Formation & Apprentissage</option>
          <option value="assurance">ğŸ›¡ï¸ Assurance Agricole</option>
        </select>
        <!-- ConservÃ© masquÃ© pour compatibilitÃ© JS -->
        <div id="reqCatGrid" style="display:none;"></div>
      </div>

      <!-- Champs dynamiques adaptÃ©s Ã  la catÃ©gorie -->
      <div id="reqFieldsContainer"></div>

      <!-- Info escrow -->
      <div style="background:rgba(74,158,42,0.07);border:1px solid rgba(74,158,42,0.18);border-radius:12px;padding:12px;font-size:0.8rem;color:var(--vert-fonce);line-height:1.6;margin-bottom:14px;">
        ğŸ”’ <strong>Protection acheteur ABAE.</strong> Toute transaction rÃ©sultant de votre demande sera couverte par notre systÃ¨me d'escrow sÃ©curisÃ©.
      </div>

      <button class="btn btn-primary btn-block" id="reqSubmitBtn" onclick="reqSubmit()" disabled style="background:linear-gradient(135deg,#D4A843,#B8860B);">
        ğŸ“¢ Publier ma demande
      </button>
    </div>
  </div>

  <!-- â•â• SHEET : Ã‰DITER UNE DEMANDE â•â• -->
  <div class="sheet" id="editRequestSheet" style="max-height:92%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">âœï¸ Modifier la demande</div><button class="sheet-close" onclick="closeSheet('editRequestSheet')">âœ•</button></div>
    <div class="sheet-body" style="overflow-y:auto;">
      <div class="form-row">
        <div class="form-label">Ce que vous recherchez</div>
        <input class="form-input" id="editReqTitle" placeholder="DÃ©crivez votre besoin"/>
      </div>
      <div class="form-row">
        <div class="form-label">Budget (XAF)</div>
        <input class="form-input" id="editReqBudget" type="number" inputmode="numeric" placeholder="0"/>
      </div>
      <div class="form-row">
        <div class="form-label">Description</div>
        <textarea class="form-input" id="editReqDesc" rows="3" style="height:auto;padding:12px;resize:none;"></textarea>
      </div>
      <div class="form-row">
        <div class="form-label">Statut</div>
        <select class="form-select" id="editReqStatus">
          <option value="active">âœ… Active â€” visible sur le marchÃ©</option>
          <option value="paused">â¸ï¸ En pause â€” masquÃ©e temporairement</option>
          <option value="fulfilled">âœ”ï¸ Satisfaite â€” besoin comblÃ©</option>
        </select>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-ghost" onclick="closeSheet('editRequestSheet')" style="flex:0.4;">Annuler</button>
        <button class="btn btn-primary" onclick="saveEditRequest()" style="flex:1;">ğŸ’¾ Sauvegarder</button>
      </div>
    </div>
  </div>

  <!-- â•â• SHEET : Ã‰DITER UNE OFFRE â•â• -->
  <div class="sheet" id="editOfferSheet" style="max-height:92%;">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">âœï¸ Modifier l'offre</div><button class="sheet-close" onclick="closeSheet('editOfferSheet')">âœ•</button></div>
    <div class="sheet-body" style="overflow-y:auto;">
      <div class="form-row">
        <div class="form-label">Titre</div>
        <input class="form-input" id="editTitle" placeholder="Titre de l'offre"/>
      </div>
      <div class="form-row">
        <div class="form-label">Prix (XAF)</div>
        <input class="form-input" id="editPrice" type="number" inputmode="numeric"/>
      </div>
      <div class="form-row">
        <div class="form-label">Description</div>
        <textarea class="form-input" id="editDesc" rows="3" style="height:auto;padding:12px;resize:none;"></textarea>
      </div>
      <div class="form-row">
        <div class="form-label">Statut</div>
        <select class="form-select" id="editStatus">
          <option value="active">âœ… Active â€” visible sur le marchÃ©</option>
          <option value="paused">â¸ï¸ En pause â€” masquÃ©e temporairement</option>
        </select>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-ghost" onclick="closeSheet('editOfferSheet')" style="flex:0.4;">Annuler</button>
        <button class="btn btn-primary" onclick="saveEditOffer()" style="flex:1;">ğŸ’¾ Sauvegarder</button>
      </div>
    </div>
  </div>

  <!-- â•â• SHEET : PROFIL â€” Informations personnelles â•â• -->
  <div class="sheet" id="profileEditSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ‘¤ Mes Informations</div><button class="sheet-close" onclick="closeSheet('profileEditSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="form-row">
        <div class="form-label">Nom complet</div>
        <input class="form-input" id="profileEditNom" placeholder="Votre nom"/>
      </div>
      <div class="form-row">
        <div class="form-label">Email</div>
        <input class="form-input" type="email" id="profileEditEmail" placeholder="Votre email"/>
      </div>
      <div class="form-row">
        <div class="form-label">TÃ©lÃ©phone</div>
        <input class="form-input" type="tel" id="profileEditTel" placeholder="Votre numÃ©ro"/>
      </div>
      <div class="form-row">
        <div class="form-label">Pays</div>
        <select class="form-select" id="profilePays">
          <optgroup label="â”€â”€ Afrique de l'Ouest â”€â”€">
          <option value="BJ">ğŸ‡§ğŸ‡¯ BÃ©nin</option>
          <option value="BF">ğŸ‡§ğŸ‡« Burkina Faso</option>
          <option value="CV">ğŸ‡¨ğŸ‡» Cap-Vert</option>
          <option value="CI">ğŸ‡¨ğŸ‡® CÃ´te d'Ivoire</option>
          <option value="GM">ğŸ‡¬ğŸ‡² Gambie</option>
          <option value="GH">ğŸ‡¬ğŸ‡­ Ghana</option>
          <option value="GN">ğŸ‡¬ğŸ‡³ GuinÃ©e</option>
          <option value="GW">ğŸ‡¬ğŸ‡¼ GuinÃ©e-Bissau</option>
          <option value="LR">ğŸ‡±ğŸ‡· LibÃ©ria</option>
          <option value="ML">ğŸ‡²ğŸ‡± Mali</option>
          <option value="MR">ğŸ‡²ğŸ‡· Mauritanie</option>
          <option value="NE">ğŸ‡³ğŸ‡ª Niger</option>
          <option value="NG">ğŸ‡³ğŸ‡¬ Nigeria</option>
          <option value="SN">ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal</option>
          <option value="SL">ğŸ‡¸ğŸ‡± Sierra Leone</option>
          <option value="TG">ğŸ‡¹ğŸ‡¬ Togo</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique Centrale â”€â”€">
          <option value="CM" selected>ğŸ‡¨ğŸ‡² Cameroun</option>
          <option value="CF">ğŸ‡¨ğŸ‡« Centrafrique</option>
          <option value="TD">ğŸ‡¹ğŸ‡© Tchad</option>
          <option value="CG">ğŸ‡¨ğŸ‡¬ Congo</option>
          <option value="CD">ğŸ‡¨ğŸ‡© RD Congo</option>
          <option value="GQ">ğŸ‡¬ğŸ‡¶ GuinÃ©e Ã‰quatoriale</option>
          <option value="GA">ğŸ‡¬ğŸ‡¦ Gabon</option>
          <option value="ST">ğŸ‡¸ğŸ‡¹ SÃ£o TomÃ©-et-PrÃ­ncipe</option>
          <option value="BI">ğŸ‡§ğŸ‡® Burundi</option>
          <option value="RW">ğŸ‡·ğŸ‡¼ Rwanda</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique de l'Est â”€â”€">
          <option value="KM">ğŸ‡°ğŸ‡² Comores</option>
          <option value="DJ">ğŸ‡©ğŸ‡¯ Djibouti</option>
          <option value="ER">ğŸ‡ªğŸ‡· Ã‰rythrÃ©e</option>
          <option value="ET">ğŸ‡ªğŸ‡¹ Ã‰thiopie</option>
          <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
          <option value="MG">ğŸ‡²ğŸ‡¬ Madagascar</option>
          <option value="MW">ğŸ‡²ğŸ‡¼ Malawi</option>
          <option value="MU">ğŸ‡²ğŸ‡º Maurice</option>
          <option value="MZ">ğŸ‡²ğŸ‡¿ Mozambique</option>
          <option value="SC">ğŸ‡¸ğŸ‡¨ Seychelles</option>
          <option value="SO">ğŸ‡¸ğŸ‡´ Somalie</option>
          <option value="SS">ğŸ‡¸ğŸ‡¸ Soudan du Sud</option>
          <option value="SD">ğŸ‡¸ğŸ‡© Soudan</option>
          <option value="TZ">ğŸ‡¹ğŸ‡¿ Tanzanie</option>
          <option value="UG">ğŸ‡ºğŸ‡¬ Ouganda</option>
          <option value="ZM">ğŸ‡¿ğŸ‡² Zambie</option>
          <option value="ZW">ğŸ‡¿ğŸ‡¼ Zimbabwe</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique du Nord â”€â”€">
          <option value="DZ">ğŸ‡©ğŸ‡¿ AlgÃ©rie</option>
          <option value="EG">ğŸ‡ªğŸ‡¬ Ã‰gypte</option>
          <option value="LY">ğŸ‡±ğŸ‡¾ Libye</option>
          <option value="MA">ğŸ‡²ğŸ‡¦ Maroc</option>
          <option value="TN">ğŸ‡¹ğŸ‡³ Tunisie</option>
          </optgroup>
          <optgroup label="â”€â”€ Afrique Australe â”€â”€">
          <option value="AO">ğŸ‡¦ğŸ‡´ Angola</option>
          <option value="BW">ğŸ‡§ğŸ‡¼ Botswana</option>
          <option value="LS">ğŸ‡±ğŸ‡¸ Lesotho</option>
          <option value="NA">ğŸ‡³ğŸ‡¦ Namibie</option>
          <option value="ZA">ğŸ‡¿ğŸ‡¦ Afrique du Sud</option>
          <option value="SZ">ğŸ‡¸ğŸ‡¿ Eswatini</option>
          </optgroup>
          <optgroup label="â”€â”€ Europe â”€â”€">
          <option value="BE">ğŸ‡§ğŸ‡ª Belgique</option>
          <option value="CH">ğŸ‡¨ğŸ‡­ Suisse</option>
          <option value="DE">ğŸ‡©ğŸ‡ª Allemagne</option>
          <option value="ES">ğŸ‡ªğŸ‡¸ Espagne</option>
          <option value="FR">ğŸ‡«ğŸ‡· France</option>
          <option value="GB">ğŸ‡¬ğŸ‡§ Royaume-Uni</option>
          <option value="IT">ğŸ‡®ğŸ‡¹ Italie</option>
          <option value="LU">ğŸ‡±ğŸ‡º Luxembourg</option>
          <option value="NL">ğŸ‡³ğŸ‡± Pays-Bas</option>
          <option value="PT">ğŸ‡µğŸ‡¹ Portugal</option>
          <option value="SE">ğŸ‡¸ğŸ‡ª SuÃ¨de</option>
          <option value="NO">ğŸ‡³ğŸ‡´ NorvÃ¨ge</option>
          <option value="FI">ğŸ‡«ğŸ‡® Finlande</option>
          <option value="DK">ğŸ‡©ğŸ‡° Danemark</option>
          <option value="PL">ğŸ‡µğŸ‡± Pologne</option>
          <option value="RO">ğŸ‡·ğŸ‡´ Roumanie</option>
          <option value="RU">ğŸ‡·ğŸ‡º Russie</option>
          <option value="TR">ğŸ‡¹ğŸ‡· Turquie</option>
          <option value="UA">ğŸ‡ºğŸ‡¦ Ukraine</option>
          </optgroup>
          <optgroup label="â”€â”€ AmÃ©riques â”€â”€">
          <option value="BR">ğŸ‡§ğŸ‡· BrÃ©sil</option>
          <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
          <option value="CL">ğŸ‡¨ğŸ‡± Chili</option>
          <option value="CO">ğŸ‡¨ğŸ‡´ Colombie</option>
          <option value="HT">ğŸ‡­ğŸ‡¹ HaÃ¯ti</option>
          <option value="MX">ğŸ‡²ğŸ‡½ Mexique</option>
          <option value="US">ğŸ‡ºğŸ‡¸ Ã‰tats-Unis</option>
          </optgroup>
          <optgroup label="â”€â”€ Asie / OcÃ©anie â”€â”€">
          <option value="CN">ğŸ‡¨ğŸ‡³ Chine</option>
          <option value="IN">ğŸ‡®ğŸ‡³ Inde</option>
          <option value="JP">ğŸ‡¯ğŸ‡µ Japon</option>
          <option value="AU">ğŸ‡¦ğŸ‡º Australie</option>
          <option value="AE">ğŸ‡¦ğŸ‡ª Ã‰mirats arabes unis</option>
          <option value="SA">ğŸ‡¸ğŸ‡¦ Arabie Saoudite</option>
          </optgroup>
        </select>
      </div>
      <div class="form-row">
        <div class="form-label">Profil(s)</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <span id="profileEditProfilBadge" style="background:#EDF7E5;color:#4A9E2A;border-radius:20px;padding:5px 12px;font-size:0.78rem;font-weight:700;border:1.5px solid #4A9E2A;">ğŸ›’ Acheteur</span>
          <span style="background:#F7F8F9;color:#9BA3AE;border-radius:20px;padding:5px 12px;font-size:0.78rem;font-weight:700;border:1.5px solid #EAECEF;cursor:pointer;" onclick="showToast('Contactez le support pour changer votre profil')">ğŸ“¦ Vendeur +</span>
        </div>
      </div>
      <div class="form-row">
        <div class="form-label">Photo de profil</div>
        <div style="display:flex;align-items:center;gap:12px;">
          <div id="profileEditAvatar" style="width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,#4A9E2A,#2A5E10);display:flex;align-items:center;justify-content:center;font-family:'Sora',sans-serif;font-weight:800;font-size:1.2rem;color:#fff;overflow:hidden;flex-shrink:0;">JP</div>
          <input type="file" id="photoFileInput" accept="image/*" style="display:none;" onchange="onPhotoFileSelected(event)"/>
          <button onclick="document.getElementById('photoFileInput').click()" style="padding:8px 14px;border:1.5px solid #4A9E2A;border-radius:10px;background:#EDF7E5;font-size:0.8rem;font-weight:700;cursor:pointer;color:#4A9E2A;">ğŸ“· Changer</button>
        </div>
      </div>
      <button class="btn btn-primary btn-block" onclick="saveProfileEdit()">ğŸ’¾ Sauvegarder</button>
      <button class="btn btn-ghost btn-block" style="margin-top:8px;" onclick="closeSheet('profileEditSheet')">Annuler</button>
    </div>
  </div>

  <!-- â•â• SHEET : SUPPORT â•â• -->
  <div class="sheet" id="supportSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ§ Support ABAE</div><button class="sheet-close" onclick="closeSheet('supportSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div style="background:linear-gradient(135deg,#EDF7E5,#F0FFF4);border-radius:16px;padding:16px;margin-bottom:16px;text-align:center;">
        <div style="font-size:2.5rem;margin-bottom:8px;">ğŸ‘‹</div>
        <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:1rem;color:#2A5E10;">Besoin d'aide ?</div>
        <div style="font-size:0.82rem;color:#4A9E2A;margin-top:4px;">Notre Ã©quipe rÃ©pond en moins de 2h</div>
      </div>
      <div class="pay-method" onclick="window.open('https://wa.me/237600000000?text=Bonjour ABAE Support','_blank');closeSheet('supportSheet')">
        <div class="pay-method-icon" style="background:#EDF7E5;">ğŸ’¬</div>
        <div><h4>WhatsApp Support</h4><p>Lunâ€“Dim Â· 7hâ€“22h Â· RÃ©ponse rapide</p></div>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9BA3AE" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="pay-method" onclick="showToast('Email: support@abae.cm copiÃ© !','ok');closeSheet('supportSheet')">
        <div class="pay-method-icon" style="background:#E8EEF5;">ğŸ“§</div>
        <div><h4>Email</h4><p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d9aaaca9a9b6abad99b8bbb8bcf7bab4">[email&#160;protected]</a> Â· RÃ©ponse sous 24h</p></div>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9BA3AE" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="pay-method" onclick="showToast('Centre d\'aide bientÃ´t disponible')">
        <div class="pay-method-icon" style="background:#FDF7F0;">ğŸ“š</div>
        <div><h4>Centre d'aide</h4><p>FAQ Â· Tutoriels Â· Guides</p></div>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9BA3AE" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div style="background:#FFF5F5;border:1px solid rgba(192,57,43,0.15);border-radius:12px;padding:12px;font-size:0.8rem;color:#C0392B;margin-top:8px;line-height:1.6;">
        ğŸš¨ <strong>Urgence transaction :</strong> Appelez le <strong>+237 600 000 000</strong> disponible 24h/24 pour toute transaction bloquÃ©e.
      </div>
    </div>
  </div>

  <!-- â•â• SHEET : FILTRE COMMANDES â•â• -->
  <div class="sheet" id="commandesFilterSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd"><div class="sheet-title">ğŸ“‹ Filtrer mes commandes</div><button class="sheet-close" onclick="closeSheet('commandesFilterSheet')">âœ•</button></div>
    <div class="sheet-body">
      <div class="form-row">
        <div class="form-label">Statut</div>
        <div style="display:flex;flex-direction:column;gap:6px;">
          <label style="display:flex;align-items:center;gap:10px;padding:10px 14px;border:1.5px solid #EAECEF;border-radius:12px;cursor:pointer;">
            <input type="checkbox" checked style="width:18px;height:18px;accent-color:#4A9E2A;"/> <span style="font-size:0.88rem;font-weight:700;">ğŸš› En livraison</span>
          </label>
          <label style="display:flex;align-items:center;gap:10px;padding:10px 14px;border:1.5px solid #EAECEF;border-radius:12px;cursor:pointer;">
            <input type="checkbox" checked style="width:18px;height:18px;accent-color:#4A9E2A;"/> <span style="font-size:0.88rem;font-weight:700;">â³ En attente</span>
          </label>
          <label style="display:flex;align-items:center;gap:10px;padding:10px 14px;border:1.5px solid #EAECEF;border-radius:12px;cursor:pointer;">
            <input type="checkbox" style="width:18px;height:18px;accent-color:#4A9E2A;"/> <span style="font-size:0.88rem;font-weight:700;">âœ… TerminÃ©es</span>
          </label>
          <label style="display:flex;align-items:center;gap:10px;padding:10px 14px;border:1.5px solid #EAECEF;border-radius:12px;cursor:pointer;">
            <input type="checkbox" style="width:18px;height:18px;accent-color:#4A9E2A;"/> <span style="font-size:0.88rem;font-weight:700;">âŒ AnnulÃ©es</span>
          </label>
        </div>
      </div>
      <div class="form-row">
        <div class="form-label">PÃ©riode</div>
        <select class="form-select">
          <option>Ce mois</option>
          <option>3 derniers mois</option>
          <option>6 derniers mois</option>
          <option>Cette annÃ©e</option>
          <option>Toutes</option>
        </select>
      </div>
      <button class="btn btn-primary btn-block" onclick="closeSheet('commandesFilterSheet');showToast('Filtres appliquÃ©s âœ“','ok')">Appliquer</button>
      <button class="btn btn-ghost btn-block" style="margin-top:8px;" onclick="closeSheet('commandesFilterSheet')">RÃ©initialiser</button>
    </div>
  </div>

</div><!-- /phone -->
<!-- /page-marche -->

<!-- â•â•â• SHEET CV ABAE â•â•â• -->
<div id="cvAbaeSheet" style="display:none;position:fixed;inset:0;z-index:3000;background:rgba(0,0,0,0.5);" onclick="if(event.target===this)closeCvAbaeSheet()">
  <div style="position:absolute;bottom:0;left:0;right:0;background:#fff;border-radius:24px 24px 0 0;padding:0 0 40px;max-height:90vh;overflow-y:auto;transform:translateY(100%);transition:transform 0.35s cubic-bezier(.22,1,.36,1);" id="cvAbaeSheetInner">
    <!-- Handle -->
    <div style="display:flex;justify-content:center;padding:12px 0 0;"><div style="width:36px;height:4px;border-radius:2px;background:#E5E7EB;"></div></div>
    <!-- Header -->
    <div style="background:linear-gradient(135deg,#1A5C8A,#2A7AB5);margin:0;padding:20px 20px 24px;">
      <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;color:#fff;">ğŸ“„ CrÃ©er mon CV ABAE</div>
      <div style="font-size:0.75rem;color:rgba(255,255,255,0.8);margin-top:4px;">Votre profil emploi agro-pastoral Â· Visible aux recruteurs</div>
    </div>
    <div style="padding:20px 18px;display:flex;flex-direction:column;gap:14px;">
      <!-- Nom et prÃ©nom -->
      <div>
        <label style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#374151;display:block;margin-bottom:5px;">Nom complet *</label>
        <input type="text" id="cvNom" placeholder="Ex: Jean-Pierre Mbarga" style="width:100%;padding:10px 14px;border:1.5px solid #E5E7EB;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:0.88rem;outline:none;box-sizing:border-box;" onfocus="this.style.borderColor='#1A5C8A'" onblur="this.style.borderColor='#E5E7EB'">
      </div>
      <!-- Poste recherchÃ© -->
      <div>
        <label style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#374151;display:block;margin-bottom:5px;">Poste recherchÃ© *</label>
        <input type="text" id="cvPoste" placeholder="Ex: Technicien agricole, Ã‰leveur, Agronomeâ€¦" style="width:100%;padding:10px 14px;border:1.5px solid #E5E7EB;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:0.88rem;outline:none;box-sizing:border-box;" onfocus="this.style.borderColor='#1A5C8A'" onblur="this.style.borderColor='#E5E7EB'">
      </div>
      <!-- FiliÃ¨re -->
      <div>
        <label style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#374151;display:block;margin-bottom:5px;">FiliÃ¨re *</label>
        <select id="cvFiliere" style="width:100%;padding:10px 14px;border:1.5px solid #E5E7EB;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:0.88rem;outline:none;box-sizing:border-box;background:#fff;">
          <option value="">-- Choisir une filiÃ¨re --</option>
          <option>ğŸŒ¾ Agricole</option>
          <option>ğŸ„ Ã‰levage</option>
          <option>ğŸŸ Piscicole</option>
          <option>ğŸ½ï¸ Agroalimentaire</option>
          <option>ğŸš› Transport & Logistique</option>
          <option>ğŸ­ Stockage & Froid</option>
          <option>ğŸ’» Digital & Tech</option>
          <option>ğŸŒ± Intrants & Agrofournitures</option>
          <option>ğŸ“š Formation & Conseil</option>
          <option>ğŸ’° Finance & Assurance</option>
        </select>
      </div>
      <!-- ExpÃ©rience -->
      <div>
        <label style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#374151;display:block;margin-bottom:5px;">Niveau d'expÃ©rience</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;" id="cvExpGrid">
          <div class="cv-exp-chip" onclick="selectCvExp(this,'DÃ©butant (0â€“2 ans)')" style="padding:6px 14px;border-radius:20px;border:1.5px solid #E5E7EB;font-size:0.78rem;cursor:pointer;font-family:'Sora',sans-serif;font-weight:600;color:#6B7280;">DÃ©butant (0â€“2 ans)</div>
          <div class="cv-exp-chip" onclick="selectCvExp(this,'IntermÃ©diaire (2â€“5 ans)')" style="padding:6px 14px;border-radius:20px;border:1.5px solid #E5E7EB;font-size:0.78rem;cursor:pointer;font-family:'Sora',sans-serif;font-weight:600;color:#6B7280;">IntermÃ©diaire (2â€“5 ans)</div>
          <div class="cv-exp-chip" onclick="selectCvExp(this,'ConfirmÃ© (5â€“10 ans)')" style="padding:6px 14px;border-radius:20px;border:1.5px solid #E5E7EB;font-size:0.78rem;cursor:pointer;font-family:'Sora',sans-serif;font-weight:600;color:#6B7280;">ConfirmÃ© (5â€“10 ans)</div>
          <div class="cv-exp-chip" onclick="selectCvExp(this,'Expert (10+ ans)')" style="padding:6px 14px;border-radius:20px;border:1.5px solid #E5E7EB;font-size:0.78rem;cursor:pointer;font-family:'Sora',sans-serif;font-weight:600;color:#6B7280;">Expert (10+ ans)</div>
        </div>
      </div>
      <!-- RÃ©gion -->
      <div>
        <label style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#374151;display:block;margin-bottom:5px;">RÃ©gion / DisponibilitÃ© gÃ©ographique</label>
        <select id="cvRegion" style="width:100%;padding:10px 14px;border:1.5px solid #E5E7EB;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:0.88rem;outline:none;box-sizing:border-box;background:#fff;">
          <option value="">-- Toutes rÃ©gions --</option>
          <option>Centre (YaoundÃ©)</option>
          <option>Littoral (Douala)</option>
          <option>Nord (Garoua)</option>
          <option>Adamaoua (NgaoundÃ©rÃ©)</option>
          <option>Ouest (Bafoussam)</option>
          <option>Nord-Ouest (Bamenda)</option>
          <option>Sud-Ouest (Buea)</option>
          <option>Est (Bertoua)</option>
          <option>Sud (Ebolowa)</option>
          <option>ExtrÃªme-Nord (Maroua)</option>
          <option>Mobile (toutes rÃ©gions)</option>
        </select>
      </div>
      <!-- Type de contrat -->
      <div>
        <label style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#374151;display:block;margin-bottom:5px;">Type de contrat souhaitÃ©</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <label style="display:flex;align-items:center;gap:6px;font-size:0.8rem;cursor:pointer;"><input type="checkbox" value="CDI" style="accent-color:#1A5C8A;"> CDI</label>
          <label style="display:flex;align-items:center;gap:6px;font-size:0.8rem;cursor:pointer;"><input type="checkbox" value="CDD" style="accent-color:#1A5C8A;"> CDD</label>
          <label style="display:flex;align-items:center;gap:6px;font-size:0.8rem;cursor:pointer;"><input type="checkbox" value="Freelance" style="accent-color:#1A5C8A;"> Freelance</label>
          <label style="display:flex;align-items:center;gap:6px;font-size:0.8rem;cursor:pointer;"><input type="checkbox" value="Stage" style="accent-color:#1A5C8A;"> Stage</label>
        </div>
      </div>
      <!-- CompÃ©tences -->
      <div>
        <label style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#374151;display:block;margin-bottom:5px;">CompÃ©tences clÃ©s <span style="font-weight:400;color:#9CA3AF;">(dÃ©crivez en quelques mots)</span></label>
        <textarea id="cvCompetences" rows="3" placeholder="Ex: Gestion troupeau bovin, conduite tracteur, maraÃ®chage sous serre, comptabilitÃ© agricoleâ€¦" style="width:100%;padding:10px 14px;border:1.5px solid #E5E7EB;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:0.85rem;outline:none;resize:none;box-sizing:border-box;" onfocus="this.style.borderColor='#1A5C8A'" onblur="this.style.borderColor='#E5E7EB'"></textarea>
      </div>
      <!-- Bouton soumettre -->
      <button onclick="saveCvAbae()" style="background:linear-gradient(135deg,#1A5C8A,#2A7AB5);color:#fff;border:none;border-radius:12px;padding:14px;font-family:'Sora',sans-serif;font-weight:800;font-size:0.9rem;cursor:pointer;margin-top:4px;transition:opacity 0.2s;" onmousedown="this.style.opacity=0.8" onmouseup="this.style.opacity=1">
        âœ… Enregistrer mon profil emploi
      </button>
      <button onclick="closeCvAbaeSheet()" style="background:transparent;color:#9CA3AF;border:1.5px solid #E5E7EB;border-radius:12px;padding:12px;font-family:'Sora',sans-serif;font-weight:600;font-size:0.82rem;cursor:pointer;">
        Plus tard
      </button>
    </div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// â•â•â• CV ABAE â€” Logique â•â•â•
let cvExpSelected = '';

function openCvAbaeSheet() {
  const sheet = document.getElementById('cvAbaeSheet');
  const inner = document.getElementById('cvAbaeSheetInner');
  sheet.style.display = 'block';
  requestAnimationFrame(() => { inner.style.transform = 'translateY(0)'; });
}

function closeCvAbaeSheet() {
  const inner = document.getElementById('cvAbaeSheetInner');
  inner.style.transform = 'translateY(100%)';
  setTimeout(() => { document.getElementById('cvAbaeSheet').style.display = 'none'; }, 350);
}

function selectCvExp(el, val) {
  document.querySelectorAll('.cv-exp-chip').forEach(c => {
    c.style.background = '';
    c.style.borderColor = '#E5E7EB';
    c.style.color = '#6B7280';
  });
  el.style.background = '#EFF8FF';
  el.style.borderColor = '#1A5C8A';
  el.style.color = '#1A5C8A';
  cvExpSelected = val;
}

function saveCvAbae() {
  const nom = document.getElementById('cvNom')?.value.trim();
  const poste = document.getElementById('cvPoste')?.value.trim();
  const filiere = document.getElementById('cvFiliere')?.value;
  if (!nom || !poste || !filiere) {
    showToast('âš ï¸ Veuillez remplir les champs obligatoires (*)');
    return;
  }
  // Masquer l'invite contextuelle
  const invite = document.getElementById('emploiProfilInvite');
  if (invite) invite.style.display = 'none';
  // Masquer la banniÃ¨re CV dans emplois
  const banner = document.getElementById('cvAbaeBanner');
  if (banner) {
    banner.innerHTML = '<div style="display:flex;align-items:center;gap:10px;"><span style="font-size:1.2rem;">âœ…</span><div><div style="font-family:\'Sora\',sans-serif;font-weight:700;font-size:0.8rem;color:#1A5C8A;">Profil emploi enregistrÃ© !</div><div style="font-size:0.68rem;color:#4A7A9B;margin-top:2px;">Vous Ãªtes visible des recruteurs ABAE</div></div></div>';
    banner.style.background = 'linear-gradient(135deg,#EFF8FF,#E8F5E9)';
    banner.style.border = '1.5px solid rgba(26,92,138,0.3)';
    banner.style.cursor = 'default';
    banner.onclick = null;
  }
  markCvAbaeDone();
  closeCvAbaeSheet();
  showToast('âœ… Profil emploi crÃ©Ã© Â· Vous Ãªtes visible des recruteurs !');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFIL DEMANDEUR D'EMPLOI â€” Logique complÃ¨te
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1) Sauvegarder le flag quand la case est cochÃ©e Ã  l'inscription
document.addEventListener('DOMContentLoaded', () => {
  const chk = document.getElementById('checkEmploi');
  if (chk) {
    // Restaurer Ã©tat si dÃ©jÃ  cochÃ© avant
    if (localStorage.getItem('abae_job_seeker') === '1') {
      chk.checked = true;
    }
    chk.addEventListener('change', () => {
      localStorage.setItem('abae_job_seeker', chk.checked ? '1' : '0');
      const invite = document.getElementById('emploiProfilInvite');
      if (invite) invite.style.display = chk.checked ? 'flex' : 'none';
    });
  }

  // 2) Ã€ chaque chargement : si job seeker et CV pas encore complÃ©tÃ© â†’ afficher invite + toast
  const isJobSeeker = localStorage.getItem('abae_job_seeker') === '1';
  const cvDone = localStorage.getItem('abae_cv_done') === '1';

  if (isJobSeeker && !cvDone) {
    const invite = document.getElementById('emploiProfilInvite');
    if (invite) invite.style.display = 'flex';
    // Toast de rappel contextuel 3s aprÃ¨s chargement (une seule fois par session)
    if (!sessionStorage.getItem('abae_job_toast_shown')) {
      sessionStorage.setItem('abae_job_toast_shown', '1');
      setTimeout(() => {
        if (typeof showToast === 'function') {
          showToast('ğŸ’¼ ComplÃ©tez votre profil emploi pour Ãªtre visible des recruteurs !');
        }
      }, 3000);
    }
  }
});

// 3) Marquer CV comme complÃ©tÃ© aprÃ¨s soumission
function markCvAbaeDone() {
  localStorage.setItem('abae_cv_done', '1');
  const invite = document.getElementById('emploiProfilInvite');
  if (invite) invite.style.display = 'none';
}
</script>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JAVASCRIPT MARKETPLACE MOBILE â€” abae-mobile.html (adaptÃ©)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ABAE â€” GRILLE TARIFAIRE DÃ‰GRESSIVE (modÃ¨le Mobile Money)
   InspirÃ©e Orange Money / MTN MoMo Cameroun
   Plafond Ã  75 000 XAF pour les trÃ¨s grosses transactions
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ABAE_TARIF = [
  { min:0,        max:25000,    taux:0.05,  label:'5%'   },
  { min:25001,    max:100000,   taux:0.04,  label:'4%'   },
  { min:100001,   max:500000,   taux:0.03,  label:'3%'   },
  { min:500001,   max:2000000,  taux:0.02,  label:'2%'   },
  { min:2000001,  max:Infinity, taux:0.015, label:'1,5%' },
];
const ABAE_COMM_PLAFOND = 75000; // XAF â€” plafond absolu

/**
 * Calcule la commission ABAE pour un montant donnÃ©.
 * @param {number} amount - Montant brut de la transaction (XAF)
 * @returns {{ comm:number, taux:number, label:string, net:number }}
 */
function calcABAECommission(amount) {
  if (!amount || amount <= 0) return { comm:0, taux:0, label:'0%', net:0 };
  const palier = ABAE_TARIF.find(p => amount >= p.min && amount <= p.max)
                 || ABAE_TARIF[ABAE_TARIF.length - 1];
  const commBrut = Math.round(amount * palier.taux);
  const comm = Math.min(commBrut, ABAE_COMM_PLAFOND);
  return {
    comm,
    taux: palier.taux,
    label: palier.label,
    net: amount - comm
  };
}

/** RÃ©trocompat : garde la structure COMM pour les endroits qui lisent juste un taux */
const COMM = new Proxy({}, {
  get(_, cat) {
    // Taux de base par dÃ©faut (sera raffinÃ© par calcABAECommission sur montant rÃ©el)
    return 0.05;
  }
});
const CATL={agricole:'ğŸŒ¾ Agricole',elevage:'ğŸ„ Ã‰levage',piscicole:'ğŸŸ Piscicole',transport:'ğŸš› Transport',stockage:'ğŸ­ Stockage',digital:'ğŸ’» Digital',financement:'ğŸ’° Financement',services:'ğŸ”§ Services',emplois:'ğŸ’¼ Emplois',formation:'ğŸ“š Formation',intrants:'ğŸŒ± Intrants',assurance:'ğŸ›¡ï¸ Assurance',agroalimentaire:'ğŸ½ï¸ Agroalimentaire'};

const PRODUCTS=[
  {id:1,name:"Sac de maÃ¯s blanc 50kg",price:18500,priceLabel:"18 500 XAF/sac",loc:"YaoundÃ©, CM",country:"CM",seller:"Coop. Mvog-Be",type:"coop",rating:4.3,reviews:27,verified:true,cat:"agricole",
    img:"https://images.unsplash.com/photo-1601472544076-6e78e9fef3b1?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1601472544076-6e78e9fef3b1?w=500&q=75","https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=500&q=75","https://images.unsplash.com/photo-1542838132-92c53300491e?w=500&q=75"],
    desc:"MaÃ¯s blanc de premiÃ¨re qualitÃ©, rÃ©colte saison sÃ¨che. HumiditÃ© contrÃ´lÃ©e, sacs 50kg cousus. IdÃ©al pour la transformation (farine, semoule) ou alimentation animale. Minimum 10 sacs."},
  {id:2,name:"BÅ“ufs de race FoulbÃ© â€” lot 5",price:300000,priceLabel:"Sur devis",loc:"NgaoundÃ©rÃ©, CM",country:"CM",seller:"Ã‰leveur Ali Hamidou",type:"producteur",rating:4.8,reviews:14,verified:true,cat:"elevage",
    img:"https://images.unsplash.com/photo-1560493676-04071c5f467b?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1560493676-04071c5f467b?w=500&q=75","https://images.unsplash.com/photo-1570042225831-d98fa7577f1e?w=500&q=75","https://images.unsplash.com/photo-1583482183020-8c02e7e4b078?w=500&q=75"],
    desc:"BÅ“ufs race FoulbÃ©, plein air, 280â€“320 kg. Carnet santÃ© Ã  jour, vaccins Ã  jour. Transport NgaoundÃ©rÃ© â†’ Garoua inclus sur devis."},
  {id:3,name:"Transport frigorifique Douala â†” YaoundÃ©",price:95000,priceLabel:"95 000 XAF/voyage",loc:"Douala, CM",country:"CM",seller:"TransCold Sarl",type:"transporteur",rating:4.1,reviews:63,verified:true,cat:"transport",
    img:"https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=500&q=75","https://images.unsplash.com/photo-1601584115197-04ecc0da31d7?w=500&q=75","https://images.unsplash.com/photo-1553413077-190dd305871c?w=500&q=75"],
    desc:"Camion 10t frigorifique, 0â€“8Â°C. Liaison quotidienne. GPS temps rÃ©el. Assurance incluse."},
  {id:4,name:"Logiciel gestion coopÃ©rative",price:12000,priceLabel:"12 000 XAF/mois",loc:"Douala, CM",country:"CM",seller:"AgroTech CM",type:"tech",rating:4.6,reviews:9,verified:false,cat:"digital",
    img:"https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=500&q=75","https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=500&q=75","https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=500&q=75"],
    desc:"SaaS pour coopÃ©ratives agricoles. Membres, stocks, collectes, Mobile Money. Essai gratuit 30 jours."},
  {id:5,name:"Ignames fraÃ®ches â€” vrac 1 tonne",price:45000,priceLabel:"45 000 XAF/tonne",loc:"Bafoussam, CM",country:"CM",seller:"GICAM-OUEST",type:"coop",rating:3.9,reviews:38,verified:true,cat:"agricole",
    img:"https://images.unsplash.com/photo-1618512496248-a07fe83aa8cb?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1618512496248-a07fe83aa8cb?w=500&q=75","https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=500&q=75","https://images.unsplash.com/photo-1533900298318-6b8da08a523e?w=500&q=75"],
    desc:"Dioscorea rotundata, 0,8â€“1,2 kg/piÃ¨ce. RÃ©colte hebdomadaire. Minimum 500 kg."},
  {id:6,name:"Stockage froid â€” 200mÂ³",price:0,priceLabel:"Sur devis",loc:"Bafoussam, CM",country:"CM",seller:"ColdStock Africa",type:"producteur",rating:4.5,reviews:21,verified:true,cat:"stockage",
    img:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1553413077-190dd305871c?w=500&q=75","https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=500&q=75","https://images.unsplash.com/photo-1601584115197-04ecc0da31d7?w=500&q=75"],
    desc:"EntrepÃ´t frigorifique 200mÂ³. Location mensuelle ou journaliÃ¨re. 0â€“15Â°C. SÃ©curitÃ© 24h/24."},
  {id:7,name:"Microfinancement agricole â€” 5M XAF",price:0,priceLabel:"Taux dÃ¨s 8%/an",loc:"YaoundÃ©, CM",country:"CM",seller:"MicroAgro Finance",type:"financeur",rating:4.2,reviews:44,verified:true,cat:"financement",
    img:"https://images.unsplash.com/photo-1579621970590-9d624316904b?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1579621970590-9d624316904b?w=500&q=75","https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=500&q=75","https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?w=500&q=75"],
    desc:"CrÃ©dit 100kâ€“5M XAF. 6â€“24 mois. Garantie allÃ©gÃ©e. DÃ©blocage 72h. Orange & MTN MoMo."},
  {id:8,name:"Cacao grade A â€” export",price:1850,priceLabel:"1 850 XAF/kg",loc:"Kribi, CM",country:"CM",seller:"Exportateurs du Sud",type:"producteur",rating:4.7,reviews:19,verified:true,cat:"agroalimentaire",
    img:"https://images.unsplash.com/photo-1481391243133-f96216dcb5d2?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1481391243133-f96216dcb5d2?w=500&q=75","https://images.unsplash.com/photo-1542838132-92c53300491e?w=500&q=75","https://images.unsplash.com/photo-1599599810769-bcde5a160d32?w=500&q=75"],
    desc:"FÃ¨ves fermentÃ©es grade A, certifiÃ© UTZ. HumiditÃ© <7,5%. Min 2 tonnes. Cert. phytosanitaire fourni."},
  {id:9,name:"Conseil agronomique Ã  distance",price:25000,priceLabel:"25 000 XAF/session",loc:"Dschang, CM",country:"CM",seller:"Dr. Mbarga Conseil",type:"producteur",rating:4.9,reviews:7,verified:false,cat:"services",
    img:"https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=500&q=75","https://images.unsplash.com/photo-1574943320219-553eb213f72d?w=500&q=75","https://images.unsplash.com/photo-1560493676-04071c5f467b?w=500&q=75"],
    desc:"PhD Agronomie. VisioconfÃ©rence ou WhatsApp. Diagnostic, fertilisation, ravageurs. 60 min + rapport."},
  {id:10,name:"Technicien Agropastoral â€” CDI",price:0,priceLabel:"Poste Ã  pourvoir",loc:"YaoundÃ©, CM",country:"CM",seller:"AgriCorp SA",type:"recruteur",rating:4.5,reviews:3,verified:true,cat:"emplois",
    img:"https://images.unsplash.com/photo-1520052205864-92d242b3a76b?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1520052205864-92d242b3a76b?w=500&q=75","https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=500&q=75","https://images.unsplash.com/photo-1560493676-04071c5f467b?w=500&q=75"],
    desc:"AgriCorp SA recrute 1 Technicien Agropastoral. Bac+2 min. ExpÃ©rience terrain souhaitÃ©e. Avantages : logement + prime rÃ©colte. CV Ã  envoyer sur la plateforme."},
  {id:11,name:"Chauffeur camion frigorifique",price:0,priceLabel:"Salaire nÃ©gociable",loc:"Douala, CM",country:"CM",seller:"TransFroid CM",type:"recruteur",rating:4.2,reviews:5,verified:true,cat:"emplois",
    img:"https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=500&q=75","https://images.unsplash.com/photo-1601584115197-04ecc0da31d7?w=500&q=75","https://images.unsplash.com/photo-1553413077-190dd305871c?w=500&q=75"],
    desc:"TransFroid CM cherche chauffeur Permis C, expÃ©rience min 2 ans. Livraisons Douala-YaoundÃ©. Contrat CDD 6 mois renouvelable. Avantages sociaux inclus."},
  {id:12,name:"Formation : Gestion d'exploitation agricole",price:45000,priceLabel:"45 000 XAF",loc:"Bafoussam, CM",country:"CM",seller:"EcoleAgro CM",type:"formateur",rating:4.8,reviews:22,verified:true,cat:"formation",
    img:"https://images.unsplash.com/photo-1524178232363-1fb2b075b655?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1524178232363-1fb2b075b655?w=500&q=75","https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=500&q=75","https://images.unsplash.com/photo-1574943320219-553eb213f72d?w=500&q=75"],
    desc:"Formation intensive 5 jours. ComptabilitÃ© agricole, planification des cultures, gestion RH, digitalisation. Attestation dÃ©livrÃ©e. Max 20 participants."},
  {id:13,name:"Engrais NPK 15-15-15 â€” sac 50kg",price:28000,priceLabel:"28 000 XAF/sac",loc:"YaoundÃ©, CM",country:"CM",seller:"AgroInput Pro",type:"fournisseur",rating:4.4,reviews:18,verified:true,cat:"intrants",
    img:"https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=500&q=75","https://images.unsplash.com/photo-1542838132-92c53300491e?w=500&q=75","https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=500&q=75"],
    desc:"Engrais NPK Ã©quilibrÃ©, certifiÃ© MINADER. IdÃ©al maÃ¯s, manioc, lÃ©gumes. Livraison possible sur YaoundÃ© et Bafoussam. Min 10 sacs."},
  {id:14,name:"Assurance rÃ©colte â€” couverture sÃ©cheresse",price:15000,priceLabel:"15 000 XAF/ha/an",loc:"Garoua, CM",country:"CM",seller:"AgroAssur",type:"assureur",rating:4.6,reviews:11,verified:true,cat:"assurance",
    img:"https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=500&q=75",
    imgs:["https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=500&q=75","https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=500&q=75","https://images.unsplash.com/photo-1574943320219-553eb213f72d?w=500&q=75"],
    desc:"Couverture sÃ©cheresse et inondations. Indemnisation rapide sous 30 jours. Partenaire BEAC. Zone Nord & ExtrÃªme-Nord Cameroun. Formulaire disponible en ligne."}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SECTION EMPLOIS â€” DONNÃ‰ES & LOGIQUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const EMPLOIS_DATA = [
  {
    id: 101, title: 'Technicien Agropastoral Senior', company: 'AgriCorp SA', logo: 'ğŸ¢',
    location: 'YaoundÃ©', country: 'CM', contractType: 'CDI', sector: 'production',
    level: 'Bac+3', experience: '3â€“5 ans', salary: '280 000 â€“ 350 000 XAF', salaryType: '/mois',
    match: 96, featured: true, verified: true, urgent: false, saved: true,
    postedAgo: 'Il y a 2h', employees: '250 employÃ©s',
    avantages: 'Logement + transport inclus, prime de rÃ©colte annuelle',
    desc: `Sous la responsabilitÃ© du Directeur de production, vous assurez la gestion technique et sanitaire d'un troupeau bovin de 400 tÃªtes. Vous supervisez l'alimentation, les soins vÃ©tÃ©rinaires prÃ©ventifs et la traÃ§abilitÃ© de l'Ã©levage selon les standards certifiÃ©s ABAE.\n\n<strong>Missions principales :</strong>\nâ€¢ Suivi quotidien de la santÃ© animale\nâ€¢ Gestion des reproductions et des naissances\nâ€¢ Formation des techniciens juniors\nâ€¢ Reporting mensuel via plateforme ABAE`,
    matchDetails: [{lbl:'CompÃ©tences techniques',val:98},{lbl:'ExpÃ©rience terrain',val:92},{lbl:'Formation acadÃ©mique',val:100},{lbl:'Localisation',val:90}],
    tags: [{label:'CDI',cls:'contrat'},{label:'YaoundÃ©',cls:'lieu'},{label:'Bac+3',cls:'niveau'},{label:'ğŸŒ¾ Agricole',cls:'secteur'}]
  },
  {
    id: 102, title: 'Chauffeur Camion Frigorifique', company: 'TransFroid CM', logo: 'ğŸš›',
    location: 'Douala', country: 'CM', contractType: 'CDD', sector: 'transport',
    level: 'Permis C', experience: '2+ ans', salary: 'NÃ©gociable', salaryType: '',
    match: 82, featured: false, verified: true, urgent: false, saved: false,
    postedAgo: 'Il y a 5h', employees: '80 employÃ©s',
    avantages: 'Avantages sociaux inclus, assurance santÃ©',
    desc: `TransFroid CM cherche un chauffeur Permis C avec expÃ©rience minimum 2 ans. Livraisons rÃ©guliÃ¨res Doualaâ€“YaoundÃ© en camion frigorifique.\n\n<strong>Profil recherchÃ© :</strong>\nâ€¢ Permis C valide\nâ€¢ SÃ©rieux et ponctualitÃ©\nâ€¢ Connaissance des rÃ¨gles de la chaÃ®ne du froid\nâ€¢ DisponibilitÃ© week-ends si nÃ©cessaire`,
    matchDetails: [{lbl:'Permis & certifications',val:90},{lbl:'ExpÃ©rience chauffeur',val:85},{lbl:'Connaissance zone',val:78},{lbl:'Localisation',val:75}],
    tags: [{label:'CDD 12 mois',cls:'contrat'},{label:'Douala',cls:'lieu'},{label:'ğŸš› Transport',cls:'secteur'}]
  },
  {
    id: 103, title: 'IngÃ©nieur Zootechnicien', company: 'IRAD Cameroun', logo: 'ğŸ”¬',
    location: 'Garoua', country: 'CM', contractType: 'Contrat Ã©tat', sector: 'elevage',
    level: 'Bac+5', experience: '5+ ans', salary: '350 000 XAF', salaryType: '/mois',
    match: 78, featured: false, verified: true, urgent: false, saved: false,
    postedAgo: 'Il y a 1j', employees: '120 agents',
    avantages: 'Statut fonctionnaire, logement de fonction, vÃ©hicule de service',
    desc: `L'Institut de Recherche Agricole pour le DÃ©veloppement recrute un IngÃ©nieur Zootechnicien pour son antenne de Garoua.\n\n<strong>ResponsabilitÃ©s :</strong>\nâ€¢ Conception et suivi des programmes d'Ã©levage\nâ€¢ Encadrement des Ã©leveurs locaux\nâ€¢ Publication de travaux de recherche\nâ€¢ Collaboration avec partenaires internationaux (FAO, CIRAD)`,
    matchDetails: [{lbl:'Formation scientifique',val:95},{lbl:'Recherche & publications',val:70},{lbl:'ExpÃ©rience terrain',val:80},{lbl:'Localisation',val:65}],
    tags: [{label:'Contrat Ã©tat',cls:'contrat urgent'},{label:'Garoua',cls:'lieu'},{label:'Bac+5',cls:'niveau'},{label:'ğŸ„ Ã‰levage',cls:'secteur'}]
  },
  {
    id: 104, title: 'Responsable Commercial Agri', company: 'AgroDistrib CEMAC', logo: 'ğŸ“Š',
    location: 'Douala', country: 'CM', contractType: 'CDI', sector: 'gestion',
    level: 'Bac+4', experience: '3+ ans', salary: '400 000 XAF', salaryType: '/mois',
    match: 71, featured: false, verified: true, urgent: true, saved: false,
    postedAgo: 'Il y a 3h', employees: '45 employÃ©s',
    avantages: 'Commissions sur ventes, voiture de fonction, tÃ©lÃ©phone',
    desc: `AgroDistrib CEMAC, leader de la distribution d'intrants agricoles en Afrique centrale, recrute un Responsable Commercial.\n\n<strong>Vos objectifs :</strong>\nâ€¢ DÃ©veloppement du portefeuille client (+30% en 1 an)\nâ€¢ Animation rÃ©seau de distributeurs\nâ€¢ Reporting hebdomadaire direction\nâ€¢ Prospection nouvelles rÃ©gions`,
    matchDetails: [{lbl:'ExpÃ©rience commerciale',val:85},{lbl:'Secteur agricole',val:75},{lbl:'Leadership',val:70},{lbl:'Localisation',val:90}],
    tags: [{label:'CDI',cls:'contrat'},{label:'Douala',cls:'lieu'},{label:'URGENT',cls:'urgent'},{label:'ğŸ“Š Gestion',cls:'secteur'}]
  },
  {
    id: 105, title: 'VÃ©tÃ©rinaire Terrain', company: 'ElevagePro Cameroun', logo: 'ğŸ„',
    location: 'Bafoussam', country: 'CM', contractType: 'CDD', sector: 'elevage',
    level: 'Bac+5 VÃ©tÃ©rinaire', experience: '1â€“2 ans', salary: '250 000 XAF', salaryType: '/mois',
    match: 65, featured: false, verified: false, urgent: false, saved: false,
    postedAgo: 'Il y a 2j', employees: '20 agents',
    avantages: 'Primes terrain, indemnitÃ©s dÃ©placement',
    desc: `ElevagePro Cameroun recrute un vÃ©tÃ©rinaire pour suivre ses exploitations dans l'Ouest Cameroun. Poste terrain avec dÃ©placements frÃ©quents.\n\n<strong>Profil :</strong>\nâ€¢ DiplÃ´me vÃ©tÃ©rinaire reconnu au Cameroun\nâ€¢ GoÃ»t pour le terrain et les dÃ©placements\nâ€¢ Permis de conduire B\nâ€¢ Sens du service et pÃ©dagogie`,
    matchDetails: [{lbl:'Formation vÃ©tÃ©rinaire',val:100},{lbl:'ExpÃ©rience Ã©levage',val:60},{lbl:'MobilitÃ© terrain',val:70},{lbl:'Localisation',val:55}],
    tags: [{label:'CDD 12 mois',cls:'contrat'},{label:'Bafoussam',cls:'lieu'},{label:'ğŸ„ Ã‰levage',cls:'secteur'}]
  }
];

let ejCurrentView = 'list'; // 'list' | 'detail' | 'apply'
let ejCurrentJob = null;
let ejActiveTab = 'all';
let ejSavedJobs = new Set([101]);
let ejApplyStep = 1;
let ejCvGenerated = false;

function openEmploisScreen() {
  ejCurrentView = 'list';
  ejShowView('list');
  ejRenderList();
  pushScreen('emplois');
}

function ejShowView(view) {
  document.getElementById('emplois-list-view').style.display = view === 'list' ? 'flex' : 'none';
  document.getElementById('emplois-detail-view').style.display = view === 'detail' ? 'flex' : 'none';
  document.getElementById('emplois-apply-view').style.display = view === 'apply' ? 'flex' : 'none';
  ejCurrentView = view;
  // Animate match bars when showing detail
  if (view === 'detail') {
    setTimeout(() => {
      document.querySelectorAll('.ej-match-bar-fill').forEach(bar => {
        const w = bar.getAttribute('data-w');
        if (w) bar.style.width = w + '%';
      });
    }, 100);
  }
}

function ejGoBackInView() {
  if (ejCurrentView === 'apply') { ejShowView('detail'); return; }
  if (ejCurrentView === 'detail') { ejShowView('list'); return; }
  goBack();
}

function ejFilter() {
  const q = (document.getElementById('ejSearchInput') || {}).value?.toLowerCase() || '';
  let data = EMPLOIS_DATA.filter(j => {
    if (q && !j.title.toLowerCase().includes(q) && !j.company.toLowerCase().includes(q) && !j.location.toLowerCase().includes(q)) return false;
    if (ejActiveTab === 'match') return j.match >= 80;
    if (ejActiveTab === 'cdi') return j.contractType === 'CDI';
    if (ejActiveTab === 'cdd') return j.contractType.startsWith('CDD');
    if (ejActiveTab === 'saved') return ejSavedJobs.has(j.id);
    return true;
  });
  ejRenderList(data);
}

function ejSetTab(el, tab) {
  ejActiveTab = tab;
  document.querySelectorAll('.ej-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  ejFilter();
}

function ejToggleSF(el, filter) {
  document.querySelectorAll('.ej-sf-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  ejFilter();
}

function ejOpenFilters() {
  showToast('ğŸ”§ Filtres avancÃ©s bientÃ´t disponibles');
}

function ejRenderList(data) {
  data = data || EMPLOIS_DATA;
  // Sort: featured first, then by match
  const sorted = [...data].sort((a, b) => {
    if (a.featured && !b.featured) return -1;
    if (!a.featured && b.featured) return 1;
    return b.match - a.match;
  });
  const el = document.getElementById('ejJobsList');
  if (!el) return;
  // Update counts
  const countEl = document.getElementById('ejCountAll');
  if (countEl) countEl.textContent = EMPLOIS_DATA.length;
  const posEl = document.getElementById('ejStatPostes');
  if (posEl) posEl.textContent = 247 + EMPLOIS_DATA.length - 5;

  if (!sorted.length) {
    el.innerHTML = `<div class="ej-empty">
      <div class="ej-empty-icon">ğŸ’¼</div>
      <div class="ej-empty-title">Aucune offre trouvÃ©e</div>
      <div class="ej-empty-sub">Essayez d'autres filtres</div>
    </div>`;
    return;
  }

  let html = `
    <div class="ej-ia-banner">
      <div class="ej-ia-glow">ğŸ¤–</div>
      <div class="ej-ia-text">
        <div class="ej-ia-title">âœ¨ Votre profil IA est prÃªt</div>
        <div class="ej-ia-sub">ABAE IA a trouvÃ© ${sorted.filter(j=>j.match>=75).length} postes pour vous</div>
      </div>
      <div style="text-align:center;">
        <div class="ej-ia-score-val">${Math.max(...sorted.map(j=>j.match))}%</div>
        <span class="ej-ia-score-lbl">Match top</span>
      </div>
    </div>
    <div class="ej-section-hdr">
      <div class="ej-section-title">â­ Meilleurs matchs IA</div>
      <div class="ej-section-action">${sorted.length} offre${sorted.length>1?'s':''}</div>
    </div>`;

  sorted.forEach((j, i) => {
    const isSaved = ejSavedJobs.has(j.id);
    const bookmarkSvg = isSaved
      ? `<svg width="14" height="14" viewBox="0 0 24 24" fill="var(--vp)" stroke="var(--vp)" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`
      : `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9BA3AE" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`;

    html += `
      <div class="ej-job-card${j.featured?' featured':''}${j.match>=90?' match-high':j.match>=75?' match-mid':''}" style="animation:fadeIn .3s ${i*60}ms both;" onclick="ejOpenDetail(${j.id})">
        ${j.featured ? '<div class="ej-featured-badge">ğŸš€ BOOSTÃ‰</div>' : ''}
        <div class="ej-jc-header">
          <div class="ej-jc-logo${j.sector==='transport'?' dark':''}">${j.logo}</div>
          <div class="ej-jc-info">
            <div class="ej-jc-title">${j.title}</div>
            <div class="ej-jc-company">
              <span>${j.company}</span>
              ${j.verified ? '<span class="ej-jc-verified">âœ“</span>' : ''}
              <span style="color:#9BA3AE;">Â· ${j.location}</span>
            </div>
          </div>
          <button class="ej-bookmark${isSaved?' saved':''}" onclick="event.stopPropagation();ejToggleSave(${j.id},this)">
            ${bookmarkSvg}
          </button>
        </div>
        <div class="ej-jc-tags">
          ${j.tags.map(t=>`<span class="ej-jc-tag ${t.cls}">${t.label}</span>`).join('')}
          ${j.urgent ? '<span class="ej-jc-tag urgent">âš¡ Urgent</span>' : ''}
        </div>
        <div class="ej-jc-bottom">
          <div>
            <div class="ej-jc-salary">${j.salary}<span class="ej-jc-salary-lbl">${j.salaryType}</span></div>
          </div>
          <div class="ej-jc-meta">
            <div class="ej-jc-time">${j.postedAgo}</div>
            <div class="ej-match-pill" style="background:${j.match>=90?'linear-gradient(135deg,#4A9E2A,#2A5E10)':j.match>=75?'linear-gradient(135deg,#D4A843,#B8860B)':'linear-gradient(135deg,#6B8B9A,#4A6575)'}">
              ğŸ¤– ${j.match}% match
            </div>
          </div>
        </div>
      </div>`;

    // Insert quick apply banner after first card
    if (i === 0) {
      html += `
        <div class="ej-quick-apply" onclick="ejOpenDetail(${sorted[0].id});setTimeout(()=>ejOpenApply(),200)">
          <div class="ej-quick-icon">âš¡</div>
          <div style="flex:1;">
            <div class="ej-quick-title">Postuler en 1 tap</div>
            <div class="ej-quick-sub">Votre CV ABAE est prÃªt Â· Envoi instantanÃ©</div>
          </div>
          <div class="ej-quick-arrow">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
        </div>
        <div class="ej-section-hdr" style="padding-top:4px;">
          <div class="ej-section-title">ğŸ• Autres offres</div>
          <div class="ej-section-action">${sorted.length - 1} offres</div>
        </div>`;
    }
  });

  el.innerHTML = html;
}

function ejToggleSave(id, btn) {
  if (ejSavedJobs.has(id)) {
    ejSavedJobs.delete(id);
    btn.classList.remove('saved');
    btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9BA3AE" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`;
    showToast('ğŸ’” Offre retirÃ©e des favoris');
  } else {
    ejSavedJobs.add(id);
    btn.classList.add('saved');
    btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="var(--vp)" stroke="var(--vp)" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`;
    showToast('ğŸ’š Offre sauvegardÃ©e !');
  }
}

function ejOpenDetail(id) {
  const j = EMPLOIS_DATA.find(x => x.id === id);
  if (!j) return;
  ejCurrentJob = j;
  const isSaved = ejSavedJobs.has(j.id);

  // Render header
  document.getElementById('ejDetailHeader').innerHTML = `
    <div class="ej-dh-top">
      <button class="ej-dh-back" onclick="ejGoBackInView()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <div class="ej-dh-actions">
        <button class="ej-dh-action" onclick="showToast('ğŸ”— Lien copiÃ© !')">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        </button>
        <button class="ej-dh-action" id="ejDetailBookmark" onclick="ejToggleSaveDetail(${j.id})">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="${isSaved?'#fff':'none'}" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
        </button>
      </div>
    </div>
    <div class="ej-dh-company">
      <div class="ej-dh-logo">${j.logo}</div>
      <div>
        <div class="ej-dh-company-name">${j.company}</div>
        <div class="ej-dh-company-meta">
          ${j.verified ? '<span class="ej-dh-verified">âœ“ Entreprise vÃ©rifiÃ©e</span>' : ''}
          Â· ğŸ“ ${j.location} Â· ğŸ­ ${j.employees}
        </div>
      </div>
    </div>
    <div class="ej-dh-role">${j.title}</div>
    <div class="ej-dh-tags">
      <div class="ej-dh-tag">ğŸ’¼ ${j.contractType}</div>
      <div class="ej-dh-tag">ğŸ“ ${j.location}</div>
      <div class="ej-dh-tag">ğŸ“ ${j.level}</div>
      <div class="ej-dh-tag">â³ ${j.experience}</div>
      ${j.urgent ? '<div class="ej-dh-tag" style="background:rgba(230,81,0,0.3);color:#FFAB40;">âš¡ Urgent</div>' : ''}
    </div>`;

  // Render body
  document.getElementById('ejDetailBody').innerHTML = `
    <div class="ej-salary-block">
      <span style="font-size:1.5rem;">ğŸ’°</span>
      <div>
        <div class="ej-salary-val">${j.salary}${j.salaryType}</div>
        <div class="ej-salary-type">Salaire mensuel Â· Avantages : ${j.avantages}</div>
      </div>
    </div>
    <div class="ej-ds">
      <div class="ej-ds-title">ğŸ“‹ Informations clÃ©s</div>
      <div class="ej-info-grid">
        <div class="ej-info-cell"><div class="ej-info-cell-icon">ğŸ“…</div><div class="ej-info-cell-lbl">Type de contrat</div><div class="ej-info-cell-val">${j.contractType}</div></div>
        <div class="ej-info-cell"><div class="ej-info-cell-icon">ğŸ“</div><div class="ej-info-cell-lbl">Niveau requis</div><div class="ej-info-cell-val">${j.level}</div></div>
        <div class="ej-info-cell"><div class="ej-info-cell-icon">â³</div><div class="ej-info-cell-lbl">ExpÃ©rience</div><div class="ej-info-cell-val">${j.experience}</div></div>
        <div class="ej-info-cell"><div class="ej-info-cell-icon">ğŸ“</div><div class="ej-info-cell-lbl">Localisation</div><div class="ej-info-cell-val">${j.location}, CM</div></div>
      </div>
    </div>
    <div class="ej-match-block">
      <div class="ej-match-hdr">
        <div class="ej-match-title">ğŸ¤– Analyse IA de compatibilitÃ©</div>
        <div class="ej-match-pct">${j.match}%</div>
      </div>
      ${j.matchDetails.map(d=>`
        <div class="ej-match-bar-row">
          <div class="ej-match-bar-lbl"><span>${d.lbl}</span><span>${d.val}%</span></div>
          <div class="ej-match-bar-track"><div class="ej-match-bar-fill" data-w="${d.val}" style="width:0%"></div></div>
        </div>`).join('')}
    </div>
    <div class="ej-ds">
      <div class="ej-ds-title">ğŸ“ Description du poste</div>
      <div class="ej-desc-text">${j.desc.replace(/\n/g,'<br>')}</div>
    </div>
    <div class="ej-ds" style="border-bottom:none;">
      <div class="ej-ds-title">ğŸ§  Analyse ABAE Smart IA</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:4px;">
        <button onclick="openSheet('aiMatchSheet')" style="display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px 8px;border:1.5px solid #E8EEF5;border-radius:14px;background:#F7F9FD;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.75rem;font-weight:700;color:#1A5C8A;">
          <span style="font-size:1.4rem;">ğŸ¯</span>Matching IA
        </button>
        <button onclick="openSheet('aiScoreSheet')" style="display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px 8px;border:1.5px solid #F5EEE8;border-radius:14px;background:#FDFAF7;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.75rem;font-weight:700;color:#8A5C1A;">
          <span style="font-size:1.4rem;">â­</span>Score fiabilitÃ©
        </button>
      </div>
    </div>
    <div style="height:20px;"></div>`;

  // Render footer
  document.getElementById('ejDetailFooter').innerHTML = `
    <button class="ej-btn-save${isSaved?' saved':''}" id="ejDetailSaveBtn" onclick="ejToggleSaveDetail(${j.id})" title="${isSaved?'Retirer des favoris':'Sauvegarder'}">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="${isSaved?'var(--vp)':'none'}" stroke="${isSaved?'var(--vp)':'var(--g400)'}" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
    </button>
    <button class="ej-btn-apply" onclick="ejOpenApply()">
      âš¡ Postuler maintenant
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
    </button>`;

  ejShowView('detail');

  // Animate bars after transition
  setTimeout(() => {
    document.querySelectorAll('.ej-match-bar-fill').forEach(bar => {
      const w = bar.getAttribute('data-w');
      if (w) bar.style.width = w + '%';
    });
  }, 200);
}

function ejToggleSaveDetail(id) {
  const j = EMPLOIS_DATA.find(x => x.id === id);
  if (!j) return;
  const wasSaved = ejSavedJobs.has(id);
  if (wasSaved) {
    ejSavedJobs.delete(id);
    showToast('ğŸ’” Offre retirÃ©e des favoris');
  } else {
    ejSavedJobs.add(id);
    showToast('ğŸ’š Offre sauvegardÃ©e !');
  }
  const isSaved = ejSavedJobs.has(id);
  // Update detail save button
  const btn = document.getElementById('ejDetailSaveBtn');
  if (btn) {
    btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="${isSaved?'var(--vp)':'none'}" stroke="${isSaved?'var(--vp)':'var(--g400)'}" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`;
    btn.classList.toggle('saved', isSaved);
  }
  // Update header bookmark
  const hbm = document.getElementById('ejDetailBookmark');
  if (hbm) {
    hbm.innerHTML = `<svg width="15" height="15" viewBox="0 0 24 24" fill="${isSaved?'#fff':'none'}" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`;
  }
}

function ejOpenApply() {
  if (!ejCurrentJob) return;
  const j = ejCurrentJob;
  ejApplyStep = 2;
  ejCvGenerated = false;

  document.getElementById('ejApplyHeader').innerHTML = `
    <button class="ej-dh-back" onclick="ejGoBackInView()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <div style="flex:1;margin:0 10px;">
      <div class="ej-apply-title">Postuler chez ${j.company}</div>
      <div class="ej-apply-sub">Ã‰tape 2 sur 3 â€” Votre profil</div>
    </div>
    <div class="ej-apply-steps">
      <div class="ej-apply-step done">âœ“</div>
      <div class="ej-apply-step-line done"></div>
      <div class="ej-apply-step active">2</div>
      <div class="ej-apply-step-line"></div>
      <div class="ej-apply-step">3</div>
    </div>`;

  document.getElementById('ejApplyBody').innerHTML = `
    <div class="ej-pre-score">
      <div class="ej-score-ring"><div class="ej-score-inner">78%</div></div>
      <div>
        <div class="ej-score-title">Profil complÃ©tÃ© Ã  78%</div>
        <div class="ej-score-desc">Ajoutez vos certifications pour atteindre 95% et multiplier vos chances par 3</div>
      </div>
    </div>
    <div class="ej-cv-block">
      <div class="ej-cv-title">âœ¨ GÃ©nÃ©ration CV IA</div>
      <div class="ej-cv-desc">ABAE IA peut crÃ©er ou optimiser votre CV en quelques secondes, adaptÃ© Ã  l'offre "${j.title}"</div>
      <div class="ej-cv-opts">
        <div class="ej-cv-opt" id="ejCvOpt1" onclick="ejCvAction('generate')">
          <div class="ej-cv-opt-icon">ğŸ“„</div>
          <div class="ej-cv-opt-lbl">GÃ©nÃ©rer mon CV</div>
        </div>
        <div class="ej-cv-opt" id="ejCvOpt2" onclick="ejCvAction('optimize')">
          <div class="ej-cv-opt-icon">ğŸ¯</div>
          <div class="ej-cv-opt-lbl">Optimiser pour ce poste</div>
        </div>
        <div class="ej-cv-opt" id="ejCvOpt3" onclick="ejCvAction('import')">
          <div class="ej-cv-opt-icon">ğŸ“¤</div>
          <div class="ej-cv-opt-lbl">Importer mon CV</div>
        </div>
        <div class="ej-cv-opt" id="ejCvOpt4" onclick="ejCvAction('letter')">
          <div class="ej-cv-opt-icon">âœï¸</div>
          <div class="ej-cv-opt-lbl">Lettre de motivation</div>
        </div>
      </div>
    </div>
    <div class="ej-form-section">
      <div class="ej-form-title">ğŸ‘¤ Informations personnelles</div>
      <div class="ej-form-row">
        <label class="ej-form-label">Nom complet <span>*</span></label>
        <input class="ej-form-input prefilled" type="text" id="ejApplyName" value="Amadou NJOYA">
      </div>
      <div class="ej-form-row">
        <label class="ej-form-label">Email professionnel <span>*</span></label>
        <input class="ej-form-input prefilled" type="email" id="ejApplyEmail" value="a.njoya@gmail.com">
      </div>
      <div class="ej-form-row">
        <label class="ej-form-label">TÃ©lÃ©phone</label>
        <input class="ej-form-input prefilled" type="tel" id="ejApplyPhone" value="+237 6XX XXX XXX">
      </div>
    </div>
    <div class="ej-form-section">
      <div class="ej-form-title">ğŸ’¬ Message de motivation</div>
      <div class="ej-form-row">
        <label class="ej-form-label">Pourquoi ce poste vous intÃ©resse-t-il ?</label>
        <textarea class="ej-form-input" id="ejApplyMotivation" rows="4" placeholder="DÃ©crivez votre motivationâ€¦ ou laissez ABAE IA l'Ã©crire ğŸ¤–" style="resize:none;line-height:1.6;"></textarea>
      </div>
    </div>
    <div class="ej-form-section">
      <div class="ej-form-title">ğŸ“ Documents</div>
      <div class="ej-upload-grid">
        <div class="ej-upload-cell${ejCvGenerated?' has-file':''}" id="ejCvUploadCell" onclick="ejCvAction('generate')" style="text-align:center;">
          <div style="font-size:1.5rem;margin-bottom:5px;">ğŸ“„</div>
          <div style="font-size:0.65rem;font-weight:700;font-family:'Sora',sans-serif;color:${ejCvGenerated?'var(--vp)':'#9BA3AE'};">${ejCvGenerated?'CV IA gÃ©nÃ©rÃ© âœ“':'CV PDF'}</div>
          <div style="font-size:0.6rem;color:#9BA3AE;margin-top:2px;">${ejCvGenerated?'OptimisÃ© pour ce poste':'Cliquez pour gÃ©nÃ©rer'}</div>
        </div>
        <div class="ej-upload-cell" id="ejDiplomaCell" onclick="showToast('ğŸ“ SÃ©lectionnez un fichier depuis votre appareil')">
          <div style="font-size:1.5rem;margin-bottom:5px;">ğŸ“</div>
          <div style="font-size:0.65rem;font-weight:700;font-family:'Sora',sans-serif;color:#9BA3AE;">DiplÃ´mes</div>
          <div style="font-size:0.6rem;color:#9BA3AE;margin-top:2px;">Ajouter</div>
        </div>
      </div>
    </div>`;

  document.getElementById('ejApplyFooter').innerHTML = `
    <button class="ej-btn-submit" onclick="ejSubmitApplication()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      Envoyer ma candidature
    </button>
    <div style="text-align:center;margin-top:8px;font-size:0.62rem;color:#9BA3AE;">
      ğŸ”’ Votre profil est sÃ©curisÃ© Â· Lu par l'employeur uniquement
    </div>`;

  ejShowView('apply');
}

function ejCvAction(action) {
  const msgs = {
    generate: 'â³ GÃ©nÃ©ration de votre CV IA en coursâ€¦',
    optimize: 'ğŸ¯ Optimisation du CV pour ce posteâ€¦',
    import: 'ğŸ“ SÃ©lectionnez votre CV PDF',
    letter: 'âœï¸ GÃ©nÃ©ration de la lettre de motivationâ€¦'
  };
  showToast(msgs[action] || 'â³ En coursâ€¦');
  if (action === 'generate' || action === 'optimize') {
    setTimeout(() => {
      ejCvGenerated = true;
      showToast('âœ… CV IA gÃ©nÃ©rÃ© et optimisÃ© pour ce poste !');
      const cell = document.getElementById('ejCvUploadCell');
      if (cell) {
        cell.classList.add('has-file');
        cell.innerHTML = `<div style="font-size:1.5rem;margin-bottom:5px;">ğŸ“„</div>
          <div style="font-size:0.65rem;font-weight:700;font-family:'Sora',sans-serif;color:var(--vp);">CV IA gÃ©nÃ©rÃ© âœ“</div>
          <div style="font-size:0.6rem;color:#9BA3AE;margin-top:2px;">OptimisÃ© pour ce poste</div>`;
      }
    }, 1500);
  }
  if (action === 'letter') {
    setTimeout(() => {
      const textarea = document.getElementById('ejApplyMotivation');
      if (textarea && !textarea.value) {
        textarea.value = `Madame, Monsieur,\n\nPassionnÃ© par le secteur agropastoral depuis 6 ans, je suis vivement intÃ©ressÃ© par le poste de ${ejCurrentJob?.title || 'Technicien'} au sein de ${ejCurrentJob?.company || 'votre entreprise'}.\n\nMon expÃ©rience terrain et ma formation me permettent de rÃ©pondre pleinement aux exigences du poste. Je suis prÃªt Ã  contribuer activement Ã  vos projets de dÃ©veloppement.\n\nCordialement,\nAmadou NJOYA`;
        showToast('âœ… Lettre de motivation gÃ©nÃ©rÃ©e par ABAE IA !');
      }
    }, 1200);
  }
}

function ejSubmitApplication() {
  if (!ejCurrentJob) return;
  const name = (document.getElementById('ejApplyName') || {}).value;
  const email = (document.getElementById('ejApplyEmail') || {}).value;
  if (!name || !email) {
    showToast('âš ï¸ Veuillez remplir les champs obligatoires');
    return;
  }
  const btn = document.querySelector('.ej-btn-submit');
  if (btn) {
    btn.textContent = 'â³ Envoi en coursâ€¦';
    btn.disabled = true;
  }
  setTimeout(() => {
    // Show success
    document.getElementById('ejApplyBody').innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:40px 20px;text-align:center;">
        <div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#4A9E2A,#2A5E10);display:flex;align-items:center;justify-content:center;font-size:2.2rem;margin-bottom:20px;box-shadow:0 8px 30px rgba(74,158,42,0.4);">âœ…</div>
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.2rem;color:var(--g900);margin-bottom:8px;">Candidature envoyÃ©e !</div>
        <div style="font-size:0.8rem;color:var(--g400);line-height:1.6;margin-bottom:24px;">
          Votre dossier a Ã©tÃ© transmis Ã  <strong>${ejCurrentJob.company}</strong>.<br>
          RÃ©ponse attendue sous <strong>48h</strong> via messagerie ABAE.
        </div>
        <div style="background:var(--vc);border-radius:14px;padding:14px 20px;margin-bottom:20px;font-size:0.8rem;color:var(--vf);font-weight:600;">
          ğŸ¤– CompatibilitÃ© IA : <strong>${ejCurrentJob.match}%</strong><br>
          ğŸ“„ CV optimisÃ© envoyÃ© Â· âœ… Profil ABAE joint
        </div>
        <button onclick="ejShowView('list')" style="padding:12px 24px;border-radius:14px;border:1.5px solid var(--vp);background:transparent;color:var(--vp);font-family:'Sora',sans-serif;font-weight:800;font-size:0.85rem;cursor:pointer;">
          â† Voir d'autres offres
        </button>
      </div>`;
    document.getElementById('ejApplyFooter').innerHTML = '';
    document.getElementById('ejApplyHeader').querySelector('.ej-apply-sub').textContent = 'Candidature envoyÃ©e ğŸ‰';
  }, 1800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentScreen='marche';
let screenHistory=[];

// Ã‰crans restreints en mode visiteur
const VISITOR_RESTRICTED_SCREENS = ['commandes','portefeuille','documents','smart','profil','parametres','messages'];

function navTo(id){
  // Bloquer la navigation vers les Ã©crans restreints en mode visiteur
  if (window.ABAE_STATE && window.ABAE_STATE.isVisitorMode && VISITOR_RESTRICTED_SCREENS.includes(id)) {
    wsShowPopup(); return;
  }
  const prev=document.getElementById('screen-'+currentScreen);
  const next=document.getElementById('screen-'+id);
  if(!next) return;
  if(prev) prev.classList.remove('active');
  next.classList.add('active');
  currentScreen=id;
  screenHistory=[]; /* FIX v52 â€” rÃ©initialisation normale sur nav principale */
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const ni=document.getElementById('nav-'+id);
  if(ni) ni.classList.add('active');
  if(id==='profil') { updateGainsStats(); populateProfileHero(); }
  // FIX v52 â€” scroll en haut Ã  chaque changement d'onglet
  const _scr = document.getElementById('screen-'+id);
  if(_scr) _scr.scrollTop = 0;
}

function pushScreen(id){
  screenHistory.push(currentScreen);
  const prev=document.getElementById('screen-'+currentScreen);
  const next=document.getElementById('screen-'+id);
  if(!next)return;

  // Cas spÃ©cial : screen-emplois = slide-up comme detail
  if(id==='emplois'){
    next.style.display='flex';
    next.style.transform='translateY(100%)';
    next.style.opacity='0';
    next.classList.add('active');
    const bn=document.querySelector('.bottomnav');
    if(bn) bn.style.display='none';
    requestAnimationFrame(()=>requestAnimationFrame(()=>{
      next.style.transform='translateY(0)';
      next.style.opacity='1';
    }));
    currentScreen=id;
    return;
  }

  // Cas spÃ©cial : screen-detail = plein Ã©cran avec slide-up
  if(id==='detail'){
    // Cacher les autres Ã©crans sans les dÃ©sactiver (resteront dessous)
    next.style.display='flex';
    next.style.transform='translateY(100%)';
    next.style.opacity='0';
    next.classList.add('active');
    // FIX v17 â€” cacher la bottomnav pour les Ã©crans plein Ã©cran
    const bn=document.querySelector('.bottomnav');
    if(bn) bn.style.display='none';
    requestAnimationFrame(()=>requestAnimationFrame(()=>{
      next.style.transform='translateY(0)';
      next.style.opacity='1';
    }));
    currentScreen=id;
    return;
  }

  // Cas spÃ©cial : screen-order = slide-up immersif avec scale
  if(id==='order'){
    next.classList.add('active');
    // FIX v17 â€” cacher la bottomnav pour les Ã©crans plein Ã©cran
    const bn=document.querySelector('.bottomnav');
    if(bn) bn.style.display='none';
    requestAnimationFrame(()=>requestAnimationFrame(()=>{
      next.style.transform='translateY(0)';
      next.style.opacity='1';
      next.style.borderRadius='0';
    }));
    currentScreen=id;
    return;
  }

  next.classList.add('screen-slide');
  next.classList.add('active');
  if(prev) prev.classList.remove('active');
  requestAnimationFrame(()=>requestAnimationFrame(()=>next.classList.add('in')));
  currentScreen=id;
}

function goBack(){
  // Cas spÃ©cial : dans l'Ã©cran emplois avec sous-vues
  if(currentScreen==='emplois' && ejCurrentView !== 'list'){
    ejGoBackInView();
    return;
  }
  if(!screenHistory.length){navTo('marche');return;}
  const prev=screenHistory.pop();
  const curr=document.getElementById('screen-'+currentScreen);
  const target=document.getElementById('screen-'+prev);

  // Cas spÃ©cial retour depuis emplois : slide-down
  if(currentScreen==='emplois' && curr){
    curr.style.transform='translateY(100%)';
    curr.style.opacity='0';
    setTimeout(()=>{
      curr.classList.remove('active');
      curr.style.transform='';
      curr.style.opacity='';
      curr.style.display='';
    }, 340);
    if(target) target.classList.add('active');
    currentScreen=prev;
    const bn=document.querySelector('.bottomnav');
    if(bn) bn.style.display='';
    return;
  }

  // Cas spÃ©cial retour depuis detail : animation slide-down
  if(currentScreen==='detail' && curr){
    curr.style.transform='translateY(100%)';
    curr.style.opacity='0';
    setTimeout(()=>{
      curr.classList.remove('active');
      curr.style.transform='';
      curr.style.opacity='';
    }, 340);
    if(target) target.classList.add('active');
    currentScreen=prev;
    // FIX v17 â€” rÃ©tablir la bottomnav
    const bn=document.querySelector('.bottomnav');
    if(bn) bn.style.display='';
    return;
  }

  // Cas spÃ©cial retour depuis order : slide-down
  if(currentScreen==='order' && curr){
    curr.style.transform='translateY(100%)';
    curr.style.opacity='0';
    setTimeout(()=>{
      curr.classList.remove('active');
      curr.style.transform='';
      curr.style.opacity='';
    }, 420);
    if(target) target.classList.add('active');
    currentScreen=prev;
    // FIX v17 â€” rÃ©tablir la bottomnav
    const bn=document.querySelector('.bottomnav');
    if(bn) bn.style.display='';
    return;
  }

  if(curr){curr.classList.remove('active');curr.classList.remove('in');curr.classList.remove('screen-slide');}
  if(target) target.classList.add('active');
  currentScreen=prev;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHEETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSheet(id){
  closeAllSheets();
  const s=document.getElementById(id);
  const o=document.getElementById('sheetOverlay');
  if(!s){ console.warn('Sheet not found:',id); return; }
  // Force reflow for mobile
  s.style.display='';
  void s.offsetHeight;
  s.classList.add('open');
  if(o) o.classList.add('open');
  // Init wallet sheets
  if(typeof walletSheetInit==='function') walletSheetInit(id);
  // Populate profile edit sheet with real user data
  if(id==='profileEditSheet') populateProfileSheet();
  // Prevent body scroll on mobile
  document.body.style.overflow='hidden';
}
function closeSheet(id){
  document.getElementById(id)?.classList.remove('open');
  document.getElementById('sheetOverlay')?.classList.remove('open');
  document.body.style.overflow='';
}
function closeAllSheets(){
  document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('open'));
  const o=document.getElementById('sheetOverlay');
  if(o) o.classList.remove('open');
  document.body.style.overflow='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeChip='all';

function stars(r){return'â˜…'.repeat(Math.floor(r))+(r%1>=.5?'Â½':'')+' '.repeat(5-Math.ceil(r));}

function renderCards(data){
  const g=document.getElementById('cardsGrid');
  document.getElementById('resultCount').textContent=data.length;
  if(!data.length){
    g.innerHTML=`<div style="text-align:center;padding:40px 20px;color:var(--g400);">
      <div style="font-size:2.5rem;margin-bottom:10px;">ğŸŒ¾</div>
      <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:var(--g700);margin-bottom:4px;">Aucun rÃ©sultat</div>
      <div style="font-size:0.78rem;">Essayez d'autres filtres</div>
    </div>`;
    return;
  }
  const sorted = [...data].sort((a,b)=>{
    const rank = p => p.boost==='pro'?3:p.boost==='vedette'?2:p.boost==='urgent'?1:0;
    return rank(b)-rank(a);
  });
  g.innerHTML=sorted.map((p,i)=>`
    <div class="card" style="animation:fadeIn .3s ${i*50}ms both;${p.boost&&p.boost!=='free'?'box-shadow:0 4px 18px rgba(212,168,67,0.2);':''}" onclick="openDetail(${p.id})">
      <div class="card-thumb" style="position:relative;">
        <img src="${p.img}" alt="${p.name}" loading="lazy" onerror="this.style.display='none'"/>
        ${(p.boost==='vedette'||p.boost==='pro')?'<div class="card-boost-badge">â­ En vedette</div>':''}
        ${(p.boost==='urgent'||p.boost==='pro')?'<div class="card-urgent-badge">ğŸ”´ Urgent</div>':''}
        ${p.verified?'<div class="badge-v">âœ“</div>':''}
        <div class="badge-cat">${CATL[p.cat]||p.cat}</div>
      </div>
      <div class="card-info">
        <div class="card-name">${p.name}</div>
        <div class="card-seller">${p.seller}</div>
        <div class="card-loc"><svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>${p.loc}</div>
        <div class="card-row">
          <div class="card-price ${p.priceLabel.includes('devis')||p.priceLabel.includes('Taux')?'on-quote':''}">${p.priceLabel}</div>
          <div class="card-rating"><span class="star">â˜…</span> ${p.rating} <span>(${p.reviews})</span></div>
        </div>
        <div class="card-escrow">ğŸ”’ Paiement ABAE</div>
      </div>
    </div>`).join('');
}

function showSkeletons(){
  document.getElementById('cardsGrid').innerHTML=Array(5).fill(0).map(()=>`
    <div class="sk-card">
      <div class="sk-thumb skeleton"></div>
      <div class="sk-body">
        <div class="skeleton sk-line" style="width:75%"></div>
        <div class="skeleton sk-line" style="width:55%"></div>
        <div class="skeleton sk-line" style="width:45%;height:9px"></div>
        <div class="skeleton sk-line" style="width:40%;margin-top:6px"></div>
      </div>
    </div>`).join('');
}

function filterCards(){
  const cat=document.getElementById('filterCat').value;
  const pays=(document.getElementById('filterPays')||{}).value||'';
  const v=document.getElementById('filterVerified').checked;
  const q=document.getElementById('heroSearchInput').value.toLowerCase();
  const filtered=PRODUCTS.filter(p=>{
    if(activeChip!=='all'&&p.cat!==activeChip)return false;
    if(cat&&p.cat!==cat)return false;
    if(pays&&p.country!==pays)return false;
    if(v&&!p.verified)return false;
    if(q&&!p.name.toLowerCase().includes(q)&&!p.desc.toLowerCase().includes(q)&&!p.seller.toLowerCase().includes(q))return false;
    return true;
  });
  const locLabel=document.getElementById('locationLabel');
  if(locLabel){
    const paysEl=document.getElementById('filterPays');
    const txt=pays&&paysEl?paysEl.options[paysEl.selectedIndex].text:'ğŸŒ Tous pays';
    locLabel.innerHTML='<span class="loc-pill">'+txt+'</span>';
  }
  showSkeletons();
  setTimeout(()=>renderCards(filtered),300);
}

function resetFilters(){
  document.getElementById('filterCat').value='';
  const paysEl=document.getElementById('filterPays');
  if(paysEl) paysEl.value='';
  document.getElementById('filterVerified').checked=false;
  document.getElementById('heroSearchInput').value='';
  activeChip='all';
  document.querySelectorAll('.chip').forEach(c=>{c.classList.remove('active');});
  document.querySelector('.chip[data-filter="all"]').classList.add('active');
  const locLabel=document.getElementById('locationLabel');
  if(locLabel) locLabel.innerHTML='<span class="loc-pill">ğŸŒ Tous pays</span>';
  showSkeletons();
  setTimeout(()=>renderCards(PRODUCTS),300);
}

function setChip(el,f){
  activeChip=f;
  // Activer tous les chips avec le mÃªme filtre (copies dans la boucle infinie)
  document.querySelectorAll('.chip').forEach(c=>{
    c.classList.remove('active');
    if(c.getAttribute('data-filter')===f) c.classList.add('active');
  });
  filterCards();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â• Ã‰tat carousel â•â•
let _carouselIdx = 0;
let _carouselImgs = [];
let _carouselTouchStartX = 0;
let _carouselTouchStartY = 0;
let _carouselDragging = false;
let _carouselDragOffset = 0;

function openDetail(id){
  const p=PRODUCTS.find(x=>x.id===id); if(!p)return;
  const { comm, taux, label } = calcABAECommission(p.price);
  const rate = taux;
  _carouselImgs = p.imgs || [p.img];
  _carouselIdx = 0;

  document.getElementById('detailTopTitle').textContent=p.name;
  document.getElementById('detailContent').innerHTML=`
    <div class="detail-carousel" id="detailCarousel">
      <div class="carousel-track" id="carouselTrack">
        ${_carouselImgs.map((src,i)=>`
          <div class="carousel-slide">
            <img src="${src}" alt="${p.name} photo ${i+1}" onerror="this.src='https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=500&q=75'"/>
          </div>`).join('')}
      </div>
      <!-- Badges -->
      <div class="carousel-badges">
        ${p.verified?'<span class="d-badge d-badge-green">âœ“ VÃ©rifiÃ©</span>':''}
        <span class="d-badge d-badge-dark">${CATL[p.cat]}</span>
      </div>
      <!-- Compteur -->
      <div class="carousel-counter" id="carouselCounter">1 / ${_carouselImgs.length}</div>
      <!-- Dots -->
      <div class="carousel-dots" id="carouselDots">
        ${_carouselImgs.map((_,i)=>`<div class="carousel-dot${i===0?' active':''}" onclick="carouselGoTo(${i})"></div>`).join('')}
      </div>
      <!-- FlÃ¨ches -->
      <button class="carousel-arrow prev hidden" id="carouselPrev" onclick="carouselGoTo(_carouselIdx-1)">
        <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <button class="carousel-arrow next" id="carouselNext" onclick="carouselGoTo(_carouselIdx+1)">
        <svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
    </div>
    <div class="detail-body">
      <div class="detail-price ${p.price===0?'on-quote':''}">${p.priceLabel}</div>
      <div class="detail-name">${p.name}</div>
      <div class="detail-tags">
        <span class="detail-tag">â­ ${p.rating} (${p.reviews} avis)</span>
        <span class="detail-tag">ğŸ“ ${p.loc}</span>
        ${p.verified?'<span class="detail-tag green">âœ… Profil vÃ©rifiÃ©</span>':''}
      </div>
    </div>
    <div class="detail-section">
      <div class="detail-section-title">Description</div>
      <div class="detail-desc">${p.desc}</div>
    </div>
    <div class="detail-section">
      <div class="masked-contact">
        <svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 01-2.18 2A19.79 19.79 0 013 7.18 2 2 0 015 5h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L9.09 12a16 16 0 006.91 6.91l1.27-1.27a2 2 0 012.11-.45c.907.34 1.85.574 2.81.7A2 2 0 0122 20z"/></svg>
        <div><div style="font-size:0.82rem;font-weight:700;color:var(--g900);">Contact masquÃ©</div><div style="font-size:0.72rem;color:var(--g400);margin-top:2px;">Ã‰changes via messagerie ABAE uniquement</div></div>
      </div>
    </div>
    ${renderDetailCommBox(p, rate, comm)}
    <!-- CARTE VENDEUR SVG -->
    ${renderSellerMapSVG(p)}
    <div class="detail-section">
      <div class="detail-section-title">ğŸ§  Analyse ABAE Smart IA</div>
      ${renderSmartIATools(p.cat)}
    </div>
    <div style="height:90px;"></div>`;

  // Init swipe touch sur le carousel
  setTimeout(()=>{
    const carousel = document.getElementById('detailCarousel');
    const track = document.getElementById('carouselTrack');
    if(!carousel || !track) return;
    carousel.addEventListener('touchstart', e=>{
      _carouselTouchStartX = e.touches[0].clientX;
      _carouselTouchStartY = e.touches[0].clientY;
      _carouselDragging = true;
      _carouselDragOffset = 0;
      track.classList.add('no-transition');
    }, {passive:true});
    carousel.addEventListener('touchmove', e=>{
      if(!_carouselDragging) return;
      const dx = e.touches[0].clientX - _carouselTouchStartX;
      const dy = e.touches[0].clientY - _carouselTouchStartY;
      if(Math.abs(dy) > Math.abs(dx) && Math.abs(_carouselDragOffset) < 5) { _carouselDragging=false; return; }
      _carouselDragOffset = dx;
      const base = -_carouselIdx * 100;
      const pct = base + (dx / carousel.offsetWidth * 100);
      track.style.transform = `translateX(${pct}%)`;
      carousel.classList.add('show-arrows');
    }, {passive:true});
    carousel.addEventListener('touchend', e=>{
      if(!_carouselDragging) return;
      _carouselDragging = false;
      track.classList.remove('no-transition');
      carousel.classList.remove('show-arrows');
      if(_carouselDragOffset < -50 && _carouselIdx < _carouselImgs.length-1) carouselGoTo(_carouselIdx+1);
      else if(_carouselDragOffset > 50 && _carouselIdx > 0) carouselGoTo(_carouselIdx-1);
      else carouselGoTo(_carouselIdx);
    }, {passive:true});
    // Preload images
    _carouselImgs.forEach(src=>{ const i=new Image(); i.src=src; });
  }, 80);

  // Footer
  const existingFooter=document.querySelector('#screen-detail .detail-footer');
  if(existingFooter) existingFooter.remove();
  const footer=document.createElement('div');
  footer.className='detail-footer';

  const role = (window.ABAE_USER_ROLE || 'acheteur').toLowerCase();
  const isMineOffer = p.isMine && canSell(role);

  if (isMineOffer) {
    // C'est MA propre offre â€” actions vendeur uniquement
    footer.innerHTML=`
      <button class="btn-contact detail-contact" onclick="openEditOffer(${p.id})" title="Modifier l'offre">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      </button>
      <button class="btn-primary" onclick="toggleOfferStatus(${p.id});goBack()" style="background:${p.status==='active'?'linear-gradient(135deg,#D4A843,#B8860B)':'linear-gradient(135deg,#4A9E2A,#2A5E10)'}">
        ${p.status==='active'?'â¸ï¸ Mettre en pause':'â–¶ï¸ RÃ©activer l\'offre'}
      </button>`;
  } else {
    // Offre d'un autre utilisateur â€” actions acheteur/commande
    footer.innerHTML=`
      <button class="btn-contact detail-contact" onclick="if(!abaeCanDo('message')) return; showToast('Message envoyÃ© Ã  ${p.seller} via ABAE')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
      </button>
      <button class="btn-primary" onclick="openOrder(${p.id})" style="display:flex;align-items:center;justify-content:center;gap:6px;">
        ${getActionCfg(p.cat).btn} â†’
      </button>`;
  }

  document.getElementById('screen-detail').appendChild(footer);
  pushScreen('detail');
}

function carouselGoTo(idx){
  const n = _carouselImgs.length;
  _carouselIdx = Math.max(0, Math.min(n-1, idx));
  const track = document.getElementById('carouselTrack');
  if(track){
    track.classList.remove('no-transition');
    track.style.transform = `translateX(${-_carouselIdx * 100}%)`;
  }
  // Dots
  document.querySelectorAll('#carouselDots .carousel-dot').forEach((d,i)=>{
    d.classList.toggle('active', i===_carouselIdx);
  });
  // Compteur
  const counter = document.getElementById('carouselCounter');
  if(counter) counter.textContent = `${_carouselIdx+1} / ${n}`;
  // FlÃ¨ches
  const prev = document.getElementById('carouselPrev');
  const next = document.getElementById('carouselNext');
  if(prev) prev.classList.toggle('hidden', _carouselIdx===0);
  if(next) next.classList.toggle('hidden', _carouselIdx===n-1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ORDER TUNNEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let orderStep=0, currentPid=null, selPayment='momo';

function openOrder(id){
  currentPid=id; orderStep=1;
  renderOrder();
  if(!abaeCanDo('commander')) return; pushScreen('order');
}

function orderBack(){
  if(orderStep>1){orderStep--;renderOrder();}
  else goBack();
}

function renderOrder(){
  const p=PRODUCTS.find(x=>x.id===currentPid); if(!p)return;
  const cfg = getActionCfg(p.cat);
  const { comm, taux, label: commLabel, net } = calcABAECommission(p.price);
  const rate = taux;
  const stepNames = cfg.hasPayment ? [cfg.step1, cfg.step2, 'Confirmation'] : [cfg.step1, cfg.step2, 'Confirmation'];
  document.getElementById('orderTopTitle').textContent = orderStep===1 ? cfg.tunnelTitle : orderStep===2 ? stepNames[1] : 'Confirmation';

  // Steps dans le header
  const hdr=document.getElementById('orderStepsInHeader');
  if(hdr) hdr.innerHTML=[0,1,2].map(i=>`<div style="flex:1;height:4px;border-radius:4px;background:${i<orderStep?'#fff':i===orderStep-1?'rgba(255,255,255,0.7)':'rgba(255,255,255,0.25)'};transition:background 0.4s;"></div>`).join('');

  const titles=['RÃ©sumÃ©','Paiement sÃ©curisÃ©','Commande confirmÃ©e'];
  const steps=``;

  // Bloc rÃ©capitulatif commission (visible Ã  l'Ã©tape 1 et 2)
  const commBlock = p.price > 0 ? `
    <div style="background:linear-gradient(135deg,rgba(74,158,42,0.06),rgba(74,158,42,0.02));border:1.5px solid rgba(74,158,42,0.22);border-radius:14px;padding:14px 16px;margin-top:12px;">
      <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.8rem;color:var(--vf);margin-bottom:10px;display:flex;align-items:center;gap:6px;">
        <span>ğŸ’°</span> DÃ©tail de la transaction
      </div>
      <div style="display:flex;justify-content:space-between;font-size:0.82rem;color:#3D4550;padding:6px 0;border-bottom:1px solid rgba(74,158,42,0.12);">
        <span>Montant de la transaction</span>
        <span style="font-family:'JetBrains Mono',monospace;font-weight:700;">${p.price.toLocaleString('fr')} XAF</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:0.82rem;color:#3D4550;padding:6px 0;border-bottom:1px solid rgba(74,158,42,0.12);">
        <span style="display:flex;align-items:center;gap:4px;">Commission ABAE <span style="background:rgba(74,158,42,0.12);color:var(--vp);font-size:0.68rem;font-weight:700;padding:1px 6px;border-radius:10px;">${commLabel} de ${p.price.toLocaleString('fr')} XAF</span></span>
        <span style="color:var(--vp);font-weight:700;">âˆ’ ${comm.toLocaleString('fr')} XAF</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:0.95rem;font-weight:700;padding:8px 0 0;">
        <span>Vous payez</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:1.05rem;color:var(--vf);">${p.price.toLocaleString('fr')} XAF</span>
      </div>
      <div style="font-size:0.7rem;color:var(--g400);margin-top:6px;line-height:1.5;">
        âœ¦ Le vendeur reÃ§oit <strong>${net.toLocaleString('fr')} XAF</strong> aprÃ¨s prÃ©lÃ¨vement automatique de la commission ABAE Ã  la confirmation de livraison.
      </div>
    </div>` : '';

  let body='';
  if(orderStep===1){
    const schema = ORDER_FORM_SCHEMAS[p.cat] || ORDER_FORM_SCHEMAS['agro'];
    let fieldsHtml = '';
    const fields = schema.fields||[];
    let fi=0;
    while(fi<fields.length){
      const f=fields[fi];
      if(f.size==='half' && fields[fi+1] && fields[fi+1].size==='half'){
        fieldsHtml+=`<div style="display:flex;gap:8px;">${_buildField(f,'ord')}${_buildField(fields[fi+1],'ord')}</div>`;
        fi+=2;
      } else {
        fieldsHtml+=_buildField(f,'ord');
        fi++;
      }
    }
    body=`
      ${steps}
      <div class="step-content">
        <div class="step-title">${schema.step1Title||cfg.step1}</div>
        <div class="step-sub">${schema.step1Sub||''}</div>
        <div class="order-summary">
          <div class="os-row"><span style="color:var(--g400);font-size:0.9rem;">${
            p.cat==='emplois'?'Poste':p.cat==='formation'?'Formation':p.cat==='services'||p.cat==='digital'||p.cat==='transport'?'Prestation':'Produit'
          }</span><span style="font-weight:700;font-size:0.95rem;max-width:55%;text-align:right;">${p.name}</span></div>
          <div class="os-row"><span style="color:var(--g400);font-size:0.9rem;">${
            p.cat==='emplois'?'Recruteur':p.cat==='formation'?'Formateur':p.cat==='services'||p.cat==='digital'?'Prestataire':p.cat==='assurance'?'Assureur':'Vendeur'
          }</span><span style="font-size:0.95rem;">${p.seller}</span></div>
          <div class="os-row"><span style="color:var(--g400);font-size:0.9rem;">Localisation</span><span style="font-size:0.95rem;">${p.loc}</span></div>
          ${p.cat==='emplois'?`
          <div class="os-row"><span style="color:var(--g400);">Contrat</span><span style="font-weight:700;color:#1A5C8A;">${p.priceLabel||'Ã€ dÃ©finir'}</span></div>
          <div class="os-row"><span style="color:var(--g400);">Candidature</span><span style="color:var(--vp);font-weight:700;">âœ“ Gratuite</span></div>
          `:p.cat==='assurance'||p.cat==='financement'?`
          <div class="os-row"><span style="color:var(--g400);">Tarif</span><span style="font-style:italic;">${p.priceLabel||'Ã€ dÃ©finir avec le conseiller'}</span></div>
          `:''}
        </div>
        ${commBlock}
        ${fieldsHtml}
      </div>`;
  } else if(orderStep===2){
    if(cfg.hasPayment && p.price > 0){
      body=`
      ${steps}
      <div class="step-content">
        <div class="step-title">${cfg.step2}</div>
        <div class="step-sub">Votre paiement sera sÃ©curisÃ© par le systÃ¨me escrow ABAE.</div>
        <div class="pay-method sel" id="pm-momo" onclick="selPay(this,'momo')" style="border:2px solid var(--vp);border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:10px;margin-bottom:9px;background:#fff;cursor:pointer;transition:all .2s;position:relative;">
          <div style="width:42px;height:42px;background:linear-gradient(135deg,#25D366,#128C7E);border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0;">ğŸ“±</div>
          <div style="flex:1;min-width:0;">
            <div style="display:flex;align-items:center;gap:6px;flex-wrap:nowrap;">
              <span style="font-weight:700;font-size:0.9rem;color:#111;white-space:nowrap;">Mobile Money</span>
              <span style="font-size:0.6rem;color:var(--vp);font-weight:700;background:rgba(74,158,42,0.12);padding:2px 7px;border-radius:20px;white-space:nowrap;flex-shrink:0;">âœ“ RecommandÃ©</span>
            </div>
            <div style="font-size:0.75rem;color:#6B7280;margin-top:2px;white-space:nowrap;">MTN Â· Orange &mdash; InstantanÃ©</div>
          </div>
        </div>
        <div class="pay-method" id="pm-wallet" onclick="selPay(this,'wallet')" style="border:2px solid #E5E7EB;border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:10px;margin-bottom:9px;cursor:pointer;transition:all .2s;">
          <div style="width:42px;height:42px;background:linear-gradient(135deg,#D4A843,#B8860B);border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0;">ğŸ’¼</div>
          <div style="flex:1;min-width:0;">
            <div style="font-weight:700;font-size:0.9rem;color:#111;">Portefeuille ABAE</div>
            <div style="font-size:0.75rem;color:#6B7280;margin-top:2px;">Solde : <strong style="color:var(--vp);">125 000 XAF</strong></div>
          </div>
        </div>
        <div class="pay-method" id="pm-bank" onclick="selPay(this,'bank')" style="border:2px solid #E5E7EB;border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:10px;margin-bottom:9px;cursor:pointer;transition:all .2s;">
          <div style="width:42px;height:42px;background:linear-gradient(135deg,#1A5C8A,#0D3A5C);border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0;">ğŸ¦</div>
          <div style="flex:1;min-width:0;">
            <div style="font-weight:700;font-size:0.9rem;color:#111;">Virement bancaire</div>
            <div style="font-size:0.75rem;color:#6B7280;margin-top:2px;">BEAC, BICEC, SCB &mdash; 24â€“48h</div>
          </div>
        </div>
        <div style="background:#F8FAF9;border:1px solid #E0EDE6;border-radius:12px;padding:12px 14px;margin-top:4px;">
          <div style="display:flex;justify-content:space-between;font-size:0.82rem;color:#6B7280;margin-bottom:6px;"><span>Commission ABAE (${commLabel} de ${p.price.toLocaleString('fr')} XAF)</span><span style="color:var(--vp);">âˆ’ ${comm.toLocaleString('fr')} XAF</span></div>
          <div style="display:flex;justify-content:space-between;font-size:0.78rem;color:#9BA3AE;margin-bottom:8px;"><span>â†’ Vendeur recevra</span><span>${net.toLocaleString('fr')} XAF</span></div>
          <div style="display:flex;justify-content:space-between;font-size:1rem;font-weight:700;"><span>Montant dÃ©bitÃ©</span><span style="font-family:'JetBrains Mono',monospace;color:var(--vf);">${p.price.toLocaleString('fr')} XAF</span></div>
        </div>
        <div class="escrow-note" style="margin-top:12px;"><strong>ğŸ”’ Escrow ABAE</strong>L'argent est bloquÃ© jusqu'Ã  confirmation de rÃ©ception. La commission de ${comm.toLocaleString('fr')} XAF sera prÃ©levÃ©e automatiquement Ã  la libÃ©ration des fonds.</div>
      </div>`;
    } else {
      // Pas de paiement : vÃ©rification rÃ©capitulative du dossier
      body=`
      ${steps}
      <div class="step-content">
        <div class="step-title">${cfg.step2}</div>
        <div class="step-sub">VÃ©rifiez votre dossier avant envoi. Cette action est irrÃ©versible.</div>
        <div class="order-summary" style="margin-top:12px;">
          <div class="os-row"><span style="color:var(--g400);">${p.cat==='emplois'?'Poste':p.cat==='assurance'?'Assurance':p.cat==='financement'?'Financement':'Offre'}</span><span style="font-weight:700;">${p.name}</span></div>
          <div class="os-row"><span style="color:var(--g400);">${p.cat==='emplois'?'Recruteur':p.cat==='assurance'?'Assureur':'Contact'}</span><span>${p.seller}</span></div>
          <div class="os-row"><span style="color:var(--g400);">Lieu</span><span>${p.loc}</span></div>
        </div>
        <div style="background:linear-gradient(135deg,rgba(74,158,42,0.06),rgba(26,92,138,0.04));border:1.5px solid rgba(74,158,42,0.2);border-radius:12px;padding:14px;margin-top:14px;font-size:0.8rem;color:#3D4550;line-height:1.6;">
          ${p.cat==='emplois'?`<strong style="color:#1A5C8A;">ğŸ“‹ Votre dossier sera transmis directement au recruteur.</strong><br/>Assurez-vous que vos coordonnÃ©es sont correctes.`:
            p.cat==='assurance'?`<strong style="color:#1A5C8A;">ğŸ›¡ï¸ Votre dossier sera traitÃ© par un conseiller ABAE.</strong><br/>Un rappel vous sera fait sous 48h.`:
            p.cat==='financement'?`<strong style="color:#1A5C8A;">ğŸ’° Votre dossier sera examinÃ© par nos partenaires financiers.</strong><br/>RÃ©ponse attendue sous 72h.`:
            `<strong style="color:#1A5C8A;">âœ‰ï¸ Votre demande sera transmise.</strong><br/>Vous serez contactÃ© rapidement.`}
        </div>
      </div>`;
    }
  } else {
    // Ã‰tape 3 : confirmation intelligente selon catÃ©gorie
    const isNoPayCat = !cfg.hasPayment || p.price === 0;
    body=`
      <div class="success-screen">
        <div class="success-icon">${cfg.step3Icon||'âœ…'}</div>
        <h2>${cfg.step3Title}</h2>
        <p>${cfg.step3Msg}</p>
        ${!isNoPayCat && p.price>0?`<p style="margin-top:8px;font-size:0.75rem;color:var(--g400);">Commission ABAE de ${comm.toLocaleString('fr')} XAF (${commLabel}) prÃ©levÃ©e Ã  la livraison confirmÃ©e.</p>`:''}
        <div style="display:flex;flex-direction:column;gap:10px;width:100%;margin-top:24px;">
          ${!isNoPayCat?`<button class="btn btn-primary btn-block" onclick="orderStep=99;goBack();goBack();navTo('documents');showToast('Documents gÃ©nÃ©rÃ©s âœ“','ok')">ğŸ“„ Voir mes documents PDF</button>`:''}
          <button class="btn ${isNoPayCat?'btn-primary':'btn-ghost'} btn-block" onclick="goBack();goBack()">Retour au marchÃ©</button>
        </div>
      </div>`;
  }

  let footer='';
  if(orderStep<3){
    footer=`
      <div class="step-footer" id="orderFooter">
        ${orderStep>1?`<button class="btn btn-ghost" onclick="orderStep--;renderOrder()">â† Retour</button>`:''}
        <button class="btn btn-primary" style="flex:1;" id="orderNextBtn" onclick="handleOrderNext()">
          ${orderStep===1 ? cfg.btnNext1 : cfg.btnNext2}
        </button>
      </div>`;
  }

  document.getElementById('orderContent').innerHTML=body+footer;
}

function selPay(el,id){
  document.querySelectorAll('.pay-method').forEach(m=>{
    m.classList.remove('sel');
    m.style.border='2px solid #E5E7EB';
    m.style.background='';
  });
  el.classList.add('sel');
  el.style.border='2px solid var(--vp)';
  el.style.background='#fff';
  selPayment=id;
}

function handleOrderNext(){
  const p = PRODUCTS.find(x=>x.id===currentPid);
  const cfg = p ? getActionCfg(p.cat) : SMART_ACTION_CONFIG['agro'];
  const needsPayment = cfg.hasPayment && p && p.price > 0;

  if(orderStep===1){
    orderStep++;
    renderOrder();
  } else if(orderStep===2){
    // Simulation traitement
    const btn=document.getElementById('orderNextBtn');
    if(!btn) return;
    btn.disabled=true;
    btn.innerHTML = needsPayment ? 'â³ Traitement du paiementâ€¦' : 'â³ Envoi en coursâ€¦';
    if(needsPayment){
      const payLabel = {momo:'Mobile Money (MTN/Orange)', wallet:'Portefeuille ABAE', bank:'Virement bancaire'}[selPayment]||'Mobile Money';
      showToast('ğŸ”’ SÃ©curisation du paiement via '+payLabel+'â€¦');
    } else {
      showToast(cfg.toast||'Dossier transmisâ€¦');
    }
    setTimeout(()=>{
      orderStep++;
      renderOrder();
    }, 1800);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOC VIEWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DOC_TEMPLATES={
  bc:{title:'Bon de commande',num:'BC-2026-001547',content:buildBC},
  bl:{title:'Bon de livraison',num:'BL-2026-001547',content:buildBL},
  fac:{title:'Facture',num:'FAC-2026-001547',content:buildFAC},
  recu:{title:'ReÃ§u de paiement',num:'RECU-2026-001547',content:buildRECU},
  dep:{title:'ReÃ§u de dÃ©pÃ´t',num:'DEP-2026-000389',content:buildDEP},
  dec:{title:'ReÃ§u dÃ©caissement',num:'DEC-2026-001547',content:buildDEC}
};
let currentDocId=null;

function goToDocViewer(id){
  const tpl=DOC_TEMPLATES[id]; if(!tpl)return;
  currentDocId=id;
  document.getElementById('docViewerTitle').textContent=tpl.title;
  document.getElementById('docViewerContent').innerHTML=
    `<div class="doc-viewer"><div class="doc-paper">${tpl.content()}</div></div>`;
  pushScreen('docviewer');
}

function docHd(type,num){return`
  <div class="doc-paper-hd">
    <div class="doc-logo-sm">
      <div class="mark"><span>AB</span></div>
      <strong>ABAE</strong>
    </div>
    <div>
      <div class="doc-type-label">${type}</div>
      <div class="doc-num-sm">${num} Â· 25 fÃ©v. 2026</div>
    </div>
  </div>`;}

function docParties(a1,a2,i1,i2){return`
  <div class="doc-parties-sm">
    <div><div class="doc-party-lbl">${a1}</div><div class="doc-party-nm">Jean-Pierre Mbida</div><div class="doc-party-info">${i1}</div></div>
    <div><div class="doc-party-lbl">${a2}</div><div class="doc-party-nm">Ã‰leveur Ali Hamidou</div><div class="doc-party-info">${i2}</div></div>
  </div>`;}

function docSigGrid(){return`
  <div class="doc-sig-grid">
    <div class="sig-zone">
      <div class="sig-zone-label">Signature Acheteur</div>
      <div id="sig-target" style="min-height:44px;display:flex;align-items:center;justify-content:center;">
        <span style="font-size:0.65rem;color:var(--g200);">Non signÃ©</span>
      </div>
      <div class="sig-name">Jean-Pierre Mbida</div>
    </div>
    <div class="sig-zone">
      <div class="sig-zone-label">Cachet ABAE</div>
      <div style="font-size:0.55rem;color:rgba(74,158,42,0.4);text-align:center;font-family:'Sora',sans-serif;font-weight:700;border:1px solid rgba(74,158,42,0.2);border-radius:50%;width:50px;height:50px;display:flex;align-items:center;justify-content:center;margin:0 auto;text-transform:uppercase;letter-spacing:0.5px;">ABAE<br/>2026</div>
    </div>
  </div>`;}

function docFooter(){return`<div class="doc-footer-sm">Document ABAE Â· Transactions sÃ©curisÃ©es par escrow Â· abae.africa</div>`;}

function buildBC(){return`
  ${docHd('Bon de commande','BC-2026-001547')}
  ${docParties('Acheteur','Vendeur (via ABAE)','Coop. Mvog-Atangana<br/>YaoundÃ© Â· Membre vÃ©rifiÃ© âœ“','NgaoundÃ©rÃ©, CM<br/>Vendeur vÃ©rifiÃ© âœ“<br/><span style="font-size:0.6rem;color:var(--g400);">Contact via ABAE uniquement</span>')}
  <table class="doc-tbl">
    <thead><tr><th>DÃ©signation</th><th>QtÃ©</th><th>P.U.</th><th>Total</th></tr></thead>
    <tbody>
      <tr><td>BÅ“ufs FoulbÃ© (lot)</td><td>5</td><td>60 000</td><td>300 000</td></tr>
      <tr><td>Transport NgaoundÃ©rÃ©â†’YdÃ©</td><td>1</td><td>45 000</td><td>45 000</td></tr>
    </tbody>
  </table>
  <div class="doc-totals-sm">
    <div class="doc-total-row-sm comm"><span>Sous-total</span><span>345 000 XAF</span></div>
    <div class="doc-total-row-sm comm"><span>Commission ABAE 5%</span><span>-17 250 XAF</span></div>
    <div class="doc-total-row-sm main"><span>TOTAL Ã€ PAYER</span><span>345 000 XAF</span></div>
  </div>
  <div style="background:rgba(74,158,42,0.07);border:1px solid rgba(74,158,42,0.15);border-radius:6px;padding:8px;font-size:0.65rem;color:var(--vf);margin:10px 0;">
    ğŸ”’ Escrow ABAE : 345 000 XAF bloquÃ©s. LibÃ©ration au vendeur aprÃ¨s confirmation de livraison. Commission prÃ©levÃ©e automatiquement.
  </div>
  ${docSigGrid()}
  ${docFooter()}`;}

function buildBL(){return`
  ${docHd('Bon de livraison','BL-2026-001547')}
  ${docParties('ExpÃ©diteur','Destinataire','NgaoundÃ©rÃ©, CM<br/>Vendeur vÃ©rifiÃ© âœ“','YaoundÃ©, CM<br/>Acheteur vÃ©rifiÃ© âœ“')}
  <table class="doc-tbl">
    <thead><tr><th>Article</th><th>Attendu</th><th>LivrÃ©</th><th>Ã‰tat</th></tr></thead>
    <tbody>
      <tr><td>BÅ“ufs FoulbÃ©</td><td>5</td><td>5</td><td style="color:var(--ok);font-weight:600;">âœ“ Conforme</td></tr>
      <tr><td>Transporteur</td><td colspan="2" style="font-size:0.65rem;">TransCold Sarl</td><td style="color:var(--ok);">LivrÃ©</td></tr>
    </tbody>
  </table>
  ${docSigGrid()}
  <div style="background:rgba(39,174,96,0.08);border:1px solid rgba(39,174,96,0.2);border-radius:6px;padding:8px;font-size:0.65rem;color:var(--ok);margin-top:8px;">
    âœ… La signature de l'acheteur dÃ©clenche le dÃ©blocage automatique du paiement au vendeur via ABAE.
  </div>
  ${docFooter()}`;}

function buildFAC(){return`
  ${docHd('Facture','FAC-2026-001547')}
  ${docParties('Ã‰metteur (vendeur)','FacturÃ© Ã ','NgaoundÃ©rÃ© Â· NÂ° AE-CM-4521<br/>Vendeur vÃ©rifiÃ© âœ“','YaoundÃ© Â· NÂ° AB-CM-8834<br/>Acheteur vÃ©rifiÃ© âœ“')}
  <table class="doc-tbl">
    <thead><tr><th>DÃ©signation</th><th>QtÃ©</th><th>P.U.</th><th>Total</th></tr></thead>
    <tbody><tr><td>BÅ“ufs FoulbÃ© (lot 5)</td><td>5</td><td>60 000</td><td>300 000 XAF</td></tr></tbody>
  </table>
  <div class="doc-totals-sm">
    <div class="doc-total-row-sm comm"><span>Sous-total</span><span>300 000 XAF</span></div>
    <div class="doc-total-row-sm comm"><span>Commission ABAE 5%</span><span style="color:var(--err);">-15 000 XAF</span></div>
    <div class="doc-total-row-sm main"><span>Net versÃ© vendeur</span><span>285 000 XAF</span></div>
  </div>
  ${docSigGrid()}
  ${docFooter()}`;}

function buildRECU(){return`
  ${docHd('ReÃ§u de paiement','RECU-2026-001547')}
  <div style="text-align:center;padding:16px 0;margin-bottom:10px;">
    <div style="font-size:2rem;margin-bottom:6px;">âœ…</div>
    <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:0.95rem;color:var(--ok);">Paiement confirmÃ©</div>
    <div style="font-size:0.65rem;color:var(--g400);">SÃ©curisÃ© par Escrow ABAE</div>
  </div>
  <table class="doc-tbl">
    <tbody>
      <tr><td style="color:var(--g400);">Acheteur</td><td>Jean-Pierre Mbida</td></tr>
      <tr><td style="color:var(--g400);">Produit</td><td style="font-size:0.68rem;">5 BÅ“ufs FoulbÃ© (Ali Hamidou)</td></tr>
      <tr><td style="color:var(--g400);">Montant payÃ©</td><td style="font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--vp);font-size:0.9rem;">345 000 XAF</td></tr>
      <tr><td style="color:var(--g400);">Commission ABAE</td><td style="color:var(--g400);font-size:0.68rem;">17 250 XAF (5%)</td></tr>
      <tr><td style="color:var(--g400);">Net vendeur</td><td style="font-weight:600;">285 000 XAF</td></tr>
      <tr><td style="color:var(--g400);">Mode</td><td>Portefeuille ABAE â†’ Escrow</td></tr>
      <tr><td style="color:var(--g400);">RÃ©f.</td><td style="font-family:'JetBrains Mono',monospace;font-size:0.62rem;">TXN-2026-001547</td></tr>
    </tbody>
  </table>
  ${docFooter()}`;}

function buildDEP(){return`
  ${docHd('ReÃ§u de dÃ©pÃ´t','DEP-2026-000389')}
  <div style="background:rgba(39,174,96,0.08);border:1px solid rgba(39,174,96,0.2);border-radius:8px;padding:14px;text-align:center;margin-bottom:12px;">
    <div style="font-size:0.7rem;color:var(--g400);">CrÃ©ditÃ© sur portefeuille ABAE</div>
    <div style="font-family:'JetBrains Mono',monospace;font-size:1.5rem;font-weight:700;color:var(--ok);">200 000 XAF</div>
  </div>
  <table class="doc-tbl">
    <tbody>
      <tr><td style="color:var(--g400);">Titulaire</td><td>Jean-Pierre Mbida Â· AB-CM-8834</td></tr>
      <tr><td style="color:var(--g400);">Mode</td><td>MTN Mobile Money</td></tr>
      <tr><td style="color:var(--g400);">NumÃ©ro source</td><td style="font-family:'JetBrains Mono',monospace;">+237 6â€¢â€¢ â€¢â€¢â€¢ â€¢â€¢â€¢</td></tr>
      <tr><td style="color:var(--g400);">Solde avant</td><td>0 XAF</td></tr>
      <tr><td style="color:var(--g400);">Solde aprÃ¨s</td><td style="font-family:'JetBrains Mono',monospace;color:var(--ok);font-weight:700;">200 000 XAF</td></tr>
      <tr><td style="color:var(--g400);">Statut</td><td style="color:var(--ok);font-weight:600;">âœ… ConfirmÃ©</td></tr>
    </tbody>
  </table>
  ${docFooter()}`;}

function buildDEC(){return`
  ${docHd('ReÃ§u de dÃ©caissement','DEC-2026-001547')}
  <div style="background:#EBF5FF;border:1px solid rgba(41,128,185,0.2);border-radius:8px;padding:14px;text-align:center;margin-bottom:12px;">
    <div style="font-size:0.7rem;color:var(--g400);">ReversÃ© au vendeur</div>
    <div style="font-family:'JetBrains Mono',monospace;font-size:1.5rem;font-weight:700;color:var(--info);">285 000 XAF</div>
  </div>
  <table class="doc-tbl">
    <tbody>
      <tr><td style="color:var(--g400);">BÃ©nÃ©ficiaire</td><td>Ã‰leveur Ali Hamidou Â· AE-CM-4521</td></tr>
      <tr><td style="color:var(--g400);">Commande source</td><td style="font-size:0.68rem;">BC-2026-001547</td></tr>
      <tr><td style="color:var(--g400);">Brut transaction</td><td>300 000 XAF</td></tr>
      <tr><td style="color:var(--g400);">Commission ABAE 5%</td><td style="color:var(--err);">-15 000 XAF</td></tr>
      <tr><td style="color:var(--g400);">Net dÃ©caissÃ©</td><td style="font-family:'JetBrains Mono',monospace;color:var(--info);font-weight:700;">285 000 XAF</td></tr>
      <tr><td style="color:var(--g400);">Vers</td><td>MTN MoMo Â· +237 6â€¢â€¢ â€¢â€¢â€¢ â€¢â€¢â€¢</td></tr>
      <tr><td style="color:var(--g400);">Statut</td><td style="color:var(--ok);font-weight:600;">âœ… VersÃ©</td></tr>
    </tbody>
  </table>
  ${docFooter()}`;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PDF
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doPrint(){
  const tpl=DOC_TEMPLATES[currentDocId]; if(!tpl)return;
  const pa=document.getElementById('printArea');
  pa.innerHTML=`<div style="font-family:'DM Sans',sans-serif;max-width:600px;margin:0 auto;padding:20px;font-size:13px;">
    <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;color:#4A9E2A;text-transform:uppercase;text-align:center;margin-bottom:20px;">ABAE Â· ${tpl.title}</div>
    ${tpl.content()}
    <div style="text-align:center;margin-top:20px;font-size:10px;color:#8A9388;">ABAE Marketplace Agro-Pastorale Â· abae.africa</div>
  </div>`;
  pa.style.display='block';
  const all=[...document.querySelectorAll('.phone>*:not(#printArea)')];
  all.forEach(el=>el.style.visibility='hidden');
  window.print();
  all.forEach(el=>el.style.visibility='');
  pa.style.display='none';
  pa.innerHTML='';
  showToast('ğŸ“„ PDF lancÃ© !','ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIGNATURE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sigCtx,sigDrawing=false,sigLX=0,sigLY=0;


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOST â€” SÃ©lection option boost
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _pubBoost = 'free';

function selBoost(el, type) {
  document.querySelectorAll('.boost-option').forEach(b => b.classList.remove('sel'));
  el.classList.add('sel');
  _pubBoost = type;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIFFICULTÃ‰S â€” Solutions IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DIFF_SOLUTIONS = {
  paiement: {
    icon:"ğŸ’³", title:"ProblÃ¨me de paiement",
    steps:[
      "VÃ©rifiez que votre solde Mobile Money est suffisant et que votre numÃ©ro est correct.",
      "Attendez <strong>5 minutes</strong> â€” certaines transactions sont en file dâ€™attente opÃ©rateur.",
      "Si le montant a Ã©tÃ© dÃ©bitÃ© mais non reÃ§u, lâ€™Escrow ABAE protÃ¨ge votre argent automatiquement.",
      "Consultez lâ€™historique dans <strong>Portefeuille â†’ Transactions</strong> pour voir lâ€™Ã©tat exact."
    ],
    action:"Si le problÃ¨me persiste aprÃ¨s 15 minutes, crÃ©ez un ticket ci-dessous et notre Ã©quipe vÃ©rifie manuellement."
  },
  commande: {
    icon:"ğŸ“¦", title:"Commande non livrÃ©e",
    steps:[
      "VÃ©rifiez le statut dans <strong>Mes Commandes</strong> â€” le vendeur doit mettre Ã  jour lâ€™Ã©tat.",
      "Lâ€™argent est <strong>bloquÃ© en Escrow</strong> : le vendeur ne reÃ§oit rien tant que vous nâ€™avez pas confirmÃ©.",
      "Contactez le vendeur via la messagerie ABAE pour un suivi direct.",
      "Si le dÃ©lai dÃ©passe la date convenue, ouvrez un <strong>litige</strong> pour rÃ©cupÃ©rer vos fonds."
    ],
    action:"Un litige dÃ©clenche une enquÃªte ABAE. Vos fonds en escrow sont protÃ©gÃ©s pendant toute la durÃ©e."
  },
  escrow: {
    icon:"ğŸ”’", title:"Fonds bloquÃ©s en escrow",
    steps:[
      "Les fonds escrow sont libÃ©rÃ©s <strong>automatiquement</strong> aprÃ¨s votre confirmation de rÃ©ception.",
      "Si vous avez reÃ§u la marchandise, confirmez la livraison dans <strong>Mes Commandes</strong>.",
      "En cas de litige avec lâ€™acheteur, ABAE arbitre de faÃ§on neutre.",
      "DÃ©lai maximum : <strong>30 jours</strong> sans confirmation â†’ remboursement automatique."
    ],
    action:"Notre Ã©quipe peut manuellement dÃ©bloquer les fonds aprÃ¨s vÃ©rification sous 24h."
  },
  offre: {
    icon:"ğŸ“¢", title:"Offre refusÃ©e / non visible",
    steps:[
      "Les offres avec photos floues ou informations incomplÃ¨tes sont automatiquement masquÃ©es.",
      "VÃ©rifiez que votre <strong>profil KYC est validÃ©</strong> â€” certaines catÃ©gories lâ€™exigent.",
      "Les prix manifestement anormaux (trop bas/haut) sont suspendus pour vÃ©rification.",
      "Ã‰ditez votre offre et ajoutez des <strong>photos nettes</strong> et une description dÃ©taillÃ©e."
    ],
    action:"Si votre offre est correcte et toujours invisible aprÃ¨s 2h, crÃ©ez un ticket ci-dessous."
  },
  compte: {
    icon:"ğŸ‘¤", title:"ProblÃ¨me de compte",
    steps:[
      "RÃ©initialisez votre mot de passe via <strong>Mot de passe oubliÃ©</strong> sur lâ€™Ã©cran de connexion.",
      "Pour la vÃ©rification KYC, assurez-vous que votre CNI est <strong>lisible et non expirÃ©</strong>.",
      "Si votre compte est suspendu, vous recevrez un email avec la raison.",
      "Changez de navigateur ou videz le cache si vous avez des problÃ¨mes dâ€™affichage."
    ],
    action:"Pour les problÃ¨mes dâ€™identitÃ©, notre Ã©quipe KYC rÃ©pond sous 4h ouvrÃ©es."
  },
  fraude: {
    icon:"ğŸš¨", title:"Signaler une fraude",
    steps:[
      "Ne payez <strong>jamais en dehors de la plateforme ABAE</strong> â€” les paiements externes ne sont pas protÃ©gÃ©s.",
      "Conservez toutes les preuves : screenshots, messages, numÃ©ros de transaction.",
      "Signalez lâ€™annonce via le bouton Signaler sur la fiche du produit.",
      "En cas dâ€™arnaque avÃ©rÃ©e, ABAE peut bloquer le compte fraudeur et initier un remboursement."
    ],
    action:"En cas dâ€™urgence (somme importante), contactez directement notre Ã©quipe via WhatsApp."
  }
};

function showDiffSolution(type) {
  const sol = DIFF_SOLUTIONS[type];
  if (!sol) return;
  document.getElementById('diffCatView').style.display = 'none';
  document.getElementById('diffSolView').style.display = 'block';
  document.getElementById('diffSolContent').innerHTML = `
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
      <div style="font-size:1.8rem;">${sol.icon}</div>
      <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:0.95rem;color:#111;">${sol.title}</div>
    </div>
    <div class="diff-ai-bubble">
      <div style="font-size:0.7rem;font-weight:700;color:var(--vp);text-transform:uppercase;letter-spacing:.05em;margin-bottom:10px;">ğŸ¤– Diagnostic IA ABAE</div>
      ${sol.steps.map((s,i)=>`
        <div style="display:flex;gap:10px;margin-bottom:10px;align-items:flex-start;">
          <div style="width:22px;height:22px;border-radius:50%;background:var(--vp);color:#fff;font-size:0.65rem;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;">${i+1}</div>
          <div style="font-size:0.82rem;line-height:1.55;">${s}</div>
        </div>`).join('')}
    </div>
    <div style="background:#FFF8F0;border:1px solid #FDDBA1;border-radius:12px;padding:12px;font-size:0.78rem;color:#7A5000;line-height:1.55;">
      ğŸ’¡ ${sol.action}
    </div>
  `;
  const sb = document.querySelector('#diffSheet .sheet-body');
  if (sb) sb.scrollTop = 0;
}

// â”€â”€ Mise Ã  jour stats Gains profil â”€â”€
function updateGainsStats() {
  const offers = window.ABAE_MY_OFFERS || [];
  const el = document.getElementById('gainsOffresVal');
  if (el) el.textContent = offers.filter(o=>o.status==='active').length;
}

function initSig(){
  const c=document.getElementById('sigCanvas'); if(!c)return;
  // Attendre que le canvas soit visible pour avoir les bonnes dimensions
  const doInit = () => {
    const wrap = c.parentElement;
    let w = wrap ? wrap.clientWidth : 0;
    if(w < 10) w = window.innerWidth - 48; // fallback largeur Ã©cran moins padding
    const dpr = window.devicePixelRatio || 1;
    const h = 180;
    c.width = w * dpr;
    c.height = h * dpr;
    c.style.width = w + 'px';
    c.style.height = h + 'px';
    sigCtx = c.getContext('2d');
    sigCtx.scale(dpr, dpr);
    sigCtx.strokeStyle = '#2A5E10';
    sigCtx.lineWidth = 2.5;
    sigCtx.lineCap = 'round';
    sigCtx.lineJoin = 'round';
    sigCtx.fillStyle = '#F8F9F8';
    sigCtx.fillRect(0, 0, w, h);
    // Ligne guide pointillÃ©e
    sigCtx.save();
    sigCtx.setLineDash([4,6]);
    sigCtx.strokeStyle='#C8D5C8';
    sigCtx.lineWidth=1;
    sigCtx.beginPath();
    sigCtx.moveTo(20, h*0.65);
    sigCtx.lineTo(w-20, h*0.65);
    sigCtx.stroke();
    sigCtx.restore();
    sigCtx.strokeStyle = '#2A5E10';
    sigCtx.lineWidth = 2.5;

    const getPos = (e, isTouch) => {
      const r = c.getBoundingClientRect();
      const src = isTouch ? e.touches[0] : e;
      return { x: src.clientX - r.left, y: src.clientY - r.top };
    };
    c.ontouchstart = e => { e.preventDefault(); e.stopPropagation(); const p=getPos(e,true); sigDrawing=true; sigLX=p.x; sigLY=p.y; };
    c.ontouchmove  = e => { e.preventDefault(); e.stopPropagation(); if(!sigDrawing)return; const p=getPos(e,true); sigCtx.beginPath(); sigCtx.moveTo(sigLX,sigLY); sigCtx.lineTo(p.x,p.y); sigCtx.stroke(); sigLX=p.x; sigLY=p.y; };
    c.ontouchend   = e => { e.preventDefault(); sigDrawing=false; };
    c.onmousedown  = e => { const p=getPos(e,false); sigDrawing=true; sigLX=p.x; sigLY=p.y; };
    c.onmousemove  = e => { if(!sigDrawing)return; const p=getPos(e,false); sigCtx.beginPath(); sigCtx.moveTo(sigLX,sigLY); sigCtx.lineTo(p.x,p.y); sigCtx.stroke(); sigLX=p.x; sigLY=p.y; };
    c.onmouseup = c.onmouseleave = () => sigDrawing=false;
  };
  // Lancer immÃ©diatement + retry si dimensions nulles
  doInit();
  if(c.width < 10) setTimeout(doInit, 100);
}

function clearSig(){
  const c=document.getElementById('sigCanvas'); if(!sigCtx)return;
  sigCtx.fillStyle='#F2F4F2';sigCtx.fillRect(0,0,c.width/devicePixelRatio,150);
}

function applySig(){
  const c=document.getElementById('sigCanvas'); if(!c)return;
  const img=c.toDataURL('image/png');
  const t=document.getElementById('sig-target');
  if(t) t.innerHTML=`<img class="sig-img" src="${img}" alt="Signature"/>`;
  closeSheet('signSheet');
  showToast('âœï¸ Document signÃ© !','ok');
}

document.getElementById('signSheet').addEventListener('transitionend',function(e){
  if(this.classList.contains('open')) initSig();
});

// Aussi dÃ©clencher initSig quand la sheet s'ouvre via openSheet
const _origOpenSheet = window.openSheet;
window.openSheet = function(id) {
  if(typeof _origOpenSheet === 'function') _origOpenSheet(id);
  if(id === 'signSheet') setTimeout(initSig, 80);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WALLET â€” Solde central + transactions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let walletBalance = 125000;
let walletEscrow  = 45000;

const TRANSACTIONS = [
  { id:'TXN-001', type:'escrow', icon:'ğŸ’¸', name:'Commande BC-001547', date:'28 fÃ©v.', sub:'Escrow bloquÃ©', amount:-345000, comm:-17250 },
  { id:'TXN-002', type:'in',     icon:'ğŸ“±', name:'DÃ©pÃ´t MTN MoMo',     date:'20 fÃ©v.', sub:'ConfirmÃ©',     amount:+200000, comm:0 },
  { id:'TXN-003', type:'in',     icon:'ğŸ’¼', name:'Versement BC-001289', date:'16 fÃ©v.', sub:'LibÃ©rÃ© par ABAE', amount:+285000, comm:-15000 },
  { id:'TXN-004', type:'out',    icon:'ğŸ¦', name:'Retrait vers MTN MoMo', date:'14 fÃ©v.', sub:'VersÃ©',      amount:-100000, comm:0 },
  { id:'TXN-005', type:'in',     icon:'ğŸ“±', name:'DÃ©pÃ´t Orange Money',  date:'10 fÃ©v.', sub:'ConfirmÃ©',     amount:+85000,  comm:0 },
  { id:'TXN-006', type:'escrow', icon:'ğŸ’¸', name:'Commande BC-001289',  date:'08 fÃ©v.', sub:'Escrow libÃ©rÃ©', amount:+300000, comm:-15000 },
];

function formatXAF(n) {
  return (n >= 0 ? '+' : '') + n.toLocaleString('fr-FR') + ' XAF';
}
function formatXAFabs(n) {
  return Math.abs(n).toLocaleString('fr-FR') + ' XAF';
}

function updateWalletUI() {
  // Solde dans le hero du portefeuille
  const balEl = document.querySelector('.wallet-balance');
  if (balEl) balEl.textContent = walletBalance.toLocaleString('fr-FR') + ' XAF';
  // Solde dans le header du relevÃ©
  const relBal = document.getElementById('releveBalanceHeader');
  if (relBal) relBal.textContent = walletBalance.toLocaleString('fr-FR') + ' XAF';
  // Solde disponible dans sheet retrait
  const withBal = document.getElementById('withAvailableBalance');
  if (withBal) withBal.textContent = walletBalance.toLocaleString('fr-FR') + ' XAF';
  // Pill wallet dans le hero marchÃ©
  const pillEl = document.querySelector('.wallet-pill span');
  if (pillEl) pillEl.textContent = walletBalance.toLocaleString('fr-FR') + ' XAF';
  // Profil â†’ portefeuille
  const profWal = document.querySelector('[data-wallet-display]');
  if (profWal) profWal.textContent = 'Solde : ' + walletBalance.toLocaleString('fr-FR') + ' XAF';
}

function addTransaction(tx) {
  TRANSACTIONS.unshift(tx);
  // Reconstruire la liste affichÃ©e dans l'Ã©cran portefeuille
  rebuildTxList();
}

function rebuildTxList() {
  // Mise Ã  jour du conteneur de transactions dans screen-portefeuille
  const container = document.querySelector('#screen-portefeuille .tx-item')?.parentElement;
  if (!container) return;
  const items = container.querySelectorAll('.tx-item');
  // Reconstruire uniquement les 5 premiÃ¨res
  // (on ne reconstruira que les 2 premiÃ¨res nouvelles en tÃªte)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÃ‰PÃ”T â€” logique complÃ¨te
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let depMethod = 'MTN Mobile Money';
let depMethodEmoji = 'ğŸ“±';

function selDepMethod(el, name, emoji) {
  document.querySelectorAll('#depositSheet .pay-method').forEach(m => m.classList.remove('sel'));
  el.classList.add('sel');
  depMethod = name;
  depMethodEmoji = emoji;
  const phoneRow = document.getElementById('depPhoneRow');
  if (phoneRow) phoneRow.style.display = name === 'Virement bancaire' ? 'none' : 'block';
  checkDepStep1();
}

function checkDepStep1() {
  const amt   = parseInt(document.getElementById('depAmount')?.value) || 0;
  const phone = document.getElementById('depPhone')?.value?.trim() || '';
  const err   = document.getElementById('depAmountErr');
  const isBanking = depMethod === 'Virement bancaire';

  if (amt > 0 && amt < 1000) {
    if (err) { err.style.display = 'block'; err.textContent = 'Montant minimum : 1 000 XAF'; }
  } else {
    if (err) err.style.display = 'none';
  }
  const valid = amt >= 1000 && (isBanking || phone.length >= 8);
  const btn = document.getElementById('depBtn1');
  if (btn) btn.disabled = !valid;
}

function goDepStep2() {
  const amt   = parseInt(document.getElementById('depAmount').value);
  const phone = document.getElementById('depPhone')?.value?.trim() || 'RIB bancaire';
  document.getElementById('depSummMethod').textContent = depMethodEmoji + ' ' + depMethod;
  document.getElementById('depSummPhone').textContent  = depMethod === 'Virement bancaire' ? 'RIB fourni' : phone;
  document.getElementById('depSummAmount').textContent = amt.toLocaleString('fr-FR') + ' XAF';
  document.getElementById('dep-step1').style.display = 'none';
  document.getElementById('dep-step2').style.display = 'block';
}
function goDepStep1() {
  document.getElementById('dep-step1').style.display = 'block';
  document.getElementById('dep-step2').style.display = 'none';
}

function confirmDeposit() {
  const btn = document.getElementById('depBtn2');
  btn.disabled = true;
  btn.textContent = 'â³ Traitement en coursâ€¦';

  setTimeout(() => {
    const amt   = parseInt(document.getElementById('depAmount').value);
    const phone = document.getElementById('depPhone')?.value?.trim() || 'RIB bancaire';

    // Mettre Ã  jour le solde
    walletBalance += amt;
    updateWalletUI();

    // Ajouter la transaction
    const now = new Date();
    const dateStr = now.getDate() + ' ' + ['jan.','fÃ©v.','mar.','avr.','mai','juin','juil.','aoÃ»t','sep.','oct.','nov.','dÃ©c.'][now.getMonth()];
    addTransaction({
      id: 'TXN-' + Date.now(),
      type: 'in',
      icon: depMethodEmoji,
      name: 'DÃ©pÃ´t ' + depMethod,
      date: dateStr,
      sub: 'ConfirmÃ©',
      amount: +amt,
      comm: 0
    });

    // Afficher succÃ¨s
    document.getElementById('depSuccessMsg').textContent =
      amt.toLocaleString('fr-FR') + ' XAF crÃ©ditÃ©s via ' + depMethod + ' (' + phone + ')';
    document.getElementById('depNewBalance').textContent =
      walletBalance.toLocaleString('fr-FR') + ' XAF';

    document.getElementById('dep-step2').style.display = 'none';
    document.getElementById('dep-step3').style.display = 'block';
    showToast('ğŸ’° DÃ©pÃ´t de ' + amt.toLocaleString('fr-FR') + ' XAF confirmÃ© !', 'ok');

    // â”€â”€ GÃ©nÃ©ration automatique du reÃ§u PDF â”€â”€
    const now2 = new Date();
    generateReceiptPDF('depot', {
      txnId:      'TXN-' + Date.now(),
      dateTime:   now2.toLocaleDateString('fr-FR') + ' Ã  ' + now2.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'}),
      amount:     amt,
      method:     depMethodEmoji + ' ' + depMethod,
      phone:      (depMethod === 'Virement bancaire') ? 'RIB fourni' : phone,
      newBalance: walletBalance
    });

    // RÃ©initialiser pour la prochaine ouverture
    btn.disabled = false;
    btn.textContent = 'âœ… Confirmer le dÃ©pÃ´t';
  }, 1800);
}

function resetDepositSheet() {
  document.getElementById('dep-step1').style.display = 'block';
  document.getElementById('dep-step2').style.display = 'none';
  document.getElementById('dep-step3').style.display = 'none';
  const amtEl = document.getElementById('depAmount');
  const phEl  = document.getElementById('depPhone');
  if (amtEl) amtEl.value = '';
  if (phEl)  phEl.value  = '';
  document.getElementById('depBtn1').disabled = true;
  document.querySelectorAll('#depositSheet .pay-method').forEach((m,i) => {
    m.classList.toggle('sel', i === 0);
  });
  depMethod = 'MTN Mobile Money'; depMethodEmoji = 'ğŸ“±';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RETRAIT â€” logique complÃ¨te
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let withMethod = 'MTN Mobile Money';
let withMethodEmoji = 'ğŸ“±';

function selWithMethod(el, name, emoji) {
  document.querySelectorAll('#withdrawSheet .pay-method').forEach(m => m.classList.remove('sel'));
  el.classList.add('sel');
  withMethod = name;
  withMethodEmoji = emoji;
  checkWithStep1();
}

function checkWithStep1() {
  const amt   = parseInt(document.getElementById('withAmount')?.value) || 0;
  const phone = document.getElementById('withPhone')?.value?.trim()   || '';
  const err   = document.getElementById('withAmountErr');
  let valid = true;

  if (amt > 0 && amt < 1000) {
    if (err) { err.style.display='block'; err.textContent='Montant minimum : 1 000 XAF'; }
    valid = false;
  } else if (amt > walletBalance) {
    if (err) { err.style.display='block'; err.textContent='Solde insuffisant (max : ' + walletBalance.toLocaleString('fr-FR') + ' XAF)'; }
    valid = false;
  } else {
    if (err) err.style.display = 'none';
  }
  const btn = document.getElementById('withBtn1');
  if (btn) btn.disabled = !(valid && amt >= 1000 && phone.length >= 8);
}

function goWithStep2() {
  const amt   = parseInt(document.getElementById('withAmount').value);
  const phone = document.getElementById('withPhone').value.trim();
  document.getElementById('withSummMethod').textContent = withMethodEmoji + ' ' + withMethod;
  document.getElementById('withSummPhone').textContent  = phone;
  document.getElementById('withSummAmount').textContent = '-' + amt.toLocaleString('fr-FR') + ' XAF';
  document.getElementById('withSummAfter').textContent  = (walletBalance - amt).toLocaleString('fr-FR') + ' XAF';
  const pinEl = document.getElementById('withPin');
  if (pinEl) pinEl.value = '';
  document.getElementById('withBtn2').disabled = true;
  document.getElementById('withPinErr').style.display = 'none';
  document.getElementById('with-step1').style.display = 'none';
  document.getElementById('with-step2').style.display = 'block';
}
function goWithStep1() {
  document.getElementById('with-step1').style.display = 'block';
  document.getElementById('with-step2').style.display = 'none';
}

function checkWithPin() {
  const pin = document.getElementById('withPin')?.value || '';
  const btn = document.getElementById('withBtn2');
  if (btn) btn.disabled = (pin.length < 4);
}

function confirmWithdraw() {
  const pin = document.getElementById('withPin')?.value || '';
  const btn = document.getElementById('withBtn2');
  const errEl = document.getElementById('withPinErr');

  // VÃ©rification PIN (dÃ©mo : 1234)
  if (pin !== '1234') {
    errEl.style.display = 'block';
    document.getElementById('withPin').value = '';
    btn.disabled = true;
    return;
  }
  errEl.style.display = 'none';
  btn.disabled = true;
  btn.textContent = 'â³ Traitement en coursâ€¦';

  setTimeout(() => {
    const amt   = parseInt(document.getElementById('withAmount').value);
    const phone = document.getElementById('withPhone').value.trim();

    walletBalance -= amt;
    updateWalletUI();

    const now = new Date();
    const dateStr = now.getDate() + ' ' + ['jan.','fÃ©v.','mar.','avr.','mai','juin','juil.','aoÃ»t','sep.','oct.','nov.','dÃ©c.'][now.getMonth()];
    addTransaction({
      id: 'TXN-' + Date.now(),
      type: 'out',
      icon: withMethodEmoji,
      name: 'Retrait vers ' + withMethod,
      date: dateStr,
      sub: 'VersÃ©',
      amount: -amt,
      comm: 0
    });

    document.getElementById('withSuccessMsg').textContent =
      amt.toLocaleString('fr-FR') + ' XAF envoyÃ©s vers ' + withMethod + ' (' + phone + ')';
    document.getElementById('withNewBalance').textContent =
      walletBalance.toLocaleString('fr-FR') + ' XAF';

    document.getElementById('with-step2').style.display = 'none';
    document.getElementById('with-step3').style.display = 'block';
    showToast('âœ… Retrait de ' + amt.toLocaleString('fr-FR') + ' XAF validÃ© !', 'ok');

    // â”€â”€ GÃ©nÃ©ration automatique du reÃ§u PDF â”€â”€
    const now3 = new Date();
    generateReceiptPDF('retrait', {
      txnId:      'TXN-' + Date.now(),
      dateTime:   now3.toLocaleDateString('fr-FR') + ' Ã  ' + now3.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'}),
      amount:     amt,
      method:     withMethodEmoji + ' ' + withMethod,
      phone:      phone,
      newBalance: walletBalance
    });

    btn.disabled = false;
    btn.textContent = 'âœ… Valider le retrait';
  }, 1800);
}

function resetWithdrawSheet() {
  document.getElementById('with-step1').style.display = 'block';
  document.getElementById('with-step2').style.display = 'none';
  document.getElementById('with-step3').style.display = 'none';
  const amtEl = document.getElementById('withAmount');
  const phEl  = document.getElementById('withPhone');
  if (amtEl) amtEl.value = '';
  if (phEl)  phEl.value  = '';
  document.getElementById('withBtn1').disabled = true;
  document.querySelectorAll('#withdrawSheet .pay-method').forEach((m,i) => m.classList.toggle('sel', i===0));
  withMethod = 'MTN Mobile Money'; withMethodEmoji = 'ğŸ“±';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RELEVÃ‰ â€” Historique filtrable
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let releveFilter = 'all';

function buildReleveItem(tx) {
  const isOut = tx.amount < 0;
  const colorClass = isOut ? 'var(--err)' : 'var(--ok)';
  const sign = isOut ? '' : '+';
  return `
    <div style="background:var(--w);border-radius:10px;padding:12px 14px;display:flex;align-items:center;gap:12px;border:1px solid var(--g100);">
      <div style="width:40px;height:40px;border-radius:10px;background:${isOut?'rgba(192,57,43,0.08)':'rgba(33,145,80,0.08)'};display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;">${tx.icon}</div>
      <div style="flex:1;min-width:0;">
        <div style="font-size:0.82rem;font-weight:600;color:var(--g900);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${tx.name}</div>
        <div style="font-size:0.68rem;color:var(--g400);">${tx.date} Â· ${tx.sub}</div>
        ${tx.comm ? `<div style="font-size:0.62rem;color:var(--g400);">Commission ABAE : ${tx.comm.toLocaleString('fr-FR')} XAF</div>` : ''}
      </div>
      <div style="text-align:right;flex-shrink:0;">
        <div style="font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.88rem;color:${colorClass};">${sign}${Math.abs(tx.amount).toLocaleString('fr-FR')}</div>
      </div>
    </div>`;
}

function filtrerReleve(filter, btn) {
  releveFilter = filter;
  document.querySelectorAll('#txSheet .chip').forEach(c => c.classList.remove('active'));
  if (btn) btn.classList.add('active');
  renderReleve();
}

function renderReleve() {
  const list = document.getElementById('releveList');
  if (!list) return;
  let filtered = TRANSACTIONS;
  if (releveFilter === 'in')     filtered = TRANSACTIONS.filter(t => t.amount > 0 && t.type !== 'escrow');
  if (releveFilter === 'out')    filtered = TRANSACTIONS.filter(t => t.amount < 0 && t.type !== 'escrow');
  if (releveFilter === 'escrow') filtered = TRANSACTIONS.filter(t => t.type === 'escrow');
  list.innerHTML = filtered.length
    ? filtered.map(buildReleveItem).join('')
    : '<div style="text-align:center;padding:30px;color:var(--g400);font-size:0.82rem;">Aucune transaction</div>';

  // Totaux
  const totalIn  = TRANSACTIONS.filter(t=>t.amount>0).reduce((s,t)=>s+t.amount,0);
  const totalOut = TRANSACTIONS.filter(t=>t.amount<0).reduce((s,t)=>s+t.amount,0);
  const inEl  = document.getElementById('releveTotal-in');
  const outEl = document.getElementById('releveTotal-out');
  if (inEl)  inEl.textContent  = '+' + totalIn.toLocaleString('fr-FR');
  if (outEl) outEl.textContent = totalOut.toLocaleString('fr-FR');
}

function exportReleve() {
  const pa = document.getElementById('printArea') || document.createElement('div');
  pa.id = 'printArea';
  document.body.appendChild(pa);
  pa.innerHTML = `
    <div style="font-family:'DM Sans',sans-serif;max-width:600px;margin:0 auto;padding:20px;font-size:13px;">
      <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;color:#4A9E2A;text-align:center;margin-bottom:8px;">ABAE Â· RELEVÃ‰ DE COMPTE</div>
      <div style="text-align:center;font-size:0.8rem;color:#8A9388;margin-bottom:20px;">AB-CM-8834 Â· Jean-Pierre Mbida Â· ${new Date().toLocaleDateString('fr-FR')}</div>
      <table style="width:100%;border-collapse:collapse;font-size:12px;">
        <thead><tr style="background:#EDF7E5;">
          <th style="padding:8px;text-align:left;border-bottom:2px solid #4A9E2A;">Date</th>
          <th style="padding:8px;text-align:left;border-bottom:2px solid #4A9E2A;">OpÃ©ration</th>
          <th style="padding:8px;text-align:right;border-bottom:2px solid #4A9E2A;">Montant (XAF)</th>
        </tr></thead>
        <tbody>
          ${TRANSACTIONS.map(t=>`<tr><td style="padding:7px 8px;border-bottom:1px solid #EFF1EF;">${t.date}</td><td style="padding:7px 8px;border-bottom:1px solid #EFF1EF;">${t.name} Â· ${t.sub}</td><td style="padding:7px 8px;border-bottom:1px solid #EFF1EF;text-align:right;color:${t.amount<0?'#C0392B':'#219150'};font-weight:600;">${t.amount>0?'+':''}${t.amount.toLocaleString('fr-FR')}</td></tr>`).join('')}
        </tbody>
        <tfoot><tr style="background:#F8FAF8;">
          <td colspan="2" style="padding:10px 8px;font-weight:700;font-family:'Sora',sans-serif;">SOLDE ACTUEL</td>
          <td style="padding:10px 8px;text-align:right;font-weight:700;font-family:'Sora',sans-serif;color:#4A9E2A;">${walletBalance.toLocaleString('fr-FR')} XAF</td>
        </tr></tfoot>
      </table>
      <div style="text-align:center;margin-top:16px;font-size:10px;color:#8A9388;">ABAE Marketplace Agro-Pastorale Â· abae.africa</div>
    </div>`;
  pa.style.display = 'block';
  const allEls = [...document.querySelectorAll('.phone>*:not(#printArea),.sheet-overlay,.sheet')];
  allEls.forEach(el=>el.style.visibility='hidden');
  window.print();
  allEls.forEach(el=>el.style.visibility='');
  pa.style.display = 'none';
  showToast('ğŸ“„ RelevÃ© PDF gÃ©nÃ©rÃ© !', 'ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GÃ‰NÃ‰RATION PDF REÃ‡U â€” DÃ©pÃ´t / Retrait
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateReceiptPDF(type, data) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'mm', format: 'a5', orientation: 'portrait' });

  const isDeposit = type === 'depot';
  const green     = [26, 122, 74];
  const darkGreen = [13, 74, 43];
  const lightGreen= [232, 245, 238];
  const grey      = [61, 69, 80];
  const lightGrey = [234, 236, 239];

  const pageW = doc.internal.pageSize.getWidth();   // 148mm
  const pageH = doc.internal.pageSize.getHeight();  // 210mm

  /* â”€â”€ Fond entÃªte â”€â”€ */
  doc.setFillColor(...green);
  doc.roundedRect(0, 0, pageW, 48, 0, 0, 'F');

  /* â”€â”€ Logo / titre â”€â”€ */
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(20);
  doc.setTextColor(255, 255, 255);
  doc.text('ABAE', pageW / 2, 18, { align: 'center' });

  doc.setFontSize(8);
  doc.setFont('helvetica', 'normal');
  doc.setTextColor(200, 230, 210);
  doc.text('Marketplace Agro-Pastorale Intelligente Â· abae.africa', pageW / 2, 24, { align: 'center' });

  /* â”€â”€ Badge opÃ©ration â”€â”€ */
  const badgeLabel = isDeposit ? 'ğŸ’°  REÃ‡U DE DÃ‰PÃ”T' : 'ğŸ“¤  REÃ‡U DE RETRAIT';
  doc.setFillColor(...lightGreen);
  doc.roundedRect(pageW / 2 - 32, 30, 64, 12, 3, 3, 'F');
  doc.setFontSize(9);
  doc.setFont('helvetica', 'bold');
  doc.setTextColor(...green);
  doc.text(isDeposit ? 'RECU DE DEPOT' : 'RECU DE RETRAIT', pageW / 2, 38, { align: 'center' });

  /* â”€â”€ RÃ©fÃ©rence â”€â”€ */
  doc.setFontSize(7);
  doc.setFont('helvetica', 'normal');
  doc.setTextColor(...grey);
  doc.text('RÃ©f. : ' + data.txnId, pageW / 2, 53, { align: 'center' });
  doc.text('Ã‰mis le : ' + data.dateTime, pageW / 2, 58, { align: 'center' });

  /* â”€â”€ Montant principal â”€â”€ */
  doc.setFillColor(...lightGreen);
  doc.roundedRect(12, 63, pageW - 24, 26, 4, 4, 'F');
  doc.setFontSize(9);
  doc.setTextColor(...grey);
  doc.setFont('helvetica', 'normal');
  doc.text('Montant', pageW / 2, 72, { align: 'center' });
  doc.setFontSize(18);
  doc.setFont('helvetica', 'bold');
  doc.setTextColor(...darkGreen);
  const sign = isDeposit ? '+' : '-';
  doc.text(sign + data.amount.toLocaleString('fr-FR') + ' XAF', pageW / 2, 84, { align: 'center' });

  /* â”€â”€ Tableau dÃ©tails â”€â”€ */
  const rows = [
    ['Titulaire',   'Jean-Pierre Mbida'],
    ['NÂ° Compte',   'AB-CM-8834'],
    ['MÃ©thode',     data.method],
    isDeposit ? ['ExpÃ©diteur', data.phone] : ['Destinataire', data.phone],
    ['Statut',      'âœ” ConfirmÃ©'],
    ['Solde aprÃ¨s', data.newBalance.toLocaleString('fr-FR') + ' XAF'],
  ];

  let y = 98;
  const colX1 = 14, colX2 = pageW / 2 + 4;
  const rowH  = 10;

  rows.forEach((row, i) => {
    if (i % 2 === 0) {
      doc.setFillColor(247, 248, 249);
      doc.rect(12, y - 5, pageW - 24, rowH, 'F');
    }
    doc.setFontSize(8);
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(155, 163, 174);
    doc.text(row[0], colX1, y);
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(...grey);
    doc.text(row[1], colX2, y);
    // SÃ©parateur lÃ©ger
    doc.setDrawColor(...lightGrey);
    doc.setLineWidth(0.2);
    doc.line(12, y + 4, pageW - 12, y + 4);
    y += rowH;
  });

  /* â”€â”€ Message â”€â”€ */
  y += 6;
  doc.setFillColor(...lightGreen);
  doc.roundedRect(12, y, pageW - 24, 18, 3, 3, 'F');
  doc.setFontSize(7.5);
  doc.setFont('helvetica', 'normal');
  doc.setTextColor(...darkGreen);
  const msg = isDeposit
    ? 'Votre compte a Ã©tÃ© crÃ©ditÃ© avec succÃ¨s.\nConservez ce reÃ§u comme preuve de transaction.'
    : 'Votre retrait a Ã©tÃ© traitÃ© avec succÃ¨s.\nConservez ce reÃ§u comme preuve de transaction.';
  doc.text(msg, pageW / 2, y + 7, { align: 'center', lineHeightFactor: 1.6 });

  /* â”€â”€ Pied de page â”€â”€ */
  doc.setFillColor(...green);
  doc.rect(0, pageH - 14, pageW, 14, 'F');
  doc.setFontSize(6.5);
  doc.setFont('helvetica', 'normal');
  doc.setTextColor(200, 230, 210);
  doc.text('ABAE Marketplace Â· Cameroun Â· support@abae.africa', pageW / 2, pageH - 7, { align: 'center' });
  doc.text('Document gÃ©nÃ©rÃ© automatiquement â€” non modifiable', pageW / 2, pageH - 3, { align: 'center' });

  /* â”€â”€ TÃ©lÃ©chargement â”€â”€ */
  const filename = (isDeposit ? 'Recu_Depot_' : 'Recu_Retrait_') + data.txnId + '.pdf';
  doc.save(filename);
  showToast('ğŸ“„ ReÃ§u PDF tÃ©lÃ©chargÃ© !', 'ok');
}

// wallet init : appelÃ© par openSheet original via walletSheetInit()
function walletSheetInit(id) {
  if (id === 'txSheet') {
    releveFilter = 'all';
    document.querySelectorAll('#txSheet .chip').forEach((c,i)=>c.classList.toggle('active',i===0));
    renderReleve();
    const rBal = document.getElementById('releveBalanceHeader');
    const rEsc = document.getElementById('releveEscrow');
    if (rBal) rBal.textContent = walletBalance.toLocaleString('fr-FR') + ' XAF';
    if (rEsc) rEsc.textContent = walletEscrow.toLocaleString('fr-FR') + ' XAF';
  }
  if (id === 'depositSheet') resetDepositSheet();
  if (id === 'withdrawSheet') {
    resetWithdrawSheet();
    const wb = document.getElementById('withAvailableBalance');
    if (wb) wb.textContent = walletBalance.toLocaleString('fr-FR') + ' XAF';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WALLET SHEETS (legacy selPay)
function selPay(el){
  el.closest('.sheet-body')?.querySelectorAll('.pay-method').forEach(m=>m.classList.remove('sel'));
  el.classList.add('sel');
}

// TOAST â€” utilise la fonction showToast globale du fichier principal
// Wrapper compatible (msg, type) â†’ showToast File2 scope
(function(){
  const _origToast = typeof showToast === 'function' ? showToast : null;
  window._showToastMarche = function(msg, type) {
    const t = document.getElementById('toast-marche');
    if (!t) { if (_origToast) _origToast(msg); return; }
    t.textContent = msg;
    t.className = 'toast-marche show' + (type ? ' ' + type : '');
    clearTimeout(window._toastMarcheT);
    window._toastMarcheT = setTimeout(() => t.classList.remove('show'), 2600);
  };
})();
function showToast(msg, type) { window._showToastMarche(msg, type); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  showSkeletons();
  setTimeout(()=>renderCards(PRODUCTS),500);

  // CSS keyframe
  const st=document.createElement('style');
  st.textContent='@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}';
  document.head.appendChild(st);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYSTÃˆME RÃ”LES â€” Vendre / Acheter automatique
// RÃ¨gle : producteur | transporteur | partenaire â†’ peut vendre ET acheter
//          acheteur â†’ peut acheter SEULEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// RÃ´les autorisÃ©s Ã  vendre
const SELLER_ROLES = ['producteur', 'vendeur', 'transporteur', 'partenaire'];

// Stock des offres de l'utilisateur courant
window.ABAE_USER_ROLE   = 'acheteur'; // par dÃ©faut
window.ABAE_USER_NAME   = 'Jean-Pierre';
window.ABAE_MY_OFFERS   = [
  { id: 101, name:'Plantains mÃ»rs â€” caisse 40kg', price:12000, priceLabel:'12 000 XAF/caisse', cat:'agricole', loc:'YaoundÃ©, CM', rating:4.5, reviews:8, verified:true, status:'active',
    img:'https://images.unsplash.com/photo-1603049378106-cfa5f7c2cca7?w=500&q=75', imgs:['https://images.unsplash.com/photo-1603049378106-cfa5f7c2cca7?w=500&q=75'],
    seller:'Moi', desc:'Plantains bien mÃ»rs, caisse 40kg. IdÃ©al transformation.', isMine:true },
  { id: 102, name:'Transport bÃ©tail NgaoundÃ©rÃ©â†’YaoundÃ©', price:75000, priceLabel:'75 000 XAF/voyage', cat:'transport', loc:'NgaoundÃ©rÃ©, CM', rating:4.2, reviews:3, verified:true, status:'active',
    img:'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=500&q=75', imgs:['https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=500&q=75'],
    seller:'Moi', desc:'Transport de bÃ©tail sÃ©curisÃ©.', isMine:true },
  { id: 103, name:'Ignames fraÃ®ches â€” sac 50kg', price:8500, priceLabel:'8 500 XAF/sac', cat:'agricole', loc:'Bafoussam, CM', rating:4.6, reviews:12, verified:true, status:'paused',
    img:'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=500&q=75', imgs:['https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=500&q=75'],
    seller:'Moi', desc:'Ignames de qualitÃ©, plaine de Bamboutos.', isMine:true },
];

// VÃ©rifier si le rÃ´le peut vendre
function canSell(role) {
  if (!role) return false;
  const r = role.toLowerCase().trim();
  return SELLER_ROLES.some(sr => r.includes(sr));
}

// VÃ©rifier si le rÃ´le est purement acheteur
function isBuyerOnly(role) {
  if (!role) return true;
  const r = role.toLowerCase().trim();
  if (r === 'affilie') return false; // affiliÃ© a son propre dashboard
  return r === 'acheteur' || r === 'buyer';
}

// Mettre Ã  jour l'UI en fonction du rÃ´le
function applyRoleUI(role) {
  window.ABAE_USER_ROLE = role || 'acheteur';
  const r = (role || 'acheteur').toLowerCase().trim();

  // â”€â”€â”€ Cas spÃ©cial affiliÃ© : redirige vers son tableau de bord â”€â”€â”€â”€â”€
  if (r === 'affilie') {
    // Masquer tout le marchÃ© et rediriger
    const sellerBanner = document.getElementById('heroSellerBanner');
    const buyerBanner  = document.getElementById('heroBuyerBanner');
    const stats        = document.getElementById('heroSellerStats');
    const offreSection = document.getElementById('mesOffresSection');
    const demandeSection = document.getElementById('mesDemandesSection');
    if (sellerBanner) sellerBanner.style.display = 'none';
    if (buyerBanner)  buyerBanner.style.display  = 'none';
    if (stats)        stats.style.display         = 'none';
    if (offreSection) offreSection.style.display  = 'none';
    if (demandeSection) demandeSection.style.display = 'none';
    // Afficher un bandeau dÃ©diÃ© affiliÃ©
    const banner = document.getElementById('roleContextBanner');
    if (banner) {
      banner.style.cssText = 'margin:0 12px 8px;padding:12px 16px;border-radius:12px;font-size:0.8rem;font-weight:700;display:flex;align-items:center;gap:10px;background:linear-gradient(135deg,rgba(155,27,106,0.12),rgba(74,14,107,0.08));border:1.5px solid rgba(155,27,106,0.3);color:#4A0E6B;cursor:pointer;';
      banner.onclick = function(){ showView('dashboard-affilie'); };
      banner.innerHTML = '<span style="font-size:1.3rem;flex-shrink:0;">ğŸ”—</span><div style="flex:1;line-height:1.4;">Espace AffiliÃ© â€” <span style="font-weight:500;opacity:0.85;">Vous avez un espace dÃ©diÃ© pour suivre vos commissions</span></div><span style="font-size:0.75rem;background:rgba(155,27,106,0.15);padding:4px 10px;border-radius:20px;white-space:nowrap;">AccÃ©der â†’</span>';
    }
    filterCards();
    return;
  }

  const seller = canSell(role);
  const buyerOnly = isBuyerOnly(role);

  // â”€â”€â”€ Hero seller banner & stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const sellerBanner = document.getElementById('heroSellerBanner');
  const buyerBanner  = document.getElementById('heroBuyerBanner');
  const stats        = document.getElementById('heroSellerStats');

  if (sellerBanner) sellerBanner.style.display = seller ? 'flex' : 'none';
  if (buyerBanner)  buyerBanner.style.display  = buyerOnly ? 'flex' : 'none';
  if (stats)        stats.style.display         = seller ? 'grid' : 'none';

  // BanniÃ¨re vendeur personnalisÃ©e selon rÃ´le
  if (seller && sellerBanner) {
    const roleLabels = {
      producteur:'Vendeur', vendeur:'Vendeur', transporteur:'Transporteur', partenaire:'Partenaire'
    };
    const r = Object.keys(roleLabels).find(k => role.toLowerCase().includes(k)) || 'vendeur';
    const bannerTitle = document.getElementById('heroSellerBannerTitle');
    const bannerSub   = document.getElementById('heroSellerBannerSub');
    if (bannerTitle) {
      const roleIcons = { producteur:'ğŸŒ¾', vendeur:'ğŸ“¦', transporteur:'ğŸš›', partenaire:'ğŸ¤' };
      bannerTitle.textContent = (roleIcons[r]||'ğŸ“¦') + ' Vos offres ' + roleLabels[r];
    }
    if (bannerSub) {
      const activeCount = window.ABAE_MY_OFFERS.filter(o=>o.status==='active').length;
      bannerSub.textContent = activeCount + ' offre(s) active(s) Â· Achetez aussi librement';
    }
  }

  // â”€â”€â”€ Barre de raccourcis marchÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  updateMarketShortcuts(role);

  // â”€â”€â”€ Section "Mes offres" (vendeurs) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const offreSection = document.getElementById('mesOffresSection');
  if (offreSection) {
    if (seller) {
      offreSection.style.display = 'block';
      renderMesOffres();
    } else {
      offreSection.style.display = 'none';
    }
  }

  // â”€â”€â”€ Section "Mes demandes" (acheteurs + tous les autres aussi) â”€â”€â”€
  const demandeSection = document.getElementById('mesDemandesSection');
  if (demandeSection) {
    // Visible pour tout le monde (acheteur, et aussi vendeur/transporteur/partenaire qui peuvent aussi demander)
    demandeSection.style.display = 'block';
    renderMesDemandes();
  }

  // â”€â”€â”€ Hero stats vendeur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (seller && stats) {
    const activeCount = window.ABAE_MY_OFFERS.filter(o=>o.status==='active').length;
    stats.innerHTML = `
      <div class="hero-seller-stat">
        <div class="hero-seller-stat-val">${activeCount}</div>
        <div class="hero-seller-stat-lbl">Offres actives</div>
      </div>
      <div class="hero-seller-stat">
        <div class="hero-seller-stat-val" id="sellerStatVues">142</div>
        <div class="hero-seller-stat-lbl">Vues ce mois</div>
      </div>
      <div class="hero-seller-stat">
        <div class="hero-seller-stat-val" id="sellerStatVentes">5</div>
        <div class="hero-seller-stat-lbl">Transactions</div>
      </div>`;
  }

  // Re-render cards pour afficher badges "Ma offre"
  filterCards();

  // â”€â”€â”€ Section info rÃ´le dans le header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  updateRoleHeader(role);
}

// Afficher un badge de rÃ´le dans le hero
function updateRoleHeader(role) {
  const roleConfig = {
    acheteur:     { emoji: 'ğŸ›’', label: 'Mode Acheteur', desc: 'Commandez librement Â· Faites des demandes si vous ne trouvez pas', color: '#1A5C8A', bg: 'linear-gradient(135deg,rgba(26,92,138,0.1),rgba(26,92,138,0.06))', border: 'rgba(26,92,138,0.25)' },
    producteur:   { emoji: 'ğŸŒ¾', label: 'Mode Vendeur', desc: 'Vendez vos produits Â· Achetez aussi Â· Faites des demandes', color: '#4A9E2A', bg: 'linear-gradient(135deg,rgba(74,158,42,0.1),rgba(74,158,42,0.06))', border: 'rgba(74,158,42,0.25)' },
    vendeur:      { emoji: 'ğŸ“¦', label: 'Mode Vendeur', desc: 'Publiez vos offres Â· Achetez aussi Â· Faites des demandes', color: '#4A9E2A', bg: 'linear-gradient(135deg,rgba(74,158,42,0.1),rgba(74,158,42,0.06))', border: 'rgba(74,158,42,0.25)' },
    transporteur: { emoji: 'ğŸš›', label: 'Mode Transporteur', desc: 'Proposez vos services Â· Livrez Â· Faites des demandes', color: '#7B5200', bg: 'linear-gradient(135deg,rgba(212,168,67,0.1),rgba(212,168,67,0.06))', border: 'rgba(212,168,67,0.3)' },
    partenaire:   { emoji: 'ğŸ¤', label: 'Mode Partenaire', desc: 'Investissez Â· Publiez des offres Â· Faites des demandes', color: '#5521B5', bg: 'linear-gradient(135deg,rgba(85,33,181,0.1),rgba(85,33,181,0.06))', border: 'rgba(85,33,181,0.25)' },
    affilie:      { emoji: 'ğŸ”—', label: 'Espace AffiliÃ©', desc: 'Votre programme de parrainage est dans votre tableau de bord dÃ©diÃ©', color: '#9B1B6A', bg: 'linear-gradient(135deg,rgba(155,27,106,0.1),rgba(74,14,107,0.06))', border: 'rgba(155,27,106,0.25)' },
  };
  const r = role ? role.toLowerCase().trim() : 'acheteur';
  const cfg = roleConfig[r] || roleConfig['acheteur'];
  const banner = document.getElementById('roleContextBanner');
  if (banner) {
    banner.style.cssText = `margin:0 12px 0;padding:10px 14px;border-radius:12px;font-size:0.78rem;font-weight:700;display:flex;align-items:center;gap:8px;background:${cfg.bg};border:1px solid ${cfg.border};color:${cfg.color};`;
    banner.innerHTML = `<span style="font-size:1.1rem;flex-shrink:0;">${cfg.emoji}</span><span style="flex:1;line-height:1.4;">${cfg.label} â€” <span style="font-weight:500;opacity:0.85;">${cfg.desc}</span></span>`;
  }
}

// â”€â”€ Barre de raccourcis selon le rÃ´le â”€â”€
function updateMarketShortcuts(role) {
  const bar = document.getElementById('marketShortcuts');
  if (!bar) return;
  const r = (role || 'acheteur').toLowerCase().trim();
  const seller = canSell(r);
  const buyerOnly = isBuyerOnly(r);

  // DÃ©finition des raccourcis par rÃ´le
  let shortcuts = [];

  if (r === 'affilie') {
    shortcuts = [
      { icon:'ğŸ”—', label:'Mes filleuls',      color:'purple', action:"showView('dashboard-affilie')" },
      { icon:'ğŸ’°', label:'Mes commissions',   color:'gold',   action:"showView('dashboard-affilie')" },
      { icon:'ğŸ“Š', label:'Mon tableau de bord', color:'dark', action:"showView('dashboard-affilie')" },
    ];
  } else if (buyerOnly) {
    shortcuts = [
      { icon:'ğŸ”', label:'Rechercher', color:'green',  action:"document.getElementById('heroSearchInput').focus();document.getElementById('heroSearchInput').scrollIntoView({behavior:'smooth'})" },
      { icon:'ğŸ“¢', label:'Faire une demande', color:'gold',   action:"openSheet('requestSheet')" },
      { icon:'ğŸ’°', label:'Mon portefeuille',  color:'blue',   action:"navTo('portefeuille')" },
      { icon:'ğŸ“¦', label:'Mes commandes',     color:'dark',   action:"navTo('commandes')" },
    ];
  } else if (r === 'transporteur') {
    shortcuts = [
      { icon:'ğŸš›', label:'Publier trajet',    color:'gold',  action:"openSheet('publishSheet')" },
      { icon:'ğŸ“¢', label:'Faire une demande', color:'green', action:"openSheet('requestSheet')" },
      { icon:'ğŸ“¦', label:'Mes commandes',     color:'dark',  action:"navTo('commandes')" },
      { icon:'ğŸ’°', label:'Portefeuille',      color:'blue',  action:"navTo('portefeuille')" },
    ];
  } else if (r === 'partenaire') {
    shortcuts = [
      { icon:'ğŸ“¦', label:'Publier une offre', color:'purple', action:"openSheet('publishSheet')" },
      { icon:'ğŸ“¢', label:'Faire une demande', color:'gold',   action:"openSheet('requestSheet')" },
      { icon:'ğŸ“Š', label:'Tableau de bord',   color:'dark',   action:"navTo('smart')" },
      { icon:'ğŸ’°', label:'Portefeuille',      color:'blue',   action:"navTo('portefeuille')" },
    ];
  } else {
    // producteur / vendeur (seller)
    shortcuts = [
      { icon:'ğŸ“¦', label:'Publier une offre', color:'gold',  action:"openSheet('publishSheet')" },
      { icon:'ğŸ“¢', label:'Faire une demande', color:'green', action:"openSheet('requestSheet')" },
      { icon:'ğŸ“Š', label:'Mes stats',         color:'dark',  action:"navTo('smart')" },
      { icon:'ğŸ’°', label:'Portefeuille',      color:'blue',  action:"navTo('portefeuille')" },
    ];
  }

  const cols = shortcuts.length <= 3 ? 'cols-3' : 'cols-2';
  bar.className = 'market-shortcuts ' + (shortcuts.length === 3 ? 'cols-3' : 'cols-2');

  bar.innerHTML = shortcuts.map(s => `
    <button class="mshortcut ${s.color}" onclick="${s.action}">
      <span class="mshortcut__icon">${s.icon}</span>
      ${s.label}
    </button>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYSTÃˆME DEMANDES ACHETEUR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.ABAE_MY_REQUESTS = []; // tableau de demandes de l'utilisateur

function renderMesDemandes() {
  const container = document.getElementById('mesDemandesCards');
  const badge     = document.getElementById('mesDemandesBadge');
  if (!container) return;

  const requests = window.ABAE_MY_REQUESTS;
  const activeCount = requests.filter(r => r.status === 'active').length;
  if (badge) badge.textContent = activeCount + ' active' + (activeCount > 1 ? 's' : '');

  if (!requests.length) {
    container.innerHTML = `<div style="text-align:center;padding:6px 8px;color:#9BA3AE;font-size:0.72rem;">
      Aucune demande pour l'instant. Publiez votre premier besoin !
    </div>`;
    return;
  }

  container.innerHTML = requests.map(r => `
    <div style="display:flex;align-items:flex-start;gap:10px;background:rgba(255,255,255,0.8);border-radius:12px;padding:10px;border:1px solid rgba(212,168,67,0.2);">
      <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,rgba(212,168,67,0.2),rgba(212,168,67,0.08));display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;">${r.catLabel.split(' ')[0]}</div>
      <div style="flex:1;min-width:0;">
        <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.78rem;color:#3D4550;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${r.title}</div>
        <div style="font-size:0.68rem;color:#9BA3AE;margin-top:2px;">${r.catLabel} Â· ${r.loc} Â· ${r.date}</div>
        <div style="font-size:0.68rem;color:#7A5A00;margin-top:2px;">Budget: ${r.budget} Â· ${r.delay}</div>
        <div style="margin-top:4px;display:flex;align-items:center;gap:6px;">
          <span style="display:inline-flex;align-items:center;gap:3px;font-size:0.6rem;font-weight:700;padding:2px 7px;border-radius:10px;${r.status==='active'?'background:#EDF7E5;color:#4A9E2A;':r.status==='fulfilled'?'background:#EBF4FF;color:#1A56DB;':'background:#FFF5E8;color:#D4A843;'}">
            ${r.status==='active'?'âœ… Active':r.status==='fulfilled'?'âœ”ï¸ Satisfaite':'â¸ï¸ En pause'}
          </span>
          ${r.responses > 0 ? `<span style="font-size:0.6rem;font-weight:700;padding:2px 7px;border-radius:10px;background:#F0ECFF;color:#5521B5;">${r.responses} rÃ©ponse(s)</span>` : ''}
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:4px;flex-shrink:0;">
        <button onclick="openEditRequest(${r.id})" style="padding:4px 8px;border-radius:8px;background:#F7F8F9;border:1px solid #EAECEF;font-size:0.62rem;font-weight:700;cursor:pointer;color:#3D4550;">âœï¸</button>
        <button onclick="toggleRequestStatus(${r.id})" style="padding:4px 8px;border-radius:8px;background:#F7F8F9;border:1px solid #EAECEF;font-size:0.62rem;font-weight:700;cursor:pointer;color:#3D4550;">
          ${r.status==='active'?'â¸ï¸':'â–¶ï¸'}
        </button>
        <button onclick="deleteRequest(${r.id})" style="padding:4px 8px;border-radius:8px;background:#FFF5F5;border:1px solid #FFE0E0;font-size:0.62rem;font-weight:700;cursor:pointer;color:#C0392B;">ğŸ—‘ï¸</button>
      </div>
    </div>`).join('');
}

function toggleRequestStatus(id) {
  const req = window.ABAE_MY_REQUESTS.find(r => r.id === id);
  if (!req) return;
  req.status = req.status === 'active' ? 'paused' : 'active';
  renderMesDemandes();
  showToast(req.status === 'active' ? 'â–¶ï¸ Demande rÃ©activÃ©e' : 'â¸ï¸ Demande mise en pause', req.status === 'active' ? 'ok' : '');
}

function deleteRequest(id) {
  const req = window.ABAE_MY_REQUESTS.find(r => r.id === id);
  if (!req) return;
  if (confirm('Supprimer cette demande dÃ©finitivement ?')) {
    window.ABAE_MY_REQUESTS = window.ABAE_MY_REQUESTS.filter(r => r.id !== id);
    renderMesDemandes();
    showToast('ğŸ—‘ï¸ Demande supprimÃ©e', '');
  }
}

function openEditRequest(id) {
  const req = window.ABAE_MY_REQUESTS.find(r => r.id === id);
  if (!req) return;
  window._editingRequestId = id;
  if (document.getElementById('editReqTitle')) document.getElementById('editReqTitle').value  = req.title;
  const budgetVal = parseInt((req.budget || '').replace(/\s/g, '').replace(/[^0-9]/g,'')) || '';
  if (document.getElementById('editReqBudget')) document.getElementById('editReqBudget').value = budgetVal;
  if (document.getElementById('editReqDesc'))   document.getElementById('editReqDesc').value   = req.desc || '';
  if (document.getElementById('editReqStatus')) document.getElementById('editReqStatus').value = req.status;
  openSheet('editRequestSheet');
}

function saveEditRequest() {
  const id  = window._editingRequestId;
  const req = window.ABAE_MY_REQUESTS.find(r => r.id === id);
  if (!req) return;
  const title  = (document.getElementById('editReqTitle')  || {}).value || '';
  const budget = parseInt((document.getElementById('editReqBudget') || {}).value) || 0;
  const desc   = (document.getElementById('editReqDesc')   || {}).value || '';
  const status = (document.getElementById('editReqStatus') || {}).value || 'active';
  req.title  = title.trim() || req.title;
  req.budget = budget > 0 ? budget.toLocaleString('fr') + ' XAF' : req.budget;
  req.desc   = desc.trim() || req.desc;
  req.status = status;
  renderMesDemandes();
  closeSheet('editRequestSheet');
  showToast('âœ… Demande mise Ã  jour !', 'ok');
}

// Render "Mes offres" mini-cards
function renderMesOffres() {
  const container = document.getElementById('mesOffresCards');
  const badge     = document.getElementById('mesOffresBadge');
  if (!container) return;
  const offers = window.ABAE_MY_OFFERS;
  const activeCount = offers.filter(o=>o.status==='active').length;
  if (badge) badge.textContent = activeCount + ' active' + (activeCount>1?'s':'');

  container.innerHTML = offers.map(o => `
    <div style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.7);border-radius:10px;padding:8px;border:1px solid rgba(212,168,67,0.2);">
      <div style="width:42px;height:42px;border-radius:8px;overflow:hidden;flex-shrink:0;background:#f0f0f0;">
        <img src="${o.img}" alt="${o.name}" style="width:100%;height:100%;object-fit:cover;" onerror="this.src='https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=100&q=60'"/>
      </div>
      <div style="flex:1;min-width:0;">
        <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.75rem;color:#3D4550;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${o.name}</div>
        <div style="font-size:0.65rem;color:#9BA3AE;margin-top:1px;">${o.priceLabel}</div>
        <div style="margin-top:2px;">
          <span style="display:inline-flex;align-items:center;gap:3px;font-size:0.58rem;font-weight:700;padding:1px 6px;border-radius:10px;${o.status==='active'?'background:#EDF7E5;color:#4A9E2A;':'background:#FFF5E8;color:#D4A843;'}">
            ${o.status==='active'?'âœ… Active':'â¸ï¸ En pause'}
          </span>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:3px;flex-shrink:0;">
        <button class="card-seller-btn edit" onclick="openEditOffer(${o.id})" style="padding:4px 9px;">âœï¸ Ã‰diter</button>
        <button class="card-seller-btn ${o.status==='active'?'pause':'edit'}" onclick="toggleOfferStatus(${o.id})" style="padding:4px 9px;">
          ${o.status==='active'?'â¸ï¸ Pause':'â–¶ï¸ Activer'}
        </button>
      </div>
    </div>`).join('');
}

// Toggle statut d'une offre
function toggleOfferStatus(id) {
  const offer = window.ABAE_MY_OFFERS.find(o=>o.id===id);
  if (!offer) return;
  offer.status = offer.status === 'active' ? 'paused' : 'active';
  renderMesOffres();
  showToast(offer.status==='active' ? 'â–¶ï¸ Offre rÃ©activÃ©e sur le marchÃ©' : 'â¸ï¸ Offre mise en pause', offer.status==='active'?'ok':'');
  filterCards();
}

// Ouvrir l'Ã©diteur d'offre
function openEditOffer(id) {
  const o = window.ABAE_MY_OFFERS.find(x=>x.id===id);
  if (!o) return;
  window._editingOfferId = id;
  document.getElementById('editTitle').value = o.name;
  document.getElementById('editPrice').value = o.price || '';
  document.getElementById('editDesc').value  = o.desc || '';
  document.getElementById('editStatus').value = o.status;
  openSheet('editOfferSheet');
}

// Sauvegarder l'Ã©dition
function saveEditOffer() {
  const id = window._editingOfferId;
  const o  = window.ABAE_MY_OFFERS.find(x=>x.id===id);
  if (!o) return;
  o.name      = document.getElementById('editTitle').value.trim() || o.name;
  o.price     = parseInt(document.getElementById('editPrice').value) || o.price;
  o.priceLabel= o.price.toLocaleString('fr') + ' XAF';
  o.desc      = document.getElementById('editDesc').value.trim() || o.desc;
  o.status    = document.getElementById('editStatus').value;
  renderMesOffres();
  closeSheet('editOfferSheet');
  showToast('âœ… Offre mise Ã  jour !', 'ok');
}

// Hook sur updateMarcheHero pour dÃ©clencher applyRoleUI automatiquement
const _origUpdateMarcheHero = window.updateMarcheHero || function(){};
window.updateMarcheHero = function(prenom, profil) {
  _origUpdateMarcheHero(prenom, profil);
  if (prenom) window.ABAE_USER_NAME = prenom;
  setTimeout(() => applyRoleUI(profil || 'acheteur'), 50);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SMART ADAPTIVE FORMS â€” Formulaires intelligents par catÃ©gorie
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CITIES_OPTIONS = `<option value="">â€” Choisir une ville â€”</option>
  <option>YaoundÃ©, CM</option><option>Douala, CM</option><option>Bafoussam, CM</option>
  <option>NgaoundÃ©rÃ©, CM</option><option>Garoua, CM</option><option>Maroua, CM</option>
  <option>Bertoua, CM</option><option>Abidjan, CI</option><option>Dakar, SN</option>
  <option>Bamako, ML</option><option>Conakry, GN</option>`;

// â”€â”€ SCHEMAS PUBLICATION : champs spÃ©cifiques par catÃ©gorie â”€â”€
const SMART_FORM_SCHEMAS = {
  agro: {
    icon: 'ğŸŒ¾', label: 'Produit Agricole / Ã‰levage',
    hint: 'CÃ©rÃ©ales, fruits, lÃ©gumes, bÃ©tail, produits laitiersâ€¦',
    titlePlaceholder: 'Ex : Sacs de maÃ¯s blanc 50kg â€” QualitÃ© A1 â€” RÃ©colte 2026',
    descPlaceholder: 'VariÃ©tÃ©, conditions de culture, stockage actuel, possibilitÃ© de certificat phytosanitaireâ€¦',
    priceLabel: 'Prix unitaire', pricePlaceholder: 'Prix par unitÃ©',
    priceUnits: ['XAF/kg','XAF/sac','XAF/tonne','XAF/tÃªte','XAF/litre','XAF'],
    extras: [
      { id:'pubQty', label:'QuantitÃ© disponible <span class="req">*</span>', type:'number', placeholder:'Ex : 500', required:true, hint:'', size:'half' },
      { id:'pubQtyUnit', label:'UnitÃ© de mesure', type:'select', options:['kg','tonnes','sacs 50kg','sacs 25kg','litres','cartons','tÃªtes (Ã©levage)','lots'], size:'half' },
      { id:'pubQuality', label:'Grade / QualitÃ©', type:'select', options:['â€” SÃ©lectionner â€”','â­â­â­ Grade A1 (Export)','â­â­ Grade A (Premium)','â­ Grade B (Standard)','ğŸŒ¿ Bio certifiÃ©','Standard non triÃ©'] },
      { id:'pubConditioning', label:'Conditionnement', type:'select', options:['â€” Conditionnement â€”','Sacs 50kg','Sacs 25kg','Vrac','Palettes','Cartons','CongÃ©lÃ© sous vide','Autre'] },
      { id:'pubDeliveryMode', label:'Livraison possible ?', type:'select', options:['Non â€” retrait sur place uniquement','Oui â€” livraison incluse dans le prix','Oui â€” livraison disponible en option','NÃ©gociable'] },
      { id:'pubHarvestDate', label:'Date de rÃ©colte / disponibilitÃ©', type:'date', required:false },
    ]
  },
  transport: {
    icon: 'ğŸš›', label: 'Transport & Logistique',
    hint: 'Camions, vÃ©hicules frigorifiques, motos, transport fluvialâ€¦',
    titlePlaceholder: 'Ex : Camion 10T â€” Douala â†’ YaoundÃ© â€” RÃ©frigÃ©rÃ© â€” Disponible maintenant',
    descPlaceholder: 'Type de marchandises acceptÃ©es, contraintes de chargement, frÃ©quence des trajetsâ€¦',
    priceLabel: 'Tarif', pricePlaceholder: 'Prix par trajet, km ou tonne',
    priceUnits: ['XAF/trajet','XAF/km','XAF/tonne','XAF/mois','XAF'],
    extras: [
      { id:'pubVehicle', label:'Type de vÃ©hicule <span class="req">*</span>', type:'select', required:true, options:['â€” Choisir le vÃ©hicule â€”','ğŸš› Camion benne 5T','ğŸš› Camion benne 10T','ğŸš› Camion benne 20T+','â„ï¸ Camion frigorifique','ğŸš Camionnette (<2T)','ğŸï¸ Moto-taxi (petits colis)','â›µ Pirogue / barque','Autre'] },
      { id:'pubCapacity', label:'CapacitÃ© de charge (tonnes)', type:'number', placeholder:'Ex : 10', size:'half' },
      { id:'pubRouteFrom', label:'Ville de dÃ©part <span class="req">*</span>', type:'select', required:true, size:'half', options:['â€” DÃ©part â€”','YaoundÃ©','Douala','Bafoussam','NgaoundÃ©rÃ©','Garoua','Maroua','Bertoua','Abidjan','Dakar','Autre'] },
      { id:'pubRouteTo', label:'Ville d\'arrivÃ©e <span class="req">*</span>', type:'select', required:true, size:'half', options:['â€” ArrivÃ©e â€”','YaoundÃ©','Douala','Bafoussam','NgaoundÃ©rÃ©','Garoua','Maroua','Bertoua','Abidjan','Dakar','Toutes villes','Autre'] },
      { id:'pubAvailability', label:'DisponibilitÃ©', type:'select', options:['â€” DisponibilitÃ© â€”','ğŸŸ¢ ImmÃ©diate','ğŸ“… Sur rÃ©servation','ğŸ”„ RÃ©guliÃ¨re (hebdomadaire)','âšª Flexible / Ã€ convenir'] },
    ]
  },
  stockage: {
    icon: 'ğŸ­', label: 'Stockage & EntrepÃ´t',
    hint: 'EntrepÃ´ts secs, chambres froides, silos, entrepÃ´ts rÃ©frigÃ©rÃ©sâ€¦',
    titlePlaceholder: 'Ex : Chambre froide 200mÂ² â€” YaoundÃ© â€” TempÃ©rature contrÃ´lÃ©e 4Â°C',
    descPlaceholder: 'AccÃ¨s horaires, Ã©quipements disponibles, surveillance, certifications spÃ©cialesâ€¦',
    priceLabel: 'Tarif', pricePlaceholder: 'Par mois, mÂ² ou tonne',
    priceUnits: ['XAF/mÂ²/mois','XAF/tonne/mois','XAF/mois','XAF/semaine','XAF'],
    extras: [
      { id:'pubStorageType', label:'Type de stockage <span class="req">*</span>', type:'select', required:true, options:['â€” Type d\'entrepÃ´t â€”','ğŸ­ EntrepÃ´t sec','â„ï¸ Chambre froide (+4Â°C)','ğŸ¥¶ EntrepÃ´t congelÃ© (-18Â°C)','ğŸŒ¾ Silo cÃ©rÃ©ales','ğŸŒ¿ Aire extÃ©rieure sÃ©curisÃ©e','Autre'] },
      { id:'pubCapacityM2', label:'Superficie (mÂ²)', type:'number', placeholder:'Ex : 300', size:'half' },
      { id:'pubCapacityTon', label:'CapacitÃ© (tonnes)', type:'number', placeholder:'Ex : 80', size:'half' },
      { id:'pubMinDuration', label:'DurÃ©e minimum', type:'select', options:['Pas de durÃ©e minimum','1 semaine','1 mois','3 mois','6 mois'] },
      { id:'pubStorageCert', label:'Ã‰quipements / Certifications', type:'select', options:['Standard','ğŸ”’ Surveillance 24h/24','ğŸ§ª Traitement anti-nuisibles','âš¡ GÃ©nÃ©rateur de secours','ğŸ… ISO 22000 / HACCP','â™»ï¸ Tous Ã©quipements'] },
    ]
  },
  digital: {
    icon: 'ğŸ’»', label: 'Services Digitaux',
    hint: 'Sites web, apps mobiles, logiciels, comptabilitÃ©, marketingâ€¦',
    titlePlaceholder: 'Ex : CrÃ©ation site web vitrine + app mobile â€” CoopÃ©rative agricole',
    descPlaceholder: 'Technologies utilisÃ©es, exemples de rÃ©alisations, processus de travail, garanties post-livraisonâ€¦',
    priceLabel: 'Tarif', pricePlaceholder: 'Forfait, hourly ou abonnement',
    priceUnits: ['XAF (forfait)','XAF/heure','XAF/jour','XAF/mois','USD','EUR'],
    extras: [
      { id:'pubDigitalType', label:'Type de service <span class="req">*</span>', type:'select', required:true, options:['â€” Choisir le service â€”','ğŸŒ Site web vitrine','ğŸ“± Application mobile','ğŸ’» Logiciel de gestion','ğŸ“Š ComptabilitÃ© & Finance','ğŸ“£ Marketing digital & rÃ©seaux','ğŸ“ Formation informatique','ğŸ”§ Support technique','ğŸ“· Photographie / VidÃ©o','Autre'] },
      { id:'pubDeadlineDig', label:'DÃ©lai de livraison', type:'select', options:['â€” DÃ©lai â€”','24hâ€“48h (urgence)','1 semaine','2 semaines','1 mois','2â€“3 mois','Sur mesure / Ã  dÃ©finir'] },
      { id:'pubRevisions', label:'RÃ©visions incluses', type:'select', size:'half', options:['1 rÃ©vision','2 rÃ©visions','3 rÃ©visions','RÃ©visions illimitÃ©es'] },
      { id:'pubDeliveryModeDig', label:'Mode de livraison', type:'select', size:'half', options:['En ligne (email / cloud)','PrÃ©sentiel sur site','Les deux'] },
    ]
  },
  financement: {
    icon: 'ğŸ’°', label: 'Financement Agricole',
    hint: 'CrÃ©dit agricole, microfinance, leasing, investissement, subventionâ€¦',
    titlePlaceholder: 'Ex : CrÃ©dit agricole 24 mois â€” Ã‰quipement irrigation â€” Taux 12%',
    descPlaceholder: 'Conditions d\'Ã©ligibilitÃ©, documents requis, processus d\'approbation, garanties acceptÃ©esâ€¦',
    priceLabel: 'Montant minimum accordÃ©', pricePlaceholder: 'Montant min (XAF)',
    priceUnits: ['XAF','USD','EUR'],
    extras: [
      { id:'pubFinType', label:'Type de financement <span class="req">*</span>', type:'select', required:true, options:['â€” Type â€”','ğŸ¦ CrÃ©dit agricole','ğŸ’³ Microfinance','ğŸ¤ Investissement participatif','âš™ï¸ Leasing Ã©quipement','ğŸ›¡ï¸ Garantie bancaire','ğŸ“‹ Subvention (projet)','Autre'] },
      { id:'pubFinMax', label:'Montant maximum (XAF)', type:'number', placeholder:'Ex : 10 000 000', size:'half' },
      { id:'pubFinRate', label:'Taux d\'intÃ©rÃªt annuel (%)', type:'number', placeholder:'Ex : 12', size:'half' },
      { id:'pubFinDuration', label:'DurÃ©e de remboursement', type:'select', options:['â€” DurÃ©e â€”','3 mois','6 mois','12 mois','24 mois','36 mois','60 mois','Ã€ nÃ©gocier'] },
      { id:'pubFinGuarantee', label:'Garanties requises', type:'select', options:['Aucune garantie (microfinance)','Titre foncier','Caution personnelle','Nantissement de rÃ©colte','MatÃ©riel agricole existant','Ã€ discuter'] },
    ]
  },
  services: {
    icon: 'ğŸ”§', label: 'Conseil & Services',
    hint: 'Agronomie, vÃ©tÃ©rinaire, formation, audit, juridique, exportâ€¦',
    titlePlaceholder: 'Ex : Formation BPA 2 jours â€” Agriculture durable â€” Groupe 20 personnes',
    descPlaceholder: 'Approche mÃ©thodologique, rÃ©fÃ©rences clients, certifications, matÃ©riel pÃ©dagogique fourniâ€¦',
    priceLabel: 'Tarif', pricePlaceholder: 'Forfait, journÃ©e ou heure',
    priceUnits: ['XAF (forfait)','XAF/jour','XAF/heure','XAF/personne','XAF'],
    extras: [
      { id:'pubServiceType', label:'Domaine d\'expertise <span class="req">*</span>', type:'select', required:true, options:['â€” Domaine â€”','ğŸŒ¿ Agronomie & production','ğŸ„ VÃ©tÃ©rinaire & Ã©levage','ğŸ½ï¸ Transformation agroalim.','ğŸ“Š Gestion & comptabilitÃ©','ğŸ“ Formation & coaching','âœ… Audit qualitÃ©','âš–ï¸ Juridique & rÃ©glementaire','ğŸŒ Export & certification','Autre'] },
      { id:'pubServiceFormat', label:'Format de prestation', type:'select', size:'half', options:['PrÃ©sentiel','Ã€ distance (visio)','Hybride (les deux)'] },
      { id:'pubServiceDuration', label:'DurÃ©e de mission', type:'select', size:'half', options:['â€” DurÃ©e â€”','< 1 journÃ©e','1 journÃ©e','2â€“3 jours','1 semaine','2 semaines','1 mois+','RÃ©current (mensuel)'] },
      { id:'pubServiceTarget', label:'Public cible', type:'select', options:['Tous publics','Agriculteurs individuels','CoopÃ©ratives & GIE','Entreprises agroalimentaires','Jeunes agriculteurs'] },
    ]
  },
  emplois: {
    icon: 'ğŸ’¼', label: "Offre d'emploi",
    hint: 'Recrutement dans le secteur agropastoral, agroalimentaire, logistiqueâ€¦',
    titlePlaceholder: 'Ex : Technicien Agricole CDI â€” YaoundÃ© â€” DÃ©butant acceptÃ©',
    descPlaceholder: 'Missions, profil recherchÃ©, avantages, conditions de travail, comment postulerâ€¦',
    priceLabel: 'Salaire proposÃ© (optionnel)', pricePlaceholder: 'Ex : 150 000 XAF/mois',
    priceUnits: ['XAF/mois','XAF/jour','Salaire Ã  nÃ©gocier'],
    extras: [
      { id:'pubJobType', label:'Type de contrat <span class="req">*</span>', type:'select', required:true, options:['â€” Type de contrat â€”','CDI','CDD','Stage','Apprentissage','Mission ponctuelle','BÃ©nÃ©volat'] },
      { id:'pubJobDomain', label:'Secteur', type:'select', options:['â€” Secteur â€”','ğŸŒ¾ Production agricole','ğŸ„ Ã‰levage','ğŸš› Transport & logistique','ğŸ­ Transformation agroalim.','ğŸ’» Digital & Tech Agri','ğŸ“Š Gestion & finance','ğŸ”¬ Recherche & dÃ©veloppement','Autre'] },
      { id:'pubJobLevel', label:"Niveau d'Ã©tudes requis", type:'select', size:'half', options:['Tous niveaux','BEPC / CEP','Bac','Bac+2 (BTS, DUT)','Bac+3 (Licence)','Bac+5 (Master)','Doctorat'] },
      { id:'pubJobExp', label:'ExpÃ©rience requise', type:'select', size:'half', options:['DÃ©butant acceptÃ©','1â€“2 ans','3â€“5 ans','5+ ans'] },
      { id:'pubJobAvantages', label:'Avantages proposÃ©s', type:'text', placeholder:'Logement, transport, primes, couverture santÃ©â€¦' },
    ]
  },
  formation: {
    icon: 'ğŸ“š', label: 'Formation & Coaching',
    hint: 'Ateliers, cours en ligne, sessions de terrain, certificationsâ€¦',
    titlePlaceholder: 'Ex : Formation Gestion CoopÃ©rative Agricole â€” 3 jours â€” Bafoussam',
    descPlaceholder: 'Programme dÃ©taillÃ©, prÃ©requis, matÃ©riel fourni, attestation dÃ©livrÃ©eâ€¦',
    priceLabel: 'Frais de formation', pricePlaceholder: 'Prix par participant',
    priceUnits: ['XAF/personne','XAF/groupe','Gratuit'],
    extras: [
      { id:'pubFormFormat', label:'Format <span class="req">*</span>', type:'select', required:true, options:['â€” Format â€”','PrÃ©sentiel','En ligne (vidÃ©o)','Hybride','Terrain / pratique'] },
      { id:'pubFormDuration', label:'DurÃ©e', type:'select', size:'half', options:['â€” DurÃ©e â€”',"Moins d'1 jour",'1 jour','2â€“3 jours','1 semaine','2 semaines','1 mois+'] },
      { id:'pubFormMaxPart', label:'Nb max participants', type:'number', size:'half', placeholder:'Ex : 20' },
      { id:'pubFormCert', label:'Attestation dÃ©livrÃ©e ?', type:'select', options:['Oui â€” attestation de participation','Oui â€” certificat reconnu','Non'] },
      { id:'pubFormTarget', label:'Public cible', type:'select', options:['Tous publics','Agriculteurs dÃ©butants','Agriculteurs expÃ©rimentÃ©s','CoopÃ©ratives / GIE','Jeunes agriculteurs','Femmes rurales'] },
    ]
  },
  intrants: {
    icon: 'ğŸŒ±', label: 'Intrants Agricoles',
    hint: 'Semences, engrais, pesticides, produits vÃ©tÃ©rinairesâ€¦',
    titlePlaceholder: 'Ex : Engrais NPK 15-15-15 â€” Sacs 50kg â€” CertifiÃ© MINADER',
    descPlaceholder: 'Composition, certification, conditions de stockage, dÃ©lai de livraisonâ€¦',
    priceLabel: 'Prix unitaire', pricePlaceholder: 'Prix par unitÃ©/sac/litre',
    priceUnits: ['XAF/kg','XAF/sac','XAF/litre','XAF/boÃ®te','XAF'],
    extras: [
      { id:'pubIntrantType', label:"Type d'intrant <span class=\"req\">*</span>", type:'select', required:true, options:['â€” Type â€”','ğŸŒ¾ Semences certifiÃ©es','ğŸŒ¿ Engrais organique','âš—ï¸ Engrais chimique','ğŸ› Pesticide / Herbicide','ğŸ’Š Produit vÃ©tÃ©rinaire','ğŸ”¬ Inoculant / Biostimulant','Autre'] },
      { id:'pubIntrantQty', label:'QuantitÃ© disponible', type:'number', size:'half', placeholder:'Ex : 500' },
      { id:'pubIntrantUnit', label:'UnitÃ©', type:'select', size:'half', options:['kg','sacs','litres','boÃ®tes','cartons'] },
      { id:'pubIntrantCert', label:'Certification / Homologation', type:'text', placeholder:'Ex : MINADER 2025, ISO 9001â€¦' },
    ]
  },
  assurance: {
    icon: 'ğŸ›¡ï¸', label: 'Assurance Agricole',
    hint: 'Assurance rÃ©colte, bÃ©tail, Ã©quipements, responsabilitÃ©â€¦',
    titlePlaceholder: 'Ex : Assurance rÃ©colte sÃ©cheresse â€” Couverture 1ha â€” Nord Cameroun',
    descPlaceholder: "Risques couverts, zone gÃ©ographique, dÃ©lai d'indemnisation, partenaires financiersâ€¦",
    priceLabel: 'Prime annuelle', pricePlaceholder: 'Ex : 15 000 XAF/ha/an',
    priceUnits: ['XAF/ha/an','XAF/tÃªte/an','XAF/an','XAF'],
    extras: [
      { id:'pubAssurType', label:"Type d'assurance <span class=\"req\">*</span>", type:'select', required:true, options:['â€” Type â€”','â˜” RÃ©colte (sÃ©cheresse / inondations)','ğŸ„ Cheptel / BÃ©tail','ğŸšï¸ Infrastructure agricole','âš™ï¸ Ã‰quipements & machines','ğŸ”„ Assurance multirisque','Autre'] },
      { id:'pubAssurZone', label:'Zone gÃ©ographique couverte', type:'text', placeholder:'Ex : RÃ©gions Nord et ExtrÃªme-Nord' },
      { id:'pubAssurDelay', label:"DÃ©lai d'indemnisation", type:'select', options:['â€” DÃ©lai â€”','Sous 15 jours','Sous 30 jours','1 Ã  2 mois','Ã€ nÃ©gocier'] },
      { id:'pubAssurPartner', label:'Partenaire financier', type:'text', placeholder:'Ex : BEAC, Bicec, MFI localeâ€¦' },
    ]
  }
};

// â”€â”€ SCHEMAS DEMANDE (REQUEST) : champs spÃ©cifiques par catÃ©gorie â”€â”€
const REQ_FORM_SCHEMAS = {
  agro: {
    icon:'ğŸŒ¾', titlePlaceholder:'Ex : 500kg de maÃ¯s blanc qualitÃ© A1, livraison YaoundÃ©',
    budgetLabel:'Budget max (optionnel)', budgetHint:'Prix que vous Ãªtes prÃªt Ã  payer',
    extras: [
      { id:'reqQty', label:'QuantitÃ© souhaitÃ©e <span class="req">*</span>', type:'number', placeholder:'Ex : 500', required:true, size:'half' },
      { id:'reqQtyUnit', label:'UnitÃ©', type:'select', size:'half', options:['kg','tonnes','sacs 50kg','sacs 25kg','litres','cartons','tÃªtes','lots'] },
      { id:'reqQuality', label:'QualitÃ© souhaitÃ©e', type:'select', options:['Toute qualitÃ© acceptÃ©e','â­â­â­ Grade A1 (Export)','â­â­ Grade A (Premium)','â­ Grade B (Standard)','ğŸŒ¿ Bio certifiÃ© uniquement'] },
      { id:'reqDeliveryMode', label:'Mode de rÃ©ception souhaitÃ©', type:'select', options:['Retrait sur place','Livraison Ã  domicile','Point relais ABAE','Ã€ nÃ©gocier'] },
      { id:'reqDeliveryAddr', label:'Adresse de livraison', type:'text', placeholder:'Quartier, ville, point de repÃ¨reâ€¦' },
    ]
  },
  transport: {
    icon:'ğŸš›', titlePlaceholder:'Ex : Transport 2 tonnes de cacao de Bafoussam Ã  Douala, urgent',
    budgetLabel:'Budget max transport (optionnel)', budgetHint:'',
    extras: [
      { id:'reqTrFrom', label:'Lieu de chargement <span class="req">*</span>', type:'text', required:true, placeholder:'Ex : MarchÃ© Central, Bafoussam', size:'half' },
      { id:'reqTrTo', label:'Lieu de livraison <span class="req">*</span>', type:'text', required:true, placeholder:'Ex : Port de Douala', size:'half' },
      { id:'reqTrDate', label:'Date souhaitÃ©e', type:'date', size:'half' },
      { id:'reqTrWeight', label:'Poids Ã  transporter (kg)', type:'number', placeholder:'Ex : 2000', size:'half' },
      { id:'reqTrGoods', label:'Nature de la marchandise', type:'text', placeholder:'Ex : Sacs de cacao, fruits pÃ©rissablesâ€¦' },
      { id:'reqVehicleType', label:'Type de vÃ©hicule souhaitÃ©', type:'select', options:['IndiffÃ©rent','Camion benne','Camion frigorifique','Camionnette','Moto-taxi'] },
    ]
  },
  stockage: {
    icon:'ğŸ­', titlePlaceholder:'Ex : EntrepÃ´t frigorifique 20 tonnes â€” 3 mois â€” YaoundÃ©',
    budgetLabel:'Budget mensuel (optionnel)', budgetHint:'',
    extras: [
      { id:'reqStType', label:'Type de stockage souhaitÃ©', type:'select', options:['IndiffÃ©rent','EntrepÃ´t sec','Chambre froide','Silo cÃ©rÃ©ales','EntrepÃ´t congelÃ©'] },
      { id:'reqStVolume', label:'Volume Ã  stocker (tonnes)', type:'number', placeholder:'Ex : 20', size:'half' },
      { id:'reqStDuration', label:'DurÃ©e souhaitÃ©e', type:'select', size:'half', options:['â€” DurÃ©e â€”','1 semaine','2 semaines','1 mois','3 mois','6 mois','12 mois+','Ã€ nÃ©gocier'] },
      { id:'reqStStart', label:'Date de dÃ©but souhaitÃ©e', type:'date', size:'half' },
      { id:'reqStGoods', label:'Produits Ã  stocker', type:'text', placeholder:'Ex : Grains de maÃ¯s, semences amÃ©liorÃ©esâ€¦', size:'half' },
      { id:'reqStConditions', label:'Conditions requises', type:'select', options:['Standard','TempÃ©rature contrÃ´lÃ©e','HumiditÃ© contrÃ´lÃ©e','Surveillance 24h/24','Traitement anti-nuisibles'] },
    ]
  },
  digital: {
    icon:'ğŸ’»', titlePlaceholder:'Ex : Application mobile de gestion des stocks pour coopÃ©rative',
    budgetLabel:'Budget disponible (optionnel)', budgetHint:'',
    extras: [
      { id:'reqDigBrief', label:'Description du besoin <span class="req">*</span>', type:'textarea', required:true, placeholder:'DÃ©crivez prÃ©cisÃ©ment : fonctionnalitÃ©s souhaitÃ©es, problÃ¨me Ã  rÃ©soudre, rÃ©sultat attendu, votre niveau technique actuelâ€¦', rows:4 },
      { id:'reqDigDeadline', label:'DÃ©lai attendu', type:'select', options:['ASAP (urgent)','1 semaine','2 semaines','1 mois','Flexible'] },
      { id:'reqDigFormat', label:'Format prÃ©fÃ©rÃ©', type:'select', options:['En ligne','PrÃ©sentiel','Les deux'] },
    ]
  },
  financement: {
    icon:'ğŸ’°', titlePlaceholder:'Ex : CrÃ©dit 3 000 000 XAF pour achat semences â€” remboursement 12 mois',
    budgetLabel:'Montant recherchÃ© <span class="req">*</span>', budgetHint:'',
    extras: [
      { id:'reqFinPurpose', label:'Objet du financement <span class="req">*</span>', type:'text', required:true, placeholder:'Ex : Achat semences amÃ©liorÃ©es, installation irrigation, construction hangarâ€¦' },
      { id:'reqFinDuration', label:'DurÃ©e souhaitÃ©e', type:'select', options:['â€” DurÃ©e de remboursement â€”','6 mois','12 mois','24 mois','36 mois','Flexible'] },
      { id:'reqFinGuarantee', label:'Garantie disponible', type:'select', options:['Aucune','Titre foncier','Caution personnelle','Nantissement rÃ©colte','MatÃ©riel existant','Ã€ discuter'] },
      { id:'reqFinActivity', label:'ActivitÃ© principale', type:'text', placeholder:'Ex : MaraÃ®chage, 2ha, en activitÃ© depuis 3 ansâ€¦' },
    ]
  },
  services: {
    icon:'ğŸ”§', titlePlaceholder:'Ex : Consultant agronomie pour diagnostic et plan de fertilisation â€” 2 jours',
    budgetLabel:'Budget (optionnel)', budgetHint:'',
    extras: [
      { id:'reqSrvBrief', label:'Description du besoin <span class="req">*</span>', type:'textarea', required:true, placeholder:'Objectif de la mission, contexte de votre activitÃ©, rÃ©sultats attendus, contraintes particuliÃ¨resâ€¦', rows:4 },
      { id:'reqSrvDate', label:'Dates souhaitÃ©es', type:'text', placeholder:'Ex : Semaine du 10 mars, ou flexible' },
      { id:'reqSrvFormat', label:'Format prÃ©fÃ©rÃ©', type:'select', size:'half', options:['PrÃ©sentiel','Ã€ distance (visio)','Hybride'] },
      { id:'reqSrvNb', label:'Nombre de participants', type:'number', placeholder:'Ex : 15', size:'half' },
    ]
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SMART ACTION CONFIG â€” Adapte l'action, le bouton et le tunnel
// selon la catÃ©gorie du produit/service
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SMART_ACTION_CONFIG = {
  agro:        { btn:'ğŸ›’ Commander',          icon:'ğŸ“¦', tunnelTitle:'Votre commande',          step1:'DÃ©tails commande',     step2:'Paiement sÃ©curisÃ©',       step3Title:'Commande confirmÃ©e !',   step3Icon:'âœ…', step3Msg:'Votre commande a Ã©tÃ© transmise au vendeur. Vous serez contactÃ© sous 24h.', hasPayment:true,  btnNext1:'Continuer â†’',            btnNext2:'Payer & Confirmer ğŸ”’', toast:'Commande envoyÃ©e au vendeur âœ“' },
  transport:   { btn:'ğŸš› RÃ©server',           icon:'ğŸš›', tunnelTitle:'RÃ©servation transport',    step1:'DÃ©tails du trajet',    step2:'Paiement sÃ©curisÃ©',       step3Title:'RÃ©servation confirmÃ©e !',icon:'âœ…', step3Msg:'Votre rÃ©servation est enregistrÃ©e. Le transporteur vous contactera pour confirmer.', hasPayment:true, btnNext1:'Continuer â†’', btnNext2:'Payer & Confirmer ğŸ”’', toast:'RÃ©servation envoyÃ©e âœ“' },
  stockage:    { btn:'ğŸ­ RÃ©server',           icon:'ğŸ­', tunnelTitle:'RÃ©servation stockage',     step1:'DÃ©tails du stockage',  step2:'Paiement sÃ©curisÃ©',       step3Title:'RÃ©servation confirmÃ©e !',icon:'âœ…', step3Msg:'Votre demande de stockage est enregistrÃ©e. Vous serez contactÃ© sous 48h.', hasPayment:true, btnNext1:'Continuer â†’', btnNext2:'Payer & Confirmer ğŸ”’', toast:'RÃ©servation stockage confirmÃ©e âœ“' },
  digital:     { btn:'ğŸ’» Demander un devis',  icon:'ğŸ’»', tunnelTitle:'Demande de devis',         step1:'Votre brief projet',   step2:'Validation du brief',     step3Title:'Devis demandÃ© !',        step3Icon:'ğŸ“©', step3Msg:'Votre brief a Ã©tÃ© transmis au prestataire. Il vous enverra un devis dans les 48h.', hasPayment:false, btnNext1:'Envoyer mon brief â†’', btnNext2:'Confirmer l\'envoi âœ“', toast:'Brief envoyÃ© au prestataire âœ“' },
  financement: { btn:'ğŸ’° Soumettre mon dossier', icon:'ğŸ’°', tunnelTitle:'Dossier de financement', step1:'Votre dossier',     step2:'VÃ©rification dossier',    step3Title:'Dossier soumis !',       step3Icon:'ğŸ“‹', step3Msg:'Votre dossier a Ã©tÃ© transmis. Un conseiller ABAE vous contactera sous 72h.', hasPayment:false, btnNext1:'VÃ©rifier mon dossier â†’', btnNext2:'Soumettre le dossier âœ“', toast:'Dossier de financement soumis âœ“' },
  services:    { btn:'ğŸ”§ RÃ©server',           icon:'ğŸ”§', tunnelTitle:'RÃ©servation prestation',   step1:'Votre besoin',         step2:'Paiement sÃ©curisÃ©',       step3Title:'RÃ©servation confirmÃ©e !',step3Icon:'âœ…', step3Msg:'Votre rÃ©servation est envoyÃ©e. Le prestataire vous contactera sous 24h pour confirmer la date.', hasPayment:true, btnNext1:'Continuer â†’', btnNext2:'Payer & Confirmer ğŸ”’', toast:'RÃ©servation envoyÃ©e au prestataire âœ“' },
  emplois:     { btn:'ğŸ’¼ Postuler',           icon:'ğŸ’¼', tunnelTitle:'Candidature',              step1:'Votre candidature',    step2:'VÃ©rification dossier',    step3Title:'Candidature envoyÃ©e !', step3Icon:'ğŸ¯', step3Msg:'Votre candidature a Ã©tÃ© transmise au recruteur. Bonne chance !', hasPayment:false, btnNext1:'VÃ©rifier ma candidature â†’', btnNext2:'Envoyer ma candidature âœ“', toast:'Candidature envoyÃ©e ! Bonne chance ğŸ¯' },
  formation:   { btn:'ğŸ“š S\'inscrire',        icon:'ğŸ“š', tunnelTitle:'Inscription formation',    step1:'Votre inscription',    step2:'Paiement de la formation', step3Title:'Inscription confirmÃ©e !',step3Icon:'ğŸ“', step3Msg:'Votre inscription est validÃ©e. Vous recevrez les dÃ©tails pratiques par message.', hasPayment:true, btnNext1:'Continuer â†’', btnNext2:'Payer & S\'inscrire ğŸ”’', toast:'Inscription formation confirmÃ©e âœ“' },
  intrants:    { btn:'ğŸŒ± Commander',          icon:'ğŸ“¦', tunnelTitle:'Votre commande d\'intrants',step1:'DÃ©tails commande',    step2:'Paiement sÃ©curisÃ©',       step3Title:'Commande confirmÃ©e !',  step3Icon:'âœ…', step3Msg:'Commande transmise. Le vendeur vous contactera pour la livraison.', hasPayment:true, btnNext1:'Continuer â†’', btnNext2:'Payer & Confirmer ğŸ”’', toast:'Commande intrants envoyÃ©e âœ“' },
  assurance:   { btn:'ğŸ›¡ï¸ Souscrire',         icon:'ğŸ›¡ï¸', tunnelTitle:'Souscription assurance',   step1:'Votre souscription',   step2:'VÃ©rification du contrat', step3Title:'Demande soumise !',     step3Icon:'ğŸ›¡ï¸', step3Msg:'Votre demande de souscription est enregistrÃ©e. Un conseiller vous contactera sous 48h.', hasPayment:false, btnNext1:'VÃ©rifier le contrat â†’', btnNext2:'Confirmer la souscription âœ“', toast:'Demande de souscription soumise âœ“' },
};

/** Simulateur interactif dans le sheet "Comment Ã§a marche" */
function simulerCommission() {
  const input = document.getElementById('commSimInput');
  const result = document.getElementById('commSimResult');
  if (!input || !result) return;
  const amount = parseInt(input.value) || 0;
  if (amount <= 0) { result.style.display = 'none'; return; }
  const { comm, label, net } = calcABAECommission(amount);
  document.getElementById('commSimMontant').textContent = amount.toLocaleString('fr') + ' XAF';
  document.getElementById('commSimTaux').textContent    = label;
  document.getElementById('commSimComm').textContent   = 'âˆ’ ' + comm.toLocaleString('fr') + ' XAF';
  document.getElementById('commSimNet').textContent    = net.toLocaleString('fr') + ' XAF';
  result.style.display = 'block';
}

/** Retourne la config d'action pour une catÃ©gorie donnÃ©e */
function getActionCfg(cat) {
  return SMART_ACTION_CONFIG[cat] || SMART_ACTION_CONFIG['agro'];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SMART IA TOOLS CONFIG â€” 4 outils IA contextuels par catÃ©gorie
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SMART_IA_TOOLS = {
  agro: [
    { icon:'ğŸ’°', label:'Estimer le prix',   color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiPriceSheet' },
    { icon:'ğŸ¯', label:'Matching IA',        color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', sheet:'aiMatchSheet' },
    { icon:'â­', label:'Score fiabilitÃ©',    color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',    color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  intrants: [
    { icon:'ğŸ’°', label:'Estimer le prix',     color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiPriceSheet' },
    { icon:'ğŸ·ï¸', label:'VÃ©rifier conformitÃ©', color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', action:'showToast("ğŸ”¬ Analyse conformitÃ© en coursâ€¦")' },
    { icon:'â­', label:'Score fournisseur',   color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',     color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  transport: [
    { icon:'ğŸš›', label:'Optimiser trajet',   color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiLogisticsSheet' },
    { icon:'ğŸ’°', label:'Estimer le coÃ»t',    color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', sheet:'aiPriceSheet' },
    { icon:'â­', label:'Score transporteur', color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',    color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  stockage: [
    { icon:'ğŸ’°', label:'Estimer le tarif',   color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiPriceSheet' },
    { icon:'ğŸ—“ï¸', label:'VÃ©rifier dispo',     color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', action:'showToast("ğŸ“… DisponibilitÃ©s chargÃ©es par l\'IAâ€¦")' },
    { icon:'â­', label:'Score entrepÃ´t',     color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',    color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  digital: [
    { icon:'ğŸ“‹', label:'Analyser le projet', color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', action:'showToast("ğŸ§  Analyse du projet en coursâ€¦")' },
    { icon:'ğŸ’°', label:'Estimer le devis',   color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', sheet:'aiPriceSheet' },
    { icon:'â­', label:'Score prestataire',  color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',    color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  financement: [
    { icon:'ğŸ“Š', label:'Simuler prÃªt',        color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiFinancementSheet' },
    { icon:'âœ…', label:'VÃ©rifier Ã©ligibilitÃ©', color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', action:'showToast("ğŸ” Analyse Ã©ligibilitÃ© en coursâ€¦")' },
    { icon:'â­', label:'Score organisme',      color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',      color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  services: [
    { icon:'â­', label:'Score prestataire',  color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiScoreSheet' },
    { icon:'ğŸ’°', label:'Estimer le prix',    color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', sheet:'aiPriceSheet' },
    { icon:'ğŸ¯', label:'Matching IA',        color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiMatchSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',    color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  emplois: [
    { icon:'ğŸ§ ', label:'Analyser le poste',    color:'#1A5C8A', bg:'#F0F6FF', border:'#D0E4F5', sheet:'aiJobSheet' },
    { icon:'ğŸ¤', label:'PrÃ©parer entretien',   color:'#4A9E2A', bg:'#F0FAF0', border:'#C8E8C8', sheet:'aiInterviewSheet' },
    { icon:'â­', label:'Score recruteur',       color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸš¨', label:'Faux emploi ?',         color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
  formation: [
    { icon:'ğŸ“‹', label:'Voir programme',       color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiFormationSheet' },
    { icon:'â­', label:'Score formateur',       color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ’°', label:'Comparer les prix',     color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', sheet:'aiPriceSheet' },
    { icon:'ğŸ¯', label:'Cette formation pour moi ?', color:'#6B3FA0', bg:'#FAF7FD', border:'#EAE0F5', sheet:'aiMatchSheet' },
  ],
  assurance: [
    { icon:'ğŸ’°', label:'Simuler ma prime',     color:'#4A9E2A', bg:'#F7FEFA', border:'#EDF7E5', sheet:'aiAssuranceSheet' },
    { icon:'ğŸ“Š', label:'Comparer les offres',   color:'#1A5C8A', bg:'#F7F9FD', border:'#E8EEF5', action:'showToast("ğŸ“Š Comparaison en coursâ€¦")' },
    { icon:'â­', label:'Score assureur',        color:'#8A5C1A', bg:'#FDFAF7', border:'#F5EEE8', sheet:'aiScoreSheet' },
    { icon:'ğŸ”', label:'DÃ©tecter fraude',       color:'#8A1A1A', bg:'#FDF7F7', border:'#F5E8E8', sheet:'aiDetectSheet' },
  ],
};

/** GÃ©nÃ¨re la grille 2Ã—2 des outils IA contextuels */
function renderSmartIATools(cat) {
  const tools = SMART_IA_TOOLS[cat] || SMART_IA_TOOLS['agro'];
  return `<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
    ${tools.map(t => {
      const onclick = t.sheet ? `openSheet('${t.sheet}')` : t.action;
      return `<button onclick="${onclick}" style="display:flex;flex-direction:column;align-items:center;gap:5px;padding:14px 8px;border:1.5px solid ${t.border};border-radius:14px;background:${t.bg};cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.72rem;font-weight:700;color:${t.color};transition:transform 0.15s,box-shadow 0.15s;" onmousedown="this.style.transform='scale(0.96)'" onmouseup="this.style.transform=''" ontouchstart="this.style.transform='scale(0.96)'" ontouchend="this.style.transform=''">
        <span style="font-size:1.5rem;">${t.icon}</span>${t.label}
      </button>`;
    }).join('')}
  </div>`;
}

/** Commission box contextuelle : cachÃ©e pour emplois, adaptÃ©e pour les autres */
function renderDetailCommBox(p, rate, comm) {
  if (p.cat === 'emplois') {
    return `<div class="detail-section">
      <div class="comm-box" style="background:linear-gradient(135deg,#EFF8FF,#E8F5FF);border-color:rgba(26,92,138,0.15);">
        <strong style="color:#1A5C8A;">ğŸ’¼ Candidature 100% gratuite</strong>
        Postuler via ABAE ne vous coÃ»te rien. La mise en relation est sÃ©curisÃ©e et anonymisÃ©e jusqu'au premier contact.
      </div>
    </div>`;
  }
  if (p.cat === 'financement') {
    return `<div class="detail-section">
      <div class="comm-box" style="background:linear-gradient(135deg,#F0FFF4,#E8F5FF);border-color:rgba(74,158,42,0.15);">
        <strong style="color:#4A9E2A;">ğŸ“‹ Dossier gratuit Â· Aucun frais cachÃ©s</strong>
        La soumission de votre dossier est gratuite. Les frais Ã©ventuels sont dÃ©finis dans le contrat de financement.
      </div>
    </div>`;
  }
  if (p.cat === 'assurance') {
    return `<div class="detail-section">
      <div class="comm-box" style="background:linear-gradient(135deg,#F0FFF4,#FFF8E8);border-color:rgba(74,158,42,0.15);">
        <strong style="color:#4A9E2A;">ğŸ›¡ï¸ Souscription sans engagement immÃ©diat</strong>
        Votre demande est gratuite. La prime sera prÃ©cisÃ©e dans le contrat envoyÃ© par le conseiller.
      </div>
    </div>`;
  }
  return `<div class="detail-section">
    <div class="comm-box">
      <strong>ğŸ’° Commission ABAE : ${(rate*100)|0}% prÃ©levÃ©e automatiquement</strong>
      ${p.price>0?`Montant net vendeur : <strong>${(p.price-comm).toLocaleString('fr')} XAF</strong> Â· Commission : ${comm.toLocaleString('fr')} XAF`:'CalculÃ©e sur le montant convenu Ã  la livraison.'}
    </div>
  </div>`;
}

// â”€â”€ SCHEMAS COMMANDE : champs adaptatifs pour tunnel d'achat â”€â”€
const ORDER_FORM_SCHEMAS = {
  agro: {
    step1Title: 'ğŸ“¦ Votre commande',
    step1Sub: 'PrÃ©cisez votre besoin pour un traitement rapide',
    fields: [
      { id:'ordQty', label:'QuantitÃ© souhaitÃ©e <span class="req">*</span>', type:'number', placeholder:'Ex : 100', required:true, size:'half' },
      { id:'ordQtyUnit', label:'UnitÃ©', type:'select', size:'half', options:['kg','tonnes','sacs 50kg','sacs 25kg','litres','cartons','tÃªtes','lots'] },
      { id:'ordQuality', label:'QualitÃ© souhaitÃ©e', type:'select', options:['QualitÃ© standard (selon annonce)','â­â­â­ Grade A1 uniquement','â­â­ Grade A minimum','ğŸŒ¿ Bio certifiÃ© uniquement'] },
      { id:'ordDelivery', label:'Mode de rÃ©ception', type:'select', options:['Retrait sur place (chez le vendeur)','Livraison Ã  domicile','Point relais ABAE'] },
      { id:'ordDeliveryAddr', label:'Adresse de livraison', type:'text', placeholder:'Quartier, ville, point de repÃ¨reâ€¦' },
      { id:'ordNote', label:'Instructions pour le vendeur', type:'textarea', placeholder:'Conditionnement souhaitÃ©, certificats requis, date limite de livraisonâ€¦', rows:2 },
    ]
  },
  transport: {
    step1Title: 'ğŸš› RÃ©server ce transport',
    step1Sub: 'PrÃ©cisez votre trajet pour la rÃ©servation',
    fields: [
      { id:'ordTrFrom', label:'Lieu de chargement <span class="req">*</span>', type:'text', required:true, placeholder:'Ex : MarchÃ© Central, Bafoussam', size:'half' },
      { id:'ordTrTo', label:'Lieu de livraison <span class="req">*</span>', type:'text', required:true, placeholder:'Ex : Port de Douala', size:'half' },
      { id:'ordTrDate', label:'Date et heure souhaitÃ©es', type:'datetime-local', size:'half' },
      { id:'ordTrWeight', label:'Poids (kg)', type:'number', placeholder:'Ex : 2000', size:'half' },
      { id:'ordTrGoods', label:'Nature de la marchandise', type:'text', placeholder:'Ex : Sacs de cacao, matÃ©riel agricoleâ€¦' },
      { id:'ordNote', label:'Instructions de chargement', type:'textarea', placeholder:'AccÃ¨s au lieu, horaires disponibles, fragilitÃ©â€¦', rows:2 },
    ]
  },
  stockage: {
    step1Title: 'ğŸ­ RÃ©server ce stockage',
    step1Sub: 'PrÃ©cisez vos besoins de stockage',
    fields: [
      { id:'ordStStart', label:'Date de dÃ©but souhaitÃ©e', type:'date', size:'half' },
      { id:'ordStDuration', label:'DurÃ©e souhaitÃ©e', type:'select', size:'half', options:['â€” DurÃ©e â€”','1 semaine','2 semaines','1 mois','3 mois','6 mois','12 mois+','Ã€ nÃ©gocier'] },
      { id:'ordStVolume', label:'Volume Ã  stocker (tonnes)', type:'number', placeholder:'Ex : 20' },
      { id:'ordStGoods', label:'Nature des produits <span class="req">*</span>', type:'text', required:true, placeholder:'Ex : Grains de maÃ¯s, semences, produits fraisâ€¦' },
      { id:'ordStConditions', label:'Conditions particuliÃ¨res', type:'select', options:['Standard','TempÃ©rature contrÃ´lÃ©e (+4Â°C)','CongÃ©lÃ© (-18Â°C)','HumiditÃ© contrÃ´lÃ©e','Surveillance renforcÃ©e'] },
      { id:'ordNote', label:'Remarques', type:'textarea', placeholder:'Horaires d\'accÃ¨s, Ã©quipements spÃ©ciaux, contactsâ€¦', rows:2 },
    ]
  },
  digital: {
    step1Title: 'ğŸ’» Commander ce service',
    step1Sub: 'DÃ©crivez votre projet pour un devis prÃ©cis',
    fields: [
      { id:'ordDigBrief', label:'Description de votre projet <span class="req">*</span>', type:'textarea', required:true, placeholder:'Expliquez prÃ©cisÃ©ment ce que vous attendez : fonctionnalitÃ©s, design, intÃ©grations, public cible de votre solutionâ€¦', rows:4 },
      { id:'ordDigDeadline', label:'DÃ©lai souhaitÃ©', type:'select', options:['ASAP (urgent)','1 semaine','2 semaines','1 mois','Flexible'] },
      { id:'ordDigFormat', label:'Mode de prestation', type:'select', size:'half', options:['En ligne','PrÃ©sentiel','Les deux'] },
      { id:'ordDigLang', label:'Langues requises', type:'select', size:'half', options:['FranÃ§ais uniquement','Anglais uniquement','FranÃ§ais + Anglais','Autre'] },
      { id:'ordNote', label:'Ressources disponibles', type:'textarea', placeholder:'Logo, charte graphique, exemples de sites, accÃ¨s serveur existantâ€¦', rows:2 },
    ]
  },
  financement: {
    step1Title: 'ğŸ’° Demande de financement',
    step1Sub: 'Renseignez votre dossier de financement',
    fields: [
      { id:'ordFinAmount', label:'Montant souhaitÃ© (XAF) <span class="req">*</span>', type:'number', required:true, placeholder:'Ex : 3 000 000' },
      { id:'ordFinPurpose', label:'Objet du financement <span class="req">*</span>', type:'text', required:true, placeholder:'Ex : Achat semences amÃ©liorÃ©es, construction hangar de stockageâ€¦' },
      { id:'ordFinDuration', label:'DurÃ©e souhaitÃ©e', type:'select', size:'half', options:['â€” DurÃ©e â€”','6 mois','12 mois','24 mois','36 mois','Flexible'] },
      { id:'ordFinGuarantee', label:'Garantie disponible', type:'select', size:'half', options:['Aucune','Titre foncier','Caution personnelle','Nantissement rÃ©colte','MatÃ©riel existant','Ã€ discuter'] },
      { id:'ordFinActivity', label:'Votre activitÃ© agricole', type:'text', placeholder:'Ex : MaraÃ®chage, 2ha en production depuis 3 ans, revenu estimÃ© 1,5M XAF/anâ€¦' },
      { id:'ordNote', label:'Informations complÃ©mentaires', type:'textarea', placeholder:'Historique de crÃ©dit, projets en cours, besoins complÃ©mentairesâ€¦', rows:2 },
    ]
  },
  services: {
    step1Title: 'ğŸ”§ RÃ©server cette prestation',
    step1Sub: 'DÃ©crivez votre besoin pour une intervention ciblÃ©e',
    fields: [
      { id:'ordSrvBrief', label:'Votre besoin <span class="req">*</span>', type:'textarea', required:true, placeholder:'Contexte de votre activitÃ©, problÃ¨me Ã  rÃ©soudre, rÃ©sultats attendus de la prestationâ€¦', rows:4 },
      { id:'ordSrvDate', label:'Dates souhaitÃ©es', type:'text', placeholder:'Ex : Semaine du 10 mars, ou flexible', size:'half' },
      { id:'ordSrvFormat', label:'Format', type:'select', size:'half', options:['PrÃ©sentiel','Ã€ distance (visio)','Hybride'] },
      { id:'ordSrvNb', label:'Nombre de participants', type:'number', placeholder:'Ex : 15', size:'half' },
      { id:'ordSrvLoc', label:'Lieu (si prÃ©sentiel)', type:'text', placeholder:'Adresse ou quartierâ€¦', size:'half' },
      { id:'ordNote', label:'Documents Ã  partager', type:'textarea', placeholder:'Rapports, photos de terrain, donnÃ©es de productionâ€¦', rows:2 },
    ]
  },
  emplois: {
    step1Title: 'ğŸ’¼ Votre candidature',
    step1Sub: 'ComplÃ©tez votre dossier de candidature â€” Le recruteur le recevra directement',
    fields: [
      { id:'ordEmpNom', label:'Nom complet <span class="req">*</span>', type:'text', required:true, placeholder:'PrÃ©nom et Nom', size:'half' },
      { id:'ordEmpTel', label:'TÃ©lÃ©phone / WhatsApp <span class="req">*</span>', type:'tel', required:true, placeholder:'Ex : +237 6XX XXX XXX', size:'half' },
      { id:'ordEmpEmail', label:'Email', type:'email', placeholder:'votremail@example.com' },
      { id:'ordEmpNiveau', label:'Niveau d\'Ã©tudes', type:'select', options:['â€” SÃ©lectionner â€”','BEPC / CEP','BaccalaurÃ©at','BTS / DUT','Licence (Bac+3)','Master (Bac+5)','Doctorat','Autre'] },
      { id:'ordEmpExp', label:'AnnÃ©es d\'expÃ©rience dans le secteur', type:'select', size:'half', options:['Aucune (dÃ©butant)','Moins d\'1 an','1â€“2 ans','3â€“5 ans','5â€“10 ans','10+ ans'] },
      { id:'ordEmpDispo', label:'DisponibilitÃ©', type:'select', size:'half', options:['ImmÃ©diate','Sous 1 semaine','Sous 1 mois','Ã€ dÃ©finir'] },
      { id:'ordEmpMotiv', label:'Lettre de motivation <span class="req">*</span>', type:'textarea', required:true, placeholder:'PrÃ©sentez-vous briÃ¨vement : compÃ©tences clÃ©s, expÃ©riences, pourquoi ce poste vous intÃ©resseâ€¦', rows:5 },
    ]
  },
  formation: {
    step1Title: 'ğŸ“š Votre inscription',
    step1Sub: 'Inscrivez-vous Ã  cette formation â€” Places limitÃ©es',
    fields: [
      { id:'ordFormNom', label:'Nom complet <span class="req">*</span>', type:'text', required:true, placeholder:'PrÃ©nom et Nom', size:'half' },
      { id:'ordFormTel', label:'TÃ©lÃ©phone / WhatsApp <span class="req">*</span>', type:'tel', required:true, placeholder:'+237 6XX XXX XXX', size:'half' },
      { id:'ordFormEmail', label:'Email', type:'email', placeholder:'votremail@example.com' },
      { id:'ordFormNiveau', label:'Votre niveau actuel', type:'select', options:['DÃ©butant','IntermÃ©diaire','AvancÃ©','Expert'] },
      { id:'ordFormNb', label:'Nombre de participants', type:'number', placeholder:'Ex : 1', size:'half' },
      { id:'ordFormMode', label:'Mode de participation', type:'select', size:'half', options:['PrÃ©sentiel','En ligne','Hybride'] },
      { id:'ordNote', label:'Attentes ou questions particuliÃ¨res', type:'textarea', placeholder:'Ce que vous souhaitez apprendre, contraintes spÃ©cifiquesâ€¦', rows:2 },
    ]
  },
  intrants: {
    step1Title: 'ğŸŒ± Votre commande d\'intrants',
    step1Sub: 'PrÃ©cisez votre besoin pour un traitement rapide',
    fields: [
      { id:'ordIntQty', label:'QuantitÃ© souhaitÃ©e <span class="req">*</span>', type:'number', placeholder:'Ex : 100', required:true, size:'half' },
      { id:'ordIntUnit', label:'UnitÃ©', type:'select', size:'half', options:['kg','sacs','litres','boÃ®tes','cartons'] },
      { id:'ordIntDelivery', label:'Mode de rÃ©ception', type:'select', options:['Retrait sur place','Livraison Ã  domicile','Point relais ABAE'] },
      { id:'ordIntAddr', label:'Adresse de livraison', type:'text', placeholder:'Quartier, ville, point de repÃ¨reâ€¦' },
      { id:'ordNote', label:'Instructions particuliÃ¨res', type:'textarea', placeholder:'Certification requise, conditionnement souhaitÃ©, urgenceâ€¦', rows:2 },
    ]
  },
  assurance: {
    step1Title: 'ğŸ›¡ï¸ Votre souscription',
    step1Sub: 'Renseignez votre dossier â€” Un conseiller vous contactera sous 48h',
    fields: [
      { id:'ordAssurNom', label:'Nom complet <span class="req">*</span>', type:'text', required:true, placeholder:'PrÃ©nom et Nom', size:'half' },
      { id:'ordAssurTel', label:'TÃ©lÃ©phone <span class="req">*</span>', type:'tel', required:true, placeholder:'+237 6XX XXX XXX', size:'half' },
      { id:'ordAssurZone', label:'Zone gÃ©ographique', type:'text', placeholder:'Ex : RÃ©gion Centre, arrondissement de Mbalmayo' },
      { id:'ordAssurType', label:"Ce que vous souhaitez assurer", type:'select', options:['â€” Choisir â€”','ğŸŒ¾ RÃ©colte / culture','ğŸ„ Cheptel / bÃ©tail','ğŸšï¸ Infrastructure agricole','âš™ï¸ Ã‰quipements & machines','Autre'] },
      { id:'ordAssurSurface', label:'Surface ou nombre de tÃªtes', type:'text', placeholder:'Ex : 2 ha de cacao, ou 50 tÃªtes de bÃ©tail', size:'half' },
      { id:'ordAssurDebut', label:'Date de dÃ©but souhaitÃ©e', type:'date', size:'half' },
      { id:'ordNote', label:'PrÃ©cisions complÃ©mentaires', type:'textarea', placeholder:'AntÃ©cÃ©dents de sinistres, documents disponibles, besoins spÃ©cifiquesâ€¦', rows:2 },
    ]
  }
};

// â”€â”€ HELPER : gÃ©nÃ©rer le HTML d'un champ dynamique â”€â”€
function _buildField(f, prefix) {
  const id = f.id;
  const req = f.required ? ' required' : '';
  const half = f.size === 'half';
  let inner = '';
  if (f.type === 'select') {
    inner = `<select class="form-select" id="${id}" onchange="${prefix}CheckDynamic()">
      ${(f.options||[]).map(o => `<option value="${o}">${o}</option>`).join('')}
    </select>`;
  } else if (f.type === 'textarea') {
    inner = `<textarea class="form-input" id="${id}" rows="${f.rows||3}" placeholder="${f.placeholder||''}" oninput="${prefix}CheckDynamic()" style="height:auto;padding:12px;resize:none;"${req}></textarea>`;
  } else {
    inner = `<input class="form-input" type="${f.type||'text'}" id="${id}" placeholder="${f.placeholder||''}" oninput="${prefix}CheckDynamic()"${req}/>`;
  }
  return `<div class="form-row" style="${half?'flex:1;min-width:0;':''}"><div class="form-label">${f.label}${f.hint?`<span style="font-weight:400;color:var(--g400);"> â€” ${f.hint}</span>`:''}</div>${inner}</div>`;
}

// â”€â”€ Lire la valeur d'un champ (text/select/number/textarea) â”€â”€
function _fieldVal(id) {
  const el = document.getElementById(id);
  return el ? (el.value||'').trim() : '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PUBLICATION â€” Formulaire intelligent
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _pubStep = 0;
let _pubCat  = '';

function pubSelectCat(el, cat) {
  document.querySelectorAll('#pubCatGrid .pub-cat-card').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  _pubCat = cat;
  document.getElementById('pubNext0').disabled = false;
}

function renderPubFields(cat) {
  const schema = SMART_FORM_SCHEMAS[cat];
  if (!schema) return;

  // Bandeau catÃ©gorie
  document.getElementById('pubCatBannerIcon').textContent = schema.icon;
  document.getElementById('pubCatBannerLabel').textContent = schema.label;
  document.getElementById('pubCatBannerHint').textContent  = schema.hint;

  // Champs communs : titre, prix, localisation, description
  let html = `
    <div class="form-row">
      <div class="form-label">Titre de l'offre <span class="req">*</span></div>
      <input class="form-input" id="pubTitle" placeholder="${schema.titlePlaceholder}" oninput="pubCheckDynamic()"/>
    </div>
    <div class="form-row">
      <div class="form-label">${schema.priceLabel} <span class="req">*</span></div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <input class="form-input" id="pubPrice" type="number" placeholder="${schema.pricePlaceholder}" inputmode="numeric" oninput="pubCheckDynamic()" style="flex:1;min-width:100px;"/>
        <select class="form-select" id="pubPriceUnit" style="width:auto;min-width:110px;height:48px;flex-shrink:0;">
          ${schema.priceUnits.map(u=>`<option>${u}</option>`).join('')}
        </select>
        <label style="display:flex;align-items:center;gap:5px;font-size:0.78rem;font-weight:700;white-space:nowrap;cursor:pointer;">
          <input type="checkbox" id="pubOnQuote" onchange="pubToggleDevis()" style="accent-color:var(--vp);width:16px;height:16px;"/> Sur devis
        </label>
      </div>
    </div>
    <div class="form-row">
      <div class="form-label">Localisation <span class="req">*</span></div>
      <select class="form-select" id="pubLoc" onchange="pubCheckDynamic()">${CITIES_OPTIONS}</select>
    </div>`;

  // Champs spÃ©cifiques par catÃ©gorie (groupÃ©s en paires si size=half)
  const extras = schema.extras || [];
  let i = 0;
  while (i < extras.length) {
    const f = extras[i];
    if (f.size === 'half' && extras[i+1] && extras[i+1].size === 'half') {
      html += `<div style="display:flex;gap:8px;">
        ${_buildField(f,'pub')}
        ${_buildField(extras[i+1],'pub')}
      </div>`;
      i += 2;
    } else {
      html += _buildField(f,'pub');
      i++;
    }
  }

  // Description (commune)
  html += `<div class="form-row">
    <div class="form-label">Description dÃ©taillÃ©e</div>
    <textarea class="form-input" id="pubDesc" rows="3" placeholder="${schema.descPlaceholder}" style="height:auto;padding:12px;resize:none;"></textarea>
  </div>`;

  // Section photos (3 slots)
  html += `
  <div class="pub-photos-section">
    <div class="pub-photos-label">
      <span>Photos du produit / service</span>
      <span style="font-size:0.7rem;font-weight:400;color:var(--gris-400);" id="pubPhotoCount">0 / 3</span>
    </div>
    <div class="pub-photos-hint">ğŸ“¸ Ajoutez jusqu'Ã  3 photos. La 1Ã¨re sera l'image principale.</div>
    <div class="pub-photos-grid">
      <div class="pub-photo-slot" id="pubSlot0" onclick="triggerPubPhoto(0)">
        <span class="pub-photo-slot__badge">PRINCIPALE</span>
        <span class="pub-photo-slot__icon">ğŸ“·</span>
        <span class="pub-photo-slot__label">Photo<br>principale</span>
      </div>
      <div class="pub-photo-slot" id="pubSlot1" onclick="triggerPubPhoto(1)">
        <span class="pub-photo-slot__icon">â•</span>
        <span class="pub-photo-slot__label">Photo 2</span>
      </div>
      <div class="pub-photo-slot" id="pubSlot2" onclick="triggerPubPhoto(2)">
        <span class="pub-photo-slot__icon">â•</span>
        <span class="pub-photo-slot__label">Photo 3</span>
      </div>
    </div>
    <input type="file" id="pubPhotoInput0" accept="image/*" capture="environment" style="display:none" onchange="handlePubPhoto(this,0)">
    <input type="file" id="pubPhotoInput1" accept="image/*" capture="environment" style="display:none" onchange="handlePubPhoto(this,1)">
    <input type="file" id="pubPhotoInput2" accept="image/*" capture="environment" style="display:none" onchange="handlePubPhoto(this,2)">
  </div>`;

  document.getElementById('pubFieldsContainer').innerHTML = html;
  document.getElementById('pubNext1').disabled = true;
}

function pubGoStep(step) {
  if (step === 1) {
    renderPubFields(_pubCat);
  }
  if (step === 2) {
    if (!pubValidateStep1()) return;
    // Remplir rÃ©cap
    const catNames = {agro:'ğŸŒ¾ Agricole/Ã‰levage',transport:'ğŸš› Transport',stockage:'ğŸ­ Stockage',digital:'ğŸ’» Digital',financement:'ğŸ’° Financement',services:'ğŸ”§ Services',emplois:'ğŸ’¼ Emplois',formation:'ğŸ“š Formation',intrants:'ğŸŒ± Intrants',assurance:'ğŸ›¡ï¸ Assurance'};
    const isQuote  = document.getElementById('pubOnQuote')?.checked;
    const priceVal = isQuote ? 0 : (parseInt(document.getElementById('pubPrice')?.value)||0);
    const unit     = document.getElementById('pubPriceUnit')?.value||'XAF';
    const { comm: commAmt, label: commLabel } = calcABAECommission(priceVal);
    const netVal = priceVal - commAmt;
    document.getElementById('prevCat').textContent   = catNames[_pubCat]||_pubCat;
    document.getElementById('prevTitle').textContent = _fieldVal('pubTitle');
    document.getElementById('prevPrice').textContent = isQuote ? 'Sur devis' : priceVal.toLocaleString('fr')+' '+unit;
    document.getElementById('prevLoc').textContent   = _fieldVal('pubLoc');
    document.getElementById('prevComm').textContent  = isQuote ? 'CalculÃ©e Ã  la livraison' : commAmt.toLocaleString('fr')+' XAF ('+commLabel+' â€” vous recevez '+netVal.toLocaleString('fr')+' XAF)';
    // Extras rÃ©cap
    const extrasEl = document.getElementById('pubPreviewExtras');
    if (extrasEl) {
      const schema = SMART_FORM_SCHEMAS[_pubCat];
      const rows = (schema?.extras||[]).filter(f=>document.getElementById(f.id)).map(f=>{
        const val = _fieldVal(f.id);
        if (!val || val.startsWith('â€”')) return '';
        const label = f.label.replace(/<[^>]+>/g,'');
        return `<div class="pub-preview-row"><span class="pub-preview-label">${label}</span><span class="pub-preview-val">${val}</span></div>`;
      }).filter(Boolean).join('');
      // AperÃ§u photos
      const photos = _pubPhotos.filter(Boolean);
      let photosHtml = '';
      if (photos.length > 0) {
        photosHtml = `<div class="pub-preview-row" style="flex-direction:column;align-items:flex-start;gap:8px;">
          <span class="pub-preview-label">Photos (${photos.length})</span>
          <div style="display:flex;gap:6px;width:100%;">
            ${photos.map((src,i)=>`<div style="position:relative;flex:1;aspect-ratio:1;border-radius:10px;overflow:hidden;border:2px solid ${i===0?'var(--vert-principal)':'var(--gris-200)'};">
              <img src="${src}" style="width:100%;height:100%;object-fit:cover;"/>
              ${i===0?'<span style="position:absolute;bottom:3px;left:3px;background:var(--vert-principal);color:#fff;font-size:0.5rem;font-weight:800;padding:1px 5px;border-radius:4px;font-family:Sora,sans-serif;">PRINCIPALE</span>':''}
            </div>`).join('')}
          </div>
        </div>`;
      } else {
        photosHtml = `<div class="pub-preview-row"><span class="pub-preview-label">Photos</span><span class="pub-preview-val" style="color:var(--gris-400);font-style:italic;">Aucune photo ajoutÃ©e</span></div>`;
      }
      extrasEl.innerHTML = rows + photosHtml;
    }
  }
  _pubStep = step;
  document.querySelectorAll('.pub-step').forEach((s,i) => s.classList.toggle('active',i===step));
  document.querySelectorAll('.pub-step-dot').forEach((d,i) => {
    d.classList.toggle('active',i===step);
    d.classList.toggle('done',i<step);
  });
  const sb = document.querySelector('#publishSheet .sheet-body');
  if (sb) sb.scrollTop = 0;
}

function pubValidateStep1() {
  const title   = _fieldVal('pubTitle');
  const loc     = _fieldVal('pubLoc');
  const isQuote = document.getElementById('pubOnQuote')?.checked;
  const price   = _fieldVal('pubPrice');
  if (!title) { showToast('Ajoutez un titre Ã  votre offre', 'err'); return false; }
  if (!loc)   { showToast('Choisissez une localisation', 'err'); return false; }
  if (!isQuote && !price) { showToast('Indiquez un prix ou cochez "Sur devis"', 'err'); return false; }
  // Valider champs requis spÃ©cifiques
  const schema = SMART_FORM_SCHEMAS[_pubCat];
  for (const f of (schema?.extras||[])) {
    if (f.required) {
      const val = _fieldVal(f.id);
      if (!val || val.startsWith('â€”')) {
        showToast('Remplissez tous les champs obligatoires (*)', 'err');
        return false;
      }
    }
  }
  return true;
}

function pubCheckDynamic() {
  const title   = _fieldVal('pubTitle');
  const loc     = _fieldVal('pubLoc');
  const isQuote = document.getElementById('pubOnQuote')?.checked;
  const price   = _fieldVal('pubPrice');
  const btn     = document.getElementById('pubNext1');
  if (btn) btn.disabled = !title || !loc || (!isQuote && !price);
}

// RÃ©trocompatibilitÃ©
function pubCheckStep1() { pubCheckDynamic(); }

function pubToggleDevis() {
  const isQuote    = document.getElementById('pubOnQuote')?.checked;
  const priceInput = document.getElementById('pubPrice');
  if (priceInput) {
    priceInput.disabled = isQuote;
    priceInput.style.opacity = isQuote ? '0.4' : '1';
    if (isQuote) priceInput.value = '';
  }
  pubCheckDynamic();
}

function pubSubmit() {
  const isQuote = document.getElementById('pubOnQuote')?.checked;
  const price   = parseInt(document.getElementById('pubPrice')?.value)||0;
  const title   = _fieldVal('pubTitle');
  const loc     = _fieldVal('pubLoc');
  const desc    = _fieldVal('pubDesc');
  const unit    = document.getElementById('pubPriceUnit')?.value||'XAF';
  const commRates_unused = null; // remplacÃ© par calcABAECommission
  const { taux: rate } = calcABAECommission(isQuote ? 0 : price);

  // Collecte des champs extras
  const schema = SMART_FORM_SCHEMAS[_pubCat];
  const extraData = {};
  (schema?.extras||[]).forEach(f=>{ extraData[f.id] = _fieldVal(f.id); });

  // RÃ©cupÃ©rer les photos uploadÃ©es
  const uploadedImgs = _pubPhotos.filter(Boolean);
  const defaultImg = 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=500&q=75';
  const mainImg = uploadedImgs[0] || defaultImg;
  const allImgs = uploadedImgs.length > 0 ? uploadedImgs : [defaultImg];

  const newOffer = {
    id: 200+window.ABAE_MY_OFFERS.length+1,
    name: title, price: isQuote?0:price,
    priceLabel: isQuote?'Sur devis':price.toLocaleString('fr')+' '+unit,
    cat: _pubCat, loc, rating:5.0, reviews:0, verified:true, status:'active',
    img: mainImg,
    imgs: allImgs,
    seller: window.ABAE_USER_NAME||'Moi',
    desc: desc||title, isMine:true, extraData
  };
  newOffer.boost = _pubBoost || 'free';
  window.ABAE_MY_OFFERS.unshift(newOffer);
  PRODUCTS.unshift({...newOffer});
  renderMesOffres(); filterCards();
  closeSheet('publishSheet');
  const boostCost = {free:0, vedette:1500, urgent:800, pro:2500};
  const cost = boostCost[_pubBoost] || 0;
  if (cost > 0) {
    walletBalance = Math.max(0, walletBalance - cost);
    updateWalletUI();
    showToast('ğŸš€ Offre publiÃ©e + Boost activÃ© (' + cost.toLocaleString('fr') + ' XAF)', 'ok');
  } else {
    showToast('ğŸš€ Offre publiÃ©e ! Visible sur le marchÃ©', 'ok');
  }
  setTimeout(()=>{
    _pubStep=0; _pubCat=''; _pubBoost='free';
    _pubPhotos=[null,null,null];
    document.querySelectorAll('#pubCatGrid .pub-cat-card').forEach(c=>c.classList.remove('sel'));
    document.querySelectorAll('.boost-option').forEach(b=>b.classList.remove('sel'));
    const bf = document.getElementById('boost-free');
    if (bf) bf.classList.add('sel');
    if(document.getElementById('pubFieldsContainer')) document.getElementById('pubFieldsContainer').innerHTML='';
    document.getElementById('pubNext0').disabled=true;
    pubGoStep(0);
  },300);
  const statEl=document.getElementById('sellerStatOffres');
  if(statEl) statEl.textContent=window.ABAE_MY_OFFERS.filter(o=>o.status==='active').length;
}

// â”€â”€ Gestion des 3 photos de publication â”€â”€
let _pubPhotos = [null, null, null];

function triggerPubPhoto(idx) {
  const slot = document.getElementById('pubSlot'+idx);
  if (!slot) return;
  // Si une photo est dÃ©jÃ  lÃ , ne pas re-ouvrir (le delete s'en occupe)
  if (_pubPhotos[idx]) return;
  const input = document.getElementById('pubPhotoInput'+idx);
  if (input) input.click();
}

function handlePubPhoto(input, idx) {
  const file = input.files[0];
  if (!file) return;
  if (!file.type.startsWith('image/')) { showToast('Fichier invalide â€” choisissez une image', 'err'); return; }
  if (file.size > 10 * 1024 * 1024) { showToast('Image trop lourde (max 10 Mo)', 'err'); return; }

  const reader = new FileReader();
  reader.onload = function(e) {
    _pubPhotos[idx] = e.target.result;
    _renderPubPhotoSlot(idx, e.target.result);
    _updatePubPhotoCount();
    // Auto-ouvrir le slot suivant vide
    const nextEmpty = _pubPhotos.findIndex(p => !p);
    if (nextEmpty !== -1 && nextEmpty !== idx) {
      setTimeout(() => {
        const nextInput = document.getElementById('pubPhotoInput'+nextEmpty);
        // Ne pas forcer l'ouverture auto sur mobile (perturbant), juste indiquer
      }, 200);
    }
  };
  reader.readAsDataURL(file);
  // Reset input pour pouvoir re-sÃ©lectionner la mÃªme image
  input.value = '';
}

function _renderPubPhotoSlot(idx, src) {
  const slot = document.getElementById('pubSlot'+idx);
  if (!slot) return;
  const badgeHtml = idx === 0 ? '<span class="pub-photo-slot__badge">PRINCIPALE</span>' : '';
  slot.innerHTML = `
    ${badgeHtml}
    <img src="${src}" alt="Photo ${idx+1}" />
    <div class="pub-photo-slot__delete" onclick="deletePubPhoto(event,${idx})" title="Supprimer">âœ•</div>
  `;
  slot.classList.add('has-photo');
}

function deletePubPhoto(event, idx) {
  event.stopPropagation();
  _pubPhotos[idx] = null;
  const slot = document.getElementById('pubSlot'+idx);
  if (!slot) return;
  const icons = ['ğŸ“·','â•','â•'];
  const labels = ['Photo<br>principale','Photo 2','Photo 3'];
  const badgeHtml = idx === 0 ? '<span class="pub-photo-slot__badge">PRINCIPALE</span>' : '';
  slot.innerHTML = `
    ${badgeHtml}
    <span class="pub-photo-slot__icon">${icons[idx]}</span>
    <span class="pub-photo-slot__label">${labels[idx]}</span>
  `;
  slot.classList.remove('has-photo');
  slot.onclick = () => triggerPubPhoto(idx);
  _updatePubPhotoCount();

  // Si on supprime la photo principale, promouvoir la suivante
  if (idx === 0) {
    const nextPhoto = _pubPhotos.find(p => p);
    if (nextPhoto) {
      showToast('ğŸ’¡ La photo suivante devient la principale');
    }
  }
}

function _updatePubPhotoCount() {
  const count = _pubPhotos.filter(Boolean).length;
  const el = document.getElementById('pubPhotoCount');
  if (el) {
    el.textContent = count + ' / 3';
    el.style.color = count > 0 ? 'var(--vert-principal)' : 'var(--gris-400)';
    el.style.fontWeight = count > 0 ? '700' : '400';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEMANDE (REQUEST) â€” Formulaire intelligent
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _reqCat = '';

function renderReqFields(cat) {
  const schema = REQ_FORM_SCHEMAS[cat];
  if (!schema) return;

  let html = `
    <div style="background:linear-gradient(135deg,rgba(212,168,67,0.12),rgba(212,168,67,0.06));border:1px solid rgba(212,168,67,0.3);border-radius:12px;padding:10px 14px;margin-bottom:14px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:1.4rem;">${schema.icon}</span>
      <span style="font-size:0.78rem;color:#7A5A00;font-weight:600;">Vous recherchez dans : <strong>${REQ_FORM_SCHEMAS[cat] ? (SMART_FORM_SCHEMAS[cat]?.label||cat) : cat}</strong></span>
    </div>
    <div class="form-row">
      <div class="form-label">Ce que vous recherchez <span class="req">*</span></div>
      <input class="form-input" id="reqTitle" placeholder="${schema.titlePlaceholder}" oninput="reqCheckDynamic()"/>
    </div>`;

  // Champs spÃ©cifiques
  const extras = schema.extras||[];
  let i=0;
  while(i<extras.length){
    const f=extras[i];
    if(f.size==='half' && extras[i+1] && extras[i+1].size==='half'){
      html+=`<div style="display:flex;gap:8px;">${_buildField(f,'req')}${_buildField(extras[i+1],'req')}</div>`;
      i+=2;
    } else {
      html+=_buildField(f,'req');
      i++;
    }
  }

  // Budget (adaptÃ© selon catÃ©gorie)
  html+=`
    <div class="form-row">
      <div class="form-label">${schema.budgetLabel||'Budget estimÃ© (optionnel)'}</div>
      <div style="display:flex;gap:8px;align-items:center;">
        <input class="form-input" id="reqBudget" type="number" placeholder="0" inputmode="numeric" style="flex:1;"/>
        <select class="form-select" id="reqBudgetUnit" style="width:auto;min-width:90px;height:48px;flex-shrink:0;">
          <option>XAF</option><option>USD</option><option>EUR</option>
        </select>
        <label style="display:flex;align-items:center;gap:5px;font-size:0.78rem;font-weight:700;white-space:nowrap;cursor:pointer;">
          <input type="checkbox" id="reqFlexBudget" onchange="reqToggleBudget()" style="accent-color:var(--vp);width:16px;height:16px;"/> Flexible
        </label>
      </div>
    </div>
    <div class="form-row">
      <div class="form-label">Localisation <span class="req">*</span></div>
      <select class="form-select" id="reqLoc" onchange="reqCheckDynamic()">
        <option value="">â€” OÃ¹ avez-vous besoin du produit / service ? â€”</option>
        <option>YaoundÃ©, CM</option><option>Douala, CM</option><option>Bafoussam, CM</option>
        <option>NgaoundÃ©rÃ©, CM</option><option>Garoua, CM</option><option>Maroua, CM</option>
        <option>Bertoua, CM</option><option>Abidjan, CI</option><option>Dakar, SN</option>
        <option>Bamako, ML</option><option>Conakry, GN</option>
      </select>
    </div>
    <div class="form-row">
      <div class="form-label">DÃ©lai souhaitÃ©</div>
      <select class="form-select" id="reqDelay">
        <option value="">â€” Quand en avez-vous besoin ? â€”</option>
        <option value="urgent">ğŸ”´ Urgent (moins de 48h)</option>
        <option value="week">ğŸŸ¡ Cette semaine</option>
        <option value="month">ğŸŸ¢ Ce mois-ci</option>
        <option value="flexible">âšª Flexible</option>
      </select>
    </div>`;

  document.getElementById('reqFieldsContainer').innerHTML = html;
  document.getElementById('reqSubmitBtn').disabled = true;
}

function reqSelectCat(el, cat) {
  document.querySelectorAll('#reqCatGrid .pub-cat-card').forEach(c => c.classList.remove('sel'));
  if (el) el.classList.add('sel');
  _reqCat = cat;
  renderReqFields(cat);
}

function reqSelectCatFromDropdown(cat) {
  _reqCat = cat;
  if (cat) {
    renderReqFields(cat);
  } else {
    const container = document.getElementById('reqFieldsContainer');
    if (container) container.innerHTML = '';
    const btn = document.getElementById('reqSubmitBtn');
    if (btn) btn.disabled = true;
  }
}

function reqCheckDynamic() {
  const title = _fieldVal('reqTitle');
  const loc   = _fieldVal('reqLoc');
  const schema = REQ_FORM_SCHEMAS[_reqCat];
  let reqOk = true;
  for(const f of (schema?.extras||[])){
    if(f.required && !_fieldVal(f.id)){ reqOk=false; break; }
  }
  const btn = document.getElementById('reqSubmitBtn');
  if (btn) btn.disabled = !title || !loc || !reqOk;
}

// RÃ©trocompatibilitÃ©
function reqCheckForm() { reqCheckDynamic(); }

function reqToggleBudget() {
  const flex = document.getElementById('reqFlexBudget');
  const budgetInput = document.getElementById('reqBudget');
  if (budgetInput) {
    budgetInput.disabled = flex && flex.checked;
    budgetInput.style.opacity = (flex&&flex.checked)?'0.4':'1';
    if (flex&&flex.checked) budgetInput.value='';
  }
}

function reqSubmit() {
  const title  = _fieldVal('reqTitle');
  const budget = parseInt(_fieldVal('reqBudget'))||0;
  const budgetUnit = _fieldVal('reqBudgetUnit')||'XAF';
  const flex   = document.getElementById('reqFlexBudget')?.checked;
  const loc    = _fieldVal('reqLoc');
  const delay  = _fieldVal('reqDelay');
  if (!title||!loc||!_reqCat){ showToast('Remplissez les champs obligatoires (*)','err'); return; }
  const schema = REQ_FORM_SCHEMAS[_reqCat];
  for(const f of (schema?.extras||[])){
    if(f.required && !_fieldVal(f.id)){ showToast('Remplissez tous les champs obligatoires (*)','err'); return; }
  }
  const delayLabels={urgent:'ğŸ”´ Urgent',week:'ğŸŸ¡ Cette semaine',month:'ğŸŸ¢ Ce mois-ci',flexible:'âšª Flexible','':'â€”'};
  const catNames={agro:'ğŸŒ¾ Agricole',transport:'ğŸš› Transport',stockage:'ğŸ­ Stockage',digital:'ğŸ’» Digital',financement:'ğŸ’° Financement',services:'ğŸ”§ Conseil',emplois:'ğŸ’¼ Emplois',formation:'ğŸ“š Formation',intrants:'ğŸŒ± Intrants',assurance:'ğŸ›¡ï¸ Assurance'};
  const extraData={};
  (schema?.extras||[]).forEach(f=>{ extraData[f.id]=_fieldVal(f.id); });
  const newReq={
    id:300+window.ABAE_MY_REQUESTS.length+1, title:title.trim(),
    cat:_reqCat, catLabel:catNames[_reqCat]||_reqCat,
    budget:flex?'Flexible':(budget>0?budget.toLocaleString('fr')+' '+budgetUnit:'Non spÃ©cifiÃ©'),
    loc, delay:delayLabels[delay]||'â€”', status:'active',
    date:new Date().toLocaleDateString('fr-FR',{day:'2-digit',month:'short'}),
    responses:0, extraData
  };
  window.ABAE_MY_REQUESTS.unshift(newReq);
  _reqCat='';
  document.querySelectorAll('#reqCatGrid .pub-cat-card').forEach(c=>c.classList.remove('sel'));
  const reqCatSel = document.getElementById('reqCatSelect');
  if (reqCatSel) reqCatSel.value = '';
  if(document.getElementById('reqFieldsContainer')) document.getElementById('reqFieldsContainer').innerHTML='';
  if(document.getElementById('reqSubmitBtn')) document.getElementById('reqSubmitBtn').disabled=true;
  renderMesDemandes();
  closeSheet('requestSheet');
  showToast('ğŸ“¢ Demande publiÃ©e ! Les vendeurs vous contacteront','ok');
}

// Override renderCards pour afficher badge "Ma offre" et boutons vendeur
const _origRenderCards = window.renderCards;
window.renderCards = function(data) {
  const g = document.getElementById('cardsGrid');
  document.getElementById('resultCount').textContent = data.length;
  if (!data.length) {
    g.innerHTML = `<div style="text-align:center;padding:40px 20px;color:var(--g400);">
      <div style="font-size:2.5rem;margin-bottom:10px;">ğŸŒ¾</div>
      <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.88rem;color:var(--g700);margin-bottom:4px;">Aucun rÃ©sultat</div>
      <div style="font-size:0.78rem;">Essayez d'autres filtres</div></div>`;
    return;
  }
  const isSeller = canSell(window.ABAE_USER_ROLE);
  g.innerHTML = data.map((p, i) => {
    const mine = p.isMine === true;
    const sellerActions = mine && isSeller ? `
      <div class="card-seller-actions">
        <button class="card-seller-btn edit" onclick="event.stopPropagation();openEditOffer(${p.id})">âœï¸ Ã‰diter</button>
        <button class="card-seller-btn ${p.status==='active'?'pause':'edit'}" onclick="event.stopPropagation();toggleOfferStatus(${p.id})">${p.status==='active'?'â¸ï¸':'â–¶ï¸'}</button>
        <button class="card-seller-btn del" onclick="event.stopPropagation();confirmDeleteOffer(${p.id})">ğŸ—‘ï¸</button>
      </div>` : '';
    return `
    <div class="card" style="animation:fadeIn .3s ${i*50}ms both;${mine&&isSeller?'border-color:rgba(212,168,67,0.4);':''}" onclick="openDetail(${p.id})">
      <div class="card-thumb">
        <img src="${p.img}" alt="${p.name}" loading="lazy" onerror="this.style.display='none'"/>
        ${p.verified ? '<div class="badge-v">âœ“</div>' : ''}
        ${mine && isSeller ? '<div class="card-mine-badge">Ma offre</div>' : ''}
        <div class="badge-cat">${CATL[p.cat]||p.cat}</div>
        ${mine && p.status==='paused' ? '<div style="position:absolute;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;font-size:0.65rem;color:#fff;font-weight:700;">â¸ï¸ En pause</div>' : ''}
      </div>
      <div class="card-info">
        <div class="card-name">${p.name}</div>
        <div class="card-seller">${mine && isSeller ? 'ğŸ“¦ Votre offre' : p.seller}</div>
        <div class="card-loc"><svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>${p.loc}</div>
        <div class="card-row">
          <div class="card-price ${p.priceLabel.includes('devis')||p.priceLabel.includes('Taux')?'on-quote':''}">${p.priceLabel}</div>
          <div class="card-rating"><span class="star">â˜…</span> ${p.rating} <span>(${p.reviews})</span></div>
        </div>
        <div class="card-escrow">ğŸ”’ Paiement ABAE</div>
        ${sellerActions}
      </div>
    </div>`;
  }).join('');
};

// Supprimer une offre
function confirmDeleteOffer(id) {
  const o = window.ABAE_MY_OFFERS.find(x=>x.id===id);
  if (!o) return;
  if (confirm('Supprimer l\'offre "' + o.name + '" dÃ©finitivement ?')) {
    window.ABAE_MY_OFFERS = window.ABAE_MY_OFFERS.filter(x=>x.id!==id);
    const idx = PRODUCTS.findIndex(x=>x.id===id);
    if (idx > -1) PRODUCTS.splice(idx, 1);
    renderMesOffres();
    filterCards();
    showToast('ğŸ—‘ï¸ Offre supprimÃ©e', '');
  }
}

// Appliquer le rÃ´le actuel du hero au chargement
(function initRoleSystem() {
  setTimeout(() => {
    const labelEl = document.getElementById('heroProfilLabel');
    const role    = labelEl ? labelEl.textContent.toLowerCase() : 'acheteur';
    applyRoleUI(role);
  }, 600);
})();


</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ABAE SMART IA â€” Widget HTML
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Tooltip d'accueil -->
<div id="abaeIATooltip">âœ¨ Je suis ABAE Smart IA, comment puis-je vous aider ?</div>

<!-- Bouton flottant -->
<button id="abaeIABtn" onclick="toggleIAPanel()" title="ABAE Smart IA" aria-label="Ouvrir l'assistant IA">
  <span id="abaeIABadge">1</span>
  <!-- IcÃ´ne chat -->
  <img class="ia-btn-icon ia-btn-icon-chat" src="data:image/webp;base64,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" alt="ABAE" style="width:34px;height:34px;object-fit:contain;border-radius:4px;" />
  <!-- IcÃ´ne fermer -->
  <svg class="ia-btn-icon ia-btn-icon-close" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
    <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
  </svg>
</button>

<!-- Panneau chat -->
<div id="abaeIAPanel">
  <!-- Header immersif -->
  <div class="ia-panel-hdr">
    <div class="ia-avatar">
      <img src="data:image/webp;base64,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" alt="ABAE" style="width:30px;height:30px;object-fit:contain;border-radius:4px;" />
      <div class="ia-avatar-pulse"></div>
    </div>
    <div class="ia-panel-info">
      <div class="ia-panel-name-row">
<div class="ia-panel-name">ABAE Smart IA</div>
        <div class="ia-panel-sub">
          <span class="ia-panel-sub-dot"></span>
          En ligne
        </div>
      </div>
      <div class="ia-context-pill" id="iaContextPill">ğŸ  Page d'accueil</div>
    </div>
    <button class="ia-panel-close" onclick="toggleIAPanel()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>

  <!-- Messages -->
  <div class="ia-messages" id="iaMessages"></div>

  <!-- Zone de saisie -->
  <div class="ia-input-zone">
    <textarea class="ia-textarea" id="iaInput" placeholder="Posez votre questionâ€¦" rows="1"
      onkeydown="iaHandleKey(event)" oninput="iaAutoResize(this)"></textarea>
    <button class="ia-send-btn" id="iaSendBtn" onclick="iaSendMessage()" disabled>
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
      </svg>
    </button>
  </div>

  <!-- Suggestions rapides -->
  <div class="ia-suggestions" id="iaSuggestions"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE SMART IA â€” Moteur principal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
'use strict';

// â”€â”€â”€ Ã‰tat global IA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const IA = {
  open: false,
  history: [],          // [{role, content}]
  loading: false,
  tooltipShown: false,
  initialized: false,
};

// â”€â”€â”€ Contextes par page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PAGE_CONTEXTS = {
  'accueil': {
    label: 'ğŸ  Page d\'accueil',
    desc: 'L\'utilisateur est sur la page d\'accueil publique d\'ABAE.',
    suggestions: ['Comment crÃ©er un compte ?', 'Qui peut rejoindre ABAE ?', 'Comment fonctionne le portefeuille ?', 'Qu\'est-ce que l\'affiliation ?']
  },
  'inscription': {
    label: 'ğŸ“ Inscription',
    desc: "L'utilisateur est en train de s'inscrire sur ABAE (formulaire 4 Ã©tapes : profil, infos personnelles, KYC identitÃ©, sÃ©curitÃ©).",
    suggestions: ['Quels documents pour le KYC ?', 'Quelle diffÃ©rence producteur/acheteur ?', "C'est quoi un code parrainage ?", 'Mon inscription est-elle sÃ©curisÃ©e ?']
  },
  'inscription-affilie': {
    label: 'ğŸ”— Inscription AffiliÃ©',
    desc: 'L\'utilisateur s\'inscrit comme affiliÃ© ABAE pour recruter des membres et gagner des commissions.',
    suggestions: ['Comment fonctionne les commissions ?', 'Quel est le taux d\'affiliation ?', 'Comment partager mon lien ?', 'Quand reÃ§ois-je mes gains ?']
  },
  'login': {
    label: 'ğŸ” Connexion',
    desc: 'L\'utilisateur est sur la page de connexion ABAE.',
    suggestions: ['J\'ai oubliÃ© mon mot de passe', 'Connexion par tÃ©lÃ©phone ?', 'ProblÃ¨me de connexion ?', 'CrÃ©er un nouveau compte']
  },
  'marche': {
    label: 'ğŸ›’ Marketplace',
    desc: 'L\'utilisateur est dans la marketplace ABAE : il peut acheter/vendre des produits agro-pastoraux, gÃ©rer son portefeuille (dÃ©pÃ´ts, retraits, historique), et consulter ses annonces.',
    suggestions: ['Comment dÃ©poser des fonds ?', 'Comment publier une annonce ?', 'Quels sont les produits disponibles ?', 'Comment fonctionne l\'escrow ?']
  },
  'dashboard-affilie': {
    label: 'ğŸ“Š Dashboard AffiliÃ©',
    desc: 'L\'utilisateur consulte son espace affiliÃ© : filleuls, commissions, lien de recrutement.',
    suggestions: ['Comment augmenter mes filleuls ?', 'Quand mes commissions sont-elles versÃ©es ?', 'Comment copier mon lien ?', 'StratÃ©gies de recrutement']
  },
  'admin': {
    label: 'âš™ï¸ Administration',
    desc: 'L\'utilisateur est dans l\'espace administrateur ABAE.',
    suggestions: ['Analyser les performances', 'GÃ©rer les utilisateurs', 'Optimiser la plateforme', 'Rapport hebdomadaire']
  },
  'forgot': {
    label: 'ğŸ”‘ Mot de passe oubliÃ©',
    desc: 'L\'utilisateur souhaite rÃ©initialiser son mot de passe.',
    suggestions: ['Je n\'ai pas reÃ§u l\'email', 'Comment crÃ©er un bon mot de passe ?', 'Contacter le support', 'Connexion par tÃ©lÃ©phone']
  },
  'verify-email': {
    label: 'ğŸ“§ VÃ©rification email',
    desc: 'L\'utilisateur attend de vÃ©rifier son adresse email pour activer son compte.',
    suggestions: ['Je n\'ai pas reÃ§u l\'email', 'VÃ©rifier mes spams', 'Modifier mon email', 'Combien de temps Ã§a prend ?']
  },
};

// â”€â”€â”€ Prompt systÃ¨me principal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildSystemPrompt(pageId) {
  const ctx = PAGE_CONTEXTS[pageId] || { label: 'ABAE', desc: 'Application ABAE.', suggestions: [] };

  // â”€â”€ Contexte enrichi par page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const PAGE_DEEP_CONTEXT = {

    'inscription': `
=== FORMULAIRE D'INSCRIPTION ABAE â€” GUIDE COMPLET ===

Le formulaire d'inscription comporte 4 Ã©tapes :

Ã‰TAPE 1 â€” CHOIX DU PROFIL
L'utilisateur sÃ©lectionne un ou plusieurs rÃ´les (cumul possible) :
â€¢ Vendeur (ex-Producteur) : agriculteurs, Ã©leveurs, transformateurs qui vendent des produits. Peut publier des annonces, recevoir des paiements escrow.
â€¢ Acheteur : entreprises, restaurants, revendeurs, particuliers qui achÃ¨tent. Peut passer des commandes, faire des demandes ciblÃ©es.
â€¢ Transporteur : camionneurs, logisticiens qui proposent des services de transport agricole. GÃ¨re des missions de livraison.
â€¢ Partenaire : investisseurs, financeurs, ONG, institutions qui soutiennent les acteurs. AccÃ¨s aux dossiers financement.
â€¢ AffiliÃ© âœ¦ : recruteurs qui invitent des professionnels et gagnent 50% de commission sur le 1er mois d'abonnement de chaque filleul. NÃ‰CESSITE une validation manuelle par l'Ã©quipe ABAE sous 24â€“48h.
â†’ Un seul compte suffit pour tous les rÃ´les. D'autres rÃ´les peuvent Ãªtre activÃ©s aprÃ¨s inscription depuis le profil.

Ã‰TAPE 2 â€” INFORMATIONS PERSONNELLES / STRUCTURE
â€¢ Pays, rÃ©gion, ville de rÃ©sidence/activitÃ©
â€¢ Nom complet, prÃ©nom, tÃ©lÃ©phone (format +237 pour Cameroun)
â€¢ Email valide (servira pour la connexion et les notifications)
â€¢ Pour les structures : raison sociale, secteur d'activitÃ©, taille
â€¢ Code de parrainage (optionnel) : si invitÃ© par un affiliÃ© ABAE, entrer son code au format ABAE-XXXX. Cela crÃ©dite une commission Ã  l'affiliÃ©. Ce champ est FACULTATIF â€” pas obligatoire pour s'inscrire.

Ã‰TAPE 3 â€” KYC (VÃ‰RIFICATION D'IDENTITÃ‰)
Le KYC (Know Your Customer) est la vÃ©rification d'identitÃ© lÃ©gale. OBLIGATOIRE pour :
- Publier des annonces et vendre
- Effectuer des dÃ©pÃ´ts et retraits
- AccÃ©der aux fonctionnalitÃ©s de paiement
Documents acceptÃ©s (1 suffÃ®t) :
â€¢ CNI (Carte Nationale d'IdentitÃ©) â€” recto + verso
â€¢ Passeport â€” page photo
â€¢ Permis de conduire â€” recto + verso
Format acceptÃ© : JPG, PNG, PDF Â· Taille max : 5 Mo par photo
L'utilisateur peut PASSER cette Ã©tape et la complÃ©ter plus tard depuis son profil. MAIS sans KYC, il ne pourra pas vendre ni retirer de fonds.
DÃ©lai de vÃ©rification KYC : 24 Ã  72h ouvrÃ©es
SÃ©curitÃ© : documents chiffrÃ©s AES-256, jamais partagÃ©s sans consentement, conformitÃ© RGPD + loi camerounaise.

Ã‰TAPE 4 â€” SÃ‰CURITÃ‰ & MOT DE PASSE
â€¢ Mot de passe : minimum 8 caractÃ¨res, doit contenir majuscule + chiffre + caractÃ¨re spÃ©cial
â€¢ Indicateur de force : Faible / Moyen / Fort / TrÃ¨s fort
â€¢ PIN de sÃ©curitÃ© Ã  4 chiffres : pour autoriser les retraits et paiements sensibles. Ã€ ne jamais partager.
â€¢ PIN de dÃ©monstration disponible pour les tests : 1234

=== SÃ‰CURITÃ‰ & CONFIDENTIALITÃ‰ ===
â€¢ DonnÃ©es chiffrÃ©es en transit (TLS 1.3) et au repos (AES-256)
â€¢ Jamais revendues Ã  des tiers
â€¢ Compte supprimable Ã  tout moment depuis les paramÃ¨tres
â€¢ ConformitÃ© RGPD et lÃ©gislation camerounaise

=== ABONNEMENTS DISPONIBLES ===
â€¢ Plan GRATUIT : accÃ¨s de base, publication limitÃ©e, fonctionnalitÃ©s essentielles
â€¢ Plan PRO : annonces illimitÃ©es, IA avancÃ©e, prioritÃ© dans les rÃ©sultats
â€¢ Plan ENTREPRISE : multi-utilisateurs, API, gestionnaire de compte dÃ©diÃ©
â†’ L'inscription de base est GRATUITE. Les plans payants sont optionnels.

=== PROGRAMME D'AFFILIATION ===
â€¢ Taux de commission : 50% du 1er mois d'abonnement du filleul
â€¢ Paiement : sur Mobile Money (MTN / Orange) ou virement bancaire
â€¢ Seuil minimum de paiement : 5 000 XAF
â€¢ Pas d'auto-parrainage autorisÃ©
â€¢ Tableau de bord dÃ©diÃ© avec suivi des filleuls en temps rÃ©el
â€¢ Lien unique format : https://abae.africa/ref/CODE

=== FAQ FRÃ‰QUENTE INSCRIPTION ===
Q: Peut-on s'inscrire depuis n'importe quel pays ?
R: Oui, ABAE est disponible dans 14 pays d'Afrique. Cameroun est le marchÃ© principal.

Q: Mon numÃ©ro de tÃ©lÃ©phone doit-il Ãªtre camerounais ?
R: Non, tout indicatif international est acceptÃ© (+237, +242, +221, +33, etc.)

Q: Puis-je changer de profil aprÃ¨s inscription ?
R: Oui, depuis les paramÃ¨tres du profil, Ã  tout moment.

Q: Combien de temps prend l'inscription ?
R: Environ 3 minutes pour les Ã©tapes 1, 2 et 4. L'Ã©tape KYC ajoute 2 minutes.

Q: Mon email n'est pas vÃ©rifiÃ©, que faire ?
R: VÃ©rifiez vos spams/courriers indÃ©sirables. Le lien expire aprÃ¨s 24h. Un renvoi est possible depuis la page de vÃ©rification.

Q: J'ai un code de parrainage mais il est refusÃ© ?
R: VÃ©rifiez le format : ABAE-XXXX (4 lettres/chiffres aprÃ¨s le tiret). Le code doit appartenir Ã  un affiliÃ© actif.
`,

    'accueil': `
=== ABAE â€” BASE DE CONNAISSANCES COMPLÃˆTE (Page d'accueil) ===

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â“ Q: Comment crÃ©er un compte sur ABAE ?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
R: CrÃ©er un compte ABAE est simple, gratuit et prend environ 3 minutes. Voici les 4 Ã©tapes :

**Ã‰tape 1 â€” Choisissez votre profil**
SÃ©lectionnez le(s) rÃ´le(s) qui vous correspondent (plusieurs possibles sur le mÃªme compte) :
ğŸŒ¾ Vendeur â€” pour vendre des produits agro-pastoraux
ğŸ›’ Acheteur â€” pour acheter auprÃ¨s de producteurs vÃ©rifiÃ©s
ğŸš› Transporteur â€” pour proposer des services de livraison
ğŸ¤ Partenaire â€” pour investir ou financer les acteurs agricoles
ğŸ”— AffiliÃ© âœ¦ â€” pour recruter et gagner des commissions (validation sous 24-48h)

**Ã‰tape 2 â€” Vos informations personnelles**
Renseignez : pays, rÃ©gion, ville, nom complet, tÃ©lÃ©phone, email.
Pour les structures : raison sociale, secteur, taille.
Code parrainage (optionnel) : format ABAE-XXXX si invitÃ© par un affiliÃ©.

**Ã‰tape 3 â€” KYC (VÃ©rification d'identitÃ©)** *(peut Ãªtre reportÃ©e)*
Uploadez une piÃ¨ce d'identitÃ© valide : CNI (recto/verso), Passeport ou Permis.
Format : JPG, PNG, PDF â€” max 5 Mo. VÃ©rification sous 24-72h ouvrÃ©es.
âš ï¸ Sans KYC : impossible de vendre ni de retirer des fonds.

**Ã‰tape 4 â€” SÃ©curitÃ©**
CrÃ©ez un mot de passe fort (8 caractÃ¨res min, majuscule + chiffre + caractÃ¨re spÃ©cial)
+ un PIN Ã  4 chiffres pour les opÃ©rations sensibles.

âœ… AprÃ¨s inscription â†’ choisissez votre abonnement (gratuit disponible) â†’ accÃ©dez au marchÃ© !

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â“ Q: Qui peut rejoindre ABAE ?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
R: ABAE est ouvert Ã  toute personne impliquÃ©e dans la chaÃ®ne agro-pastorale, en Afrique et dans la diaspora :

ğŸ‘¨â€ğŸŒ¾ **Producteurs & Ã‰leveurs** â€” vendent cÃ©rÃ©ales, bÃ©tail, produits laitiers, maraÃ®chage
ğŸ›’ **Acheteurs** â€” entreprises agroalimentaires, restaurants, revendeurs, particuliers
ğŸš› **Transporteurs** â€” camionneurs, logisticiens, propriÃ©taires de vÃ©hicules rÃ©frigÃ©rÃ©s
ğŸ¤ **Partenaires / Investisseurs** â€” ONG, institutions financiÃ¨res, investisseurs, bailleurs
ğŸ”— **AffiliÃ©s** â€” tout professionnel souhaitant promouvoir la plateforme et gagner des commissions
ğŸ¢ **Structures & CoopÃ©ratives** â€” avec options multi-utilisateurs (Plan Entreprise)

ğŸŒ **Pays couverts** : ABAE est disponible dans 14 pays d'Afrique (Cameroun marchÃ© principal + SÃ©nÃ©gal, CÃ´te d'Ivoire, Mali, Nigeria, Gabon, Congo, etc.) et accessible depuis l'Europe/diaspora.
ğŸ“± AccÃ¨s via navigateur web (mobile ou desktop) â€” aucune application Ã  tÃ©lÃ©charger.
L'inscription de base est **entiÃ¨rement gratuite** â€” les plans payants sont optionnels.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â“ Q: Comment fonctionne le portefeuille ABAE ?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
R: Le portefeuille ABAE est votre compte financier intÃ©grÃ© pour toutes vos transactions sur la plateforme.

**ğŸ’³ DÃ©pÃ´t de fonds**
MÃ©thodes acceptÃ©es :
â€¢ MTN Mobile Money
â€¢ Orange Money
â€¢ Virement bancaire
Montant minimum : 1 000 XAF
â†’ Les fonds sont disponibles instantanÃ©ment aprÃ¨s confirmation.

**ğŸ’¸ Retrait de fonds**
MÃ©thodes : MTN Mobile Money ou Orange Money
Montant minimum : 5 000 XAF
DÃ©lai de traitement : 24 Ã  48h ouvrÃ©es
âœ… KYC obligatoire pour retirer.
ğŸ” PIN de sÃ©curitÃ© Ã  4 chiffres requis pour tout retrait.

**ğŸ”’ SystÃ¨me Escrow (paiement sÃ©curisÃ©)**
Quand vous passez une commande, le montant est **bloquÃ© en escrow** (mis en attente) dans le portefeuille.
â†’ Les fonds ne sont libÃ©rÃ©s au vendeur qu'aprÃ¨s **confirmation de livraison** par l'acheteur.
â†’ En cas de litige, l'Ã©quipe ABAE intervient sous 48h.
â†’ Commission ABAE : 3 Ã  8% selon la catÃ©gorie, dÃ©duite automatiquement.

**ğŸ“Š Historique des transactions**
Consultez toutes vos opÃ©rations : entrÃ©es, sorties, escrow, commissions â€” depuis l'onglet Portefeuille.

**ğŸ¯ Pour tester** : PIN de dÃ©monstration = 1234

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â“ Q: Qu'est-ce que l'affiliation ABAE ?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
R: Le programme d'affiliation ABAE vous permet de **gagner de l'argent en invitant d'autres professionnels** Ã  rejoindre la plateforme.

**ğŸ’° Comment Ã§a marche ?**
1. Inscrivez-vous avec le profil AffiliÃ© âœ¦ (validation manuelle sous 24-48h)
2. Recevez votre code unique personnel au format **ABAE-XXXX**
3. Partagez votre lien : https://abae.africa/ref/VOTRECODE
4. Quand un filleul souscrit un **abonnement payant**, vous recevez **50% du montant de son 1er mois**

**ğŸ“Š Exemple concret :**
â€¢ Filleul souscrit Plan Standard (1 000 XAF/mois) â†’ vous gagnez **500 XAF**
â€¢ Filleul souscrit Plan Pro (3 000 XAF/mois) â†’ vous gagnez **1 500 XAF**
â€¢ Filleul souscrit Plan Entreprise (15 000 XAF/mois) â†’ vous gagnez **7 500 XAF**

**ğŸ’³ Paiement des commissions**
â€¢ Seuil minimum de paiement : 5 000 XAF
â€¢ MÃ©thodes : MTN Mobile Money, Orange Money ou virement bancaire
â€¢ Pas d'auto-parrainage autorisÃ©

**ğŸ“ˆ Suivi en temps rÃ©el**
Tableau de bord dÃ©diÃ© avec : nombre de filleuls actifs, commissions en attente, commissions versÃ©es.

**ğŸ¯ StratÃ©gies recommandÃ©es**
â€¢ Groupes WhatsApp/Telegram agricoles
â€¢ CoopÃ©ratives et marchÃ©s agricoles locaux
â€¢ RÃ©seaux sociaux avec votre lien personnalisÃ©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ ABONNEMENTS DISPONIBLES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ± **Gratuit** â€” 0 XAF/mois (pour toujours)
  â†’ 2 annonces, prix marchÃ©, mÃ©tÃ©o, 3 requÃªtes IA/mois, messagerie

ğŸ“Š **Standard** â€” 1 000 XAF/mois (10 000 XAF/an)
  â†’ 10 annonces, 30 requÃªtes IA, prÃ©vision marchÃ©, stats basiques, pub rÃ©duite 50%

ğŸš€ **Pro** â€” 3 000 XAF/mois (30 000 XAF/an) â­ Le plus populaire
  â†’ Annonces illimitÃ©es, IA illimitÃ©e, factures auto, badge Professionnel, sans publicitÃ©, signature Ã©lectronique

ğŸ¢ **Entreprise** â€” 15 000 XAF/mois (150 000 XAF/an)
  â†’ Tout plan Pro + campagnes pub, API inclus, badge Partenaire, support prioritaire

âœ… Annulation Ã  tout moment â€” Paiement sÃ©curisÃ© â€” AdaptÃ© au Cameroun
`,

    'marche': `
=== MARKETPLACE ABAE â€” GUIDE COMPLET ===
L'utilisateur navigue dans la marketplace agro-pastorale.

FONCTIONNALITÃ‰S DISPONIBLES :
â€¢ Publier une offre : bouton "+ Publier une nouvelle offre" â†’ sÃ©lectionner catÃ©gorie, prix, photos, description, localisation
â€¢ Recherche : barre de recherche en haut, filtres par catÃ©gorie (Agro, Transport, Stockage, Digital, Financement), filtre vendeurs vÃ©rifiÃ©s
â€¢ Passer commande : cliquer sur un produit â†’ "Commander" â†’ paiement par escrow sÃ©curisÃ©
â€¢ Portefeuille : dÃ©pÃ´t via MTN Mobile Money / Orange Money, retraits sur Mobile Money
â€¢ Escrow : paiement bloquÃ© jusqu'Ã  confirmation de livraison par l'acheteur
â€¢ Mes offres : section visible pour les vendeurs, bouton Ã‰diter / Pause / Activer
â€¢ Mes demandes : pour les acheteurs, permet de publier une demande ciblÃ©e
â€¢ Smart IA : onglet dÃ©diÃ© pour analyses, prÃ©visions prix, logistique, finance, RH, projets

PRIX & COMMISSIONS :
â€¢ Commission ABAE : 3 Ã  8% selon la catÃ©gorie (dÃ©duite automatiquement)
â€¢ DÃ©pÃ´t minimum : 1 000 XAF
â€¢ Retrait minimum : 5 000 XAF
â€¢ DÃ©lai de retrait : 24 Ã  48h ouvrÃ©es

CATÃ‰GORIES DISPONIBLES :
ğŸŒ¾ Agro : cÃ©rÃ©ales, lÃ©gumes, fruits, bÃ©tail, produits laitiers, poisson
ğŸš› Transport : camions, vÃ©hicules rÃ©frigÃ©rÃ©s, motos
ğŸ­ Stockage : entrepÃ´ts, silos, chambres froides
ğŸ’» Digital : logiciels de gestion, SaaS agricole
ğŸ’° Financement : microcrÃ©dits, assurances rÃ©colte, investissement
ğŸ’¼ Emplois : offres CDI/CDD/stage dans le secteur agropastoral
ğŸ“š Formation : ateliers, certifications, coaching agricole
ğŸŒ± Intrants : semences, engrais, produits vÃ©tÃ©rinaires
ğŸ›¡ï¸ Assurance : rÃ©colte, cheptel, Ã©quipements

SÃ‰CURITÃ‰ :
â€¢ Vendeurs vÃ©rifiÃ©s KYC identifiÃ©s par un badge âœ…
â€¢ SystÃ¨me de notation et avis aprÃ¨s transaction
â€¢ Litiges traitÃ©s par l'Ã©quipe ABAE dans les 48h
`,

    'login': `
=== PAGE DE CONNEXION ABAE ===
L'utilisateur souhaite accÃ©der Ã  son compte.

OPTIONS DE CONNEXION :
â€¢ Email + mot de passe (principal)
â€¢ NumÃ©ro de tÃ©lÃ©phone + mot de passe
â€¢ RÃ©cupÃ©ration mot de passe par email

MOT DE PASSE OUBLIÃ‰ :
â€¢ Cliquer "Mot de passe oubliÃ©" sur la page de connexion
â€¢ Entrer son email â†’ recevoir un lien de rÃ©initialisation (valide 1h)
â€¢ VÃ©rifier les spams si non reÃ§u

PROBLÃˆMES COURANTS :
â€¢ Compte bloquÃ© aprÃ¨s 5 tentatives Ã©chouÃ©es â†’ attendre 15 minutes
â€¢ Email incorrect â†’ essayer avec le numÃ©ro de tÃ©lÃ©phone
â€¢ Compte non activÃ© â†’ vÃ©rifier l'email de confirmation
`,

    'dashboard-affilie': `
=== ESPACE AFFILIÃ‰ ABAE ===
L'utilisateur gÃ¨re son programme d'affiliation.

FONCTIONNEMENT :
â€¢ Chaque affiliÃ© reÃ§oit un code unique format ABAE-XXXX
â€¢ Partager le lien d'invitation : https://abae.africa/ref/CODE
â€¢ Quand un filleul souscrit un abonnement payant, l'affiliÃ© reÃ§oit 50% du montant du 1er mois
â€¢ Suivi en temps rÃ©el : filleuls actifs, commissions en attente, commissions versÃ©es

STRATÃ‰GIES DE RECRUTEMENT RECOMMANDÃ‰ES :
â€¢ Partager dans les groupes WhatsApp / Telegram agricoles
â€¢ Contacter les coopÃ©ratives agricoles locales
â€¢ PrÃ©senter ABAE lors de marchÃ©s et foires agricoles
â€¢ Publier sur les rÃ©seaux sociaux avec son lien personnalisÃ©

PAIEMENT :
â€¢ Seuil minimum : 5 000 XAF
â€¢ MÃ©thode : MTN Mobile Money, Orange Money, virement
â€¢ FrÃ©quence : paiement Ã  chaque dÃ©passement du seuil
`,
  };

  const deepCtx = PAGE_DEEP_CONTEXT[pageId] || '';

  return `Tu es ABAE Smart IA, l'assistant intelligent officiel de la plateforme ABAE â€” Marketplace Agro-Pastorale Intelligente du Cameroun et d'Afrique Centrale.

CONTEXTE ACTUEL : ${ctx.label}
${ctx.desc}

${deepCtx}

TES DOMAINES D'EXPERTISE GÃ‰NÃ‰RAUX :
â€¢ Marketplace agro-pastorale : produits agricoles, bÃ©tail, cÃ©rÃ©ales, maraÃ®chage, transformation
â€¢ Portefeuille numÃ©rique : dÃ©pÃ´ts, retraits, escrow, Mobile Money (MTN, Orange), virements
â€¢ Inscription & KYC : documents, vÃ©rification, profils (vendeur, acheteur, transporteur, partenaire, affiliÃ©)
â€¢ Programme d'affiliation : commissions 50%, recrutement, lien de parrainage, tableau de bord
â€¢ Agriculture & Ã©levage : conseils agricoles, prix du marchÃ©, saisons, bonnes pratiques
â€¢ Finance & investissement agricole : crÃ©dits, assurances, gestion de trÃ©sorerie
â€¢ Logistique & transport : livraison, stockage, chaÃ®ne du froid
â€¢ RH Agribusiness : recrutement, contrats, paie, formation (module Premium)
â€¢ Montage de projets : business plan, budget, financement, partenaires (module Premium)

RÃˆGLES DE COMPORTEMENT STRICTES :
â€¢ RÃ©ponds TOUJOURS en franÃ§ais, de faÃ§on claire, bienveillante et professionnelle
â€¢ Sois concis mais complet â€” utilise des listes si plusieurs points
â€¢ Adapte chaque rÃ©ponse au contexte exact de la page
â€¢ Utilise des emojis avec parcimonie pour rendre les rÃ©ponses plus lisibles
â€¢ Si hors pÃ©rimÃ¨tre â†’ oriente vers : support@abae.africa
â€¢ Montre de l'empathie pour les problÃ¨mes techniques ou financiers
â€¢ PIN de dÃ©monstration pour les tests de retraits : 1234
â€¢ Ne pas inventer de prix ou taux non mentionnÃ©s ci-dessus
â€¢ Ne pas prÃ©tendre avoir accÃ¨s aux donnÃ©es personnelles de l'utilisateur
â€¢ Si l'utilisateur semble bloquÃ© dans le formulaire â†’ guide-le Ã©tape par Ã©tape

Tu es le meilleur alliÃ© de chaque utilisateur ABAE. RÃ©ponds de maniÃ¨re utile, prÃ©cise et chaleureuse.`;
}

// â”€â”€â”€ DÃ©tection de page courante â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function detectCurrentPage() {
  const pages = ['inscription-affilie','verify-email','email-confirmed','dashboard-affilie','admin-login','admin','login','forgot','inscription','marche'];
  for (const p of pages) {
    const el = document.getElementById('page-' + p);
    if (el && (el.classList.contains('active') || el.style.display === 'block')) return p;
  }
  const acc = document.getElementById('page-accueil') || document.getElementById('ws-screen');
  if (acc && (acc.style.display === 'block' || !acc.classList.contains('hidden'))) return 'accueil';
  return 'accueil';
}

// â”€â”€â”€ Mise Ã  jour du contexte affichÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateIAContext() {
  const pageId = detectCurrentPage();
  const ctx = PAGE_CONTEXTS[pageId] || { label: 'ğŸ“ ABAE', suggestions: [] };
  const pill = document.getElementById('iaContextPill');
  if (pill) pill.textContent = ctx.label;
  renderSuggestions(ctx.suggestions);
}

// â”€â”€â”€ Rendu suggestions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSuggestions(suggestions) {
  const el = document.getElementById('iaSuggestions');
  if (!el) return;
  el.innerHTML = suggestions.slice(0, 4).map(s =>
    `<button class="ia-suggestion-chip" onclick="iaSendQuick('${s.replace(/'/g, "\\'")}')">
      <span>${s}</span>
    </button>`
  ).join('');
}

// â”€â”€â”€ Ouverture / fermeture du panneau â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.toggleIAPanel = function() {
  IA.open = !IA.open;
  const panel = document.getElementById('abaeIAPanel');
  const btn   = document.getElementById('abaeIABtn');
  const badge = document.getElementById('abaeIABadge');
  const tooltip = document.getElementById('abaeIATooltip');

  panel.classList.toggle('ia-visible', IA.open);
  btn.classList.toggle('ia-open', IA.open);
  if (badge) badge.style.display = 'none';
  if (tooltip) tooltip.classList.remove('show');

  if (IA.open) {
    updateIAContext();
    if (!IA.initialized) {
      IA.initialized = true;
      iaAddWelcomeMessage();
    }
    setTimeout(() => document.getElementById('iaInput')?.focus(), 350);
  }
};

// â”€â”€â”€ Message de bienvenue contextuel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function iaAddWelcomeMessage() {
  const pageId = detectCurrentPage();
  const welcomes = {
    'accueil': 'ğŸ‘‹ Bonjour ! Je suis **ABAE Smart IA**, votre assistant agro-pastoral intelligent.\n\nJe suis lÃ  pour vous aider Ã  dÃ©couvrir la plateforme, rÃ©pondre Ã  vos questions et vous guider dans toutes vos dÃ©marches. Que souhaitez-vous savoir ?',
    'inscription': "ğŸ“ Bienvenue dans le formulaire d'inscription ABAE !\n\nJe suis lÃ  pour vous guider Ã  chaque Ã©tape :\n**Ã‰tape 1** â€” Choisissez votre profil (Vendeur, Acheteur, Transporteurâ€¦)\n**Ã‰tape 2** â€” Vos informations personnelles\n**Ã‰tape 3** â€” VÃ©rification KYC (piÃ¨ce d'identitÃ©)\n**Ã‰tape 4** â€” Mot de passe & sÃ©curitÃ©\n\nPosez-moi vos questions, je rÃ©pondrai prÃ©cisÃ©ment ğŸ‘‡",
    'login': 'ğŸ” Besoin d\'aide pour vous connecter ?\n\nJe peux vous aider Ã  retrouver votre mot de passe, comprendre les diffÃ©rents profils de connexion, ou rÃ©soudre tout problÃ¨me d\'accÃ¨s.',
    'marche': 'ğŸ›’ Vous Ãªtes dans la Marketplace ABAE !\n\nJe peux vous aider Ã  **publier une annonce**, **gÃ©rer votre portefeuille**, trouver des produits, ou comprendre comment fonctionne le systÃ¨me d\'escrow sÃ©curisÃ©.',
    'dashboard-affilie': 'ğŸ“Š Bienvenue dans votre espace affiliÃ© !\n\nJe peux vous aider Ã  **maximiser vos commissions**, comprendre le suivi de vos filleuls, ou optimiser vos stratÃ©gies de recrutement.',
    'admin': 'âš™ï¸ Bonjour Administrateur !\n\nJe suis Ã  votre disposition pour analyser les performances, rÃ©pondre Ã  des questions sur la gestion de la plateforme, ou vous aider Ã  prendre des dÃ©cisions Ã©clairÃ©es.',
  };
  const msg = welcomes[pageId] || welcomes['accueil'];
  addBotMessage(msg);
}

// â”€â”€â”€ Ajout de messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addBotMessage(text) {
  const container = document.getElementById('iaMessages');
  if (!container) return;

  const now = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
  const div = document.createElement('div');
  div.className = 'ia-msg ia-bot';
  div.innerHTML = `
    <div class="ia-msg-hdr">
      <div class="ia-msg-av"><img src="data:image/webp;base64,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" alt="ABAE" style="width:22px;height:22px;object-fit:contain;border-radius:4px;"></div>
      <div class="ia-msg-sender">ABAE Smart IA</div>
    </div>
    <div class="ia-msg-bubble">${formatIAText(text)}</div>
    <div class="ia-msg-time">${now}</div>`;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

function addUserMessage(text) {
  const container = document.getElementById('iaMessages');
  if (!container) return;
  const now = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
  const div = document.createElement('div');
  div.className = 'ia-msg ia-user';
  div.innerHTML = `
    <div class="ia-msg-bubble">${escHtml(text)}</div>
    <div class="ia-msg-time">${now}</div>`;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

function addTypingIndicator() {
  const container = document.getElementById('iaMessages');
  if (!container) return;
  const div = document.createElement('div');
  div.className = 'ia-msg ia-bot ia-typing';
  div.id = 'iaTyping';
  div.innerHTML = `
    <div class="ia-msg-hdr">
      <div class="ia-msg-av"><img src="data:image/webp;base64,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" alt="ABAE" style="width:22px;height:22px;object-fit:contain;border-radius:4px;"></div>
      <div class="ia-msg-sender">ABAE Smart IA</div>
    </div>
    <div class="ia-msg-bubble">
      <div class="ia-dot"></div>
      <div class="ia-dot"></div>
      <div class="ia-dot"></div>
    </div>`;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
  return div;
}

function removeTypingIndicator() {
  const el = document.getElementById('iaTyping');
  if (el) el.remove();
}

// â”€â”€â”€ Formatage texte IA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function formatIAText(text) {
  return text
    .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/\n\n/g, '</p><p>')
    .replace(/\n/g, '<br>')
    .replace(/^/, '<p>').replace(/$/, '</p>');
}
function escHtml(t) {
  return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// â”€â”€â”€ Envoi de message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.iaSendQuick = function(text) {
  const input = document.getElementById('iaInput');
  if (input) { input.value = text; iaAutoResize(input); }
  iaSendMessage();
};

window.iaSendMessage = async function() {
  const input = document.getElementById('iaInput');
  const sendBtn = document.getElementById('iaSendBtn');
  if (!input || IA.loading) return;

  const text = input.value.trim();
  if (!text) return;

  input.value = '';
  iaAutoResize(input);
  if (sendBtn) sendBtn.disabled = true;

  addUserMessage(text);

  // Ajouter au historique
  IA.history.push({ role: 'user', content: text });

  // Limiter l'historique Ã  20 messages
  if (IA.history.length > 20) IA.history = IA.history.slice(-20);

  IA.loading = true;
  addTypingIndicator();

  // Contexte page actuelle
  const pageId = detectCurrentPage();
  const systemPrompt = buildSystemPrompt(pageId);

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: systemPrompt,
        messages: IA.history
      })
    });

    const data = await response.json();
    removeTypingIndicator();

    if (data.content && data.content[0] && data.content[0].text) {
      const reply = data.content[0].text;
      IA.history.push({ role: 'assistant', content: reply });
      addBotMessage(reply);
    } else {
      addBotMessage('Je rencontre une difficultÃ© technique momentanÃ©e. Veuillez rÃ©essayer ou contactez le support : **support@abae.africa** ğŸ™');
    }
  } catch (err) {
    removeTypingIndicator();
    addBotMessage('âš ï¸ Impossible de me connecter au serveur. VÃ©rifiez votre connexion internet et rÃ©essayez.');
  }

  IA.loading = false;
  if (sendBtn) sendBtn.disabled = false;
  setTimeout(() => input.focus(), 100);
};

// â”€â”€â”€ Auto-resize du textarea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.iaAutoResize = function(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 100) + 'px';
  const sendBtn = document.getElementById('iaSendBtn');
  if (sendBtn) sendBtn.disabled = el.value.trim().length === 0;
};

window.iaHandleKey = function(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    iaSendMessage();
  }
};

// â”€â”€â”€ Init : tooltip d'accueil (3 secondes aprÃ¨s chargement) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setTimeout(() => {
  const tooltip = document.getElementById('abaeIATooltip');
  if (tooltip && !IA.open) {
    tooltip.classList.add('show');
    setTimeout(() => tooltip.classList.remove('show'), 5000);
  }
}, 3000);

// â”€â”€â”€ Observer pour mettre Ã  jour le contexte lors des changements de page â”€â”€
const pageObserver = new MutationObserver(() => {
  if (IA.open) updateIAContext();
});
document.querySelectorAll('.page, #page-accueil').forEach(el => {
  pageObserver.observe(el, { attributes: true, attributeFilter: ['class', 'style'] });
});

// â”€â”€â”€ BanniÃ¨re contextuelle dans le chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const iaInput = document.getElementById('iaInput');
if (iaInput) {
  iaInput.addEventListener('input', function() {
    const sendBtn = document.getElementById('iaSendBtn');
    if (sendBtn) sendBtn.disabled = this.value.trim().length === 0;
  });
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ABAE SMART IA â€” JavaScript complet pour tous les modules IA
   Fonctions modulaires Â· Simulateurs intelligents Â· Anti-contournement
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â•â• Ã‰TAT GLOBAL IA â•â•
const AI_STATE = {
  plan: 'pro',       // 'basic' | 'pro' | 'premium'
  credits: 53,
  analysisCount: 8,
  selectedCreditPack: { name: 'pack150', credits: 150, price: 12000 },
  selectedUpgMethod: 'MTN Mobile Money'
};

// â•â• VÃ‰RIFICATION ABONNEMENT â•â•
function checkPlanAccess(requiredPlan) {
  const plans = { basic: 0, pro: 1, premium: 2 };
  return plans[AI_STATE.plan] >= plans[requiredPlan];
}

function showUpgradeIfNeeded(requiredPlan) {
  if (!checkPlanAccess(requiredPlan)) {
    openSheet('upgradeSheet');
    return false;
  }
  return true;
}

// â•â• UTILITAIRES IA â•â•
function fmtXAF(n) {
  return Math.round(n).toLocaleString('fr-FR') + ' XAF';
}

function aiSimDelay(minMs=1200, maxMs=2200) {
  return new Promise(r => setTimeout(r, minMs + Math.random() * (maxMs - minMs)));
}

function showAILoading(btn) {
  const orig = btn.innerHTML;
  btn.innerHTML = '<div class="ai-spinner" style="border-top-color:#fff;"></div> Analyse en coursâ€¦';
  btn.disabled = true;
  return orig;
}

function restoreAIBtn(btn, orig) {
  btn.innerHTML = orig;
  btn.disabled = false;
}

function consumeCredits(amount=1) {
  AI_STATE.credits = Math.max(0, AI_STATE.credits - amount);
  AI_STATE.analysisCount++;
  const cv = document.getElementById('smartCreditsVal');
  const cb = document.getElementById('smartCreditsBar');
  const ac = document.getElementById('smartAnalysisCount');
  if (cv) cv.textContent = AI_STATE.credits + ' / 100 crÃ©dits utilisÃ©s';
  if (cb) cb.style.width = Math.min(100, AI_STATE.credits) + '%';
  if (ac) ac.textContent = AI_STATE.analysisCount;
}

// â•â• SCROLL VERS MODULE IA â•â•
window.scrollToAiModule = function(id) {
  const el = document.getElementById(id);
  if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 1 : ESTIMATION PRIX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PRICE_DATA = {
  mais:      { min: 15000, max: 22000, trend: 'ğŸ“ˆ Hausse (+8%)', advice: 'Achetez maintenant avant la hausse de mars', cat: 'agro' },
  boeufs:    { min: 280000, max: 380000, trend: 'ğŸ“Š Stable', advice: 'Prix stables, bonne pÃ©riode pour nÃ©gocier', cat: 'agro' },
  cacao:     { min: 1600, max: 2100, trend: 'ğŸ“ˆ Hausse (+12%)', advice: 'Vendez rapidement pour profiter du pic', cat: 'agro' },
  ignames:   { min: 38000, max: 55000, trend: 'ğŸ“‰ Baisse (-5%)', advice: 'Attendez 2 semaines pour vendre au meilleur prix', cat: 'agro' },
  transport: { min: 75000, max: 120000, trend: 'ğŸ“Š Stable', advice: 'RÃ©servez en avance pour les weekends', cat: 'transport' },
  stockage:  { min: 15000, max: 35000, trend: 'ğŸ“ˆ Hausse lÃ©gÃ¨re', advice: 'Stockez maintenant avant la pleine saison', cat: 'stockage' }
};

window.runPriceEstimation = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const product = document.getElementById('priceProductType')?.value || 'mais';
  const qty = parseFloat(document.getElementById('priceQty')?.value) || 1;
  
  await aiSimDelay();
  
  const data = PRICE_DATA[product] || PRICE_DATA.mais;
  const moyPrice = (data.min + data.max) / 2;
  const totalTx = moyPrice * qty;
  const { comm: commission, label: commLabel, net: netVendeur } = calcABAECommission(totalTx);
  
  const result = document.getElementById('priceResult');
  if (result) {
    document.getElementById('priceMin').textContent = fmtXAF(data.min) + '/unitÃ©';
    document.getElementById('priceMax').textContent = fmtXAF(data.max) + '/unitÃ©';
    document.getElementById('priceMoy').textContent = fmtXAF(moyPrice) + '/unitÃ©';
    document.getElementById('priceTrend').textContent = data.trend;
    document.getElementById('priceAdvice').textContent = 'ğŸ’¡ ' + data.advice;
    
    const commCalc = document.getElementById('priceCommCalcul');
    if (commCalc && qty > 1) {
      document.getElementById('priceCommTotal').textContent = fmtXAF(totalTx);
      document.getElementById('priceCommABAE').textContent = 'âˆ’' + fmtXAF(commission) + ' (' + commLabel + ')';
      document.getElementById('priceCommNet').textContent = fmtXAF(netVendeur);
      commCalc.style.display = 'block';
    }
    result.classList.add('show');
    consumeCredits(2);
    showToast('ğŸ’° Estimation IA terminÃ©e !', 'ok');
  }
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 2 : MATCHING IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MATCH_PROFILES = {
  mais: [
    { name: 'Coop. Mvog-Be', role: 'Vendeur', loc: 'YaoundÃ©', score: 94, price: '18 500 XAF/sac' },
    { name: 'GICAM-OUEST', role: 'Vendeur', loc: 'Bafoussam', score: 87, price: '17 000 XAF/sac' },
    { name: 'Farine & Semoule Sarl', role: 'Acheteur', loc: 'Douala', score: 91, price: 'Offre : 20 000 XAF/sac' }
  ],
  boeufs: [
    { name: 'Ã‰leveur Ali Hamidou', role: 'Vendeur', loc: 'NgaoundÃ©rÃ©', score: 96, price: '300 000â€“380 000 XAF' },
    { name: 'Boucherie Modern CM', role: 'Acheteur', loc: 'YaoundÃ©', score: 89, price: 'Offre : 320 000 XAF/tÃªte' }
  ],
  cacao: [
    { name: 'Exportateurs du Sud', role: 'Vendeur', loc: 'Kribi', score: 93, price: '1 850 XAF/kg' },
    { name: 'Barry Callebaut CM', role: 'Acheteur', loc: 'Douala', score: 98, price: 'Offre : 2 000 XAF/kg' }
  ],
  transport: [
    { name: 'TransCold Sarl', role: 'Transporteur', loc: 'Douala', score: 88, price: '95 000 XAF/voyage' },
    { name: 'AfriLog Pro', role: 'Transporteur', loc: 'YaoundÃ©', score: 85, price: '88 000 XAF/voyage' }
  ],
  financement: [
    { name: 'MicroAgro Finance', role: 'Financeur', loc: 'YaoundÃ©', score: 91, price: 'Taux dÃ¨s 8%/an' },
    { name: 'BEAC AgriCredit', role: 'Financeur', loc: 'National', score: 95, price: 'Taux dÃ¨s 6.5%/an' }
  ]
};

window.runMatching = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const product = document.getElementById('matchProduct')?.value || 'mais';
  
  await aiSimDelay();
  
  const profiles = MATCH_PROFILES[product] || MATCH_PROFILES.mais;
  const matchList = document.getElementById('matchList');
  const result = document.getElementById('matchResult');
  
  if (matchList && result) {
    matchList.innerHTML = '';
    profiles.forEach((p, i) => {
      const color = p.score >= 90 ? '#4A9E2A' : p.score >= 80 ? '#D4A843' : '#9BA3AE';
      matchList.innerHTML += `
        <div style="background:#f7f8f9;border-radius:10px;padding:10px 12px;border:1px solid #eaecef;display:flex;align-items:center;gap:10px;">
          <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#4A9E2A,#2A5E10);display:flex;align-items:center;justify-content:center;color:#fff;font-size:0.8rem;font-weight:700;flex-shrink:0;">${p.score}</div>
          <div style="flex:1;">
            <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.8rem;color:#1A1E25;">${p.name}</div>
            <div style="font-size:0.68rem;color:#9BA3AE;">${p.role} Â· ${p.loc} Â· ${p.price}</div>
          </div>
          <button class="phone-unlock-btn" onclick="showToast('Transaction initiÃ©e avec ${p.name}', 'ok')" style="font-size:0.62rem;">Contacter</button>
        </div>
      `;
    });
    result.classList.add('show');
    consumeCredits(3);
    showToast('ğŸ¯ ' + profiles.length + ' profils trouvÃ©s !', 'ok');
  }
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 3 : SCORE FIABILITÃ‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ACTOR_SCORES = {
  coop:         { score: 88, tx: '47', rating: '4.3/5', delays: '94%', kyc: 'âœ… VÃ©rifiÃ©', reco: 'Fiable Â· RecommandÃ© pour achats rÃ©guliers', phone: '+237 222 XX XX XX' },
  ali:          { score: 96, tx: '31', rating: '4.8/5', delays: '100%', kyc: 'âœ… VÃ©rifiÃ©', reco: 'Excellente rÃ©putation Â· PrioritÃ© haute', phone: '+237 677 XX XX XX' },
  transcold:    { score: 82, tx: '89', rating: '4.1/5', delays: '87%', kyc: 'âœ… VÃ©rifiÃ©', reco: 'Bon transporteur Â· VÃ©rifiez les dÃ©lais contractuels', phone: '+237 699 XX XX XX' },
  microagro:    { score: 91, tx: '156', rating: '4.2/5', delays: '95%', kyc: 'âœ… VÃ©rifiÃ©', reco: 'Institution fiable Â· Conditions transparentes', phone: '+237 233 XX XX XX' },
  exportateurs: { score: 93, tx: '22', rating: '4.7/5', delays: '98%', kyc: 'âœ… VÃ©rifiÃ©', reco: 'Acteur premium Â· RecommandÃ© pour l\'export', phone: '+237 688 XX XX XX' }
};

window.runScoreAnalysis = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const actor = document.getElementById('scoreActorSelect')?.value || 'coop';
  
  await aiSimDelay();
  
  const data = ACTOR_SCORES[actor] || ACTOR_SCORES.coop;
  
  document.getElementById('scoreCircleVal').textContent = data.score;
  document.getElementById('scoreLabel').textContent = 'Score fiabilitÃ© ABAE / 100';
  document.getElementById('scoreTx').textContent = data.tx + ' transactions';
  document.getElementById('scoreRating').textContent = data.rating;
  document.getElementById('scoreDelays').textContent = data.delays + ' dans les dÃ©lais';
  document.getElementById('scoreKyc').textContent = data.kyc;
  document.getElementById('scoreReco').textContent = 'ğŸ’¡ ' + data.reco;
  
  // Stocker le phone pour dÃ©blocage
  const maskedContact = document.getElementById('maskedContact');
  if (maskedContact) maskedContact.dataset.phone = data.phone;
  
  document.getElementById('scoreResult')?.classList.add('show');
  consumeCredits(2);
  showToast('â­ Score analysÃ© : ' + data.score + '/100', 'ok');
  restoreAIBtn(btn, orig);
};

// DÃ©bloquer contact aprÃ¨s paiement
window.unlockContact = function() {
  const maskedContact = document.getElementById('maskedContact');
  const phone = maskedContact?.dataset.phone || '+237 6XX XXX XXX';
  
  // Simulation vÃ©rification paiement
  showToast('ğŸ”’ VÃ©rification paiement en coursâ€¦');
  setTimeout(() => {
    maskedContact.style.display = 'none';
    document.getElementById('contactPhone').textContent = phone;
    document.getElementById('unlockedContact').style.display = 'block';
    showToast('âœ… Contact dÃ©bloquÃ© ! Transaction sÃ©curisÃ©e.', 'ok');
    consumeCredits(1);
  }, 1500);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 4 : DÃ‰TECTION FRAUDE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.runDetection = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const price = parseFloat(document.getElementById('detectPrice')?.value) || 0;
  const desc = document.getElementById('detectDescription')?.value || '';
  
  await aiSimDelay();
  
  // Logique de dÃ©tection (simulation IA)
  let riskScore = 0;
  let alerts = [];
  
  if (price < 1000 && price > 0) { riskScore += 40; alerts.push('Prix anormalement bas'); }
  if (price > 5000000) { riskScore += 20; alerts.push('Prix trÃ¨s Ã©levÃ© â€” vÃ©rifiez'); }
  if (desc.toLowerCase().includes('western union') || desc.toLowerCase().includes('western')) { riskScore += 60; alerts.push('MÃ©thode de paiement externe mentionnÃ©e'); }
  if (desc.toLowerCase().includes('avance') || desc.toLowerCase().includes('urgent')) { riskScore += 30; alerts.push('Pression urgence dÃ©tectÃ©e'); }
  if (!desc || desc.length < 20) { riskScore += 15; alerts.push('Description trop courte'); }
  
  let level, text, reco, color;
  if (riskScore >= 60) {
    level = 'ğŸ”´'; text = 'RISQUE Ã‰LEVÃ‰'; reco = 'Ne procÃ©dez pas Ã  cette transaction. Signalez Ã  ABAE.';
    document.getElementById('detectFraudProb').className = 'ai-result-value danger';
    document.getElementById('detectFraudProb').textContent = riskScore + '% probabilitÃ© fraude';
  } else if (riskScore >= 30) {
    level = 'ğŸŸ¡'; text = 'RISQUE MODÃ‰RÃ‰'; reco = 'ProcÃ©dez avec prudence. Exigez toutes les garanties ABAE.';
    document.getElementById('detectFraudProb').className = 'ai-result-value warn';
    document.getElementById('detectFraudProb').textContent = riskScore + '% probabilitÃ© fraude';
  } else {
    level = 'ğŸŸ¢'; text = 'RISQUE FAIBLE'; reco = 'Offre semble lÃ©gitime. Utilisez l\'escrow ABAE pour la sÃ©curitÃ©.';
    document.getElementById('detectFraudProb').className = 'ai-result-value good';
    document.getElementById('detectFraudProb').textContent = riskScore + '% probabilitÃ© fraude';
  }
  
  document.getElementById('detectRiskLevel').textContent = level;
  document.getElementById('detectRiskText').textContent = text;
  document.getElementById('detectPriceOk').textContent = (price > 1000 && price < 5000000) ? 'âœ… CohÃ©rent' : 'âš ï¸ Ã€ vÃ©rifier';
  document.getElementById('detectAlerts').textContent = alerts.length > 0 ? alerts.join(' Â· ') : 'Aucun signal suspect dÃ©tectÃ©';
  document.getElementById('detectReco').textContent = 'ğŸ’¡ ' + reco;
  
  document.getElementById('detectResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ” Analyse sÃ©curitÃ© terminÃ©e', 'ok');
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SMART IA â€” NOUVEAUX MODULES CONTEXTUELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ EMPLOIS : Analyser le poste â”€â”€
window.runJobAnalysis = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const niveau = document.getElementById('jobNiveau')?.value || 'junior';

  await aiSimDelay();

  const scores = { debutant:62, junior:78, confirme:88, senior:72 };
  const competences = { debutant:'Travail en Ã©quipe, polyvalence, formation', junior:'Techniques agro., rapports, autonomie', confirme:'Management terrain, analyse rÃ©sultats', senior:'StratÃ©gie, leadership, gestion budgets' };
  const concurrences = { debutant:'ğŸŸ  Moyenne', junior:'ğŸŸ¡ ModÃ©rÃ©e', confirme:'ğŸŸ¢ Faible', senior:'ğŸŸ¡ ModÃ©rÃ©e' };
  const conseils = { debutant:'Mettez en avant votre motivation et votre capacitÃ© d\'apprentissage.', junior:'PrÃ©sentez 2â€“3 rÃ©alisations chiffrÃ©es de vos missions passÃ©es.', confirme:'Insistez sur vos rÃ©sultats mesurables et votre leadership terrain.', senior:'Positionnez-vous sur la valeur ajoutÃ©e stratÃ©gique que vous apportez.' };

  document.getElementById('jobMatchScore').textContent = scores[niveau] + '%';
  document.getElementById('jobSalaire').textContent = niveau === 'debutant' ? '80 000â€“120 000 XAF/mois' : niveau === 'junior' ? '120 000â€“200 000 XAF' : niveau === 'confirme' ? '200 000â€“400 000 XAF' : '350 000â€“700 000 XAF';
  document.getElementById('jobCompetences').textContent = competences[niveau];
  document.getElementById('jobConcurrence').textContent = concurrences[niveau];
  document.getElementById('jobConseil').textContent = 'ğŸ’¡ ' + conseils[niveau];

  document.getElementById('jobAnalysisResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ§  Analyse du poste terminÃ©e', 'ok');
  restoreAIBtn(btn, orig);
};

// â”€â”€ EMPLOIS : PrÃ©parer entretien â”€â”€
window.runInterviewPrep = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const poste = document.getElementById('interviewPoste')?.value || 'Technicien';

  await aiSimDelay();

  const questions = [
    'â“ Parlez-moi d\'une situation difficile que vous avez gÃ©rÃ©e sur le terrain.',
    'â“ Quels sont vos principales compÃ©tences techniques dans ce domaine ?',
    'â“ Pourquoi avez-vous choisi le secteur agro-pastoral ?',
    'â“ Comment gÃ©rez-vous les dÃ©lais serrÃ©s et la pression ?',
    'â“ Donnez un exemple de problÃ¨me technique que vous avez rÃ©solu seul.',
  ];
  const tips = { 'Technicien agricole': 'Montrez votre connaissance des variÃ©tÃ©s locales et des techniques de culture.', 'Chauffeur / Logisticien': 'Mettez en avant votre connaissance des routes et votre sens des responsabilitÃ©s.', 'Comptable / Gestionnaire': 'PrÃ©parez des exemples chiffrÃ©s de vos rÃ©alisations financiÃ¨res.' };
  const tip = tips[poste] || 'PrÃ©parez 3 exemples concrets de vos rÃ©alisations passÃ©es.';

  const qZone = document.getElementById('interviewQuestions');
  if (qZone) qZone.innerHTML = questions.map(q => `<div style="background:#F7F9FD;border:1px solid #D0E0F0;border-radius:10px;padding:10px 12px;font-size:0.78rem;color:#1A5C8A;font-weight:600;">${q}</div>`).join('');
  document.getElementById('interviewTip').textContent = 'ğŸ’¡ ' + tip;
  document.getElementById('interviewWarn').textContent = 'âš ï¸ Ã‰vitez de critiquer vos anciens employeurs.';

  document.getElementById('interviewResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ¤ Kit entretien gÃ©nÃ©rÃ© !', 'ok');
  restoreAIBtn(btn, orig);
};

// â”€â”€ FORMATION : Analyser la formation â”€â”€
window.runFormationAnalysis = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);

  await aiSimDelay();

  const score = 72 + Math.floor(Math.random() * 22);
  const qp = score >= 80 ? 'âœ… Excellent' : score >= 65 ? 'ğŸ‘ Bon' : 'âš ï¸ Correct';

  document.getElementById('formScore').textContent = score + '/100';
  document.getElementById('formQP').textContent = qp + ` (${score >= 80 ? 'trÃ¨s rentable' : 'acceptable'})`;
  document.getElementById('formAdeq').textContent = 'âœ… Correspond Ã  votre profil';
  document.getElementById('formPlus').textContent = 'âœ… Intervenant certifiÃ© Â· Attestation reconnue Â· Pratique terrain';
  document.getElementById('formMinus').textContent = 'âš ï¸ VÃ©rifiez la rÃ©putation du formateur Â· Demandez les tÃ©moignages';
  document.getElementById('formReco').textContent = score >= 70 ? 'ğŸ’¡ Formation recommandÃ©e par ABAE Smart IA.' : 'ğŸ’¡ Comparez avec d\'autres formations avant de vous inscrire.';

  document.getElementById('formationResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ“‹ Analyse formation terminÃ©e', 'ok');
  restoreAIBtn(btn, orig);
};

// â”€â”€ ASSURANCE : Simuler la prime â”€â”€
window.runAssuranceSimulation = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const type = document.getElementById('assurType')?.value || 'recolte';
  const surface = parseFloat(document.getElementById('assurSurface')?.value) || 1;
  const region = document.getElementById('assurRegion')?.value || '';

  await aiSimDelay();

  const tauxBase = { recolte:15000, betail:8000, infra:25000, equip:18000 };
  const risqueRegion = region.includes('Nord') || region.includes('Est') ? 1.4 : 1.0;
  const prime = Math.round(tauxBase[type] * surface * risqueRegion);
  const couv = Math.round(prime * 12);
  const risque = risqueRegion > 1.2 ? 'ğŸ”´ Ã‰levÃ© (zone Ã  risque climatique)' : 'ğŸŸ¢ ModÃ©rÃ©';

  document.getElementById('assurPrime').textContent = prime.toLocaleString('fr') + ' XAF/an';
  document.getElementById('assurCouv').textContent = couv.toLocaleString('fr') + ' XAF';
  document.getElementById('assurRisque').textContent = risque;
  document.getElementById('assurConseil').textContent = risqueRegion > 1.2 ? 'ğŸ’¡ Zone Ã  risque : optez pour une couverture multirisque complÃ¨te.' : 'ğŸ’¡ Bonne couverture de base recommandÃ©e pour votre activitÃ©.';

  document.getElementById('assuranceResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ›¡ï¸ Simulation prime terminÃ©e', 'ok');
  restoreAIBtn(btn, orig);
};

// â”€â”€ FINANCEMENT : Simuler prÃªt â”€â”€
window.runFinancementSimulation = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const montant = parseFloat(document.getElementById('finMontant')?.value) || 0;
  const duree = parseInt(document.getElementById('finDuree')?.value) || 12;
  const revenu = parseFloat(document.getElementById('finRevenu')?.value) || 0;

  await aiSimDelay();

  if (!montant || montant < 50000) {
    showToast('âš ï¸ Veuillez entrer un montant valide', 'warn');
    restoreAIBtn(btn, orig); return;
  }
  const taux = 0.015; // 1.5% mensuel
  const mensual = Math.round(montant * (taux * Math.pow(1+taux, duree)) / (Math.pow(1+taux, duree) - 1));
  const total = mensual * duree;
  const effort = revenu > 0 ? Math.round((mensual / revenu) * 100) : null;

  document.getElementById('finMensual').textContent = mensual.toLocaleString('fr') + ' XAF/mois';
  document.getElementById('finTotal').textContent = total.toLocaleString('fr') + ' XAF';
  document.getElementById('finEffort').textContent = effort ? (effort + '% de vos revenus ' + (effort <= 33 ? 'âœ… Acceptable' : effort <= 50 ? 'âš ï¸ Ã‰levÃ©' : 'ğŸ”´ Trop Ã©levÃ©')) : 'â€” (revenu non renseignÃ©)';
  document.getElementById('finElig').textContent = !effort || effort <= 40 ? 'âœ… Probablement Ã©ligible' : 'âš ï¸ DifficultÃ© potentielle â€” rÃ©duisez le montant';
  document.getElementById('finConseil').textContent = effort && effort > 40 ? 'ğŸ’¡ RÃ©duisez le montant ou augmentez la durÃ©e.' : 'ğŸ’¡ Profil compatible avec les offres de microfinance ABAE.';

  document.getElementById('financementResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ“Š Simulation financement terminÃ©e', 'ok');
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 5 : ANALYSE MARCHÃ‰ COMPLÃˆTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.runFullMarketAnalysis = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  
  await aiSimDelay(1500, 2500);
  
  document.getElementById('aiMarketAvgPrice').textContent = '18 500 XAF/sac maÃ¯s Â· 1 850 XAF/kg cacao';
  document.getElementById('aiMarketTrend').textContent = 'ğŸ“ˆ Hausse gÃ©nÃ©rale +8% ce mois';
  document.getElementById('aiMarketOpportunity').textContent = 'ğŸ¯ Cacao grade A â€” 3 acheteurs actifs';
  document.getElementById('aiMarketRisks').textContent = 'âš ï¸ PÃ©nurie transport frigorifique';
  document.getElementById('aiMarketReco').textContent = 'ğŸ’¡ Achetez maÃ¯s maintenant, vendez cacao sous 2 semaines';
  
  document.getElementById('fullMarketResult')?.classList.add('show');
  consumeCredits(5);
  showToast('âœ¨ Analyse complÃ¨te terminÃ©e !', 'ok');
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 6 : LOGISTIQUE IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TRAJET_DATA = {
  'YaoundÃ©-Douala': { dist: 250, time: '3â€“4h', cost: 85000, vehicle: 'ğŸš› Camion 10T ou ğŸš Fourgon 3T' },
  'YaoundÃ©-Bafoussam': { dist: 350, time: '5â€“6h', cost: 110000, vehicle: 'ğŸš› Camion 15T' },
  'NgaoundÃ©rÃ©-YaoundÃ©': { dist: 580, time: '8â€“10h', cost: 175000, vehicle: 'ğŸš› Semi-remorque' },
  'Douala-Kribi': { dist: 180, time: '2â€“3h', cost: 65000, vehicle: 'ğŸš Fourgon ou petit camion' },
  'default': { dist: 300, time: '4â€“5h', cost: 95000, vehicle: 'ğŸš› Camion standard' }
};

function switchLogTab(n) {
  [1,2,3].forEach(i => {
    const tab = document.getElementById('logTab'+i);
    const content = document.getElementById('logTabContent'+i);
    if (tab) tab.className = 'tab' + (i === n ? ' active' : '');
    if (content) content.style.display = i === n ? 'block' : 'none';
  });
}

window.switchLogTab = switchLogTab;

window.runLogisticsOptimization = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const from = document.getElementById('logFrom')?.value || 'YaoundÃ©';
  const to = document.getElementById('logTo')?.value || 'Douala';
  const weight = parseFloat(document.getElementById('logWeight')?.value) || 1000;
  const goodsType = document.getElementById('logGoodsType')?.value || 'agro';
  
  await aiSimDelay();
  
  const key = from + '-' + to;
  const data = TRAJET_DATA[key] || TRAJET_DATA.default;
  const costMult = weight > 10000 ? 1.4 : weight > 5000 ? 1.2 : 1;
  const finalCost = Math.round(data.cost * costMult);
  let vehicle = data.vehicle;
  if (goodsType === 'frigo') vehicle = 'â„ï¸ Camion frigorifique 0â€“8Â°C';
  if (goodsType === 'betail') vehicle = 'ğŸ„ Camion bÃ©taillÃ¨re ventilÃ©';
  
  document.getElementById('logDistance').textContent = data.dist + ' km';
  document.getElementById('logDuration').textContent = data.time;
  document.getElementById('logVehicle').textContent = vehicle;
  document.getElementById('logCost').textContent = fmtXAF(finalCost);
  document.getElementById('logRoute').textContent = from + ' â†’ ' + (from !== to ? to : 'Destination') + ' (route nationale prioritaire)';
  
  document.getElementById('logisticsResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸš› Trajet optimisÃ© !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runCostCalculation = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const goodsValue = parseFloat(document.getElementById('logGoodsValue')?.value) || 500000;
  const distKm = parseFloat(document.getElementById('logDistKm')?.value) || 250;
  const insurance = document.getElementById('logInsurance')?.value || 'none';
  
  await aiSimDelay(800, 1500);
  
  const transport = Math.round(distKm * 380);
  const handling = Math.round(transport * 0.12);
  const insRate = insurance === 'basic' ? 0.01 : insurance === 'full' ? 0.025 : 0;
  const insuranceCost = Math.round(goodsValue * insRate);
  const abaeComm = Math.round(goodsValue * 0.07);
  const total = transport + handling + insuranceCost + abaeComm;
  
  document.getElementById('costTransport').textContent = fmtXAF(transport);
  document.getElementById('costHandling').textContent = fmtXAF(handling);
  document.getElementById('costInsurance').textContent = insuranceCost > 0 ? fmtXAF(insuranceCost) : '0 XAF';
  document.getElementById('costAbae').textContent = 'âˆ’' + fmtXAF(abaeComm) + ' (7% auto-prÃ©levÃ©)';
  document.getElementById('costTotal').textContent = fmtXAF(total);
  
  document.getElementById('costResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ’° CoÃ»ts calculÃ©s !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runGroupage = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const route = document.getElementById('groupageRoute')?.value || 'YaoundÃ© â†’ Douala';
  
  await aiSimDelay();
  
  const partners = [
    { name: 'Coop. Farine Mvog', vol: '3mÂ³', saving: '38%', depart: 'Demain 6h' },
    { name: 'AgroTech CM', vol: '2mÂ³', saving: '32%', depart: 'AprÃ¨s-demain 8h' }
  ];
  
  const list = document.getElementById('groupageList');
  if (list) {
    list.innerHTML = '';
    partners.forEach(p => {
      list.innerHTML += `
        <div style="background:#fff;border:1px solid #eaecef;border-radius:10px;padding:10px 12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
            <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.8rem;">${p.name}</div>
            <div style="background:#EDF7E5;color:#4A9E2A;font-size:0.65rem;font-weight:700;padding:3px 8px;border-radius:10px;">âˆ’${p.saving}</div>
          </div>
          <div style="font-size:0.68rem;color:#9BA3AE;">ğŸ“¦ Volume partagÃ©: ${p.vol} Â· ğŸ• DÃ©part: ${p.depart}</div>
          <button class="ai-mini-btn" style="margin-top:8px;width:100%;" onclick="showToast('Demande de groupage envoyÃ©e Ã  ${p.name} !', 'ok')">Rejoindre ce groupage â†’</button>
        </div>
      `;
    });
    document.getElementById('groupageResult')?.classList.add('show');
    consumeCredits(2);
    showToast('ğŸ”— ' + partners.length + ' groupages trouvÃ©s !', 'ok');
  }
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 7 : FINANCE IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchFinTab(n) {
  [1,2,3].forEach(i => {
    const tab = document.getElementById('finTab'+i);
    const content = document.getElementById('finTabContent'+i);
    if (tab) tab.className = 'tab' + (i === n ? ' active' : '');
    if (content) content.style.display = i === n ? 'block' : 'none';
  });
}
window.switchFinTab = switchFinTab;

window.runCreditScoring = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const age = parseInt(document.getElementById('creditAge')?.value) || 3;
  const ca = parseFloat(document.getElementById('creditCA')?.value) || 2000000;
  const txCount = parseInt(document.getElementById('creditTx')?.value) || 5;
  
  await aiSimDelay();
  
  // Algorithme de scoring simplifiÃ©
  let score = 400;
  score += Math.min(age * 25, 150);
  score += Math.min(ca / 50000, 150);
  score += Math.min(txCount * 10, 100);
  score = Math.min(850, Math.max(300, Math.round(score)));
  
  const maxLoan = Math.round(ca * 0.6);
  const rate = score > 700 ? '8%' : score > 600 ? '10%' : '12â€“15%';
  const partners = score > 700 ? 'MicroAgro Finance Â· BEAC AgriCredit Â· Orange Bank' : 'MicroAgro Finance Â· Coop. de crÃ©dit locale';
  const reco = score > 700 ? 'Excellent profil â€” accÃ¨s facilitÃ© au crÃ©dit' : score > 550 ? 'Bon profil â€” prÃ©sentez votre historique ABAE' : 'Renforcez votre activitÃ© et vos transactions avant de demander un crÃ©dit';
  let scoreClass = score > 700 ? 'Excellent' : score > 600 ? 'Bon' : score > 500 ? 'Acceptable' : 'Ã€ amÃ©liorer';
  
  document.getElementById('creditScoreVal').textContent = score;
  document.getElementById('creditAmount').textContent = fmtXAF(maxLoan);
  document.getElementById('creditRate').textContent = rate + ' / an';
  document.getElementById('creditPartners').textContent = partners;
  document.getElementById('creditReco').textContent = 'ğŸ’¡ ' + reco;
  
  document.getElementById('creditResult')?.classList.add('show');
  consumeCredits(3);
  showToast('ğŸ¦ Score crÃ©dit calculÃ© : ' + score + '/850 (' + scoreClass + ')', 'ok');
  restoreAIBtn(btn, orig);
};

window.runFinancingSimulation = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const amount = parseFloat(document.getElementById('finAmount')?.value) || 1000000;
  const duration = parseInt(document.getElementById('finDuration')?.value) || 12;
  const purpose = document.getElementById('finPurpose')?.value || 'equipement';
  
  await aiSimDelay(800, 1500);
  
  const rate = purpose === 'fonds' ? 0.12 : purpose === 'intrants' ? 0.09 : 0.10;
  const monthlyRate = rate / 12;
  const monthly = Math.round(amount * monthlyRate * Math.pow(1+monthlyRate, duration) / (Math.pow(1+monthlyRate, duration) - 1));
  const totalCost = monthly * duration - amount;
  const orgs = { equipement: 'MicroAgro Finance Â· Orange Bank', intrants: 'BEAC AgriCredit Â· Coop. CrÃ©dit', terrain: 'BEAC Â· SCB', fonds: 'MicroAgro Finance' };
  
  document.getElementById('finSimAmount').textContent = fmtXAF(amount);
  document.getElementById('finSimRate').textContent = (rate * 100).toFixed(0) + '% / an';
  document.getElementById('finSimMonthly').textContent = fmtXAF(monthly) + '/mois';
  document.getElementById('finSimTotalCost').textContent = fmtXAF(totalCost) + ' (intÃ©rÃªts)';
  document.getElementById('finSimOrg').textContent = orgs[purpose] || 'MicroAgro Finance';
  
  document.getElementById('finSimResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ’° Simulation financement terminÃ©e !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runRentabilityAnalysis = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const invest = parseFloat(document.getElementById('rentInvest')?.value) || 1000000;
  const ca = parseFloat(document.getElementById('rentCA')?.value) || 2000000;
  const charges = parseFloat(document.getElementById('rentCharges')?.value) || 500000;
  
  await aiSimDelay(800, 1500);
  
  const margeBrute = ca - charges;
  const netResult = margeBrute;
  const tauxRent = ((margeBrute / invest) * 100).toFixed(1);
  const seuil = charges;
  const payback = invest / margeBrute;
  let avis = tauxRent > 30 ? 'Excellente rentabilitÃ© â€” investissement fortement recommandÃ©' : tauxRent > 15 ? 'Bonne rentabilitÃ© â€” projet viable' : 'RentabilitÃ© modÃ©rÃ©e â€” optimisez les charges';
  
  document.getElementById('rentMargin').textContent = fmtXAF(margeBrute);
  document.getElementById('rentNet').textContent = fmtXAF(netResult);
  document.getElementById('rentRate').textContent = tauxRent + '%';
  document.getElementById('rentBreakeven').textContent = fmtXAF(seuil) + ' CA minimum';
  document.getElementById('rentPayback').textContent = payback.toFixed(1) + ' an(s)';
  document.getElementById('rentAvis').textContent = 'ğŸ’¡ ' + avis;
  
  document.getElementById('rentResult')?.classList.add('show');
  consumeCredits(3);
  showToast('ğŸ“ˆ Analyse rentabilitÃ© terminÃ©e !', 'ok');
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 8 : SERVICES AGRICOLES IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchAgriTab(n) {
  [1,2,3].forEach(i => {
    const tab = document.getElementById('agriTab'+i);
    const content = document.getElementById('agriTabContent'+i);
    if (tab) tab.className = 'tab' + (i === n ? ' active' : '');
    if (content) content.style.display = i === n ? 'block' : 'none';
  });
}
window.switchAgriTab = switchAgriTab;

const YIELD_DATA = {
  mais:     { min: 2.5, max: 5.5, price: 18000 },
  manioc:   { min: 8, max: 15, price: 45000 },
  cacao:    { min: 0.6, max: 1.2, price: 1850000 },
  cafe:     { min: 0.5, max: 1.0, price: 2500000 },
  arachide: { min: 1.2, max: 2.5, price: 750000 },
  plantain: { min: 12, max: 25, price: 120000 }
};

window.runYieldPrediction = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const culture = document.getElementById('agriCulture')?.value || 'mais';
  const ha = parseFloat(document.getElementById('agriHectares')?.value) || 2;
  const season = document.getElementById('agriSeason')?.value || 'grande';
  
  await aiSimDelay();
  
  const data = YIELD_DATA[culture] || YIELD_DATA.mais;
  const seasonMult = season === 'grande' ? 1 : season === 'petite' ? 0.75 : 0.9;
  const minY = Math.round(data.min * ha * seasonMult * 10) / 10;
  const maxY = Math.round(data.max * ha * seasonMult * 10) / 10;
  const totalY = (minY + maxY) / 2;
  const value = Math.round(totalY * data.price);
  const risks = season === 'petite' ? 'ğŸŒ§ï¸ Pluies tardives possibles en Octâ€“Nov' : season === 'seche' ? 'â˜€ï¸ Stress hydrique si irrigation insuffisante' : 'âœ… Conditions saisonniÃ¨res favorables';
  const advice = value > 2000000 ? 'Excellent potentiel â€” prÃ©voyez le stockage et la commercialisation en avance' : 'Bon rendement â€” contactez les acheteurs ABAE dÃ¨s maintenant';
  
  document.getElementById('yieldMin').textContent = minY + ' t/ha minimum';
  document.getElementById('yieldMax').textContent = maxY + ' t/ha maximum';
  document.getElementById('yieldTotal').textContent = totalY.toFixed(1) + ' tonnes estimÃ©es';
  document.getElementById('yieldValue').textContent = fmtXAF(value);
  document.getElementById('yieldRisk').textContent = risks;
  document.getElementById('yieldAdvice').textContent = 'ğŸ’¡ ' + advice;
  
  document.getElementById('yieldResult')?.classList.add('show');
  consumeCredits(3);
  showToast('ğŸŒ¾ PrÃ©vision rendement terminÃ©e !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runIntrantRecommendation = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const culture = document.getElementById('intrantCulture')?.value || 'mais';
  const ha = parseFloat(document.getElementById('intrantHa')?.value) || 2;
  
  await aiSimDelay(1000, 1800);
  
  const INTRANTS = {
    mais:     { semences: 'MaÃ¯s hybride CMS 8704 (25 kg/ha)', engrais: 'NPK 20-10-10 + UrÃ©e 46%', qty: Math.round(ha * 200) + ' kg NPK Â· ' + Math.round(ha * 100) + ' kg UrÃ©e', pesticides: 'Atrazine (herbicide) Â· Actellic (insecticide)', cost: Math.round(ha * 85000), suppliers: 'Agrochim YaoundÃ© Â· SODECOTON' },
    manioc:   { semences: 'Boutures certifiÃ©es TMS 91934 (' + Math.round(ha * 10000) + ' tiges)', engrais: 'NPK 15-15-15', qty: Math.round(ha * 300) + ' kg NPK', pesticides: 'Roundup (dÃ©sherbage)', cost: Math.round(ha * 65000), suppliers: 'IRAD Ekona Â· Agro-Input CM' },
    cacao:    { semences: 'Plants greffÃ©s IMC 67 Â· Catongo (320 plants/ha)', engrais: 'KCl + Calcium MagnÃ©sium', qty: Math.round(ha * 400) + ' kg mÃ©lange', pesticides: 'Bordeaux (mildiou) Â· PyrÃ©thrinoÃ¯des', cost: Math.round(ha * 250000), suppliers: 'SIC Cacao Â· SODECAO' },
    arachide: { semences: 'Fleur 11 Â· ICGS 76 (100 kg/ha)', engrais: 'Superphosphate triple', qty: Math.round(ha * 250) + ' kg', pesticides: 'Emamectin (chenilles)', cost: Math.round(ha * 55000), suppliers: 'SODECOTON Â· Agrochim' }
  };
  
  const data = INTRANTS[culture] || INTRANTS.mais;
  
  document.getElementById('intrantSemences').textContent = data.semences;
  document.getElementById('intrantEngrais').textContent = data.engrais;
  document.getElementById('intrantQtyEngrais').textContent = data.qty;
  document.getElementById('intrantPesticides').textContent = data.pesticides;
  document.getElementById('intrantCost').textContent = fmtXAF(data.cost);
  document.getElementById('intrantSuppliers').textContent = data.suppliers;
  
  document.getElementById('intrantResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸŒ± Recommandation intrants gÃ©nÃ©rÃ©e !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runHarvestPlanning = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const culture = document.getElementById('recolteCulture')?.value || 'mais';
  
  await aiSimDelay(1000, 1800);
  
  const HARVEST = {
    mais:   { duration: '5â€“7 jours', meteo: 'â˜€ï¸ Saison sÃ¨che favorable', mainoeuvre: '4â€“6 personnes/ha', prix: '18 000â€“22 000 XAF/sac', conseil: 'SÃ©chez 3 jours avant stockage Â· Contactez les minoteries ABAE' },
    manioc: { duration: '10â€“14 jours', meteo: 'ğŸŒ¤ï¸ Conditions mixtes acceptables', mainoeuvre: '6â€“8 personnes/ha', prix: '45 000â€“60 000 XAF/tonne', conseil: 'Commercialisez rapidement â€” dÃ©gradation rapide aprÃ¨s rÃ©colte' },
    cacao:  { duration: '6â€“8 semaines (cabosses successives)', meteo: 'ğŸŒ¦ï¸ HumiditÃ© modÃ©rÃ©e recommandÃ©e', mainoeuvre: '5â€“7 personnes/ha', prix: '1 800â€“2 100 XAF/kg fermentÃ©', conseil: 'Fermentez 5â€“7 jours Â· SÃ©chez Ã  7.5% humiditÃ© Â· Exportateurs ABAE disponibles' }
  };
  
  const data = HARVEST[culture] || HARVEST.mais;
  const now = new Date();
  const recolteMonth = new Date(now.getFullYear(), now.getMonth() + 3, 15);
  
  document.getElementById('recolteDate2').textContent = recolteMonth.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
  document.getElementById('recolteDuration').textContent = data.duration;
  document.getElementById('recolteMeteo').textContent = data.meteo;
  document.getElementById('recolteMainOeuvre').textContent = data.mainoeuvre;
  document.getElementById('recoltePrix').textContent = data.prix;
  document.getElementById('recolteConseil').textContent = 'ğŸ’¡ ' + data.conseil;
  
  document.getElementById('recolteResult')?.classList.add('show');
  consumeCredits(2);
  showToast('ğŸ—“ï¸ Plan de rÃ©colte gÃ©nÃ©rÃ© !', 'ok');
  restoreAIBtn(btn, orig);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 9 : PAIEMENTS & ABONNEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.selUpgMethod = function(el, method) {
  document.querySelectorAll('#upgradeSheet .pay-method').forEach(m => m.classList.remove('sel'));
  el.classList.add('sel');
  AI_STATE.selectedUpgMethod = method;
};

window.confirmUpgrade = function() {
  showToast('ğŸ”’ Paiement via ' + AI_STATE.selectedUpgMethod + ' en coursâ€¦');
  setTimeout(() => {
    AI_STATE.plan = 'premium';
    AI_STATE.credits = 500;
    closeSheet('upgradeSheet');
    
    // Mettre Ã  jour l'interface
    const pill = document.getElementById('smartPlanPill');
    if (pill) pill.textContent = 'ğŸ‘‘ Plan Premium Â· IA ComplÃ¨te';
    const cv = document.getElementById('smartCreditsVal');
    if (cv) cv.textContent = '500 / 500 crÃ©dits disponibles';
    const cb = document.getElementById('smartCreditsBar');
    if (cb) cb.style.width = '0%';
    
    showToast('âœ… Plan Premium activÃ© ! Commission ABAE prÃ©levÃ©e automatiquement.', 'ok');
  }, 2000);
};

let selectedCreditPack = { name: 'pack150', credits: 150, price: 12000 };

window.selectCreditPack = function(el, packId, credits, price) {
  document.querySelectorAll('#creditsSheet .pay-method').forEach(m => m.classList.remove('sel'));
  el.classList.add('sel');
  selectedCreditPack = { name: packId, credits, price };
};

window.purchaseCredits = function() {
  showToast('ğŸ”’ Achat sÃ©curisÃ© ' + selectedCreditPack.credits + ' crÃ©dits IA â€” In-Appâ€¦');
  setTimeout(() => {
    AI_STATE.credits += selectedCreditPack.credits;
    const cv = document.getElementById('smartCreditsVal');
    if (cv) cv.textContent = AI_STATE.credits + ' / 100 crÃ©dits disponibles';
    const cDisplay = document.getElementById('creditsDisplayVal');
    if (cDisplay) cDisplay.textContent = AI_STATE.credits;
    closeSheet('creditsSheet');
    showToast('âš¡ ' + selectedCreditPack.credits + ' crÃ©dits ajoutÃ©s ! Commission ABAE prÃ©levÃ©e automatiquement.', 'ok');
  }, 1800);
};

// â•â• NAVIGATION SMART SCREEN â•â•
// screen-smart is now inside #screens â€” standard navTo handles it automatically
// Just register the screen ID mapping
(function() {
  // Ensure screen-smart works with standard navigation
  const origNavTo = window.navTo;
  if (origNavTo) {
    window.navTo = function(id) {
      origNavTo(id);
      // If navigating to smart, also clear the nav badge
      if (id === 'smart') {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        const ni = document.getElementById('nav-smart');
        if (ni) ni.classList.add('active');
      }
    };
  }
})();

console.log('âœ… ABAE Smart IA â€” Modules chargÃ©s avec succÃ¨s');





// â•â•â• FONCTIONS ABONNEMENTS ADMIN â•â•â•
let _aboFilter = 'tous';

function updateAboStats() {
  const plans = {gratuit:0, standard:0, pro:0, entreprise:0};
  adminUsers.forEach(u => { if(u.plan) plans[u.plan] = (plans[u.plan]||0)+1; });
  ['gratuit','standard','pro','entreprise'].forEach(p => {
    const el = document.getElementById('aboCount-'+p);
    if(el) el.textContent = plans[p] || 0;
    const sel = document.getElementById('statPlan'+p.charAt(0).toUpperCase()+p.slice(1));
    if(sel) sel.textContent = plans[p] || 0;
  });
  // Revenus
  const prices = {gratuit:0, standard:1000, pro:3000, entreprise:15000};
  const payants = adminUsers.filter(u => u.plan && u.plan !== 'gratuit' && u.payStatus === 'paid');
  const revMensuel = payants.reduce((s,u) => s + (prices[u.plan]||0), 0);
  const el1 = document.getElementById('adminRevenueMensuel');
  const el2 = document.getElementById('adminRevenueAnnuel');
  const el3 = document.getElementById('adminAbonnesPay');
  const el4 = document.getElementById('adminTauxConv');
  if(el1) el1.textContent = revMensuel.toLocaleString('fr-FR') + ' XAF';
  if(el2) el2.textContent = (revMensuel*12).toLocaleString('fr-FR') + ' XAF';
  if(el3) el3.textContent = payants.length;
  const taux = adminUsers.length ? Math.round(payants.length/adminUsers.length*100) : 0;
  if(el4) el4.textContent = taux + '%';
}

function renderAboTable(filter) {
  _aboFilter = filter;
  const list = filter === 'tous' ? adminUsers : adminUsers.filter(u => u.plan === filter);
  const tbody = document.getElementById('aboTableBody');
  const empty = document.getElementById('aboEmpty');
  if(!tbody) return;
  if(!list.length) { tbody.innerHTML=''; if(empty) empty.style.display='block'; return; }
  if(empty) empty.style.display='none';
  const planColors = {gratuit:'#9BA3AE',standard:'#3B82F6',pro:'#8B5CF6',entreprise:'#D4A843'};
  const planIcons = {gratuit:'ğŸŒ±',standard:'ğŸ“Š',pro:'ğŸš€',entreprise:'ğŸ¢'};
  tbody.innerHTML = list.map(u => {
    const init = u.nom.split(' ').map(w=>w[0]||'').join('').substring(0,2).toUpperCase();
    const pl = u.plan || 'gratuit';
    const pc = planColors[pl] || '#9BA3AE';
    const planBadge = '<span style="display:inline-flex;align-items:center;gap:4px;font-size:0.68rem;font-weight:700;padding:3px 8px;border-radius:10px;background:'+pc+'22;color:'+pc+';border:1px solid '+pc+'44;">'+(planIcons[pl]||'')+ ' '+pl.charAt(0).toUpperCase()+pl.slice(1)+'</span>';
    const statusBadge = u.payStatus === 'paid'
      ? '<span style="font-size:0.68rem;font-weight:700;background:#EDF7E5;color:#4A9E2A;padding:3px 8px;border-radius:10px;border:1px solid #4A9E2A44;">âœ… PayÃ©</span>'
      : '<span style="font-size:0.68rem;font-weight:700;background:#F7F8F9;color:#9BA3AE;padding:3px 8px;border-radius:10px;border:1px solid #EAECEF;">â€” Gratuit</span>';
    const expiry = u.planEnd
      ? '<span style="font-size:0.78rem;color:var(--gris-700);">'+u.planEnd+'</span>'
      : '<span style="font-size:0.78rem;color:#9BA3AE;">Sans expiration</span>';
    return '<tr>'
      +'<td><div class="admin-user-cell"><div class="admin-avatar">'+init+'</div><div><div class="admin-user-name">'+u.nom+'</div><div class="admin-user-email">'+(u.email||'â€”')+'</div></div></div></td>'
      +'<td>'+planBadge+'</td>'
      +'<td>'+statusBadge+'</td>'
      +'<td style="font-size:0.78rem;color:var(--gris-400);">'+(u.planStart||'â€”')+'</td>'
      +'<td>'+expiry+'</td>'
      +'<td style="font-size:0.78rem;color:var(--gris-400);">'+(u.payStatus==='paid'?'Mobile Money':'â€”')+'</td>'
      +'<td><button class="admin-btn" onclick="adminChangePlan('+u.id+')">âœ Changer</button></td>'
      +'</tr>';
  }).join('');
}

function filterAboTable(filter, btn) {
  document.querySelectorAll('#adminPanelAbonnements .admin-filter-btn').forEach(b => b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  renderAboTable(filter);
}

function adminChangePlan(id) {
  const u = adminUsers.find(u => u.id === id);
  if(!u) return;
  const plans = ['gratuit','standard','pro','entreprise'];
  const current = u.plan || 'gratuit';
  const next = plans[(plans.indexOf(current)+1) % plans.length];
  u.plan = next;
  renderAboTable(_aboFilter);
  updateAboStats();
  showToast('âœ“ Plan de '+u.nom+' â†’ '+next.charAt(0).toUpperCase()+next.slice(1), 'ok');
}

function adminRefreshAbo() {
  renderAboTable(_aboFilter);
  updateAboStats();
  showToast('âœ“ DonnÃ©es abonnements actualisÃ©es');
}

})(); // fin IIFE
</script>


<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE SUBSCRIPTION PAGE LOGIC â€” Global scope
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ ABONNEMENT PAGE LOGIC â”€â”€
let _aboPlan = 'gratuit';
let _aboBillingAnnual = false;
let _aboPayMethod = 'mtn';

function selectAboPlan(plan) {
  _aboPlan = plan;
  document.querySelectorAll('.abo-card').forEach(c => c.classList.remove('selected'));
  const card = document.getElementById('aboCard-' + plan);
  if (card) card.classList.add('selected');

  // Mettre Ã  jour CTA
  const cta = document.getElementById('aboCta');
  if (cta) {
    if (plan === 'gratuit') {
      cta.className = 'abo-cta-btn gratuit';
      cta.textContent = 'ğŸŒ± Commencer gratuitement';
    } else {
      const plans = ABAE_SUB.getAllPlans();
      const p = plans[plan];
      const price = _aboBillingAnnual ? p.priceA.toLocaleString('fr-FR') + ' XAF/an' : p.priceM.toLocaleString('fr-FR') + ' XAF/mois';
      cta.className = 'abo-cta-btn payant';
      cta.textContent = 'ğŸ’³ Souscrire â€” ' + price;
    }
  }
};

function toggleMesDemandes() {
  const body = document.getElementById('mesDemandesBody');
  const chevron = document.getElementById('mesDemandesChevron');
  const isOpen = body.style.maxHeight !== '0px' && body.style.maxHeight !== '';
  if (isOpen) {
    body.style.maxHeight = '0px';
    chevron.style.transform = 'rotate(0deg)';
  } else {
    body.style.maxHeight = '300px';
    chevron.style.transform = 'rotate(180deg)';
  }
}

function toggleMesOffres() {
  const body = document.getElementById('mesOffresBody');
  const chevron = document.getElementById('mesOffresChevron');
  const isOpen = body.style.maxHeight !== '0px' && body.style.maxHeight !== '';
  if (isOpen) {
    body.style.maxHeight = '0px';
    chevron.style.transform = 'rotate(0deg)';
  } else {
    body.style.maxHeight = '320px';
    chevron.style.transform = 'rotate(180deg)';
  }
}

function toggleAboBilling() {
  _aboBillingAnnual = !_aboBillingAnnual;
  const toggle = document.getElementById('aboBillingToggle');
  const lbM = document.getElementById('toggleLabelMonth');
  const lbY = document.getElementById('toggleLabelYear');
  if (toggle) toggle.classList.toggle('annual', _aboBillingAnnual);
  if (lbM) { lbM.classList.toggle('active', !_aboBillingAnnual); }
  if (lbY) { lbY.classList.toggle('active', _aboBillingAnnual); }

  // Mettre Ã  jour les prix
  const prices = { standard:[1000,10000], pro:[3000,30000], entreprise:[15000,150000] };
  ['standard','pro','entreprise'].forEach(p => {
    const el = document.getElementById('aboPrice-' + p);
    const anEl = document.getElementById('aboAnnual-' + p);
    if (el) el.textContent = (_aboBillingAnnual ? prices[p][1] : prices[p][0]).toLocaleString('fr-FR') + ' XAF';
    if (anEl) anEl.style.display = _aboBillingAnnual ? 'none' : 'block';
  });
  // Refresh CTA
  selectAboPlan(_aboPlan);
};

function handleAboSubmit() {
  if (_aboPlan === 'gratuit') {
    // Activation immÃ©diate
    ABAE_SUB.activate('gratuit', 'none');
    showView('marche');
    const _u1 = ABAE_getActiveUser();
    updateMarcheHero(_u1.nom, _u1.profil);
    showToast('âœ… Plan Gratuit activÃ© ! Bienvenue sur ABAE.', 'ok');
  } else {
    // Ouvrir le modal paiement
    const plans = ABAE_SUB.getAllPlans();
    const p = plans[_aboPlan];
    const price = _aboBillingAnnual ? p.priceA : p.priceM;
    const billing = _aboBillingAnnual ? 'Abonnement annuel' : 'Abonnement mensuel';

    document.getElementById('aboPayPlanName').textContent = 'Plan ' + p.label;
    document.getElementById('aboPayPeriodLabel').textContent = billing;
    document.getElementById('aboPayPrice').textContent = price.toLocaleString('fr-FR') + ' XAF';
    document.getElementById('aboPayPrice').className = 'abo-pay-plan-price ' + _aboPlan;

    document.getElementById('aboPayOverlay').classList.add('show');
  }
};

function selectPayMethod(method) {
  _aboPayMethod = method;
  document.querySelectorAll('.abo-pay-method').forEach(m => m.classList.remove('sel'));
  const el = document.getElementById('pm-' + method);
  if (el) el.classList.add('sel');
};

function confirmAboPay() {
  const btn = document.querySelector('.abo-pay-confirm-btn');
  if (btn) { btn.textContent = 'â³ Traitement en coursâ€¦'; btn.disabled = true; }

  setTimeout(() => {
    document.getElementById('aboPayOverlay').classList.remove('show');
    ABAE_SUB.activate(_aboPlan, _aboBillingAnnual ? 'annual' : 'monthly');

    // GÃ©nÃ©rer reÃ§u (simulÃ©)
    const plans = ABAE_SUB.getAllPlans();
    const p = plans[_aboPlan];
    const price = _aboBillingAnnual ? p.priceA : p.priceM;
    const receipt = {
      num: 'ABAE-' + Date.now().toString().slice(-6),
      plan: 'Plan ' + p.label,
      montant: price.toLocaleString('fr-FR') + ' XAF',
      methode: _aboPayMethod.toUpperCase(),
      date: new Date().toLocaleDateString('fr-FR'),
    };
    console.log('ğŸ“„ ReÃ§u ABAE gÃ©nÃ©rÃ© :', receipt);

    if (btn) { btn.textContent = 'âœ… Confirmer le paiement'; btn.disabled = false; }

    showView('marche');
    const _u2 = ABAE_getActiveUser();
    updateMarcheHero(_u2.nom, _u2.profil);
    showToast('ğŸ‰ Plan ' + p.label + ' activÃ© ! ReÃ§u NÂ° ' + receipt.num, 'ok');
  }, 2200);
};

function openAboFromDashboard() {
  showView('abonnement');
};

// Init â€” prÃ©sÃ©lectionner gratuit
(function initAbonnement() {
  selectAboPlan('gratuit');
})();


</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PANNEAU ACCÃˆS ADMIN â€” Design natif ABAE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<style>
/* Bouton dÃ©clencheur latÃ©ral */
#adminAccessBtn {
  position: fixed; top: 50%; right: 0; transform: translateY(-50%);
  z-index: 99999;
  background: linear-gradient(135deg, var(--vf, #2A5E10), var(--vp, #4A9E2A));
  color: #fff; border: none; cursor: pointer;
  width: 28px; height: 72px;
  border-radius: 10px 0 0 10px;
  display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 4px;
  box-shadow: -4px 0 18px rgba(13,74,43,0.35);
  font-family: 'Sora', sans-serif; font-size: 0.52rem; font-weight: 700;
  letter-spacing: 1.2px; text-transform: uppercase;
  padding: 8px 0;
  writing-mode: vertical-rl;
  -webkit-tap-highlight-color: transparent;
  transition: width 0.18s;
}
#adminAccessBtn span.aab-icon { writing-mode: horizontal-tb; font-size: 0.95rem; }
#adminAccessBtn:hover { width: 34px; }

/* Overlay */
#adminAccessOverlay {
  position: fixed; inset: 0; z-index: 99997;
  background: rgba(0,0,0,0.45);
  opacity: 0; pointer-events: none;
  transition: opacity 0.28s;
}
#adminAccessOverlay.show { opacity: 1; pointer-events: all; }

/* Panneau â€” mÃªme dimensions que .phone */
#adminAccessPanel {
  position: fixed; top: 0; right: -100%; bottom: 0; z-index: 99998;
  width: 100%; max-width: 390px;
  background: var(--bg, #F2F4F2);
  display: flex; flex-direction: column;
  overflow: hidden;
  transition: right 0.3s cubic-bezier(0.4,0,0.2,1);
  font-family: 'DM Sans', sans-serif;
}
#adminAccessPanel.open { right: 0; }

/* â”€â”€ Topbar style natif â”€â”€ */
.aap-topbar {
  height: 48px; min-height: 48px;
  background: #fff;
  border-bottom: 1px solid var(--g100, #F2F4F2);
  display: flex; align-items: center; padding: 0 14px; gap: 10px;
  flex-shrink: 0; z-index: 10;
}
.aap-topbar-back {
  width: 32px; height: 32px; border-radius: 9px;
  background: var(--g100, #F2F4F2); border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  -webkit-tap-highlight-color: transparent; flex-shrink: 0;
}
.aap-topbar-back svg { width: 18px; height: 18px; stroke: var(--g900, #1A1E25); fill: none; stroke-width: 2.5; }
.aap-topbar-title {
  font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.95rem;
  color: var(--g900, #1A1E25); flex: 1;
}
.aap-topbar-badge {
  background: var(--vc, #EDF7E5); color: var(--vp, #4A9E2A);
  font-family: 'Sora', sans-serif; font-size: 0.6rem; font-weight: 700;
  padding: 3px 8px; border-radius: 8px; border: 1px solid rgba(74,158,42,0.2);
  white-space: nowrap;
}

/* â”€â”€ Hero banner style natif â”€â”€ */
.aap-hero {
  background: linear-gradient(135deg, var(--vf, #2A5E10), var(--vp, #4A9E2A));
  padding: 10px 14px 12px; flex-shrink: 0;
}
.aap-hero-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.aap-hero-greeting { color: rgba(255,255,255,0.7); font-size: 0.68rem; }
.aap-hero-title {
  font-family: 'Sora', sans-serif; font-weight: 800; font-size: 0.92rem; color: #fff;
  margin-top: 1px;
}
.aap-hero-sub {
  display: inline-flex; align-items: center; gap: 4px;
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25);
  border-radius: 20px; padding: 2px 8px; margin-top: 4px;
  font-size: 0.63rem; font-weight: 600; color: rgba(255,255,255,0.9);
}
.aap-hero-dot { width: 5px; height: 5px; border-radius: 50%; background: #6ED63B; flex-shrink: 0; }

/* Toggle bypass â€” style wallet pill natif */
.aap-bypass-pill {
  display: flex; align-items: center; gap: 8px;
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.22);
  border-radius: 10px; padding: 6px 10px; cursor: pointer;
  backdrop-filter: blur(8px);
  transition: background 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.aap-bypass-pill.active { background: rgba(46,204,113,0.2); border-color: rgba(46,204,113,0.45); }
.aap-bypass-pill-icon { font-size: 1rem; }
.aap-bypass-pill-text { flex: 1; }
.aap-bypass-pill-label { font-family: 'Sora', sans-serif; font-size: 0.70rem; font-weight: 700; color: #fff; }
.aap-bypass-pill-sub { font-size: 0.58rem; color: rgba(255,255,255,0.65); margin-top: 0px; }
.aap-bypass-pill.active .aap-bypass-pill-sub { color: #6ED63B; }
.aap-switch {
  width: 40px; height: 22px; border-radius: 11px; background: rgba(255,255,255,0.25);
  position: relative; flex-shrink: 0; transition: background 0.22s;
}
.aap-bypass-pill.active .aap-switch { background: #6ED63B; }
.aap-switch::after {
  content: ''; position: absolute; top: 3px; left: 3px;
  width: 16px; height: 16px; border-radius: 50%; background: #fff;
  box-shadow: 0 1px 4px rgba(0,0,0,0.25); transition: transform 0.22s;
}
.aap-bypass-pill.active .aap-switch::after { transform: translateX(18px); }

/* â”€â”€ Scroll body â”€â”€ */
.aap-scroll {
  flex: 1; overflow-y: auto; padding-bottom: 16px;
  background: var(--bg, #F2F4F2);
}
.aap-scroll::-webkit-scrollbar { display: none; }

/* â”€â”€ Section header natif â”€â”€ */
.aap-section-hd {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 16px 8px; flex-shrink: 0;
}
.aap-section-hd h3 {
  font-family: 'Sora', sans-serif; font-size: 0.82rem; font-weight: 700;
  color: var(--g900, #1A1E25);
}
.aap-section-count {
  font-size: 0.68rem; color: var(--g400, #9BA3AE); font-weight: 600;
  font-family: 'Sora', sans-serif;
}

/* â”€â”€ Cards style natif â”€â”€ */
.aap-cards { display: flex; flex-direction: column; gap: 8px; padding: 0 12px; }
.aap-card {
  background: #fff;
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 1px 6px rgba(0,0,0,0.06);
  display: flex; flex-direction: row;
  min-height: 76px; cursor: pointer;
  border: 1px solid var(--g100, #F2F4F2);
  transition: transform 0.18s; -webkit-tap-highlight-color: transparent;
  width: 100%;
}
.aap-card:active { transform: scale(0.98); }

/* Thumb colorÃ© */
.aap-card-thumb {
  width: 76px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.6rem;
  background: var(--vc, #EDF7E5);
}
.aap-card-thumb.green { background: #EDF7E5; }
.aap-card-thumb.gold { background: #FFF8E1; }
.aap-card-thumb.red { background: #FFF5F5; }
.aap-card-thumb.blue { background: #EBF4FF; }
.aap-card-thumb.purple { background: #F5F0FF; }

/* Info block */
.aap-card-info {
  flex: 1; padding: 10px 12px 10px;
  display: flex; flex-direction: column; justify-content: center; gap: 3px;
  min-width: 0;
}
.aap-card-name {
  font-family: 'Sora', sans-serif; font-size: 0.82rem; font-weight: 700;
  color: var(--g900, #1A1E25); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.aap-card-sub { font-size: 0.68rem; color: var(--g400, #9BA3AE); margin-top: 1px; }
.aap-card-row { display: flex; align-items: center; justify-content: space-between; margin-top: 5px; }
.aap-card-badge {
  font-size: 0.6rem; font-weight: 700; font-family: 'Sora', sans-serif;
  padding: 2px 7px; border-radius: 5px;
}
.aap-card-badge.green { background: var(--vc, #EDF7E5); color: var(--vp, #4A9E2A); }
.aap-card-badge.gold { background: #FFF8E1; color: #B7791F; }
.aap-card-badge.red { background: #FFF5F5; color: #C53030; }
.aap-card-badge.blue { background: #EBF4FF; color: #2B6CB0; }
.aap-card-arrow {
  width: 24px; height: 24px; border-radius: 8px;
  background: var(--g100, #F2F4F2); display: flex; align-items: center; justify-content: center;
}
.aap-card-arrow svg { width: 12px; height: 12px; stroke: var(--g400,#9BA3AE); fill:none; stroke-width:2.5; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INSCRIPTION â€” Dark Immersive Theme (matching login page aesthetic)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Page backgrounds â”€â”€ */
#page-inscription,
#page-inscription-affilie {
  min-height: 100vh;
  background: #163D25;
  position: relative;
  overflow-x: hidden;
}

/* â”€â”€ Background mesh + grid (same as login) â”€â”€ */
#page-inscription::before,
#page-inscription-affilie::before {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 60% 40% at 15% 10%, rgba(74,158,42,0.35) 0%, transparent 60%),
    radial-gradient(ellipse 50% 40% at 85% 85%, rgba(46,204,113,0.18) 0%, transparent 55%),
    radial-gradient(ellipse 35% 30% at 50% 50%, rgba(212,168,67,0.06) 0%, transparent 60%);
}
#page-inscription::after,
#page-inscription-affilie::after {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background-image:
    linear-gradient(rgba(46,204,113,0.035) 1px, transparent 1px),
    linear-gradient(90deg, rgba(46,204,113,0.035) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(ellipse 90% 90% at 50% 50%, black 0%, transparent 100%);
}

/* â”€â”€ Floating orbs â”€â”€ */
#page-inscription .insc-orb,
#page-inscription-affilie .insc-orb {
  position: fixed; border-radius: 50%; pointer-events: none; z-index: 0;
  filter: blur(70px); opacity: 0.35;
  animation: inscOrbDrift ease-in-out infinite alternate;
}

/* â”€â”€ Contenu au-dessus des orbs â”€â”€ */
#page-verify-email .verify-wrap,
#page-verify-email header,
#page-email-confirmed > *:not(.insc-orb),
#page-abonnement .abo-hdr,
#page-abonnement .abo-hero,
#page-abonnement .abo-toggle-wrap,
#page-abonnement .abo-cards,
#page-abonnement .abo-footer {
  position: relative;
  z-index: 2;
}

/* â”€â”€ Orbs sur verify-email, email-confirmed, abonnement â€” position absolute â”€â”€ */
#page-verify-email,
#page-email-confirmed,
#page-abonnement {
  position: relative;
  overflow-x: hidden;
}
#page-verify-email .insc-orb,
#page-email-confirmed .insc-orb,
#page-abonnement .insc-orb {
  position: absolute; border-radius: 50%; pointer-events: none; z-index: 0;
  filter: blur(70px); opacity: 0.22;
  animation: inscOrbDrift ease-in-out infinite alternate;
}
@keyframes inscOrbDrift {
  from { transform: translate(0,0) scale(1); }
  to   { transform: translate(25px,18px) scale(1.12); }
}

/* â”€â”€ Header dark style override â”€â”€ */
#page-inscription .hdr,
#page-inscription-affilie .hdr {
  background: rgba(3,15,7,0.85) !important;
  backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(46,204,113,0.1) !important;
  position: sticky; top: 0; z-index: 100;
}
#page-inscription .hdr-back,
#page-inscription-affilie .hdr-back {
  color: rgba(255,255,255,0.5) !important;
  font-size: 0.82rem;
}
#page-inscription .hdr-back:hover,
#page-inscription-affilie .hdr-back:hover {
  color: #6ED63B !important;
}
#page-inscription .hdr-back svg,
#page-inscription-affilie .hdr-back svg {
  stroke: currentColor !important;
}
#page-inscription .logo-mark,
#page-inscription-affilie .logo-mark {
  background: linear-gradient(135deg, #4A9E2A 0%, #2A5E10 100%) !important;
  box-shadow: 0 0 12px rgba(74,158,42,0.5) !important;
}
#page-inscription .logo-name,
#page-inscription-affilie .logo-name {
  color: #fff !important;
}
#page-inscription .hdr-right a,
#page-inscription-affilie .hdr-right a {
  color: #6ED63B !important;
  font-weight: 700 !important;
}

/* â”€â”€ Progress bar dark style â”€â”€ */
#page-inscription .prog,
#page-inscription-affilie .prog {
  position: relative; z-index: 2;
  background: rgba(255,255,255,0.02);
  border-bottom: 1px solid rgba(46,204,113,0.08);
  padding: 16px 20px;
  max-width: 100%;
}
#page-inscription .prog-steps,
#page-inscription-affilie .prog-steps {
  max-width: 480px; margin: 0 auto;
}
#page-inscription .prog-step:not(:last-child)::after,
#page-inscription-affilie .prog-step:not(:last-child)::after {
  background: rgba(255,255,255,0.08) !important;
}
#page-inscription .prog-step.done:not(:last-child)::after,
#page-inscription .prog-step.active:not(:last-child)::after,
#page-inscription-affilie .prog-step.done:not(:last-child)::after,
#page-inscription-affilie .prog-step.active:not(:last-child)::after {
  background: rgba(46,204,113,0.5) !important;
}
#page-inscription .pending .prog-num,
#page-inscription-affilie .pending .prog-num {
  background: rgba(255,255,255,0.07) !important;
  color: rgba(255,255,255,0.3) !important;
}
#page-inscription .active .prog-num,
#page-inscription-affilie .active .prog-num {
  background: linear-gradient(135deg, #4A9E2A, #6ED63B) !important;
  color: #fff !important;
  box-shadow: 0 0 0 4px rgba(46,204,113,0.15), 0 0 20px rgba(46,204,113,0.3) !important;
}
#page-inscription .done .prog-num,
#page-inscription-affilie .done .prog-num {
  background: rgba(74,158,42,0.6) !important;
  color: #6ED63B !important;
}
#page-inscription .pending .prog-lbl,
#page-inscription-affilie .pending .prog-lbl {
  color: rgba(255,255,255,0.25) !important;
}
#page-inscription .active .prog-lbl,
#page-inscription-affilie .active .prog-lbl {
  color: #6ED63B !important;
}
#page-inscription .done .prog-lbl,
#page-inscription-affilie .done .prog-lbl {
  color: rgba(46,204,113,0.6) !important;
}

/* â”€â”€ Form wrapper â”€â”€ */
#page-inscription .fw,
#page-inscription-affilie .fw,
#page-inscription-affilie .insc-aff-body {
  position: relative; z-index: 2;
  max-width: 520px; margin: 0 auto;
  padding: 32px 20px 100px;
}

/* â”€â”€ Form card glass container â”€â”€ */
#page-inscription .form-head,
#page-inscription-affilie .form-head {
  margin-bottom: 28px;
  padding: 28px 28px 20px;
  background: rgba(255,255,255,0.025);
  border: 1px solid rgba(46,204,113,0.12);
  border-radius: 24px;
  backdrop-filter: blur(20px);
  box-shadow: 0 0 0 1px rgba(255,255,255,0.03) inset, 0 24px 60px rgba(0,0,0,0.5);
  animation: inscCardIn 0.75s cubic-bezier(0.22,1,0.36,1) both;
}
@keyframes inscCardIn {
  from { opacity:0; transform: translateY(28px) scale(0.97); }
  to   { opacity:1; transform: translateY(0) scale(1); }
}

/* â”€â”€ Logo mark dark â”€â”€ */
#page-inscription .form-lm,
#page-inscription-affilie .form-lm {
  background: linear-gradient(135deg, #4A9E2A 0%, #2A5E10 100%) !important;
  box-shadow: 0 4px 20px rgba(74,158,42,0.5), 0 0 0 1px rgba(255,255,255,0.08) !important;
  border-radius: 16px !important;
  width: 56px !important; height: 56px !important;
}

/* â”€â”€ Form title dark â”€â”€ */
#page-inscription .form-title,
#page-inscription-affilie .form-title {
  color: #fff !important;
  font-size: 1.7rem !important;
}
#page-inscription .form-sub,
#page-inscription-affilie .form-sub {
  color: rgba(255,255,255,0.45) !important;
}

/* â”€â”€ Step banner â”€â”€ */
#page-inscription .step-banner,
#page-inscription-affilie .step-banner {
  background: rgba(74,158,42,0.15) !important;
  border: 1px solid rgba(46,204,113,0.18) !important;
  color: #6ED63B !important;
  border-radius: 10px !important;
  padding: 10px 14px !important;
  font-size: 0.82rem !important;
  margin-bottom: 20px !important;
  font-family: 'Sora', sans-serif !important;
  display: block !important;
  letter-spacing: 0.3px !important;
}

/* â”€â”€ Step container glass card â”€â”€ */
#page-inscription .step.active,
#page-inscription-affilie .step.active {
  background: rgba(255,255,255,0.025);
  border: 1px solid rgba(46,204,113,0.1);
  border-radius: 20px;
  padding: 24px;
  backdrop-filter: blur(20px);
  box-shadow: 0 0 0 1px rgba(255,255,255,0.03) inset, 0 20px 50px rgba(0,0,0,0.4);
  animation: inscCardIn 0.5s cubic-bezier(0.22,1,0.36,1) both;
}

/* â”€â”€ Section labels dark â”€â”€ */
#page-inscription .sec-lbl span,
#page-inscription-affilie .sec-lbl span {
  color: rgba(255,255,255,0.3) !important;
}
#page-inscription .sec-lbl::after,
#page-inscription-affilie .sec-lbl::after {
  background: rgba(255,255,255,0.07) !important;
}

/* â”€â”€ Selection cards dark â”€â”€ */
#page-inscription .sel-card,
#page-inscription-affilie .sel-card {
  background: rgba(255,255,255,0.035) !important;
  border: 1.5px solid rgba(255,255,255,0.07) !important;
  border-radius: 16px !important;
  transition: all 0.22s ease !important;
}
#page-inscription .sel-card:hover,
#page-inscription-affilie .sel-card:hover {
  border-color: rgba(46,204,113,0.35) !important;
  background: rgba(74,158,42,0.1) !important;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3) !important;
  transform: translateY(-2px) !important;
}
#page-inscription .sel-card.active,
#page-inscription-affilie .sel-card.active {
  background: rgba(74,158,42,0.2) !important;
  border-color: rgba(46,204,113,0.5) !important;
  box-shadow: 0 0 0 3px rgba(46,204,113,0.1), 0 0 25px rgba(46,204,113,0.1) !important;
}
#page-inscription .sc-icon,
#page-inscription-affilie .sc-icon {
  background: rgba(255,255,255,0.06) !important;
}
#page-inscription .sel-card.active .sc-icon,
#page-inscription-affilie .sel-card.active .sc-icon {
  background: rgba(46,204,113,0.12) !important;
}
#page-inscription .sc-icon svg,
#page-inscription-affilie .sc-icon svg {
  stroke: rgba(255,255,255,0.5) !important;
}
#page-inscription .sel-card.active .sc-icon svg,
#page-inscription-affilie .sel-card.active .sc-icon svg {
  stroke: #6ED63B !important;
}
#page-inscription .sc-title,
#page-inscription-affilie .sc-title {
  color: rgba(255,255,255,0.85) !important;
}
#page-inscription .sc-sub,
#page-inscription-affilie .sc-sub {
  color: rgba(255,255,255,0.35) !important;
}

/* â”€â”€ Multi role cards â”€â”€ */
#page-inscription .sel-card--multi.active .sc-badge,
#page-inscription-affilie .sel-card--multi.active .sc-badge {
  background: #6ED63B !important;
  border-color: #6ED63B !important;
}
#page-inscription .sel-card--affilie,
#page-inscription-affilie .sel-card--affilie {
  background: linear-gradient(135deg, rgba(74,14,107,0.25), rgba(155,27,106,0.2)) !important;
  border-color: rgba(155,27,106,0.3) !important;
}

/* â”€â”€ Info box â”€â”€ */
#page-inscription [style*="background:var(--vert-clair)"],
#page-inscription [style*="background: var(--vert-clair)"] {
  background: rgba(74,158,42,0.12) !important;
  border-left-color: rgba(46,204,113,0.4) !important;
  color: rgba(255,255,255,0.75) !important;
}

/* â”€â”€ Roles resume â”€â”€ */
#rolesResume {
  background: rgba(255,255,255,0.04) !important;
  border-radius: 10px !important;
  color: rgba(255,255,255,0.6) !important;
}
#rolesResume strong {
  color: #6ED63B !important;
}

/* â”€â”€ Form fields dark â”€â”€ */
#page-inscription .field-label span,
#page-inscription-affilie .field-label span {
  color: rgba(255,255,255,0.55) !important;
}
#page-inscription .input,
#page-inscription-affilie .input,
#page-inscription .sel,
#page-inscription-affilie .sel {
  background: rgba(255,255,255,0.05) !important;
  border: 1.5px solid rgba(255,255,255,0.08) !important;
  border-radius: 12px !important;
  color: #fff !important;
}
#page-inscription .input::placeholder,
#page-inscription-affilie .input::placeholder {
  color: rgba(255,255,255,0.2) !important;
}
#page-inscription .input:focus,
#page-inscription-affilie .input:focus,
#page-inscription .sel:focus,
#page-inscription-affilie .sel:focus {
  border-color: rgba(46,204,113,0.5) !important;
  background: rgba(74,158,42,0.1) !important;
  box-shadow: 0 0 0 3px rgba(46,204,113,0.08), 0 0 20px rgba(46,204,113,0.06) !important;
}
#page-inscription .input.err,
#page-inscription-affilie .input.err {
  border-color: rgba(229,62,62,0.5) !important;
  background: rgba(229,62,62,0.07) !important;
}
#page-inscription .fhint,
#page-inscription-affilie .fhint {
  color: rgba(255,255,255,0.3) !important;
}
#page-inscription .fmsg.err,
#page-inscription-affilie .fmsg.err {
  color: #fc8181 !important;
}
#page-inscription .fmsg.ok,
#page-inscription-affilie .fmsg.ok {
  color: #6ED63B !important;
}

/* â”€â”€ Phone wrap dark â”€â”€ */
#page-inscription .phone-wrap,
#page-inscription-affilie .phone-wrap {
  border-color: rgba(255,255,255,0.08) !important;
  background: rgba(255,255,255,0.05) !important;
  border-radius: 12px !important;
}
#page-inscription .phone-pfx,
#page-inscription-affilie .phone-pfx {
  background: rgba(255,255,255,0.05) !important;
  border-right-color: rgba(255,255,255,0.08) !important;
  color: rgba(255,255,255,0.6) !important;
}
#page-inscription .phone-wrap:focus-within,
#page-inscription-affilie .phone-wrap:focus-within {
  border-color: rgba(46,204,113,0.5) !important;
  box-shadow: 0 0 0 3px rgba(46,204,113,0.08) !important;
}

/* â”€â”€ Select dropdown dark â”€â”€ */
#page-inscription .sel-wrap::after,
#page-inscription-affilie .sel-wrap::after {
  border-top-color: rgba(255,255,255,0.35) !important;
}
#page-inscription .sel option,
#page-inscription-affilie .sel option {
  background: #0D1F14;
  color: #fff;
}

/* â”€â”€ Password strength â”€â”€ */
#page-inscription .pw-bar,
#page-inscription-affilie .pw-bar {
  background: rgba(255,255,255,0.08) !important;
}
#page-inscription .pw-rule,
#page-inscription-affilie .pw-rule {
  color: rgba(255,255,255,0.35) !important;
}
#page-inscription .pw-rule.ok,
#page-inscription-affilie .pw-rule.ok {
  color: #6ED63B !important;
}
#page-inscription .pw-dot,
#page-inscription-affilie .pw-dot {
  background: rgba(255,255,255,0.2) !important;
}
#page-inscription .pw-rule.ok .pw-dot,
#page-inscription-affilie .pw-rule.ok .pw-dot {
  background: #6ED63B !important;
}

/* â”€â”€ Password icon toggle dark â”€â”€ */
#page-inscription .ico-r,
#page-inscription-affilie .ico-r {
  stroke: rgba(255,255,255,0.3) !important;
}
#page-inscription .ico-r:hover,
#page-inscription-affilie .ico-r:hover {
  stroke: rgba(255,255,255,0.7) !important;
}

/* â”€â”€ CGU checkbox dark â”€â”€ */
#page-inscription .cgu,
#page-inscription-affilie .cgu {
  color: rgba(255,255,255,0.45) !important;
}
#page-inscription .cgu a,
#page-inscription-affilie .cgu a {
  color: #6ED63B !important;
}
#page-inscription .chk,
#page-inscription-affilie .chk {
  border-color: rgba(255,255,255,0.2) !important;
  background: rgba(255,255,255,0.05) !important;
}
#page-inscription .chk.on,
#page-inscription-affilie .chk.on {
  background: rgba(74,158,42,0.5) !important;
  border-color: rgba(46,204,113,0.5) !important;
}

/* â”€â”€ Primary button dark â”€â”€ */
#page-inscription .btn-p,
#page-inscription-affilie .btn-p {
  background: linear-gradient(135deg, #4A9E2A 0%, #0f5234 100%) !important;
  border-radius: 14px !important;
  box-shadow: 0 4px 20px rgba(74,158,42,0.4), 0 0 0 1px rgba(46,204,113,0.15) inset !important;
  font-size: 0.95rem !important;
  position: relative; overflow: hidden;
}
#page-inscription .btn-p::before,
#page-inscription-affilie .btn-p::before {
  content: '';
  position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
  transform: skewX(-20deg);
  animation: inscShine 4s ease 1s infinite;
}
@keyframes inscShine { 0%{left:-100%} 35%,100%{left:150%} }
#page-inscription .btn-p:hover:not(:disabled),
#page-inscription-affilie .btn-p:hover:not(:disabled) {
  background: linear-gradient(135deg, #22974F 0%, #4A9E2A 100%) !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 8px 28px rgba(74,158,42,0.55) !important;
}
#page-inscription .btn-p:disabled,
#page-inscription-affilie .btn-p:disabled {
  opacity: 0.35 !important;
}

/* â”€â”€ Back button dark â”€â”€ */
#page-inscription .btn-back,
#page-inscription-affilie .btn-back {
  color: rgba(255,255,255,0.25) !important;
}
#page-inscription .btn-back:hover,
#page-inscription-affilie .btn-back:hover {
  color: #6ED63B !important;
}

/* â”€â”€ Secondary / outline buttons dark â”€â”€ */
#page-inscription .btn-o,
#page-inscription-affilie .btn-o {
  border-color: rgba(46,204,113,0.4) !important;
  color: #6ED63B !important;
  background: rgba(74,158,42,0.08) !important;
}
#page-inscription .btn-g,
#page-inscription-affilie .btn-g {
  border-color: rgba(255,255,255,0.1) !important;
  color: rgba(255,255,255,0.45) !important;
  background: rgba(255,255,255,0.03) !important;
}

/* â”€â”€ Security note dark â”€â”€ */
#page-inscription .sec-note,
#page-inscription-affilie .sec-note {
  color: rgba(255,255,255,0.25) !important;
}
#page-inscription .sec-note svg,
#page-inscription-affilie .sec-note svg {
  stroke: rgba(255,255,255,0.25) !important;
}

/* â”€â”€ Upload zones dark â”€â”€ */
#page-inscription .upload-zone,
#page-inscription-affilie .upload-zone {
  background: rgba(255,255,255,0.03) !important;
  border: 2px dashed rgba(255,255,255,0.1) !important;
  border-radius: 14px !important;
}
#page-inscription .upload-zone:hover,
#page-inscription-affilie .upload-zone:hover {
  border-color: rgba(46,204,113,0.4) !important;
  background: rgba(74,158,42,0.08) !important;
}
#page-inscription .upload-icon svg,
#page-inscription-affilie .upload-icon svg {
  stroke: rgba(255,255,255,0.3) !important;
}
#page-inscription .upload-title,
#page-inscription-affilie .upload-title {
  color: rgba(255,255,255,0.6) !important;
}
#page-inscription .upload-sub,
#page-inscription-affilie .upload-sub {
  color: rgba(255,255,255,0.25) !important;
}
#page-inscription .upload-zone.done,
#page-inscription-affilie .upload-zone.done {
  background: rgba(74,158,42,0.12) !important;
  border-color: rgba(46,204,113,0.4) !important;
}

/* â”€â”€ Reassurance row dark â”€â”€ */
#page-inscription .reas-row,
#page-inscription-affilie .reas-row {
  border-top: 1px solid rgba(255,255,255,0.06) !important;
}
#page-inscription .reas-item,
#page-inscription-affilie .reas-item {
  color: rgba(255,255,255,0.3) !important;
}
#page-inscription .reas-item svg,
#page-inscription-affilie .reas-item svg {
  stroke: rgba(46,204,113,0.5) !important;
}
#page-inscription .reas-sep,
#page-inscription-affilie .reas-sep {
  background: rgba(255,255,255,0.08) !important;
}

/* â”€â”€ Link center dark â”€â”€ */
#page-inscription .link-center,
#page-inscription-affilie .link-center {
  color: rgba(255,255,255,0.3) !important;
}
#page-inscription .link-center a,
#page-inscription-affilie .link-center a,
#page-inscription .link-center button,
#page-inscription-affilie .link-center button {
  color: #6ED63B !important;
  font-weight: 700 !important;
}

/* â”€â”€ Footer mini dark â”€â”€ */
#page-inscription .footer-mini,
#page-inscription-affilie .footer-mini {
  background: rgba(255,255,255,0.02) !important;
  border-top: 1px solid rgba(255,255,255,0.06) !important;
  position: relative; z-index: 2;
}
#page-inscription .footer-mini p,
#page-inscription-affilie .footer-mini p {
  color: rgba(255,255,255,0.2) !important;
}
#page-inscription .footer-mini a,
#page-inscription-affilie .footer-mini a {
  color: rgba(255,255,255,0.2) !important;
}
#page-inscription .footer-mini a:hover,
#page-inscription-affilie .footer-mini a:hover {
  color: #6ED63B !important;
}

/* â”€â”€ Affiliation banner card (affiliÃ© page special style) â”€â”€ */
#page-inscription-affilie .aff-header-card {
  background: linear-gradient(135deg, rgba(74,14,107,0.5), rgba(155,27,106,0.4));
  border: 1px solid rgba(155,27,106,0.35);
  border-radius: 20px;
  padding: 24px 24px 20px;
  margin-bottom: 20px;
  backdrop-filter: blur(20px);
  box-shadow: 0 20px 50px rgba(74,14,107,0.3);
}
#page-inscription-affilie .aff-header-card .aff-hdr-title {
  font-family: 'Sora', sans-serif; font-weight: 800;
  font-size: 1.5rem; color: #fff; margin-bottom: 6px;
}
#page-inscription-affilie .aff-header-card .aff-hdr-sub {
  color: rgba(255,255,255,0.55); font-size: 0.875rem;
}

/* â”€â”€ Pill badges dark â”€â”€ */
#page-inscription .freq,
#page-inscription-affilie .freq {
  color: #fc8181 !important;
}
#page-inscription .fopt,
#page-inscription-affilie .fopt {
  background: rgba(255,255,255,0.07) !important;
  color: rgba(255,255,255,0.35) !important;
}

/* â”€â”€ Profil chips dark â”€â”€ */
#page-inscription .profil-chip,
#page-inscription-affilie .profil-chip {
  background: rgba(255,255,255,0.04) !important;
  border-color: rgba(255,255,255,0.07) !important;
}
#page-inscription .profil-chip:hover,
#page-inscription-affilie .profil-chip:hover {
  border-color: rgba(46,204,113,0.35) !important;
  background: rgba(74,158,42,0.1) !important;
}
#page-inscription .profil-chip.active,
#page-inscription-affilie .profil-chip.active {
  border-color: rgba(46,204,113,0.5) !important;
  background: rgba(74,158,42,0.2) !important;
  box-shadow: 0 0 0 3px rgba(46,204,113,0.1) !important;
}
#page-inscription .profil-chip__label,
#page-inscription-affilie .profil-chip__label {
  color: rgba(255,255,255,0.55) !important;
}
#page-inscription .profil-chip.active .profil-chip__label,
#page-inscription-affilie .profil-chip.active .profil-chip__label {
  color: #6ED63B !important;
}

/* â”€â”€ Profil subfields dark â”€â”€ */
#page-inscription .profil-subfields,
#page-inscription-affilie .profil-subfields {
  background: rgba(74,158,42,0.1) !important;
  border-color: rgba(46,204,113,0.25) !important;
}
#page-inscription .profil-subfields .psf-title,
#page-inscription-affilie .profil-subfields .psf-title {
  color: #6ED63B !important;
}
#page-inscription .profil-subfields .input,
#page-inscription-affilie .profil-subfields .input,
#page-inscription .profil-subfields .sel,
#page-inscription-affilie .profil-subfields .sel {
  background: rgba(255,255,255,0.06) !important;
  border-color: rgba(255,255,255,0.08) !important;
  color: #fff !important;
}
#page-inscription .profil-subfields .field-label span,
#page-inscription-affilie .profil-subfields .field-label span {
  color: rgba(255,255,255,0.55) !important;
}

/* â”€â”€ Parrainage code input dark â”€â”€ */
#page-inscription [id*="parrain"],
#page-inscription-affilie [id*="parrain"] {
  color: #D4A843 !important;
}

/* â”€â”€ Step banner affilie dark (purple gradient) â”€â”€ */
#page-inscription-affilie .step-banner {
  background: rgba(155,27,106,0.15) !important;
  border-color: rgba(155,27,106,0.25) !important;
  color: #d966b2 !important;
}

/* â”€â”€ Iico (input with icon) dark â”€â”€ */
#page-inscription .iico .ico-r,
#page-inscription-affilie .iico .ico-r {
  stroke: rgba(255,255,255,0.3) !important;
}

/* â”€â”€ KYC modal / skip button â”€â”€ */
#page-inscription [onclick*="showKycModal"] {
  color: rgba(255,255,255,0.3) !important;
}
#page-inscription [onclick*="showKycModal"]:hover {
  color: #6ED63B !important;
}

/* â”€â”€ Partenaire/investisseur special card â”€â”€ */
#page-inscription .sel-card--affilie .sc-title,
#page-inscription-affilie .sel-card--affilie .sc-title {
  color: #d966b2 !important;
}
#page-inscription .sel-card--affilie .sc-sub,
#page-inscription-affilie .sel-card--affilie .sc-sub {
  color: rgba(217,102,178,0.7) !important;
}

/* â”€â”€ Floating particle effect â”€â”€ */
#insc-particles {
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  overflow: hidden;
}
.insc-particle {
  position: absolute;
  width: 2px; height: 2px;
  background: #6ED63B;
  border-radius: 50%;
  opacity: 0;
  animation: inscParticleFloat linear infinite;
}
@keyframes inscParticleFloat {
  0% { opacity: 0; transform: translateY(100vh) scale(0); }
  10% { opacity: 0.4; }
  90% { opacity: 0.2; }
  100% { opacity: 0; transform: translateY(-20px) scale(1.5); }
}

/* â”€â”€ Textarea dark â”€â”€ */
#page-inscription textarea,
#page-inscription-affilie textarea {
  background: rgba(255,255,255,0.05) !important;
  border: 1.5px solid rgba(255,255,255,0.08) !important;
  color: #fff !important;
  border-radius: 12px !important;
}
#page-inscription textarea:focus,
#page-inscription-affilie textarea:focus {
  border-color: rgba(46,204,113,0.5) !important;
  box-shadow: 0 0 0 3px rgba(46,204,113,0.08) !important;
}
#page-inscription textarea::placeholder,
#page-inscription-affilie textarea::placeholder {
  color: rgba(255,255,255,0.2) !important;
}

/* â”€â”€ AffiliÃ© page step indicators â”€â”€ */
#page-inscription-affilie .step-dot {
  background: rgba(255,255,255,0.1) !important;
}
#page-inscription-affilie .step-dot.active {
  background: #d966b2 !important;
}

/* â”€â”€ aff-step-banner dark â”€â”€ */
#page-inscription-affilie .aff-step-banner {
  background: rgba(155,27,106,0.15) !important;
  border-left-color: rgba(155,27,106,0.5) !important;
  border-radius: 8px !important;
  color: #d966b2 !important;
}

/* â”€â”€ hdr style â”€â”€ */
#page-inscription .hdr-in,
#page-inscription-affilie .hdr-in {
  max-width: 100%;
}

</style>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ABAE â€” FULLSCREEN PANELS OVERRIDE  (v9)
     Transforme tous les panneaux en vue plein Ã©cran
     avec animation d'ouverture fluide + polices agrandies
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<style>
/* â”€â”€â”€ Keyframes d'ouverture â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes abaeSheetOpen {
  from { opacity: 0; transform: translateY(100%) scale(0.97); }
  to   { opacity: 1; transform: translateY(0)    scale(1);    }
}
@keyframes abaePanelSlideRight {
  from { opacity: 0; transform: translateX(100%) scale(0.97); }
  to   { opacity: 1; transform: translateX(0)    scale(1);    }
}
@keyframes abaePanelSlideUp {
  from { opacity: 0; transform: translateY(30px) scale(0.96); }
  to   { opacity: 1; transform: translateY(0)    scale(1);    }
}

/* â”€â”€â”€ BOTTOM SHEETS â†’ plein Ã©cran â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sheet {
  top: 0 !important;
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  max-height: 100% !important;
  height: 100% !important;
  border-radius: 0 !important;
  transform: translateY(100%) scale(0.97) !important;
  transition: transform 0.38s cubic-bezier(0.32, 0.72, 0, 1),
              opacity  0.30s cubic-bezier(0.32, 0.72, 0, 1) !important;
  opacity: 0 !important;
  display: block !important;       /* toujours dans le DOM, cachÃ© par opacity+transform */
  pointer-events: none !important;
}
.sheet.open {
  transform: translateY(0) scale(1) !important;
  opacity: 1 !important;
  pointer-events: all !important;
  animation: abaeSheetOpen 0.38s cubic-bezier(0.32, 0.72, 0, 1) both !important;
}

/* Handle â†’ masquÃ© en plein Ã©cran */
.sheet-handle { display: none !important; }

/* Header du sheet plein Ã©cran */
.sheet-hd {
  padding: 18px 20px 16px !important;
  border-bottom: 1px solid var(--g200, #EAECEF) !important;
}
.sheet-title { font-size: 1.15rem !important; }
.sheet-close {
  width: 38px !important; height: 38px !important;
  font-size: 1.1rem !important;
  border-radius: 10px !important;
}
.sheet-body { padding: 20px !important; }

/* Typographie agrandie dans les sheets */
.sheet label,
.sheet .sheet-label { font-size: 1rem !important; }
.sheet input,
.sheet select,
.sheet textarea { font-size: 1rem !important; padding: 13px 14px !important; }
.sheet .btn,
.sheet button.btn-primary,
.sheet button.btn-outline { font-size: 1rem !important; padding: 15px 20px !important; }
.sheet p, .sheet span, .sheet div { font-size: inherit; }
.sheet .sheet-section-title,
.sheet h3 { font-size: 1.05rem !important; }
.sheet .pay-method { padding: 14px 16px !important; }
.sheet .pay-method-name { font-size: 1rem !important; }
.sheet .ai-feature-card { padding: 16px !important; }
.sheet .ai-feature-card-title { font-size: 0.95rem !important; }
.sheet .ai-feature-card-desc { font-size: 0.82rem !important; }
.sheet .sheet-row { padding: 10px 0 !important; }
.sheet .sheet-val,
.sheet .sheet-label { font-size: 0.95rem !important; }
.sheet .sheet-total { font-size: 1.05rem !important; }
.sheet .sheet-note { font-size: 0.85rem !important; }

/* â”€â”€â”€ THEME PANEL â†’ plein Ã©cran â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#themePanel {
  top: 0 !important; right: 0 !important;
  bottom: 0 !important; left: 0 !important;
  width: 100% !important;
  max-height: 100% !important;
  border-radius: 0 !important;
  display: none;
  overflow-y: auto !important;
}
#themePanel.open {
  display: block !important;
  animation: abaePanelSlideRight 0.38s cubic-bezier(0.32, 0.72, 0, 1) both !important;
}
.theme-panel-header {
  padding: 20px 24px 16px !important;
  position: sticky; top: 0; z-index: 10;
}
.theme-panel-title { font-size: 1.1rem !important; }
.theme-panel-body { padding: 20px 24px !important; gap: 18px !important; }
.theme-row-label { font-size: 0.95rem !important; }
.theme-row input[type=color] { width: 44px !important; height: 38px !important; }
.theme-row select { font-size: 0.9rem !important; padding: 8px 12px !important; max-width: none !important; }
.theme-reset-btn { font-size: 0.9rem !important; padding: 12px !important; }

/* â”€â”€â”€ BIZ PANEL â†’ plein Ã©cran â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#bizPanel {
  top: 0 !important; right: 0 !important;
  bottom: 0 !important; left: 0 !important;
  width: 100% !important;
  max-height: 100% !important;
  border-radius: 0 !important;
  display: none;
  overflow-y: auto !important;
}
#bizPanel.open {
  display: block !important;
  animation: abaePanelSlideRight 0.38s cubic-bezier(0.32, 0.72, 0, 1) both !important;
}
.biz-panel-header {
  padding: 20px 24px 16px !important;
}
.biz-panel-title { font-size: 1.1rem !important; }
.biz-panel-body { padding: 20px 24px !important; gap: 18px !important; }
.biz-section-label { font-size: 0.78rem !important; }
.biz-field-label { font-size: 0.9rem !important; }
.biz-field input,
.biz-field textarea {
  font-size: 0.95rem !important;
  padding: 10px 12px !important;
}

/* â”€â”€â”€ ADMIN ACCESS PANEL â†’ plein Ã©cran â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#adminAccessPanel {
  max-width: 100% !important;
  width: 100% !important;
  right: -100% !important;
  transition: right 0.38s cubic-bezier(0.32, 0.72, 0, 1) !important;
}
#adminAccessPanel.open {
  right: 0 !important;
  animation: abaePanelSlideRight 0.38s cubic-bezier(0.32, 0.72, 0, 1) both !important;
}
/* Typographie agrandie dans adminAccessPanel */
.aap-topbar-title { font-size: 1.1rem !important; }
.aap-hero-title   { font-size: 1.35rem !important; }
.aap-hero-greeting { font-size: 0.9rem !important; }
.aap-section-hd h3 { font-size: 1rem !important; }
.aap-card-name { font-size: 1rem !important; }
.aap-card-sub  { font-size: 0.82rem !important; }
.aap-card-badge { font-size: 0.72rem !important; }
.aap-card-thumb { font-size: 1.4rem !important; width: 52px !important; height: 52px !important; }

/* â”€â”€â”€ Scroll body plein Ã©cran corrigÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sheet.open,
#themePanel.open,
#bizPanel.open {
  overflow-y: auto !important;
}
</style>

<!-- Bouton latÃ©ral dÃ©clencheur -->
<button id="adminAccessBtn" onclick="toggleAdminAccessPanel()">
  <span class="aab-icon">ğŸ”‘</span>
  Pages
</button>

<!-- Overlay fond sombre -->
<div id="adminAccessOverlay" onclick="closeAdminAccessPanel()"></div>

<!-- â•â•â• PANNEAU PRINCIPAL â•â•â• -->
<div id="adminAccessPanel">

  <!-- Topbar -->
  <div class="aap-topbar">
    <button class="aap-topbar-back" onclick="closeAdminAccessPanel()">
      <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <div class="aap-topbar-title">AccÃ¨s Admin</div>
    <div class="aap-topbar-badge">ğŸ”‘ DEV</div>
  </div>

  <!-- Contenu scrollable -->
  <div class="aap-scroll">

    <!-- Pages publiques -->
    <div class="aap-section-hd">
      <h3>Pages publiques</h3>
      <span class="aap-section-count">5 pages</span>
    </div>
    <div class="aap-cards">

      <button class="aap-card" onclick="aapGo('accueil')">
        <div class="aap-card-thumb green">ğŸ </div>
        <div class="aap-card-info">
          <div class="aap-card-name">Accueil</div>
          <div class="aap-card-sub">Page d'atterrissage principale</div>
          <div class="aap-card-row">
            <span class="aap-card-badge green">Public</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGo('login')">
        <div class="aap-card-thumb blue">ğŸ”</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Connexion</div>
          <div class="aap-card-sub">Login membre & affiliÃ©</div>
          <div class="aap-card-row">
            <span class="aap-card-badge blue">Public</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGo('inscription')">
        <div class="aap-card-thumb green">ğŸ“</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Inscription Membre</div>
          <div class="aap-card-sub">Onboarding nouvel utilisateur</div>
          <div class="aap-card-row">
            <span class="aap-card-badge green">Public</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGo('inscription-affilie')">
        <div class="aap-card-thumb purple">âœ¦</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Inscription AffiliÃ©</div>
          <div class="aap-card-sub">Programme de parrainage</div>
          <div class="aap-card-row">
            <span class="aap-card-badge" style="background:#F5F0FF;color:#6B46C1;">AffiliÃ©</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGo('forgot')">
        <div class="aap-card-thumb blue">ğŸ”“</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Mot de passe oubliÃ©</div>
          <div class="aap-card-sub">RÃ©initialisation du compte</div>
          <div class="aap-card-row">
            <span class="aap-card-badge blue">Public</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

    </div>

    <!-- Pages protÃ©gÃ©es -->
    <div class="aap-section-hd" style="margin-top:6px;">
      <h3>Pages protÃ©gÃ©es</h3>
      <span class="aap-section-count">4 pages</span>
    </div>
    <div class="aap-cards">

      <button class="aap-card" onclick="aapGo('abonnement')">
        <div class="aap-card-thumb gold">ğŸ’³</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Abonnement</div>
          <div class="aap-card-sub">Plans & paiement</div>
          <div class="aap-card-row">
            <span class="aap-card-badge gold">Sub requis</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGo('verify-email')">
        <div class="aap-card-thumb red">ğŸ“§</div>
        <div class="aap-card-info">
          <div class="aap-card-name">VÃ©rification email</div>
          <div class="aap-card-sub">Confirmation du compte</div>
          <div class="aap-card-row">
            <span class="aap-card-badge red">Auth requis</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGoMarche()">
        <div class="aap-card-thumb green">ğŸ›’</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Marketplace</div>
          <div class="aap-card-sub">Offres agro-pastorales</div>
          <div class="aap-card-row">
            <span class="aap-card-badge green">Sub + Auth</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGo('dashboard-affilie')">
        <div class="aap-card-thumb purple">ğŸ“Š</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Espace AffiliÃ©</div>
          <div class="aap-card-sub">Dashboard parrainage & commissions</div>
          <div class="aap-card-row">
            <span class="aap-card-badge" style="background:#F5F0FF;color:#6B46C1;">Auth requis</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

    </div>

    <!-- Administration -->
    <div class="aap-section-hd" style="margin-top:6px;">
      <h3>Administration</h3>
      <span class="aap-section-count">2 pages</span>
    </div>
    <div class="aap-cards" style="padding-bottom:4px;">

      <button class="aap-card" onclick="aapGo('admin-login')">
        <div class="aap-card-thumb" style="background:#1A1E25;">âš™ï¸</div>
        <div class="aap-card-info">
          <div class="aap-card-name">Login Admin</div>
          <div class="aap-card-sub">Page de connexion administrateur</div>
          <div class="aap-card-row">
            <span class="aap-card-badge" style="background:#F0F0F0;color:#3D4550;">Code: 123456</span>
            <div class="aap-card-arrow"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

      <button class="aap-card" onclick="aapGoAdmin()" style="border-color:rgba(74,158,42,0.3);">
        <div class="aap-card-thumb" style="background:linear-gradient(135deg,#2A5E10,#4A9E2A);">ğŸ›¡ï¸</div>
        <div class="aap-card-info">
          <div class="aap-card-name" style="color:var(--vp,#4A9E2A);">Dashboard Admin</div>
          <div class="aap-card-sub">AccÃ¨s complet â€” connexion auto</div>
          <div class="aap-card-row">
            <span class="aap-card-badge green">Auto-login</span>
            <div class="aap-card-arrow" style="background:var(--vc,#EDF7E5);"><svg viewBox="0 0 24 24" style="stroke:var(--vp,#4A9E2A);"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </button>

    </div>

  </div><!-- /aap-scroll -->
</div><!-- /adminAccessPanel -->

<script>
window.ABAE_BYPASS_AUTH = false;

function toggleAdminAccessPanel() {
  const panel = document.getElementById('adminAccessPanel');
  const overlay = document.getElementById('adminAccessOverlay');
  if (panel.classList.contains('open')) closeAdminAccessPanel();
  else { panel.classList.add('open'); overlay.classList.add('show'); }
}
function closeAdminAccessPanel() {
  document.getElementById('adminAccessPanel').classList.remove('open');
  document.getElementById('adminAccessOverlay').classList.remove('show');
}

function toggleBypassAuth() {
  window.ABAE_BYPASS_AUTH = !window.ABAE_BYPASS_AUTH;
  const toggle = document.getElementById('aapBypassToggle');
  const status = document.getElementById('aapBypassStatus');
  const heroLabel = document.getElementById('aapHeroProfilLabel');
  const icon = document.getElementById('aapBypassIcon');
  if (window.ABAE_BYPASS_AUTH) {
    toggle.classList.add('active');
    status.textContent = 'ActivÃ© â€” accÃ¨s total dÃ©verrouillÃ©';
    if (heroLabel) heroLabel.textContent = 'Mode Admin actif ğŸ”“';
    if (icon) icon.textContent = 'âœ…';
    ABAE_SUB.activate('pro', 'monthly');
  } else {
    toggle.classList.remove('active');
    status.textContent = 'DÃ©sactivÃ© â€” accÃ¨s restreint';
    if (heroLabel) heroLabel.textContent = 'Mode restreint';
    if (icon) icon.textContent = 'ğŸ›¡';
  }
}

function aapGo(page) {
  if (!window.ABAE_BYPASS_AUTH) {
    window.ABAE_BYPASS_AUTH = true;
    document.getElementById('aapBypassToggle').classList.add('active');
    document.getElementById('aapBypassStatus').textContent = 'ActivÃ© â€” accÃ¨s total dÃ©verrouillÃ©';
    const heroLabel = document.getElementById('aapHeroProfilLabel');
    if (heroLabel) heroLabel.textContent = 'Mode Admin actif ğŸ”“';
    const icon = document.getElementById('aapBypassIcon');
    if (icon) icon.textContent = 'âœ…';
    ABAE_SUB.activate('pro', 'monthly');
  }
  closeAdminAccessPanel();
  showView(page);
}

function aapGoMarche() {
  if (!window.ABAE_BYPASS_AUTH) {
    window.ABAE_BYPASS_AUTH = true;
    ABAE_SUB.activate('pro', 'monthly');
    document.getElementById('aapBypassToggle').classList.add('active');
    document.getElementById('aapBypassStatus').textContent = 'ActivÃ© â€” accÃ¨s total dÃ©verrouillÃ©';
    const heroLabel = document.getElementById('aapHeroProfilLabel');
    if (heroLabel) heroLabel.textContent = 'Mode Admin actif ğŸ”“';
    const icon = document.getElementById('aapBypassIcon');
    if (icon) icon.textContent = 'âœ…';
  }
  closeAdminAccessPanel();
  showView('marche');
  setTimeout(() => {
    if (typeof updateMarcheHero === 'function') updateMarcheHero('harold', 'vendeur');
  }, 120);
}

function aapGoAdmin() {
  window.ABAE_BYPASS_AUTH = true;
  closeAdminAccessPanel();
  showView('admin-login');
  setTimeout(() => {
    const code = '123456';
    for (let i = 0; i < 6; i++) {
      const inp = document.getElementById('ac' + i);
      if (inp) { inp.value = code[i]; inp.dispatchEvent(new Event('input')); }
    }
    // Auto-submit after filling the code
    setTimeout(() => {
      const submitBtn = document.querySelector('#page-admin-login .btn-p, #page-admin-login button[type="submit"], #page-admin-login .btn-primary');
      if (submitBtn) submitBtn.click();
    }, 300);
  }, 400);
}
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ABAE â€” MOTEUR DE PERSISTANCE PROFIL  (v9)
     Sauvegarde / Restauration rigoureuse des profils utilisateurs
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<style>
/* BanniÃ¨re de reconnaissance profil sur la page login */
#loginProfileRecognized {
  display: none;
  align-items: center;
  gap: 10px;
  background: var(--vc, #EDF7E5);
  border: 1.5px solid rgba(74,158,42,0.25);
  border-radius: 12px;
  padding: 10px 14px;
  margin-bottom: 14px;
  animation: abaePanelSlideUp 0.28s cubic-bezier(0.32,0.72,0,1) both;
}
#loginProfileRecognized .lpr-icon {
  font-size: 1.6rem;
  flex-shrink: 0;
}
#loginProfileRecognized .lpr-info { flex: 1; min-width: 0; }
#loginProfileRecognized .lpr-name {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 0.9rem;
  color: var(--gris-900, #1A1E25);
}
#loginProfileRecognized .lpr-profil {
  font-size: 0.75rem;
  color: var(--vert-principal, #4A9E2A);
  margin-top: 2px;
  font-weight: 600;
}
#loginProfileRecognized .lpr-badge {
  background: var(--vert-principal, #4A9E2A);
  color: #fff;
  font-size: 0.65rem;
  font-weight: 700;
  font-family: 'Sora', sans-serif;
  padding: 3px 8px;
  border-radius: 20px;
  white-space: nowrap;
  flex-shrink: 0;
}


/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  PAGE LOGIN â€” ABAE Luxury Dark v27                               â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

#page-login {
  min-height: 100vh;
  background: #163D25;
  position: relative;
  overflow: hidden;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
#page-login.active { display: flex; }

/* â”€â”€ Fond : mesh lumineux â”€â”€ */
#lp-bg {
  position: absolute; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 60% 40% at 20% 15%, rgba(74,158,42,0.30) 0%, transparent 60%),
    radial-gradient(ellipse 50% 35% at 80% 80%, rgba(46,204,113,0.15) 0%, transparent 55%),
    radial-gradient(ellipse 30% 25% at 50% 50%, rgba(212,168,67,0.05) 0%, transparent 60%);
}

/* Lignes de grille subtiles */
#lp-grid {
  position: absolute; inset: 0; pointer-events: none; z-index: 0;
  background-image:
    linear-gradient(rgba(46,204,113,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(46,204,113,0.04) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(ellipse 80% 80% at 50% 50%, black 0%, transparent 100%);
}

/* Orbes flottants */
.lp-orb {
  position: absolute; border-radius: 50%; pointer-events: none; z-index: 0;
  filter: blur(60px); opacity: 0.25;
  animation: lp-orb-drift ease-in-out infinite alternate;
}
.lp-orb:nth-child(1) { width:300px;height:300px; background:#4A9E2A; top:-80px;  left:-80px;  animation-duration:8s; }
.lp-orb:nth-child(2) { width:200px;height:200px; background:#6ED63B; bottom:-60px;right:-60px; animation-duration:11s;animation-delay:2s; }
.lp-orb:nth-child(3) { width:150px;height:150px; background:#D4A843; top:40%;    right:5%;    animation-duration:9s; animation-delay:4s;opacity:0.12; }
@keyframes lp-orb-drift {
  from { transform: translate(0,0) scale(1); }
  to   { transform: translate(30px,20px) scale(1.15); }
}

/* â”€â”€ Card principale â”€â”€ */
#lp-card {
  position: relative; z-index: 2;
  width: 100%; max-width: 420px;
  padding: 40px 36px 36px;
  background: rgba(255,255,255,0.035);
  border: 1px solid rgba(46,204,113,0.12);
  border-radius: 28px;
  backdrop-filter: blur(20px);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.04) inset,
    0 32px 80px rgba(0,0,0,0.6),
    0 0 60px rgba(74,158,42,0.08);
  margin: 20px 16px;
  animation: lp-card-in 0.8s cubic-bezier(0.22,1,0.36,1) both;
}
@keyframes lp-card-in {
  from { opacity:0; transform: translateY(32px) scale(0.97); }
  to   { opacity:1; transform: translateY(0)    scale(1);    }
}

/* â”€â”€ Header card â”€â”€ */
#lp-header {
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 28px;
  animation: lp-fadein 0.6s ease 0.25s both;
}
#lp-logo-img {
  width: 52px; height: 52px; border-radius: 14px;
  object-fit: cover; flex-shrink: 0;
  box-shadow: 0 4px 16px rgba(74,158,42,0.4), 0 0 0 1px rgba(255,255,255,0.08);
}
#lp-header-text {}
#lp-header-title {
  font-family: 'Sora', sans-serif;
  font-size: 1.35rem; font-weight: 800;
  color: #fff; line-height: 1.1;
  letter-spacing: -0.4px;
  margin: 0 0 3px;
}
#lp-header-sub {
  font-family: 'DM Sans', sans-serif;
  font-size: 0.82rem; color: rgba(255,255,255,0.45);
  margin: 0; font-weight: 400;
}

/* â”€â”€ Onglets profil (Membre / AffiliÃ©) â”€â”€ */
#lp-profile-tabs {
  display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
  margin-bottom: 22px;
  animation: lp-fadein 0.6s ease 0.35s both;
}
.lp-ptab {
  display: flex; align-items: center; justify-content: center; gap: 7px;
  padding: 11px 14px; border-radius: 12px;
  border: 1.5px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.03);
  font-family: 'Sora', sans-serif; font-weight: 600;
  font-size: 0.82rem; color: rgba(255,255,255,0.4);
  cursor: pointer; transition: all 0.22s ease;
}
.lp-ptab svg { width:15px;height:15px;stroke:currentColor;stroke-width:1.8;fill:none;flex-shrink:0; }
.lp-ptab:hover { border-color:rgba(46,204,113,0.3); color:rgba(255,255,255,0.7); }
.lp-ptab.active {
  border-color: rgba(46,204,113,0.5);
  background: rgba(74,158,42,0.2);
  color: #6ED63B;
  box-shadow: 0 0 0 3px rgba(46,204,113,0.08), inset 0 0 12px rgba(46,204,113,0.05);
}
.lp-ptab.active[data-p="affilie"] {
  border-color: rgba(155,27,106,0.5);
  background: rgba(155,27,106,0.15);
  color: #d966b2;
  box-shadow: 0 0 0 3px rgba(155,27,106,0.08);
}

/* Bandeau affiliÃ© */
#lp-aff-banner {
  display: none; border-radius: 12px; padding: 12px 14px;
  background: linear-gradient(135deg,rgba(74,14,107,0.6),rgba(155,27,106,0.6));
  border: 1px solid rgba(155,27,106,0.3);
  margin-bottom: 18px; gap: 10px; align-items: center;
  animation: lp-fadein 0.3s ease both;
}
#lp-aff-banner.show { display: flex; }
#lp-aff-banner svg { width:22px;height:22px;stroke:#fff;stroke-width:1.5;fill:none;flex-shrink:0; }
#lp-aff-banner-title { font-family:'Sora',sans-serif;font-weight:700;font-size:0.85rem;color:#fff; }
#lp-aff-banner-sub { font-size:0.72rem;color:rgba(255,255,255,0.65);margin-top:2px; }

/* â”€â”€ Onglets Email / Tel â”€â”€ */
#lp-method-tabs {
  display: flex; background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 12px; padding: 4px; gap: 4px;
  margin-bottom: 20px;
  animation: lp-fadein 0.6s ease 0.4s both;
}
.lp-mtab {
  flex: 1; text-align: center; padding: 9px 12px;
  border-radius: 9px; font-size: 0.82rem; font-weight: 600;
  color: rgba(255,255,255,0.35); cursor: pointer;
  transition: all 0.22s ease;
}
.lp-mtab.active {
  background: rgba(74,158,42,0.25);
  color: #6ED63B;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

/* â”€â”€ Champs de saisie â”€â”€ */
.lp-field {
  margin-bottom: 14px;
  animation: lp-fadein 0.6s ease var(--d,0.45s) both;
}
.lp-field-label {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 7px;
}
.lp-field-label span {
  font-size: 0.8rem; font-weight: 600;
  color: rgba(255,255,255,0.55); font-family: 'DM Sans', sans-serif;
}
.lp-field-label a {
  font-size: 0.75rem; color: #6ED63B; font-weight: 600;
  text-decoration: none; opacity: 0.8; transition: opacity 0.2s;
}
.lp-field-label a:hover { opacity: 1; }

.lp-input-wrap { position: relative; }
.lp-input {
  width: 100%; height: 52px;
  background: rgba(255,255,255,0.05);
  border: 1.5px solid rgba(255,255,255,0.08);
  border-radius: 12px; padding: 0 44px 0 16px;
  font-size: 0.95rem; color: #fff;
  font-family: 'DM Sans', sans-serif; font-weight: 500;
  outline: none; transition: all 0.25s ease;
  -webkit-appearance: none;
}
.lp-input::placeholder { color: rgba(255,255,255,0.2); }
.lp-input:focus {
  border-color: rgba(46,204,113,0.5);
  background: rgba(74,158,42,0.1);
  box-shadow: 0 0 0 3px rgba(46,204,113,0.08), 0 0 20px rgba(46,204,113,0.06);
}
.lp-input.err { border-color: rgba(229,62,62,0.6); background: rgba(229,62,62,0.07); }
.lp-ico-r {
  position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
  width: 18px; height: 18px; stroke: rgba(255,255,255,0.3);
  stroke-width: 1.5; fill: none; cursor: pointer; transition: stroke 0.2s;
}
.lp-ico-r:hover { stroke: rgba(255,255,255,0.7); }

/* Phone wrap */
.lp-phone-wrap { display: flex; gap: 8px; }
.lp-phone-pfx {
  display: flex; align-items: center; gap: 6px;
  padding: 0 14px; height: 52px; border-radius: 12px;
  background: rgba(255,255,255,0.05);
  border: 1.5px solid rgba(255,255,255,0.08);
  font-size: 0.875rem; color: rgba(255,255,255,0.6);
  white-space: nowrap; flex-shrink: 0;
}
.lp-phone-wrap .lp-input { flex: 1; }

/* Rester connectÃ© */
#lp-remember {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 18px; cursor: pointer;
  animation: lp-fadein 0.6s ease 0.55s both;
}
#lp-remember-chk {
  width: 20px; height: 20px; border-radius: 6px; flex-shrink: 0;
  border: 1.5px solid rgba(255,255,255,0.2);
  background: rgba(255,255,255,0.04);
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s ease;
}
#lp-remember-chk.on {
  background: rgba(74,158,42,0.5);
  border-color: rgba(46,204,113,0.5);
}
#lp-remember-chk svg { width:12px;height:12px;stroke:#6ED63B;stroke-width:2.5;fill:none;opacity:0;transition:opacity 0.2s; }
#lp-remember-chk.on svg { opacity: 1; }
#lp-remember-txt {
  font-size: 0.82rem; color: rgba(255,255,255,0.45);
  font-family: 'DM Sans', sans-serif; user-select: none;
}

/* Alerte erreur */
#lp-err {
  display: none; align-items: center; gap: 10px;
  background: rgba(229,62,62,0.1); border: 1px solid rgba(229,62,62,0.25);
  border-radius: 10px; padding: 12px 14px; margin-bottom: 14px;
  font-size: 0.82rem; color: #fc8181;
  animation: lp-fadein 0.3s ease both;
}
#lp-err.show { display: flex; }
#lp-err svg { width:16px;height:16px;stroke:#fc8181;stroke-width:1.5;fill:none;flex-shrink:0; }

/* â”€â”€ Bouton Se connecter â”€â”€ */
#lp-submit {
  width: 100%; padding: 16px;
  background: linear-gradient(135deg, #4A9E2A 0%, #0f5234 100%);
  color: #fff; font-family: 'Sora', sans-serif;
  font-size: 0.95rem; font-weight: 700;
  border: none; border-radius: 14px; cursor: pointer;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  box-shadow: 0 4px 20px rgba(74,158,42,0.4), 0 0 0 1px rgba(46,204,113,0.15) inset;
  position: relative; overflow: hidden;
  transition: transform 0.18s ease, box-shadow 0.18s ease;
  margin-bottom: 16px;
  animation: lp-fadein 0.6s ease 0.6s both;
}
#lp-submit::before {
  content:''; position:absolute; top:0; left:-100%; width:60%; height:100%;
  background: linear-gradient(90deg,transparent,rgba(255,255,255,0.12),transparent);
  transform: skewX(-20deg);
  animation: lp-shine 3.5s ease 1.5s infinite;
}
@keyframes lp-shine { 0%{left:-100%} 35%,100%{left:150%} }
#lp-submit:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(74,158,42,0.55); }
#lp-submit:active { transform: translateY(0) scale(0.98); }
#lp-submit svg { width:16px;height:16px;stroke:#fff;stroke-width:2.5;fill:none;flex-shrink:0; }

/* â”€â”€ Lien inscription â”€â”€ */
.lp-link-row {
  text-align: center; font-size: 0.82rem;
  color: rgba(255,255,255,0.35); margin-bottom: 4px;
  animation: lp-fadein 0.6s ease 0.65s both;
}
.lp-link-row a, .lp-link-row button {
  color: #6ED63B; font-weight: 700;
  font-family: 'Sora', sans-serif; font-size: 0.82rem;
  background: none; border: none; cursor: pointer; text-decoration: none;
  transition: opacity 0.2s;
}
.lp-link-row a:hover { opacity: 0.75; }

/* â”€â”€ SÃ©parateur â”€â”€ */
.lp-sep {
  display: flex; align-items: center; gap: 12px;
  margin: 18px 0; color: rgba(255,255,255,0.2); font-size: 0.78rem;
  animation: lp-fadein 0.6s ease 0.68s both;
}
.lp-sep::before, .lp-sep::after {
  content:''; flex:1; height:1px; background:rgba(255,255,255,0.08);
}

/* â”€â”€ Boutons sociaux â”€â”€ */
#lp-social {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
  animation: lp-fadein 0.6s ease 0.72s both;
}
.lp-social-btn {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 12px; border-radius: 12px;
  border: 1.5px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.03);
  font-family: 'DM Sans', sans-serif; font-weight: 600;
  font-size: 0.82rem; color: rgba(255,255,255,0.55);
  cursor: pointer; transition: all 0.22s ease;
}
.lp-social-btn:hover { border-color:rgba(255,255,255,0.2); color:#fff; background:rgba(255,255,255,0.06); }
.lp-social-btn svg { width:16px;height:16px;flex-shrink:0; }

/* â”€â”€ Footer â”€â”€ */
#lp-footer {
  text-align: center; margin-top: 20px;
  font-size: 0.72rem; color: rgba(255,255,255,0.2);
  animation: lp-fadein 0.6s ease 0.8s both;
}
#lp-footer a { color: rgba(255,255,255,0.3); text-decoration: none; transition: color 0.2s; }
#lp-footer a:hover { color: rgba(255,255,255,0.6); }
#lp-footer span { margin: 0 6px; }

/* Bouton admin discret */
#lp-admin-btn {
  display: block; text-align: center; margin-top: 10px;
  font-size: 0.68rem; color: rgba(255,255,255,0.12);
  background: none; border: none; cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  transition: color 0.2s;
}
#lp-admin-btn:hover { color: rgba(255,255,255,0.35); }

/* Animation utilitaire */
@keyframes lp-fadein {
  from { opacity:0; transform: translateY(12px); }
  to   { opacity:1; transform: translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE VÃ‰RIFICATION EMAIL â€” Dark Immersive Theme
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-verify-email {
  min-height: 100vh;
  background: #163D25;
  position: relative;
  overflow: hidden;
}
#page-verify-email::before {
  content: '';
  position: absolute; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 55% 40% at 20% 20%, rgba(74,158,42,0.20) 0%, transparent 60%),
    radial-gradient(ellipse 45% 35% at 80% 80%, rgba(46,204,113,0.08) 0%, transparent 55%);
}
#page-verify-email::after {
  content: '';
  position: absolute; inset: 0; pointer-events: none; z-index: 0;
  background-image:
    linear-gradient(rgba(46,204,113,0.035) 1px, transparent 1px),
    linear-gradient(90deg, rgba(46,204,113,0.035) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(ellipse 80% 80% at 50% 50%, black 0%, transparent 100%);
}
/* Floating email particles */
.ve-particles { position: absolute; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
.ve-particle {
  position: absolute; bottom: -10px; width: 4px; height: 4px; border-radius: 50%;
  background: rgba(46,204,113,0.4); opacity: 0;
  animation: veParticleFloat ease-in-out infinite;
}
@keyframes veParticleFloat {
  0% { opacity: 0; transform: translateY(0) scale(0.5); }
  15% { opacity: 0.5; }
  85% { opacity: 0.2; }
  100% { opacity: 0; transform: translateY(-90vh) scale(1.2); }
}

/* Header */
#page-verify-email .hdr {
  background: rgba(3,15,7,0.85) !important;
  backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(46,204,113,0.1) !important;
  position: sticky; top: 0; z-index: 100;
}
#page-verify-email .hdr-back { color: rgba(255,255,255,0.5) !important; }
#page-verify-email .hdr-back:hover { color: #6ED63B !important; }
#page-verify-email .hdr-back svg { stroke: currentColor !important; }
#page-verify-email .logo-mark {
  background: linear-gradient(135deg, #4A9E2A 0%, #2A5E10 100%) !important;
  box-shadow: 0 0 12px rgba(74,158,42,0.5) !important;
}
#page-verify-email .logo-name { color: #fff !important; }

/* Verify wrap */
#page-verify-email .verify-wrap {
  max-width: 440px; margin: 0 auto; padding: 60px 20px 80px;
  text-align: center; position: relative; z-index: 2;
}

/* Animated envelope icon */
#page-verify-email .verify-icon {
  width: 110px; height: 110px; border-radius: 50%;
  background: rgba(74,158,42,0.15) !important;
  border: 2px solid rgba(46,204,113,0.25) !important;
  box-shadow: 0 0 0 10px rgba(46,204,113,0.05), 0 0 40px rgba(46,204,113,0.15) !important;
  animation: veIconPulse 2.5s ease-in-out infinite !important;
}
@keyframes veIconPulse {
  0%, 100% { box-shadow: 0 0 0 8px rgba(46,204,113,0.05), 0 0 30px rgba(46,204,113,0.1); }
  50% { box-shadow: 0 0 0 16px rgba(46,204,113,0.03), 0 0 50px rgba(46,204,113,0.2); }
}
#page-verify-email .verify-icon svg { stroke: #6ED63B !important; }

/* Glass card wrapping content */
#page-verify-email .verify-wrap::before {
  content: '';
  position: absolute; top: 130px; left: 0; right: 0; bottom: 20px;
  background: rgba(255,255,255,0.025);
  border: 1px solid rgba(46,204,113,0.12);
  border-radius: 28px;
  backdrop-filter: blur(20px);
  box-shadow: 0 0 0 1px rgba(255,255,255,0.03) inset, 0 24px 60px rgba(0,0,0,0.5);
  z-index: -1;
  pointer-events: none;
}

/* Texts */
#page-verify-email .form-title { color: #fff !important; }
#page-verify-email .form-sub { color: rgba(255,255,255,0.5) !important; }
#page-verify-email p[style*="color:var(--gris-700)"],
#page-verify-email p[style*="color: var(--gris-700)"] { color: rgba(255,255,255,0.5) !important; }
#page-verify-email p[style*="color:var(--gris-400)"],
#page-verify-email p[style*="color: var(--gris-400)"] { color: rgba(255,255,255,0.3) !important; }
#page-verify-email p a[style*="color:var(--gris-400)"] { color: rgba(255,255,255,0.3) !important; }
#page-verify-email p a[style*="color:var(--gris-400)"]:hover { color: #6ED63B !important; }

/* Email badge */
#page-verify-email .verify-email-badge {
  background: rgba(46,204,113,0.1) !important;
  color: #6ED63B !important;
  border: 1px solid rgba(46,204,113,0.2) !important;
  border-radius: 12px !important;
  padding: 10px 20px !important;
  font-family: 'JetBrains Mono', monospace !important;
}

/* Email buttons */
#page-verify-email .email-btns .btn {
  background: rgba(255,255,255,0.05) !important;
  border: 1.5px solid rgba(255,255,255,0.1) !important;
  color: rgba(255,255,255,0.65) !important;
  border-radius: 12px !important;
}
#page-verify-email .email-btns .btn:hover {
  background: rgba(255,255,255,0.1) !important;
  border-color: rgba(46,204,113,0.3) !important;
  color: #fff !important;
}

/* Separator */
#page-verify-email .separator { color: rgba(255,255,255,0.25) !important; }
#page-verify-email .separator::before,
#page-verify-email .separator::after { background: rgba(255,255,255,0.07) !important; }

/* Resend link */
#page-verify-email .resend-link { color: #6ED63B !important; }

/* Admin bypass section */
#page-verify-email [style*="border-top:1px dashed"] {
  border-top-color: rgba(255,255,255,0.07) !important;
}
#page-verify-email #adminBypassArea { background: transparent; }
#page-verify-email #adminBypassCode {
  background: rgba(255,255,255,0.05) !important;
  border-color: rgba(255,255,255,0.08) !important;
  color: #fff !important;
  border-radius: 12px !important;
}

/* Footer */
#page-verify-email .footer-mini {
  background: rgba(255,255,255,0.02) !important;
  border-top-color: rgba(255,255,255,0.06) !important;
  position: relative; z-index: 2;
}
#page-verify-email .footer-mini p,
#page-verify-email .footer-mini a { color: rgba(255,255,255,0.2) !important; }
#page-verify-email .footer-mini a:hover { color: #6ED63B !important; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE EMAIL CONFIRMÃ‰ â€” Dark Celebration Theme
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-email-confirmed {
  min-height: 100vh;
  background: #163D25;
  position: relative;
  overflow: hidden;
}
#page-email-confirmed::before {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 60% 45% at 50% 0%, rgba(46,204,113,0.18) 0%, transparent 65%),
    radial-gradient(ellipse 50% 40% at 20% 90%, rgba(212,168,67,0.10) 0%, transparent 55%),
    radial-gradient(ellipse 40% 35% at 80% 60%, rgba(74,158,42,0.12) 0%, transparent 60%);
}
#page-email-confirmed::after {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background-image:
    linear-gradient(rgba(46,204,113,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(46,204,113,0.03) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(ellipse 90% 90% at 50% 50%, black 0%, transparent 100%);
}

/* Celebration confetti particles */
.conf-particles { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
.conf-p {
  position: absolute; bottom: -10px; width: 5px; height: 5px; border-radius: 50%;
  opacity: 0;
  animation: confFloat ease-in-out infinite;
}
@keyframes confFloat {
  0% { opacity: 0; transform: translateY(0) rotate(0deg) scale(0.5); }
  10% { opacity: 0.7; }
  90% { opacity: 0.2; }
  100% { opacity: 0; transform: translateY(-85vh) rotate(720deg) scale(1.5); }
}

/* Header */
#page-email-confirmed .hdr {
  background: rgba(3,15,7,0.85) !important;
  backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(46,204,113,0.1) !important;
  position: sticky; top: 0; z-index: 100;
}
#page-email-confirmed .logo-mark {
  background: linear-gradient(135deg, #4A9E2A 0%, #2A5E10 100%) !important;
  box-shadow: 0 0 12px rgba(74,158,42,0.5) !important;
}
#page-email-confirmed .logo-name { color: #fff !important; }

/* Success wrap */
#page-email-confirmed .success-wrap {
  max-width: 460px; margin: 0 auto; padding: 60px 20px 80px;
  text-align: center; position: relative; z-index: 2;
}

/* Glass card effect behind content */
#page-email-confirmed .success-wrap > *:not(:first-child) {
  position: relative; z-index: 2;
}

/* Success icon â€” celebration ring */
#page-email-confirmed .success-icon {
  width: 120px; height: 120px; border-radius: 50%;
  background: radial-gradient(circle, rgba(46,204,113,0.2), rgba(74,158,42,0.1)) !important;
  border: 2px solid rgba(46,204,113,0.4) !important;
  box-shadow: 0 0 0 12px rgba(46,204,113,0.06), 0 0 60px rgba(46,204,113,0.25) !important;
  animation: successBounce 0.6s cubic-bezier(0.22,1,0.36,1) 0.1s both, successGlow 2.5s ease-in-out 0.7s infinite !important;
}
@keyframes successBounce {
  from { opacity:0; transform: scale(0.4) rotate(-10deg); }
  to { opacity:1; transform: scale(1) rotate(0deg); }
}
@keyframes successGlow {
  0%, 100% { box-shadow: 0 0 0 10px rgba(46,204,113,0.05), 0 0 40px rgba(46,204,113,0.15); }
  50% { box-shadow: 0 0 0 20px rgba(46,204,113,0.03), 0 0 70px rgba(46,204,113,0.3); }
}
#page-email-confirmed .success-icon svg { stroke: #6ED63B !important; width: 50px !important; height: 50px !important; }

/* Texts */
#page-email-confirmed .form-title {
  color: #fff !important;
  font-size: 2rem !important;
  animation: inscCardIn 0.6s ease 0.35s both;
}
#page-email-confirmed .form-sub {
  color: rgba(255,255,255,0.55) !important;
  animation: inscCardIn 0.6s ease 0.45s both;
}
#page-email-confirmed .form-sub strong { color: #6ED63B !important; }

/* CTA button */
#page-email-confirmed .btn-p {
  background: linear-gradient(135deg, #4A9E2A 0%, #0f5234 100%) !important;
  border-radius: 14px !important;
  box-shadow: 0 4px 20px rgba(74,158,42,0.4), 0 0 0 1px rgba(46,204,113,0.15) inset !important;
  animation: inscCardIn 0.6s ease 0.55s both;
  position: relative; overflow: hidden;
}
#page-email-confirmed .btn-p::before {
  content: '';
  position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
  transform: skewX(-20deg);
  animation: inscShine 4s ease 2s infinite;
}
#page-email-confirmed .btn-p:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 8px 28px rgba(74,158,42,0.55) !important;
}

/* KYC box */
#page-email-confirmed .kyc-box {
  background: rgba(255,255,255,0.04) !important;
  border: 1px solid rgba(255,255,255,0.08) !important;
  border-radius: 16px !important;
}
#page-email-confirmed .kyc-box-title { color: rgba(255,255,255,0.85) !important; }
#page-email-confirmed .kyc-box p { color: rgba(255,255,255,0.5) !important; }
#page-email-confirmed .btn-o {
  border-color: rgba(46,204,113,0.4) !important;
  color: #6ED63B !important;
  background: rgba(74,158,42,0.08) !important;
}
#page-email-confirmed .btn-g {
  border-color: rgba(255,255,255,0.1) !important;
  color: rgba(255,255,255,0.35) !important;
  background: rgba(255,255,255,0.03) !important;
}

/* Success / affiliation box */
#page-email-confirmed .success-box {
  background: rgba(255,255,255,0.04) !important;
  border: 1px solid rgba(212,168,67,0.15) !important;
  border-radius: 16px !important;
  animation: inscCardIn 0.6s ease 0.65s both;
}
#page-email-confirmed .success-box p { color: rgba(255,255,255,0.55) !important; }
#page-email-confirmed .aff-code {
  background: rgba(255,255,255,0.04) !important;
  border: 1.5px solid rgba(212,168,67,0.25) !important;
  border-radius: 12px !important;
  color: #D4A843 !important;
  font-family: 'JetBrains Mono', monospace !important;
  font-size: 1.1rem !important;
  letter-spacing: 3px !important;
}
#page-email-confirmed .copy-btn {
  background: rgba(212,168,67,0.15) !important;
  border: 1px solid rgba(212,168,67,0.3) !important;
  color: #D4A843 !important;
  border-radius: 10px !important;
}
#page-email-confirmed .copy-btn:hover {
  background: rgba(212,168,67,0.25) !important;
}

/* Footer */
#page-email-confirmed .footer-mini {
  background: rgba(255,255,255,0.02) !important;
  border-top-color: rgba(255,255,255,0.06) !important;
  position: relative; z-index: 2;
}
#page-email-confirmed .footer-mini p,
#page-email-confirmed .footer-mini a { color: rgba(255,255,255,0.2) !important; }
#page-email-confirmed .footer-mini a:hover { color: #6ED63B !important; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE ABONNEMENT â€” Elevated Premium Dark Theme
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-abonnement {
  background: #163D25 !important;
  position: relative;
}
#page-abonnement::before {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 60% 40% at 15% 10%, rgba(74,158,42,0.22) 0%, transparent 60%),
    radial-gradient(ellipse 50% 40% at 85% 85%, rgba(110,214,59,0.10) 0%, transparent 55%),
    radial-gradient(ellipse 35% 30% at 50% 50%, rgba(212,168,67,0.06) 0%, transparent 60%);
}
#page-abonnement::after {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background-image:
    linear-gradient(rgba(110,214,59,0.035) 1px, transparent 1px),
    linear-gradient(90deg, rgba(110,214,59,0.035) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(ellipse 90% 90% at 50% 50%, black 0%, transparent 100%);
}

/* Header */
.abo-hdr { padding: 24px 20px 0; position: relative; z-index: 2; }
.abo-logo-mark {
  background: rgba(255,255,255,0.12) !important;
  border: 1.5px solid rgba(255,255,255,0.2) !important;
  box-shadow: 0 0 20px rgba(46,204,113,0.2) !important;
}

/* Hero */
.abo-hero {
  padding: 32px 20px 24px;
  position: relative; z-index: 2;
  animation: inscCardIn 0.7s cubic-bezier(0.22,1,0.36,1) both;
}
.abo-hero-badge {
  background: rgba(212,168,67,0.15) !important;
  border: 1px solid rgba(212,168,67,0.35) !important;
  box-shadow: 0 0 20px rgba(212,168,67,0.1);
}
.abo-hero h1 {
  font-size: 2rem !important;
  background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.7) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.abo-hero p { color: rgba(255,255,255,0.55) !important; }

/* Toggle wrap */
.abo-toggle-wrap { position: relative; z-index: 2; }
.abo-toggle {
  background: rgba(255,255,255,0.1) !important;
  border: 1px solid rgba(255,255,255,0.15) !important;
  box-shadow: inset 0 1px 4px rgba(0,0,0,0.3) !important;
}
.abo-toggle.annual { background: rgba(212,168,67,0.2) !important; }
.abo-annual-badge { box-shadow: 0 2px 12px rgba(212,168,67,0.4) !important; }

/* Cards */
.abo-cards { position: relative; z-index: 2; }
.abo-card {
  background: rgba(255,255,255,0.04) !important;
  border: 1.5px solid rgba(255,255,255,0.07) !important;
  backdrop-filter: blur(20px);
  border-radius: 20px !important;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.03) inset !important;
  transition: all 0.25s cubic-bezier(0.4,0,0.2,1) !important;
}
.abo-card:hover {
  transform: translateY(-3px) !important;
  border-color: rgba(255,255,255,0.15) !important;
  box-shadow: 0 16px 48px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05) inset !important;
}
.abo-card.selected {
  background: rgba(74,158,42,0.18) !important;
  border-color: rgba(46,204,113,0.45) !important;
  box-shadow: 0 0 0 3px rgba(46,204,113,0.1), 0 16px 50px rgba(74,158,42,0.25), 0 0 40px rgba(46,204,113,0.1) !important;
}
.abo-card.standard.selected {
  background: rgba(59,130,246,0.12) !important;
  border-color: rgba(59,130,246,0.4) !important;
}
.abo-card.pro.selected {
  background: rgba(139,92,246,0.12) !important;
  border-color: rgba(139,92,246,0.4) !important;
}
.abo-card.entreprise.selected {
  background: rgba(212,168,67,0.12) !important;
  border-color: rgba(212,168,67,0.4) !important;
}

/* Card stripe */
.abo-card::before { opacity: 0.7 !important; }
.abo-card.selected::before { opacity: 1 !important; height: 4px !important; }

/* Card text */
.abo-card-name { color: rgba(255,255,255,0.9) !important; }
.abo-card-tagline { color: rgba(255,255,255,0.35) !important; }
.abo-card .abo-price-amount { color: rgba(255,255,255,0.95) !important; }
.abo-card.standard .abo-price-amount { color: #60A5FA !important; }
.abo-card.pro .abo-price-amount { color: #A78BFA !important; }
.abo-card.entreprise .abo-price-amount { color: #D4A843 !important; }
.abo-price-period { color: rgba(255,255,255,0.3) !important; }

/* Card icon */
.abo-card.gratuit .abo-card-icon { background: rgba(155,163,174,0.15) !important; }
.abo-card.standard .abo-card-icon { background: rgba(59,130,246,0.15) !important; }
.abo-card.pro .abo-card-icon { background: rgba(139,92,246,0.15) !important; }
.abo-card.entreprise .abo-card-icon { background: rgba(212,168,67,0.15) !important; }

/* Features chips */
.abo-feat {
  background: rgba(255,255,255,0.05) !important;
  border: 1px solid rgba(255,255,255,0.08) !important;
  color: rgba(255,255,255,0.65) !important;
  border-radius: 8px !important;
}
.abo-card.selected .abo-feat {
  background: rgba(46,204,113,0.08) !important;
  border-color: rgba(46,204,113,0.15) !important;
  color: rgba(255,255,255,0.8) !important;
}
.abo-feat-check { color: #6ED63B !important; font-weight: 900 !important; }

/* Popular badge */
.abo-badge-popular {
  background: linear-gradient(135deg, rgba(139,92,246,0.8), rgba(167,139,250,0.8)) !important;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(139,92,246,0.4) !important;
}

/* CTA */
.abo-cta-wrap { padding: 16px 16px 10px; position: relative; z-index: 2; }
.abo-cta-btn {
  border-radius: 16px !important;
  font-size: 1rem !important;
  letter-spacing: 0.2px !important;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3) !important;
  position: relative; overflow: hidden;
}
.abo-cta-btn::before {
  content: '';
  position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
  transform: skewX(-20deg);
  animation: inscShine 4s ease 1.5s infinite;
}
.abo-cta-btn.gratuit {
  background: rgba(255,255,255,0.07) !important;
  border: 1.5px solid rgba(255,255,255,0.15) !important;
}
.abo-cta-btn.gratuit:hover {
  background: rgba(255,255,255,0.12) !important;
}
.abo-cta-btn.payant {
  background: linear-gradient(135deg, #D4A843 0%, #F59E0B 100%) !important;
  box-shadow: 0 4px 24px rgba(212,168,67,0.45), 0 0 0 1px rgba(255,255,255,0.15) inset !important;
}
.abo-cta-btn.payant:hover { transform: translateY(-2px) !important; box-shadow: 0 8px 32px rgba(212,168,67,0.6) !important; }
.abo-security { color: rgba(255,255,255,0.35) !important; }

/* Payment sheet overlay */
.abo-pay-overlay { background: rgba(0,0,10,0.75) !important; backdrop-filter: blur(8px) !important; }
.abo-pay-sheet {
  background: #0d1f14 !important;
  border: 1px solid rgba(46,204,113,0.15) !important;
  border-bottom: none !important;
  box-shadow: 0 -20px 60px rgba(0,0,0,0.6) !important;
}
.abo-pay-title { color: #fff !important; }
.abo-pay-subtitle { color: rgba(255,255,255,0.35) !important; }
.abo-pay-summary {
  background: rgba(255,255,255,0.04) !important;
  border: 1px solid rgba(255,255,255,0.07) !important;
  border-radius: 14px !important;
}
.abo-pay-plan-name { color: rgba(255,255,255,0.85) !important; }
.abo-pay-methods-title { color: rgba(255,255,255,0.55) !important; }
.abo-pay-method {
  background: rgba(255,255,255,0.03) !important;
  border: 1.5px solid rgba(255,255,255,0.07) !important;
  border-radius: 14px !important;
}
.abo-pay-method:hover { border-color: rgba(46,204,113,0.3) !important; background: rgba(74,158,42,0.08) !important; }
.abo-pay-method.sel { border-color: rgba(46,204,113,0.5) !important; background: rgba(74,158,42,0.15) !important; }
.abo-pay-method-name { color: rgba(255,255,255,0.85) !important; }
.abo-pay-method-desc { color: rgba(255,255,255,0.35) !important; }
.abo-pay-confirm-btn {
  background: linear-gradient(135deg, #4A9E2A, #2A5E10) !important;
  border-radius: 14px !important;
  box-shadow: 0 4px 20px rgba(74,158,42,0.4), 0 0 0 1px rgba(46,204,113,0.15) inset !important;
}
.abo-pay-confirm-btn:hover { transform: translateY(-2px) !important; box-shadow: 0 8px 28px rgba(74,158,42,0.55) !important; }
.abo-pay-cancel { color: rgba(255,255,255,0.3) !important; }
.abo-pay-cancel:hover { color: #fc8181 !important; }

/* Back button in abo header */
#page-abonnement .abo-hdr button[onclick*="marche"] {
  background: rgba(255,255,255,0.08) !important;
  border: 1px solid rgba(255,255,255,0.12) !important;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 12px rgba(0,0,0,0.3) !important;
  color: rgba(255,255,255,0.7) !important;
}
#page-abonnement .abo-hdr button[onclick*="marche"]:hover {
  background: rgba(255,255,255,0.15) !important;
  color: #fff !important;
}


</style>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE â€” BASE DE DONNÃ‰ES UTILISATEURS (localStorage)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/** Lire toute la DB utilisateurs depuis localStorage */
function ABAE_getUsersDB() {
  try { return JSON.parse(localStorage.getItem('ABAE_USERS_DB') || '{}'); }
  catch(e) { return {}; }
}

/** Trouver un utilisateur par son email */
function ABAE_getUserByEmail(email) {
  if (!email) return null;
  const db = ABAE_getUsersDB();
  return db[email.toLowerCase().trim()] || null;
}

/** RÃ©cupÃ©rer l'utilisateur actif (email courant en session) */
function ABAE_getActiveUser() {
  const email = localStorage.getItem('ABAE_CURRENT_EMAIL') || '';
  const user  = ABAE_getUserByEmail(email);
  if (user) return user;
  // Fallback : rÃ©cupÃ©rer depuis fd ou nom par dÃ©faut
  return {
    nom:    fd && fd.type ? ((fd.type==='structure' ? '' : '') || window.ABAE_USER_NAME || 'Utilisateur') : (window.ABAE_USER_NAME || 'Utilisateur'),
    profil: fd && fd.profil ? fd.profil : 'acheteur',
    profils: fd && fd.profils ? fd.profils : ['acheteur']
  };
}

/** Injecter la banniÃ¨re de reconnaissance sur la page login */
function ABAE_injectLoginRecognitionBanner() {
  const loginForm = document.getElementById('loginEmailMode');
  if (!loginForm) return;
  if (document.getElementById('loginProfileRecognized')) return;

  const banner = document.createElement('div');
  banner.id = 'loginProfileRecognized';
  banner.innerHTML = `
    <div class="lpr-icon" id="lprIcon">ğŸ‘¤</div>
    <div class="lpr-info">
      <div class="lpr-name" id="lprName">â€”</div>
      <div class="lpr-profil" id="lprProfil">â€”</div>
    </div>
    <div class="lpr-badge">Reconnu âœ“</div>
  `;
  // InsÃ©rer avant le champ email
  const fieldGroup = loginForm.closest('form') || loginForm.parentElement;
  const firstField = loginForm;
  firstField.parentElement.insertBefore(banner, firstField);
}

/** Mettre Ã  jour la banniÃ¨re de reconnaissance selon l'email saisi */
function ABAE_updateLoginRecognition(emailVal) {
  const banner  = document.getElementById('loginProfileRecognized');
  if (!banner) return;

  const email   = (emailVal || '').toLowerCase().trim();
  const user    = ABAE_getUserByEmail(email);

  if (user && email.length > 4) {
    const profLabels = {
      producteur:   { label: 'Vendeur', emoji: 'ğŸŒ¾' },
      acheteur:     { label: 'Acheteur',             emoji: 'ğŸ›’' },
      transporteur: { label: 'Transporteur',         emoji: 'ğŸš›' },
      partenaire:   { label: 'Partenaire',           emoji: 'ğŸ¤' },
      affilie:      { label: 'AffiliÃ©',              emoji: 'ğŸ”—' }
    };
    const p = profLabels[user.profil] || { label: user.profil, emoji: 'ğŸ‘¤' };

    document.getElementById('lprIcon').textContent  = p.emoji;
    document.getElementById('lprName').textContent  = user.nom;
    document.getElementById('lprProfil').textContent = p.label;
    banner.style.display = 'flex';
  } else {
    banner.style.display = 'none';
  }
}

// â”€â”€ Initialisation : brancher la dÃ©tection sur le champ email login â”€â”€
(function ABAE_initProfilePersistence() {
  // Injecter la banniÃ¨re dÃ¨s que la page login est visible
  const observer = new MutationObserver(() => {
    const loginPage = document.getElementById('page-login');
    if (loginPage && loginPage.classList.contains('active')) {
      ABAE_injectLoginRecognitionBanner();

      // Brancher l'Ã©vÃ©nement input sur le champ email
      const emailInput = document.getElementById('loginEmail');
      if (emailInput && !emailInput.dataset.abaeHooked) {
        emailInput.dataset.abaeHooked = '1';
        emailInput.addEventListener('input', () => {
          ABAE_updateLoginRecognition(emailInput.value);
        });
        emailInput.addEventListener('blur', () => {
          ABAE_updateLoginRecognition(emailInput.value);
        });
        // Si un email est dÃ©jÃ  prÃ©-rempli
        if (emailInput.value) ABAE_updateLoginRecognition(emailInput.value);
      }
    }
  });
  observer.observe(document.body, { attributes: true, subtree: true, attributeFilter: ['class'] });

  // Hook sur showView pour dÃ©clencher aussi Ã  l'ouverture de login
  const _origShowView = window.showView;
  window.showView = function(id) {
    _origShowView.call(this, id);
    if (id === 'login') {
      setTimeout(() => {
        ABAE_injectLoginRecognitionBanner();
        const emailInput = document.getElementById('loginEmail');
        if (emailInput && !emailInput.dataset.abaeHooked) {
          emailInput.dataset.abaeHooked = '1';
          emailInput.addEventListener('input', () => ABAE_updateLoginRecognition(emailInput.value));
          emailInput.addEventListener('blur',  () => ABAE_updateLoginRecognition(emailInput.value));
        }
        // Tenter de prÃ©-remplir si session courante connue
        const currentEmail = localStorage.getItem('ABAE_CURRENT_EMAIL');
        if (currentEmail && emailInput && !emailInput.value) {
          emailInput.value = currentEmail;
          ABAE_updateLoginRecognition(currentEmail);
        }
      }, 100);
    }
  };
})();

// Initialisation des raccourcis marchÃ© au chargement
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHIPS TICKER â€” Injection sur toutes les pages marchÃ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function injectChipsTicker() {
  const CHIPS = [
    {icon:'ğŸŒ', label:'Tout'},
    {icon:'ğŸŒ¾', label:'Agricole'},
    {icon:'ğŸš›', label:'Transport'},
    {icon:'ğŸ­', label:'Stockage'},
    {icon:'ğŸ’»', label:'Digital'},
    {icon:'ğŸ’°', label:'Financement'},
    {icon:'ğŸ”§', label:'Conseil'},
    {icon:'âš™ï¸', label:'Ã‰quipements'},
    {icon:'ğŸšœ', label:'Machines'},
    {icon:'ğŸ½ï¸', label:'Agroalimentaire'},
  ];
  const chipHTML = CHIPS.map(c=>`<span class="chip-ticker-item">${c.icon} ${c.label}</span>`).join('');
  const tickerHTML = `<div class="chips-ticker-bar"><div class="chips-ticker-track">${chipHTML}${chipHTML}</div></div>`;

  const targets = ['screen-commandes','screen-documents','screen-docviewer',
                   'screen-portefeuille','screen-profil','screen-smart',
                   'screen-parametres','screen-detail','screen-order'];
  targets.forEach(id => {
    const screen = document.getElementById(id);
    if (!screen) return;
    // Insert after topbar (first child)
    const topbar = screen.querySelector('.topbar');
    if (topbar && topbar.nextSibling) {
      topbar.insertAdjacentHTML('afterend', tickerHTML);
    }
  });
})();

document.addEventListener('DOMContentLoaded', function() {
  if (typeof updateMarketShortcuts === 'function') {
    updateMarketShortcuts(window.ABAE_USER_ROLE || 'acheteur');
  }
});
</script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE â€” SystÃ¨me de ThÃ¨mes (v17)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  const THEME_KEY = 'abae_theme';
  const TARGET = document.getElementById('app') || document.body;

  function setTheme(theme) {
    // Appliquer sur l'Ã©lÃ©ment phone + body
    TARGET.setAttribute('data-theme', theme === 'light' ? '' : theme);
    document.body.setAttribute('data-theme', theme === 'light' ? '' : theme);
    localStorage.setItem(THEME_KEY, theme);

    // Mettre Ã  jour les boutons
    document.querySelectorAll('.theme-btn').forEach(btn => {
      const isActive = btn.id === 'theme-btn-' + theme;
      btn.style.borderColor = isActive ? 'var(--vp)' : 'var(--g200)';
      btn.style.background = isActive ? 'rgba(74,158,42,0.1)' : 'transparent';
      btn.classList.toggle('active', isActive);
      const label = btn.querySelector('span');
      if (label) label.style.color = isActive ? 'var(--vp)' : 'var(--g600)';
    });

    // Toast de confirmation
    if (typeof showToast === 'function') {
      const labels = { light: 'â˜€ï¸ ThÃ¨me Clair', dark: 'ğŸŒ™ ThÃ¨me Sombre', blue: 'ğŸŒŠ ThÃ¨me Bleu Marine' };
      showToast(labels[theme] || 'ThÃ¨me appliquÃ©');
    }
  }

  // Exposer globalement
  window.setTheme = setTheme;

  // Appliquer le thÃ¨me sauvegardÃ© au dÃ©marrage
  const saved = localStorage.getItem(THEME_KEY) || 'light';
  setTheme(saved);
})();
</script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE â€” PRIX DU MARCHÃ‰ EN TEMPS RÃ‰EL (v17)
// Utilise l'API Claude pour gÃ©nÃ©rer des prix rÃ©alistes et actualisÃ©s
// pour les produits agro-pastoraux, digitaux et Ã©quipements au Cameroun
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const MARKET_PRODUCTS = [
  // Agro-pastoraux
  { id:'mais',      emoji:'ğŸŒ½', name:'MaÃ¯s blanc',         unit:'XAF/kg',   base:370,  cat:'agricole' },
  { id:'cacao',     emoji:'ğŸ«', name:'Cacao grade A',       unit:'XAF/kg',   base:1850, cat:'agroalimentaire' },
  { id:'cafe',      emoji:'â˜•', name:'CafÃ© Arabica',        unit:'XAF/kg',   base:2200, cat:'agroalimentaire' },
  { id:'manioc',    emoji:'ğŸ¥”', name:'Manioc frais',        unit:'XAF/kg',   base:120,  cat:'agricole' },
  { id:'igname',    emoji:'ğŸŒ¿', name:'Igname Dioscorea',    unit:'XAF/kg',   base:450,  cat:'agricole' },
  { id:'plantain',  emoji:'ğŸŒ', name:'Banane plantain',     unit:'XAF/rÃ©gime',base:2500,cat:'agricole' },
  { id:'palmhuile', emoji:'ğŸ«™', name:'Huile de palme',      unit:'XAF/litre',base:950,  cat:'agroalimentaire' },
  { id:'boeuf',     emoji:'ğŸ„', name:'BÅ“uf vif (FoulbÃ©)',   unit:'XAF/kg vif',base:1200,cat:'elevage' },
  { id:'poisson',   emoji:'ğŸŸ', name:'Poisson fumÃ©',        unit:'XAF/kg',   base:2800, cat:'piscicole' },
  { id:'tomate',    emoji:'ğŸ…', name:'Tomate fraÃ®che',      unit:'XAF/kg',   base:350,  cat:'agricole' },
  // Ã‰quipements agricoles
  { id:'tracteur',  emoji:'ğŸšœ', name:'Location tracteur',   unit:'XAF/jour', base:45000,cat:'equipement' },
  { id:'pulveri',   emoji:'ğŸ’¨', name:'PulvÃ©risateur 20L',   unit:'XAF/unitÃ©',base:18000,cat:'equipement' },
  { id:'froid',     emoji:'â„ï¸', name:'Stockage froid 1mÂ³', unit:'XAF/mois', base:8500, cat:'equipement' },
  { id:'transport', emoji:'ğŸš›', name:'Transport Doualaâ†”YdÃ©',unit:'XAF/voyage',base:95000,cat:'transport' },
  // Digital & Services
  { id:'saas',      emoji:'ğŸ’»', name:'SaaS gestion coop.',  unit:'XAF/mois', base:12000,cat:'digital' },
  { id:'conseil',   emoji:'ğŸ§‘â€ğŸŒ¾', name:'Conseil agronomique',unit:'XAF/session',base:25000,cat:'services' },
  { id:'credit',    emoji:'ğŸ’°', name:'CrÃ©dit agricole',     unit:'%/an',     base:8,    cat:'financement' },
  { id:'assurance', emoji:'ğŸ›¡ï¸', name:'Assurance rÃ©colte',  unit:'XAF/ha/an',base:15000,cat:'services' },
];

let LIVE_PRICES = {};
let priceRefreshTimer = null;
let tickerInitialized = false;

// â”€â”€ GÃ©nÃ©rer variation rÃ©aliste â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function simulateMarketVariation(base, volatility = 0.04) {
  const trend = (Math.random() - 0.48) * volatility;
  const noise = (Math.random() - 0.5) * 0.02;
  const newPrice = Math.round(base * (1 + trend + noise));
  const pct = ((newPrice - base) / base * 100);
  return {
    price: newPrice,
    change: pct,
    direction: pct > 0.3 ? 'up' : pct < -0.3 ? 'down' : 'flat'
  };
}

// â”€â”€ Formater le prix selon la catÃ©gorie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function formatMarketPrice(product, price) {
  if (product.id === 'credit') return price.toFixed(1) + '%';
  if (price >= 100000) return (price/1000).toFixed(0) + 'K XAF';
  if (price >= 1000) return price.toLocaleString('fr-FR') + ' XAF';
  return price + ' XAF';
}

// â”€â”€ Charger les prix via Claude API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchMarketPricesFromAI() {
  const productList = MARKET_PRODUCTS.map(p =>
    `${p.name} (base: ${p.base} ${p.unit})`
  ).join(', ');

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{
          role: 'user',
          content: `Tu es un expert des marchÃ©s agro-pastoraux camerounais.
GÃ©nÃ¨re des prix de marchÃ© RÃ‰ALISTES en XAF pour aujourd'hui (${new Date().toLocaleDateString('fr-FR')}).
Tiens compte des saisons, de l'inflation locale, et des fluctuations habituelles.

Produits: ${productList}

RÃ©ponds UNIQUEMENT en JSON valide, sans aucun texte avant ou aprÃ¨s:
{
  "prices": [
    {"id": "mais", "price": 385, "change": +2.5, "trend": "up"},
    ...
  ],
  "lastUpdate": "Mis Ã  jour Ã  HH:MM"
}

RÃ¨gles:
- Prix en XAF entiers (sauf crÃ©dit en % avec 1 dÃ©cimale)
- change = variation en % par rapport Ã  hier (-10 Ã  +10%)
- trend: "up" si change > 0.3, "down" si change < -0.3, "flat" sinon
- Utilise les IDs exacts: ${MARKET_PRODUCTS.map(p=>p.id).join(', ')}`
        }]
      })
    });

    const data = await response.json();
    const text = data.content?.map(c => c.text || '').join('') || '';
    const clean = text.replace(/```json|```/g, '').trim();
    const parsed = JSON.parse(clean);

    if (parsed.prices && Array.isArray(parsed.prices)) {
      parsed.prices.forEach(item => {
        const product = MARKET_PRODUCTS.find(p => p.id === item.id);
        if (product) {
          LIVE_PRICES[item.id] = {
            price: item.price,
            change: item.change,
            direction: item.trend || (item.change > 0.3 ? 'up' : item.change < -0.3 ? 'down' : 'flat'),
            formatted: formatMarketPrice(product, item.price)
          };
        }
      });
      return parsed.lastUpdate || 'Mis Ã  jour Ã  ' + new Date().toLocaleTimeString('fr-FR', {hour:'2-digit',minute:'2-digit'});
    }
  } catch(e) {
    console.warn('API prix indisponible, simulation locale:', e);
  }

  // Fallback : simulation locale
  MARKET_PRODUCTS.forEach(p => {
    const v = simulateMarketVariation(p.base);
    LIVE_PRICES[p.id] = {
      price: v.price,
      change: v.change,
      direction: v.direction,
      formatted: formatMarketPrice(p, v.price)
    };
  });
  return 'SimulÃ© Ã  ' + new Date().toLocaleTimeString('fr-FR', {hour:'2-digit',minute:'2-digit'});
}

// â”€â”€ Rendu du ticker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTicker() {
  const track = document.getElementById('tickerTrack');
  if (!track) return;

  const items = MARKET_PRODUCTS.map(p => {
    const lp = LIVE_PRICES[p.id];
    if (!lp) return '';
    const sign = lp.change > 0 ? '+' : '';
    return `<span class="ticker-item" onclick="navTo('smart')">
      <span class="ticker-name">${p.emoji} ${p.name}</span>
      <span class="ticker-price">${lp.formatted}</span>
      <span class="ticker-change ${lp.direction}">${sign}${lp.change.toFixed(1)}%</span>
    </span>`;
  }).join('');

  // Doubler pour le scroll infini
  track.innerHTML = items + items;
}

// â”€â”€ Rendu du panel Smart IA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMarketPricePanel(lastUpdate) {
  const panel = document.getElementById('marketPriceRows');
  const updateEl = document.getElementById('priceLastUpdate');
  if (updateEl) updateEl.textContent = lastUpdate;
  if (!panel) return;

  const catLabels = {
    agro: 'ğŸŒ¾ Agro-pastoral',
    equipement: 'âš™ï¸ Ã‰quipements',
    transport: 'ğŸš› Transport',
    digital: 'ğŸ’» Digital',
    services: 'ğŸ› ï¸ Services',
    financement: 'ğŸ’° Financement'
  };

  let html = '';
  let currentCat = '';

  MARKET_PRODUCTS.forEach(p => {
    const lp = LIVE_PRICES[p.id];
    if (!lp) return;
    if (p.cat !== currentCat) {
      if (currentCat) html += '</div>';
      currentCat = p.cat;
      html += `<div class="market-cat-group">
        <div style="padding:6px 14px;background:var(--g50);font-size:0.62rem;font-weight:700;color:var(--g600);letter-spacing:0.5px;text-transform:uppercase;">${catLabels[p.cat]||p.cat}</div>`;
    }
    const sign = lp.change > 0 ? '+' : '';
    const arrow = lp.direction === 'up' ? 'â–²' : lp.direction === 'down' ? 'â–¼' : 'â—';
    html += `<div class="market-price-row" onclick="navTo('marche')">
      <span class="market-price-emoji">${p.emoji}</span>
      <div style="flex:1;">
        <div class="market-price-name">${p.name}</div>
        <div class="market-price-unit">${p.unit}</div>
      </div>
      <div>
        <div class="market-price-val">${lp.formatted}</div>
        <div class="market-price-change ${lp.direction}">${arrow} ${sign}${lp.change.toFixed(1)}%</div>
      </div>
    </div>`;
  });
  if (currentCat) html += '</div>';
  panel.innerHTML = html;
}

// â”€â”€ Mettre Ã  jour les prix sur les cards du marchÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateProductCardPrices() {
  const priceMap = {
    'mais':      1,  // id produit ABAE
    'igname':    5,
    'cacao':     8,
    'transport': 3,
    'saas':      4,
    'conseil':   9,
  };

  Object.entries(priceMap).forEach(([marketId, productId]) => {
    const lp = LIVE_PRICES[marketId];
    const product = PRODUCTS.find(p => p.id === productId);
    if (!lp || !product || product.priceLabel.includes('devis') || product.priceLabel.includes('Taux')) return;

    const product2 = MARKET_PRODUCTS.find(p => p.id === marketId);
    product.price = lp.price;
    product.priceLabel = `${lp.formatted}/${product2.unit.split('/')[1] || 'unitÃ©'}`;
  });
}

// â”€â”€ RafraÃ®chissement â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function refreshMarketPrices() {
  const btn = document.querySelector('#marketPricePanel button');
  if (btn) { btn.textContent = 'â³'; btn.disabled = true; }

  // Afficher shimmer
  const panel = document.getElementById('marketPriceRows');
  if (panel) panel.innerHTML = `<div style="padding:16px;">
    ${[...Array(4)].map(()=>`<div style="display:flex;gap:10px;margin-bottom:10px;align-items:center;">
      <div class="price-loading" style="width:30px;height:30px;border-radius:8px;"></div>
      <div style="flex:1;"><div class="price-loading" style="width:70%;margin-bottom:4px;"></div><div class="price-loading" style="width:40%;"></div></div>
      <div class="price-loading" style="width:50px;"></div>
    </div>`).join('')}
  </div>`;

  const lastUpdate = await fetchMarketPricesFromAI();
  renderTicker();
  renderMarketPricePanel(lastUpdate);
  updateProductCardPrices();

  if (btn) { btn.textContent = 'â†» Actualiser'; btn.disabled = false; }

  // RafraÃ®chir les cards si on est sur le marchÃ©
  if (currentScreen === 'marche') {
    filterCards();
  }
}

// â”€â”€ Initialisation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initMarketPrices() {
  if (tickerInitialized) return;
  tickerInitialized = true;

  // Afficher ticker vide avec animation pendant le chargement
  const track = document.getElementById('tickerTrack');
  if (track) track.innerHTML = '<span class="ticker-item"><span class="ticker-name">â³ Chargement des cotations...</span></span>';

  await refreshMarketPrices();

  // Auto-refresh toutes les 5 minutes
  priceRefreshTimer = setInterval(refreshMarketPrices, 5 * 60 * 1000);
}

// DÃ©marrer quand la page est prÃªte
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initMarketPrices);
} else {
  setTimeout(initMarketPrices, 800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MÃ‰TÃ‰O & GÃ‰OLOCALISATION â€” Module ABAE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const WEATHER_CODES = {
  0:  { icon:'â˜€ï¸',  label:'Ciel dÃ©gagÃ©' },
  1:  { icon:'ğŸŒ¤ï¸', label:'Peu nuageux' },
  2:  { icon:'â›…',  label:'Partiellement nuageux' },
  3:  { icon:'â˜ï¸',  label:'Couvert' },
  45: { icon:'ğŸŒ«ï¸', label:'Brouillard' },
  48: { icon:'ğŸŒ«ï¸', label:'Brouillard givrant' },
  51: { icon:'ğŸŒ¦ï¸', label:'Bruine lÃ©gÃ¨re' },
  53: { icon:'ğŸŒ¦ï¸', label:'Bruine modÃ©rÃ©e' },
  55: { icon:'ğŸŒ§ï¸', label:'Bruine forte' },
  61: { icon:'ğŸŒ§ï¸', label:'Pluie lÃ©gÃ¨re' },
  63: { icon:'ğŸŒ§ï¸', label:'Pluie modÃ©rÃ©e' },
  65: { icon:'ğŸŒ§ï¸', label:'Pluie forte' },
  71: { icon:'â„ï¸',  label:'Neige lÃ©gÃ¨re' },
  73: { icon:'â„ï¸',  label:'Neige modÃ©rÃ©e' },
  75: { icon:'â„ï¸',  label:'Neige forte' },
  80: { icon:'ğŸŒ¦ï¸', label:'Averses lÃ©gÃ¨res' },
  81: { icon:'ğŸŒ§ï¸', label:'Averses modÃ©rÃ©es' },
  82: { icon:'â›ˆï¸', label:'Averses fortes' },
  85: { icon:'ğŸŒ¨ï¸', label:'Averses de neige' },
  95: { icon:'â›ˆï¸', label:'Orage' },
  96: { icon:'â›ˆï¸', label:'Orage avec grÃªle' },
  99: { icon:'â›ˆï¸', label:'Orage fort' },
};

let GEO_DATA = { lat: null, lon: null, city: 'Cameroun', country: 'CM' };

// â”€â”€ Conseils agro selon mÃ©tÃ©o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getAgroAdvice(code, temp, wind) {
  if ([95,96,99].includes(code))
    return { type:'wind', icon:'â›ˆï¸', text:'Orage prÃ©vu â€” ProtÃ©gez le matÃ©riel et les rÃ©coltes sensibles' };
  if ([61,63,65,80,81,82].includes(code))
    return { type:'rain', icon:'ğŸ’§', text:'Pluies prÃ©vues â€” Bon moment pour les semis, Ã©vitez les traitements phytosanitaires' };
  if ([51,53,55].includes(code))
    return { type:'rain', icon:'ğŸŒ¦ï¸', text:'Bruine â€” Surveillance des maladies fongiques recommandÃ©e' };
  if (temp >= 35)
    return { type:'heat', icon:'ğŸŒ¡ï¸', text:`Chaleur intense (${temp}Â°C) â€” Arrosez tÃ´t le matin, protÃ©gez les jeunes plants` };
  if (wind >= 30)
    return { type:'wind', icon:'ğŸ’¨', text:`Vent fort (${wind} km/h) â€” Ã‰vitez les Ã©pandages, sÃ©curisez les structures` };
  if (code === 0 && temp >= 22 && temp <= 32)
    return { type:'good', icon:'ğŸŒ±', text:'Conditions idÃ©ales â€” Excellent pour les travaux agricoles et l\'Ã©levage' };
  if ([1,2].includes(code))
    return { type:'sun', icon:'â˜€ï¸', text:'Bonne journÃ©e â€” IdÃ©al pour le sÃ©chage post-rÃ©colte et les traitements' };
  return { type:'good', icon:'âœ…', text:'Conditions favorables pour les activitÃ©s agro-pastorales' };
}

// â”€â”€ Afficher le widget mÃ©tÃ©o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderWeather(data) {
  const strip    = document.getElementById('weatherStrip');
  const alert    = document.getElementById('agroAlert');
  if (!strip) return;

  const temp  = Math.round(data.current.temperature_2m);
  const code  = data.current.weather_code;
  const hum   = Math.round(data.current.relative_humidity_2m);
  const wind  = Math.round(data.current.wind_speed_10m);
  const wInfo = WEATHER_CODES[code] || { icon:'ğŸŒ¡ï¸', label:'Variable' };

  document.getElementById('weatherIcon').textContent   = wInfo.icon;
  document.getElementById('weatherTemp').textContent   = `${temp}Â°C`;
  document.getElementById('weatherDesc').textContent   = wInfo.label;
  document.getElementById('weatherCity').textContent   = GEO_DATA.city;
  document.getElementById('weatherHumidity').textContent = `${hum}%`;
  document.getElementById('weatherWind').textContent   = `${wind} km/h`;

  // Conseil agro
  const advice = getAgroAdvice(code, temp, wind);
  // Mise Ã  jour du widget mÃ©tÃ©o principal (screen-marche)
  const alertIcon = document.getElementById('agroAlertIcon');
  const alertText = document.getElementById('agroAlertText');
  if (alertIcon) alertIcon.textContent = advice.icon;
  if (alertText) alertText.textContent = advice.text;
  // Mise Ã  jour de toutes les barres mÃ©tÃ©o compactes (autres pages)
  document.querySelectorAll('.wx-icon').forEach(el => el.textContent = wInfo.icon);
  document.querySelectorAll('.wx-temp').forEach(el => el.textContent = `${temp}Â°C`);
  document.querySelectorAll('.wx-desc').forEach(el => el.textContent = wInfo.label);
  document.querySelectorAll('.wx-city').forEach(el => el.textContent = GEO_DATA.city);
  document.querySelectorAll('.wx-hum').forEach(el => el.textContent = `${hum}%`);
  document.querySelectorAll('.wx-wind').forEach(el => el.textContent = `${wind} km/h`);
  document.querySelectorAll('.wx-advice-icon').forEach(el => el.textContent = advice.icon);
  document.querySelectorAll('.wx-advice-text').forEach(el => el.textContent = advice.text);

  // Mettre Ã  jour le label localisation dans le header
  const locLabel = document.getElementById('locationLabel');
  if (locLabel) {
    locLabel.innerHTML = `<span class="loc-pill"><svg viewBox="0 0 24 24" style="width:12px;height:12px;stroke:currentColor;fill:none;stroke-width:2.5;"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>${GEO_DATA.city}</span>`;
  }
  // FIX v53 â€” Afficher les prÃ©visions 7 jours si disponibles
  if (data.daily) renderForecast(data.daily);
}

// â”€â”€ RÃ©cupÃ©rer la mÃ©tÃ©o via Open-Meteo (gratuit, sans API key) â”€â”€â”€â”€â”€
// FIX v53 â€” Open-Meteo : current + prÃ©visions 7 jours (gratuit, sans clÃ©)
async function fetchWeather(lat, lon) {
  const url = `https://api.open-meteo.com/v1/forecast`
    + `?latitude=${lat}&longitude=${lon}`
    + `&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m`
    + `&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum`
    + `&timezone=auto&forecast_days=7`;
  const res = await fetch(url);
  if (!res.ok) throw new Error('MÃ©tÃ©o indisponible');
  return res.json();
}

// â”€â”€ Reverse geocoding via Nominatim (OpenStreetMap, gratuit) â”€â”€â”€â”€â”€â”€
async function reverseGeocode(lat, lon) {
  const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&accept-language=fr`;
  const res = await fetch(url, { headers: { 'Accept-Language': 'fr' } });
  if (!res.ok) return 'Ma position';
  const data = await res.json();
  // PrioritÃ© : ville > commune > dÃ©partement > pays
  return data.address?.city
      || data.address?.town
      || data.address?.village
      || data.address?.county
      || data.address?.state
      || data.address?.country
      || 'Ma position';
}

// â”€â”€ MÃ©tÃ©o de secours (coordonnÃ©es YaoundÃ©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchWeatherFallback() {
  GEO_DATA = { lat: 3.848, lon: 11.502, city: 'YaoundÃ©', country: 'CM' };
  try {
    const data = await fetchWeather(3.848, 11.502);
    renderWeather(data);
  } catch(e) {
    // Afficher donnÃ©es simulÃ©es si API injoignable
    renderWeather({
      current: { temperature_2m: 27, weather_code: 2, relative_humidity_2m: 72, wind_speed_10m: 12 }
    });
  }
}

// â”€â”€ RafraÃ®chissement manuel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function refreshWeather() {
  const city = document.getElementById('weatherCity');
  if (city) city.textContent = 'â³ Mise Ã  jourâ€¦';
  const alertText = document.getElementById('agroAlertText');
  if (alertText) alertText.textContent = 'Actualisation en coursâ€¦';
  await initWeather();
}

// â”€â”€ Initialisation principale â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initWeather() {
  if (!('geolocation' in navigator)) {
    await fetchWeatherFallback();
    return;
  }

  navigator.geolocation.getCurrentPosition(
    async (pos) => {
      const { latitude: lat, longitude: lon } = pos.coords;
      GEO_DATA.lat = lat;
      GEO_DATA.lon = lon;

      // Reverse geocoding + mÃ©tÃ©o en parallÃ¨le
      try {
        const [city, weatherData] = await Promise.all([
          reverseGeocode(lat, lon),
          fetchWeather(lat, lon)
        ]);
        GEO_DATA.city = city;
        renderWeather(weatherData);
      } catch(e) {
        // Si mÃ©tÃ©o Ã©choue aprÃ¨s gÃ©oloc, on essaie quand mÃªme d'afficher la ville
        GEO_DATA.city = await reverseGeocode(lat, lon).catch(()=>'Ma position');
        await fetchWeatherFallback();
      }
    },
    async (err) => {
      // Refus ou erreur â†’ fallback YaoundÃ©
      await fetchWeatherFallback();
    },
    { timeout: 8000, maximumAge: 300000, enableHighAccuracy: false }
  );
}

// Lancer aprÃ¨s l'init des prix (lÃ©gÃ¨rement dÃ©calÃ© pour ne pas bloquer)
setTimeout(initWeather, 1200);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODULE RH AGRIBUSINESS IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function switchHRTab(n) {
  [1,2,3,4].forEach(i => {
    const tab = document.getElementById('hrTab'+i);
    const content = document.getElementById('hrTabContent'+i);
    if (tab) tab.className = 'tab' + (i === n ? ' active' : '');
    if (content) content.style.display = i === n ? 'block' : 'none';
  });
}
window.switchHRTab = switchHRTab;

const HR_SALAIRES = {
  agronome:    { debutant:[80000,120000],  confirme:[130000,200000], senior:[210000,350000], expert:[360000,600000] },
  technicien:  { debutant:[60000,90000],   confirme:[95000,150000],  senior:[160000,250000], expert:[260000,400000] },
  eleveur:     { debutant:[55000,80000],   confirme:[85000,130000],  senior:[140000,220000], expert:[230000,350000] },
  commercial:  { debutant:[70000,100000],  confirme:[110000,180000], senior:[190000,300000], expert:[310000,500000] },
  logisticien: { debutant:[75000,110000],  confirme:[115000,175000], senior:[185000,280000], expert:[290000,450000] },
  comptable:   { debutant:[70000,100000],  confirme:[110000,170000], senior:[180000,270000], expert:[280000,430000] },
  ouvrier:     { debutant:[36270,50000],   confirme:[52000,75000],   senior:[78000,110000],  expert:[115000,160000] },
  directeur:   { debutant:[200000,300000], confirme:[320000,500000], senior:[520000,800000], expert:[850000,1500000] },
  autre:       { debutant:[50000,80000],   confirme:[85000,140000],  senior:[150000,250000], expert:[260000,420000] },
};

window.runHRRecrutement = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const poste    = document.getElementById('hrPoste')?.value || 'technicien';
  const niveau   = document.getElementById('hrNiveau')?.value || 'confirme';
  const region   = document.getElementById('hrRegion')?.value || 'YaoundÃ© / Centre';
  const structure = document.getElementById('hrStructure')?.value || 'exploitation';
  await aiSimDelay(1500, 2500);

  const sal = HR_SALAIRES[poste] || HR_SALAIRES['autre'];
  const range = sal[niveau] || sal['confirme'];
  const salMin = fmtXAF(range[0]);
  const salMax = fmtXAF(range[1]);
  const posteLabels = {agronome:'Agronome / Conseiller Agricole',technicien:'Technicien Agricole',eleveur:"Chef d'Ã‰levage",commercial:'Commercial Agribusiness',logisticien:'Responsable Logistique',comptable:'Comptable / Gestionnaire',ouvrier:'Ouvrier Agricole',directeur:"Directeur d'Exploitation",autre:'Poste SpÃ©cialisÃ©'};
  const structLabels = {exploitation:'exploitation agricole',coop:'coopÃ©rative agricole',pme:'PME agribusiness',ong:'ONG / projet de dÃ©veloppement',export:"sociÃ©tÃ© d'export"};
  const niveauLabels = {debutant:'DÃ©butant (0â€“2 ans)',confirme:'ConfirmÃ© (3â€“5 ans)',senior:'Senior (5+ ans)',expert:'Expert / Cadre supÃ©rieur'};

  const fiche = `FICHE DE POSTE â€” ${(posteLabels[poste]||'Poste').toUpperCase()}\n\nStructure : ${structLabels[structure]||structure}\nLocalisation : ${region}\nNiveau : ${niveauLabels[niveau]}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMISSION PRINCIPALE\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nAssurer le dÃ©veloppement et la performance des activitÃ©s agro-pastorales dans le respect des objectifs de production et de rentabilitÃ© fixÃ©s par la direction.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nRESPONSABILITÃ‰S CLÃ‰S\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ Planifier et superviser les activitÃ©s de production\nâ€¢ Assurer le suivi technique et qualitatif des opÃ©rations\nâ€¢ GÃ©rer les ressources matÃ©rielles et humaines\nâ€¢ RÃ©diger des rapports d'activitÃ© hebdomadaires\nâ€¢ Assurer la liaison avec les partenaires et fournisseurs\nâ€¢ Veiller au respect des normes de sÃ©curitÃ© et d'hygiÃ¨ne\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nPROFIL REQUIS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ Formation : Bac+2 minimum en agriculture / agronomie\nâ€¢ ExpÃ©rience : ${niveauLabels[niveau]}\nâ€¢ Langues : FranÃ§ais obligatoire, anglais (atout)\nâ€¢ Permis B souhaitÃ©\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nCOMPÃ‰TENCES TECHNIQUES\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ MaÃ®trise des techniques agro-pastorales locales\nâ€¢ Connaissance du marchÃ© agricole camerounais\nâ€¢ CapacitÃ© Ã  utiliser les outils numÃ©riques de gestion\nâ€¢ Notions de comptabilitÃ© agricole\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nRÃ‰MUNÃ‰RATION\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ Salaire brut : ${salMin} â€“ ${salMax} / mois\nâ€¢ Avantages : Variable selon structure\nâ€¢ Prise de poste : ImmÃ©diate\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nQUESTIONS D'ENTRETIEN IA\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n1. DÃ©crivez votre expÃ©rience la plus significative dans le secteur agro-pastoral.\n2. Comment gÃ©rez-vous une baisse inattendue de rendement ?\n3. Quelle est votre connaissance des coopÃ©ratives agricoles au Cameroun ?\n4. Donnez un exemple oÃ¹ vous avez rÃ©solu un problÃ¨me technique sur le terrain.\n5. Quelles formations avez-vous suivies rÃ©cemment ?\n\nGÃ©nÃ©rÃ© par ABAE Smart IA Â· ${new Date().toLocaleDateString('fr-FR')}`;

  document.getElementById('hrRecrutContent').textContent = fiche;
  document.getElementById('hrRecrutResult')?.classList.add('show');
  document.getElementById('hrDownloadBtn').style.display = 'block';
  consumeCredits(5);
  showToast('Fiche de poste gÃ©nÃ©rÃ©e !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runHRContrat = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const type    = document.getElementById('hrContratType')?.value || 'cdi';
  const poste   = document.getElementById('hrContratPoste')?.value || 'EmployÃ© agricole';
  const salaire = parseInt(document.getElementById('hrContratSalaire')?.value) || 80000;
  const duree   = document.getElementById('hrContratDuree')?.value || '';
  await aiSimDelay(1500, 2500);

  const typeLabels = {cdi:'CONTRAT Ã€ DURÃ‰E INDÃ‰TERMINÃ‰E (CDI)',cdd:'CONTRAT Ã€ DURÃ‰E DÃ‰TERMINÃ‰E (CDD)',saisonnier:'CONTRAT SAISONNIER AGRICOLE',journalier:'CONTRAT DE PRESTATION JOURNALIÃˆRE',apprentissage:"CONTRAT D'APPRENTISSAGE",stage:'CONVENTION DE STAGE'};
  const dureeClause = duree ? `DurÃ©e : ${duree}\n` : 'DurÃ©e : IndÃ©terminÃ©e\n';

  const contrat = `${typeLabels[type]||'CONTRAT DE TRAVAIL'}\n\nENTRE LES PARTIES\n\nL'EMPLOYEUR :\nRaison sociale : _______________________\nSiÃ¨ge social : ${document.getElementById('hrRegion')?.value||'Cameroun'}\nReprÃ©sentÃ© par : _______________________ (Directeur)\n\nL'EMPLOYÃ‰(E) :\nNom & PrÃ©noms : _______________________\nDate de naissance : ____________________\nCNI NÂ° : _______________________\nAdresse : _______________________\n${dureeClause}\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nARTICLE 1 â€” ENGAGEMENT\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nL'Employeur engage l'EmployÃ©(e) en qualitÃ© de ${poste}, Ã  compter du __ / __ / ____.\n\nARTICLE 2 â€” PÃ‰RIODE D'ESSAI\n${type==='cdi'?"PÃ©riode d'essai : 3 mois, renouvelable une fois.":'Pas de pÃ©riode d\'essai pour ce type de contrat.'}\n\nARTICLE 3 â€” RÃ‰MUNÃ‰RATION\nSalaire brut mensuel : ${fmtXAF(salaire)}\nCotisations CNPS et IRPP retenus conformÃ©ment Ã  la loi camerounaise.\n\nARTICLE 4 â€” DURÃ‰E DU TRAVAIL\n40 heures / semaine â€” Code du Travail camerounais (Loi NÂ° 92/007 du 14 aoÃ»t 1992).\n\nARTICLE 5 â€” CONGÃ‰S PAYÃ‰S\n18 jours / an (1.5 jour par mois de service).\n\nARTICLE 6 â€” OBLIGATIONS DE L'EMPLOYÃ‰(E)\nâ€¢ ExÃ©cuter sa mission avec diligence et loyautÃ©\nâ€¢ Respecter le rÃ¨glement intÃ©rieur de la structure\nâ€¢ Maintenir la confidentialitÃ© des informations\nâ€¢ Signaler toute situation Ã  risque Ã  sa hiÃ©rarchie\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nSIGNATURES\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nFait Ã  ________________, le ___ / ___ / _______\n\nL'Employeur                    L'EmployÃ©(e)\n_________________          _________________\n(Cachet et signature)        (Lu et ApprouvÃ©)\n\nâš ï¸ GÃ©nÃ©rÃ© par ABAE Smart IA â€” Ã€ valider avec un juriste avant usage officiel.`;

  document.getElementById('hrContratContent').textContent = contrat;
  document.getElementById('hrContratResult')?.classList.add('show');
  document.getElementById('hrContratDownloadBtn').style.display = 'block';
  consumeCredits(6);
  showToast('Contrat de travail gÃ©nÃ©rÃ© !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runHRPaie = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const brut    = parseFloat(document.getElementById('hrPaieSalaire')?.value) || 100000;
  const nbEmp   = parseInt(document.getElementById('hrNbEmployes')?.value) || 1;
  const avantages = parseInt(document.getElementById('hrAvantages')?.value) || 0;
  await aiSimDelay(800, 1400);

  const brutTotal    = brut + avantages;
  const cnpsEmp      = Math.round(brutTotal * 0.042);
  const irppBase     = brutTotal - cnpsEmp;
  const irpp         = irppBase <= 62000 ? 0 : Math.round(irppBase * 0.115);
  const net          = brutTotal - cnpsEmp - irpp;
  const cnpsEmployeur = Math.round(brutTotal * 0.1395);
  const coutTotal    = brutTotal + cnpsEmployeur;
  const masseSalariale = coutTotal * nbEmp;

  document.getElementById('hrPaieGross').textContent     = fmtXAF(brutTotal);
  document.getElementById('hrCNPSemp').textContent       = `- ${fmtXAF(cnpsEmp)}`;
  document.getElementById('hrIRPP').textContent          = `- ${fmtXAF(irpp)}`;
  document.getElementById('hrPaieNet').textContent       = fmtXAF(net);
  document.getElementById('hrCNPSemp2').textContent      = `+ ${fmtXAF(cnpsEmployeur)}`;
  document.getElementById('hrCoutTotal').textContent     = fmtXAF(coutTotal);
  document.getElementById('hrMasseSalariale').textContent = `${fmtXAF(masseSalariale)} (${nbEmp} emp.)`;

  document.getElementById('hrPaieResult')?.classList.add('show');
  consumeCredits(2);
  showToast('Bulletin de paie calculÃ© !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runHRFormation = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const profil  = document.getElementById('hrFormationProfil')?.value || 'technicien';
  const domaine = document.getElementById('hrFormationDomaine')?.value || 'technique';
  const budget  = parseInt(document.getElementById('hrFormationBudget')?.value) || 300000;
  await aiSimDelay(1200, 2000);

  const domaineLabels = {technique:'Techniques Agricoles Modernes',numerique:'Digitalisation & Outils NumÃ©riques',gestion:'Gestion FinanciÃ¨re & ComptabilitÃ©',leadership:'Leadership & Management',qualite:'QualitÃ©, HygiÃ¨ne & Certifications',export:'Export & Commerce International',securite:'SÃ©curitÃ© & PrÃ©vention des Risques'};
  const profilLabels  = {ouvrier:'Ouvriers agricoles',technicien:'Techniciens de terrain',cadre:'Cadres intermÃ©diaires',dirigeant:'Dirigeants / Managers',commercial:'Ã‰quipe commerciale'};

  const plan = `PLAN DE FORMATION â€” ${(domaineLabels[domaine]||domaine).toUpperCase()}\nCible : ${profilLabels[profil]||profil}\nBudget allouÃ© : ${fmtXAF(budget)}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMODULE 1 â€” DIAGNOSTIC & BESOINS (Semaine 1)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ Ã‰valuation initiale des compÃ©tences actuelles\nâ€¢ Identification des gaps et prioritÃ©s\nâ€¢ Questionnaire individuel\nDurÃ©e : 1 jour Â· CoÃ»t estimÃ© : ${fmtXAF(Math.round(budget*0.05))}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMODULE 2 â€” FORMATION THÃ‰ORIQUE (Semaines 2â€“3)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ Cours par expert sectoriel agrÃ©Ã©\nâ€¢ Supports documentaires remis aux participants\nâ€¢ Ã‰tudes de cas camerounais et sous-rÃ©gionaux\nDurÃ©e : 3 jours Â· CoÃ»t estimÃ© : ${fmtXAF(Math.round(budget*0.30))}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMODULE 3 â€” PRATIQUE TERRAIN (Semaines 4â€“5)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ Visites de sites pilotes / exploitation modÃ¨le\nâ€¢ Travaux pratiques supervisÃ©s\nâ€¢ RÃ©solution de problÃ¨mes rÃ©els\nDurÃ©e : 4 jours Â· CoÃ»t estimÃ© : ${fmtXAF(Math.round(budget*0.40))}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMODULE 4 â€” Ã‰VALUATION & CERTIFICATION (Semaine 6)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ Test de compÃ©tences post-formation\nâ€¢ Remise des attestations ABAE\nâ€¢ Plan d'action individuel\nDurÃ©e : 1 jour Â· CoÃ»t estimÃ© : ${fmtXAF(Math.round(budget*0.10))}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nPARTENAIRES FORMATION\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ IRAD Cameroun (Institut de Recherche Agricole)\nâ€¢ FASA Dschang (FacultÃ© des Sciences Agronomiques)\nâ€¢ MINADER â€” Services rÃ©gionaux de formation\nâ€¢ ABAE Academy (plateforme en ligne â€” bientÃ´t)\n\nBudget restant (imprÃ©vus) : ${fmtXAF(Math.round(budget*0.15))}\n\nGÃ©nÃ©rÃ© par ABAE Smart IA Â· ${new Date().toLocaleDateString('fr-FR')}`;

  document.getElementById('hrFormationContent').textContent = plan;
  document.getElementById('hrFormationResult')?.classList.add('show');
  consumeCredits(4);
  showToast('Plan de formation gÃ©nÃ©rÃ© !', 'ok');
  restoreAIBtn(btn, orig);
};

window.downloadHRDoc = function() { showToast('TÃ©lÃ©chargement PDF â€” FonctionnalitÃ© Pro (5 000 XAF)', 'ok'); };
window.downloadHRContrat = function() { showToast('TÃ©lÃ©chargement contrat â€” FonctionnalitÃ© Pro (5 000 XAF)', 'ok'); };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODULE MONTAGE DE PROJETS IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function switchProjTab(n) {
  [1,2,3,4].forEach(i => {
    const tab = document.getElementById('projTab'+i);
    const content = document.getElementById('projTabContent'+i);
    if (tab) tab.className = 'tab' + (i === n ? ' active' : '');
    if (content) content.style.display = i === n ? 'block' : 'none';
  });
}
window.switchProjTab = switchProjTab;

const PROJ_DATA = {
  ferme:          { capex:[2000000,8000000],   opex:[800000,2000000],   ca1:[1500000,4000000],   growth:1.35 },
  elevage:        { capex:[3000000,12000000],  opex:[1200000,3500000],  ca1:[2000000,6000000],   growth:1.40 },
  transformation: { capex:[5000000,20000000],  opex:[2000000,6000000],  ca1:[4000000,12000000],  growth:1.45 },
  coop:           { capex:[1000000,5000000],   opex:[500000,1500000],   ca1:[2000000,8000000],   growth:1.50 },
  export:         { capex:[4000000,15000000],  opex:[1500000,4000000],  ca1:[5000000,18000000],  growth:1.55 },
  aviculture:     { capex:[1500000,6000000],   opex:[600000,1800000],   ca1:[1200000,4500000],   growth:1.38 },
  pisciculture:   { capex:[2000000,8000000],   opex:[700000,2000000],   ca1:[1500000,5000000],   growth:1.35 },
  irrigation:     { capex:[6000000,25000000],  opex:[1000000,3000000],  ca1:[3000000,10000000],  growth:1.30 },
  serre:          { capex:[3000000,10000000],  opex:[900000,2500000],   ca1:[2500000,7000000],   growth:1.42 },
  'agro-industrie':{ capex:[10000000,50000000], opex:[3000000,10000000], ca1:[8000000,25000000],  growth:1.48 },
};

window.runBusinessPlan = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const type         = document.getElementById('projType')?.value || 'ferme';
  const superficie   = document.getElementById('projSuperficie')?.value || '5 ha';
  const localisation = document.getElementById('projLocalisation')?.value || 'Centre';
  const investInit   = parseInt(document.getElementById('projInvest')?.value) || 5000000;
  await aiSimDelay(2000, 3500);

  const d    = PROJ_DATA[type] || PROJ_DATA['ferme'];
  const ca1  = Math.round((d.ca1[0]+d.ca1[1])/2);
  const opex = Math.round((d.opex[0]+d.opex[1])/2);
  const marge1 = ca1 - opex;
  const ca3    = Math.round(ca1 * d.growth * d.growth);
  const payback = (investInit / marge1).toFixed(1);
  const roi3    = (((ca3-opex*d.growth)*3-investInit)/investInit*100).toFixed(0);
  const typeLabels = {ferme:"Exploitation Agricole",elevage:"Projet d'Ã‰levage Bovin",transformation:'UnitÃ© de Transformation Agro-alimentaire',coop:'CoopÃ©rative Agricole',export:"Projet d'Exportation",aviculture:'Exploitation Avicole',pisciculture:'Ferme Piscicole',irrigation:'PÃ©rimÃ¨tre IrriguÃ©',serre:'Culture sous Serre','agro-industrie':'Complexe Agro-industriel'};

  const bp = `BUSINESS PLAN â€” ${(typeLabels[type]||type).toUpperCase()}\nLocalisation : ${localisation} Â· CapacitÃ© : ${superficie}\nDate : ${new Date().toLocaleDateString('fr-FR')}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nI. RÃ‰SUMÃ‰ EXÃ‰CUTIF\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nProjet de crÃ©ation d'une ${typeLabels[type]||type} dans la rÃ©gion ${localisation} du Cameroun. S'inscrit dans la modernisation du secteur agro-pastoral et le renforcement de la sÃ©curitÃ© alimentaire nationale.\n\nInvestissement initial  : ${fmtXAF(investInit)}\nCA prÃ©visionnel an 1    : ${fmtXAF(ca1)}\nRetour investissement   : ${payback} ans\nROI sur 3 ans           : ${roi3}%\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nII. ANALYSE DU MARCHÃ‰\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMarchÃ© cible : Producteurs, transformateurs et consommateurs locaux, marchÃ©s CEMAC\nTendance : Demande en forte croissance (+8%/an au Cameroun)\nAvantage concurrentiel : ProximitÃ©, qualitÃ© produit, digitalisation via ABAE\n\nOpportunitÃ©s :\nâ€¢ Croissance dÃ©mographique (3.2%/an) = demande alimentaire en hausse\nâ€¢ Politique MINADER de soutien Ã  l'agribusiness\nâ€¢ DÃ©veloppement des corridors commerciaux CEMAC\n\nRisques identifiÃ©s :\nâ€¢ AlÃ©as climatiques â†’ couverture assurance rÃ©colte ABAE\nâ€¢ VolatilitÃ© des prix â†’ contrats Ã  terme ABAE\nâ€¢ AccÃ¨s au crÃ©dit â†’ partenariat MicroAgro Finance prÃ©vu\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nIII. STRATÃ‰GIE COMMERCIALE\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nCanaux de vente : MarchÃ© local + Plateforme ABAE + Export\nPricing : Alignement sur cotations ABAE (prix marchÃ©)\nDistribution : Transport direct + RÃ©seau coopÃ©ratives\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nIV. PRÃ‰VISIONS FINANCIÃˆRES (3 ANS)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nInvestissement total    : ${fmtXAF(investInit)}\nCA AnnÃ©e 1              : ${fmtXAF(ca1)}\nCharges d'exploitation  : ${fmtXAF(opex)}/an\nRÃ©sultat net An 1       : ${fmtXAF(marge1)}\nCA AnnÃ©e 3              : ${fmtXAF(ca3)}\nRetour investissement   : ${payback} ans\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nV. BESOINS EN FINANCEMENT\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nApport personnel (30%)  : ${fmtXAF(Math.round(investInit*0.30))}\nCrÃ©dit bancaire (50%)   : ${fmtXAF(Math.round(investInit*0.50))}\nSubvention/Don (20%)    : ${fmtXAF(Math.round(investInit*0.20))}\n\nGÃ©nÃ©rÃ© par ABAE Smart IA Â· ${new Date().toLocaleDateString('fr-FR')}\nÂ© ABAE â€” Marketplace Agro-Pastorale Intelligente`;

  document.getElementById('projBizContent').textContent = bp;
  document.getElementById('projBizResult')?.classList.add('show');
  document.getElementById('projBizDownloadBtn').style.display = 'block';
  consumeCredits(8);
  showToast('Business plan gÃ©nÃ©rÃ© avec succÃ¨s !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runBudgetPrevisionnel = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const type    = document.getElementById('budgetProjType')?.value || 'ferme';
  const horizon = parseInt(document.getElementById('budgetHorizon')?.value) || 3;
  await aiSimDelay(1000, 1800);

  const d    = PROJ_DATA[type] || PROJ_DATA['ferme'];
  const capex = Math.round((d.capex[0]+d.capex[1])/2);
  const opex  = Math.round((d.opex[0]+d.opex[1])/2);
  const ca1   = Math.round((d.ca1[0]+d.ca1[1])/2);
  const ca3   = Math.round(ca1 * Math.pow(d.growth, horizon-1));
  const net1  = ca1 - opex;
  const breakevenMonths = Math.ceil(capex / (net1/12));
  const roi   = (((ca3-opex)*horizon-capex)/capex*100).toFixed(0);

  document.getElementById('budCapex').textContent     = fmtXAF(capex);
  document.getElementById('budOpex').textContent      = fmtXAF(opex);
  document.getElementById('budCA1').textContent       = fmtXAF(ca1);
  document.getElementById('budCA3').textContent       = fmtXAF(ca3);
  document.getElementById('budNet1').textContent      = fmtXAF(net1);
  document.getElementById('budBreakeven').textContent = `${breakevenMonths} mois`;
  document.getElementById('budROI').textContent       = roi + '%';

  const lines = `DÃ©tail CAPEX estimÃ© :\nâ€¢ Foncier / Location : ${fmtXAF(Math.round(capex*0.15))}\nâ€¢ Ã‰quipements & matÃ©riel : ${fmtXAF(Math.round(capex*0.40))}\nâ€¢ Construction / AmÃ©nagements : ${fmtXAF(Math.round(capex*0.25))}\nâ€¢ Fonds de roulement : ${fmtXAF(Math.round(capex*0.15))}\nâ€¢ ImprÃ©vus (5%) : ${fmtXAF(Math.round(capex*0.05))}`;
  document.getElementById('budgetDetailLines').textContent = lines;
  document.getElementById('budgetResult')?.classList.add('show');
  consumeCredits(5);
  showToast('Budget prÃ©visionnel calculÃ© !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runDossierFinancement = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const montant  = parseInt(document.getElementById('finProjMontant')?.value) || 10000000;
  const type     = document.getElementById('finProjType')?.value || 'credit';
  const garantie = document.getElementById('finProjGarantie')?.value || 'foncier';
  await aiSimDelay(1200, 2000);

  const orgs = {
    credit:       ['Afriland First Bank Â· Agri-PrÃªt', 'BICEC Â· Ligne agricole CEMAC'],
    microfinance: ['MicroAgro Finance Cameroun', 'CamPost Financement Â· MUCADEC'],
    subvention:   ['MINADER â€” Programme PACA', 'GIZ Â· Programme Emploi Vert CEMAC'],
    investisseur: ['AGBC â€” Agri-Business Cameroun', 'ACTIV (Fonds BDEAC)'],
    mixte:        ['Consortium bancaire ABAE', 'Mix Banque + MFI + Subvention'],
  };
  const taux  = {credit:'9â€“12%/an',microfinance:'15â€“24%/an',subvention:'0% (don non remboursable)',investisseur:'Equity 15â€“30%',mixte:'8â€“15%/an'};
  const docs  = {foncier:'Titre foncier + Plan cadastral + Statuts',equipement:'Factures Ã©quipements + Attestation propriÃ©tÃ©',caution:'PV AG coopÃ©rative + Liste membres + Statuts',aucune:'Business plan + Historique ABAE + CV + CNI'};
  const delais = {credit:'4â€“8 semaines',microfinance:'1â€“3 semaines',subvention:'3â€“6 mois',investisseur:'2â€“4 mois',mixte:'6â€“10 semaines'};

  const orgList = orgs[type] || orgs['credit'];
  document.getElementById('finOrg1').textContent  = orgList[0];
  document.getElementById('finOrg2').textContent  = orgList[1];
  document.getElementById('finTaux').textContent  = taux[type]||'10%/an';
  document.getElementById('finDocs').textContent  = docs[garantie]||docs['aucune'];
  document.getElementById('finDelai').textContent = delais[type]||'4â€“6 semaines';

  const tips = `Conseils IA pour maximiser vos chances :\nâ€¢ PrÃ©parez un Business Plan solide (utilisez notre outil ci-dessus)\nâ€¢ Montrez votre historique de transactions ABAE\nâ€¢ PrÃ©sentez des projections financiÃ¨res rÃ©alistes sur 3 ans\nâ€¢ Constituez un dossier complet avant le premier contact\nâ€¢ Mentionnez votre adhÃ©sion Ã  ABAE comme garantie de sÃ©rieux\n\nMontant recherchÃ© : ${fmtXAF(montant)}\nFonds propres recommandÃ©s : ${fmtXAF(Math.round(montant*0.30))} (30% minimum)`;
  document.getElementById('finProjTips').textContent = tips;
  document.getElementById('finProjResult')?.classList.add('show');
  consumeCredits(5);
  showToast('Dossier financement prÃªt !', 'ok');
  restoreAIBtn(btn, orig);
};

window.runRecherchePartenaires = async function() {
  const btn = event.target.closest('button');
  const orig = showAILoading(btn);
  const filiere  = document.getElementById('partFiliere')?.value || 'cereales';
  const typepart = document.getElementById('partType')?.value || 'acheteur';
  const capacite = document.getElementById('partCapacite')?.value || 'Ã€ dÃ©finir';
  await aiSimDelay(1500, 2500);

  const partDB = {
    cereales: { acheteur:['SODECOTON (contrat offtake)','Boulangeries industrielles Douala','MINADER â€” RÃ©serves stratÃ©giques','Exportateurs CEMAC Ndjamena'], fournisseur:['AGRO-PME Intrants YaoundÃ©','Semences certifiÃ©es IRAD','Engrais subventionnÃ©s MINADER'], technique:['IRAD â€” Station de Foumbot','FAO Cameroun â€” Programme cÃ©rÃ©ales','FASA Dschang'], financier:['MicroAgro Finance','BEAC AgriCredit','Orange Bank Agriculture'], logistique:['Camrail Fret agricole','Transporteurs ABAE certifiÃ©s','EntrepÃ´ts CAMCOLD Douala'], formation:['IRAD Formation continue','FASA Licences professionnelles','ABAE Academy'] },
    elevage:  { acheteur:['Abattoirs SODEPA NgaoundÃ©rÃ©','Restaurants & hÃ´tels YaoundÃ©/Douala','Exportateurs viande CEMAC','GIE Ã‰leveurs Adamaoua'], fournisseur:['Aliments bÃ©tail PROVICAM','VÃ©tÃ©rinaires agrÃ©Ã©s','LANAVET â€” Vaccins'], technique:['MINEPIA â€” Services rÃ©gionaux','IRAD Wakwa (Adamaoua)','FAO â€” Programme Ã©levage'], financier:['CrÃ©dit Agricole Cameroun','MUCADEC','BDEAC â€” Projets Ã©levage'], logistique:['Camions bÃ©tail certifiÃ©s ABAE','MarchÃ©s Ã  bÃ©tail NgaoundÃ©rÃ©/Garoua'], formation:['ENASA NgaoundÃ©rÃ©','MINEPIA Formation'] },
  };
  const defaultPart = ['Partenaires ABAE vÃ©rifiÃ©s disponibles','RÃ©seaux professionnels CEMAC','ONG de dÃ©veloppement agricole','Chambres d\'agriculture rÃ©gionales'];
  const partList = (partDB[filiere]?.[typepart]) || defaultPart;
  const typeLabels = {acheteur:'Acheteurs / DÃ©bouchÃ©s commerciaux',fournisseur:"Fournisseurs d'intrants",technique:'Partenaires techniques',financier:'Partenaires financiers',logistique:'Partenaires logistiques',formation:'Centres de formation'};

  const content = `${(typeLabels[typepart]||typepart).toUpperCase()}\nFiliÃ¨re : ${filiere} Â· CapacitÃ© : ${capacite}\n\n${partList.map((p,i)=>`${i+1}. ${p}`).join('\n')}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nDÃ‰MARCHE RECOMMANDÃ‰E\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n1. PrÃ©parez votre dossier de prÃ©sentation (Business plan ABAE)\n2. Contactez en prioritÃ© le partenaire nÂ°1\n3. PrÃ©sentez vos certifications et historique ABAE\n4. NÃ©gociez les termes via l'IA Finance ABAE\n5. Signez un protocole d'accord avant tout engagement\n\nConseil IA : Votre profil ABAE vÃ©rifiÃ© augmente de 60% vos chances d'Ãªtre acceptÃ© par ces partenaires.\n\nGÃ©nÃ©rÃ© par ABAE Smart IA Â· ${new Date().toLocaleDateString('fr-FR')}`;

  document.getElementById('partContent').textContent = content;
  document.getElementById('partResult')?.classList.add('show');
  consumeCredits(4);
  showToast('Partenaires identifiÃ©s avec succÃ¨s !', 'ok');
  restoreAIBtn(btn, orig);
};

window.downloadBusinessPlan = function() { showToast('TÃ©lÃ©chargement Business Plan â€” Pack Complet (35 000 XAF)', 'ok'); };
</script>

<!-- â•â• MODAL RECADRAGE PHOTO DE PROFIL â•â• -->
<div id="photoCropModal" style="display:none;position:fixed;inset:0;z-index:99999;background:rgba(0,0,0,0.88);display:none;flex-direction:column;align-items:center;justify-content:center;padding:20px;">
  <div style="background:#1A1E25;border-radius:20px;width:100%;max-width:380px;overflow:hidden;box-shadow:0 24px 64px rgba(0,0,0,0.6);">

    <!-- Header -->
    <div style="display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.08);">
      <div style="font-family:'Sora',sans-serif;font-weight:700;font-size:0.95rem;color:#fff;">ğŸ“· Recadrer la photo</div>
      <button onclick="closeCropModal()" style="background:rgba(255,255,255,0.1);border:none;border-radius:50%;width:32px;height:32px;color:#fff;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;">âœ•</button>
    </div>

    <!-- Zone de crop -->
    <div style="position:relative;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden;" id="cropContainer">
      <canvas id="cropCanvas" style="display:block;max-width:100%;touch-action:none;"></canvas>
      <!-- Cercle de guide -->
      <div id="cropCircleGuide" style="position:absolute;border-radius:50%;border:2px dashed rgba(255,255,255,0.6);pointer-events:none;box-shadow:0 0 0 9999px rgba(0,0,0,0.5);"></div>
    </div>

    <!-- Slider zoom -->
    <div style="padding:14px 20px 4px;">
      <div style="display:flex;align-items:center;gap:10px;">
        <span style="font-size:0.85rem;">ğŸ”</span>
        <input type="range" id="cropZoom" min="1" max="3" step="0.01" value="1" style="flex:1;accent-color:#4A9E2A;" oninput="updateCropCanvas()"/>
        <span style="font-size:1rem;">ğŸ”</span>
      </div>
      <div style="text-align:center;font-size:0.72rem;color:rgba(255,255,255,0.4);margin-top:4px;">Pincez ou glissez pour recadrer Â· Zoomez avec le curseur</div>
    </div>

    <!-- AperÃ§u -->
    <div style="display:flex;align-items:center;gap:14px;padding:10px 20px;">
      <div style="font-size:0.75rem;color:rgba(255,255,255,0.5);font-weight:600;">AperÃ§u :</div>
      <div id="cropPreview" style="width:50px;height:50px;border-radius:50%;overflow:hidden;border:2px solid #4A9E2A;flex-shrink:0;background:#2A5E10;"></div>
      <div id="cropPreviewSm" style="width:34px;height:34px;border-radius:50%;overflow:hidden;border:1.5px solid rgba(255,255,255,0.2);flex-shrink:0;background:#2A5E10;"></div>
    </div>

    <!-- Actions -->
    <div style="display:flex;gap:10px;padding:10px 20px 20px;">
      <button onclick="closeCropModal()" style="flex:1;padding:12px;border:1.5px solid rgba(255,255,255,0.15);border-radius:12px;background:transparent;color:#fff;font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;cursor:pointer;">Annuler</button>
      <button onclick="applyCrop()" style="flex:2;padding:12px;border:none;border-radius:12px;background:linear-gradient(135deg,#4A9E2A,#2A5E10);color:#fff;font-family:'Sora',sans-serif;font-weight:700;font-size:0.82rem;cursor:pointer;box-shadow:0 4px 14px rgba(74,158,42,0.4);">âœ… Appliquer</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GESTION PHOTO DE PROFIL â€” Upload + Crop + Persist
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const PHOTO_STORAGE_KEY = 'ABAE_PROFILE_PHOTO';

let _cropImg = null;
let _cropOffsetX = 0, _cropOffsetY = 0;
let _cropDragStart = null;
let _cropCanvasSize = 320;
let _cropCircleR = 130;

/** DÃ©clenchÃ© Ã  la sÃ©lection d'un fichier image */
function onPhotoFileSelected(event) {
  const file = event.target.files[0];
  if (!file) return;
  if (!file.type.startsWith('image/')) { showToast('Format invalide â€” JPG, PNG ou WEBP requis', 'err'); return; }
  if (file.size > 8 * 1024 * 1024) { showToast('Image trop lourde (max 8 Mo)', 'err'); return; }

  const reader = new FileReader();
  reader.onload = (e) => {
    const img = new Image();
    img.onload = () => {
      _cropImg = img;
      _cropOffsetX = 0;
      _cropOffsetY = 0;
      document.getElementById('cropZoom').value = 1;
      openCropModal();
      updateCropCanvas();
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
  // Reset input pour permettre re-sÃ©lection du mÃªme fichier
  event.target.value = '';
}

function openCropModal() {
  const modal = document.getElementById('photoCropModal');
  modal.style.display = 'flex';
  // Calcul taille canvas selon Ã©cran
  _cropCanvasSize = Math.min(window.innerWidth - 40, 340);
  _cropCircleR    = Math.floor(_cropCanvasSize * 0.42);
  const canvas = document.getElementById('cropCanvas');
  canvas.width  = _cropCanvasSize;
  canvas.height = _cropCanvasSize;
  // Guide cercle
  const guide = document.getElementById('cropCircleGuide');
  const d = _cropCircleR * 2;
  guide.style.width  = d + 'px';
  guide.style.height = d + 'px';
  guide.style.left   = ((_cropCanvasSize - d) / 2) + 'px';
  guide.style.top    = ((_cropCanvasSize - d) / 2) + 'px';
  updateCropCanvas();
  setupCropTouch();
}

function closeCropModal() {
  document.getElementById('photoCropModal').style.display = 'none';
}

/** Redessiner le canvas avec l'image recadrÃ©e */
function updateCropCanvas() {
  const canvas = document.getElementById('cropCanvas');
  const ctx    = canvas.getContext('2d');
  const zoom   = parseFloat(document.getElementById('cropZoom').value);
  const size   = _cropCanvasSize;
  const cx     = size / 2, cy = size / 2;

  ctx.clearRect(0, 0, size, size);
  ctx.fillStyle = '#111';
  ctx.fillRect(0, 0, size, size);

  if (!_cropImg) return;

  const imgW = _cropImg.width;
  const imgH = _cropImg.height;
  const scale = Math.max(size / imgW, size / imgH) * zoom;
  const drawW = imgW * scale;
  const drawH = imgH * scale;
  const x = cx - drawW / 2 + _cropOffsetX;
  const y = cy - drawH / 2 + _cropOffsetY;

  ctx.drawImage(_cropImg, x, y, drawW, drawH);

  // Overlay assombri hors cercle
  ctx.save();
  ctx.beginPath();
  ctx.arc(cx, cy, _cropCircleR, 0, Math.PI * 2);
  ctx.rect(size, 0, -size, size);
  ctx.fillStyle = 'rgba(0,0,0,0.55)';
  ctx.fill('evenodd');
  ctx.restore();

  // Anneau lumineux du cercle
  ctx.save();
  ctx.beginPath();
  ctx.arc(cx, cy, _cropCircleR, 0, Math.PI * 2);
  ctx.strokeStyle = 'rgba(255,255,255,0.55)';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.restore();

  updateCropPreview(canvas, zoom);
}

/** Mettre Ã  jour les miniatures de prÃ©visualisation */
function updateCropPreview(srcCanvas, zoom) {
  const r = _cropCircleR;
  const cx = _cropCanvasSize / 2, cy = _cropCanvasSize / 2;
  [
    { id: 'cropPreview',   size: 50 },
    { id: 'cropPreviewSm', size: 34 }
  ].forEach(({ id, size }) => {
    const prev = document.getElementById(id);
    prev.innerHTML = '';
    const c = document.createElement('canvas');
    c.width = c.height = size;
    const ctx2 = c.getContext('2d');
    ctx2.drawImage(srcCanvas, cx - r, cy - r, r * 2, r * 2, 0, 0, size, size);
    c.style.width = c.style.height = '100%';
    prev.appendChild(c);
  });
}

/** Appliquer le crop, sauvegarder et propager */
function applyCrop() {
  const canvas = document.getElementById('cropCanvas');
  const r   = _cropCircleR;
  const cx  = _cropCanvasSize / 2;
  const cy  = _cropCanvasSize / 2;

  // Canvas final carrÃ© 256Ã—256
  const out = document.createElement('canvas');
  out.width = out.height = 256;
  const ctx = out.getContext('2d');
  ctx.drawImage(canvas, cx - r, cy - r, r * 2, r * 2, 0, 0, 256, 256);

  const dataUrl = out.toDataURL('image/jpeg', 0.88);

  // Sauvegarder en localStorage
  const email = localStorage.getItem('ABAE_CURRENT_EMAIL') || '';
  if (email) {
    const db = ABAE_getUsersDB();
    if (db[email]) { db[email].photo = dataUrl; localStorage.setItem('ABAE_USERS_DB', JSON.stringify(db)); }
  }
  localStorage.setItem(PHOTO_STORAGE_KEY, dataUrl);

  // Propager sur tous les avatars de l'app
  applyPhotoToAllAvatars(dataUrl);
  showToast('Photo de profil mise Ã  jour âœ“', 'ok');
  closeCropModal();
}

/** Appliquer la photo Ã  tous les Ã©lÃ©ments avatar */
function applyPhotoToAllAvatars(dataUrl) {
  const ids = ['profileHeroAvatar', 'profileEditAvatar'];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.innerHTML = '';
    el.style.padding = '0';
    const img = document.createElement('img');
    img.src = dataUrl;
    img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:50%;';
    el.appendChild(img);
  });
}

/** Charger la photo sauvegardÃ©e au dÃ©marrage et Ã  chaque ouverture du profil */
function loadSavedPhoto() {
  const email = localStorage.getItem('ABAE_CURRENT_EMAIL') || '';
  let photo = null;
  if (email) {
    const db = ABAE_getUsersDB();
    photo = db[email]?.photo || null;
  }
  if (!photo) photo = localStorage.getItem(PHOTO_STORAGE_KEY);
  if (photo) applyPhotoToAllAvatars(photo);
}

// â”€â”€â”€ Touch/drag events pour dÃ©placer l'image dans le cercle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupCropTouch() {
  const canvas = document.getElementById('cropCanvas');
  // Eviter double-bind
  canvas.replaceWith(canvas.cloneNode(true));
  const c2 = document.getElementById('cropCanvas');
  c2.addEventListener('mousedown',  onCropDragStart);
  c2.addEventListener('mousemove',  onCropDragMove);
  c2.addEventListener('mouseup',    onCropDragEnd);
  c2.addEventListener('mouseleave', onCropDragEnd);
  c2.addEventListener('touchstart', onCropTouchStart, { passive: false });
  c2.addEventListener('touchmove',  onCropTouchMove,  { passive: false });
  c2.addEventListener('touchend',   onCropDragEnd);
  // Re-bind zoom after cloneNode
  c2.parentElement.querySelector('#cropZoom') && null; // zoom already ok
}

function onCropDragStart(e) { _cropDragStart = { x: e.clientX, y: e.clientY, ox: _cropOffsetX, oy: _cropOffsetY }; }
function onCropDragMove(e) {
  if (!_cropDragStart) return;
  _cropOffsetX = _cropDragStart.ox + (e.clientX - _cropDragStart.x);
  _cropOffsetY = _cropDragStart.oy + (e.clientY - _cropDragStart.y);
  updateCropCanvas();
}
function onCropDragEnd() { _cropDragStart = null; }

let _pinchStart = null;
function onCropTouchStart(e) {
  e.preventDefault();
  if (e.touches.length === 1) {
    _cropDragStart = { x: e.touches[0].clientX, y: e.touches[0].clientY, ox: _cropOffsetX, oy: _cropOffsetY };
  } else if (e.touches.length === 2) {
    const dx = e.touches[1].clientX - e.touches[0].clientX;
    const dy = e.touches[1].clientY - e.touches[0].clientY;
    _pinchStart = { dist: Math.hypot(dx, dy), zoom: parseFloat(document.getElementById('cropZoom').value) };
  }
}
function onCropTouchMove(e) {
  e.preventDefault();
  if (e.touches.length === 1 && _cropDragStart) {
    _cropOffsetX = _cropDragStart.ox + (e.touches[0].clientX - _cropDragStart.x);
    _cropOffsetY = _cropDragStart.oy + (e.touches[0].clientY - _cropDragStart.y);
    updateCropCanvas();
  } else if (e.touches.length === 2 && _pinchStart) {
    const dx = e.touches[1].clientX - e.touches[0].clientX;
    const dy = e.touches[1].clientY - e.touches[0].clientY;
    const dist = Math.hypot(dx, dy);
    const newZoom = Math.min(3, Math.max(1, _pinchStart.zoom * (dist / _pinchStart.dist)));
    document.getElementById('cropZoom').value = newZoom;
    updateCropCanvas();
  }
}

// Charger la photo sauvegardÃ©e dÃ¨s que le marchÃ© est actif
(function patchNavToForPhoto() {
  const _origNavTo = window.navTo;
  if (typeof _origNavTo === 'function') {
    window.navTo = function(id) {
      _origNavTo.call(this, id);
      if (id === 'profil') setTimeout(loadSavedPhoto, 80);
    };
  }
  // Aussi Ã  l'ouverture du sheet
  const _origOpenSheet = window.openSheet;
  if (typeof _origOpenSheet === 'function') {
    window.openSheet = function(id) {
      _origOpenSheet.call(this, id);
      if (id === 'profileEditSheet') setTimeout(loadSavedPhoto, 80);
    };
  }
})();

// Charger au dÃ©marrage si dÃ©jÃ  connectÃ©
document.addEventListener('DOMContentLoaded', () => { setTimeout(loadSavedPhoto, 500); });

// â”€â”€ Animation zoom sur les boutons de la barre de navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function initNavZoomAnim() {
  function bindNavZoom() {
    document.querySelectorAll('.nav-item').forEach(item => {
      if (item.dataset.zoomBound) return;
      item.dataset.zoomBound = '1';
      item.addEventListener('click', function() {
        // Retirer la classe si dÃ©jÃ  prÃ©sente, puis l'ajouter
        item.classList.remove('nav-zoom-anim');
        void item.offsetWidth; // force reflow
        item.classList.add('nav-zoom-anim');
        item.addEventListener('animationend', function onEnd() {
          item.classList.remove('nav-zoom-anim');
          item.removeEventListener('animationend', onEnd);
        }, { once: true });
      });
    });
  }
  // Bind au dÃ©marrage et aprÃ¨s chaque navTo
  document.addEventListener('DOMContentLoaded', bindNavZoom);
  setTimeout(bindNavZoom, 800);
  const _origNavToZoom = window.navTo;
  if (typeof _origNavToZoom === 'function') {
    window.navTo = function(id) {
      _origNavToZoom.call(this, id);
      setTimeout(bindNavZoom, 100);
    };
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABAE v52 â€” PATCHES DYNAMIQUES (banniÃ¨re dÃ©mo + injection donnÃ©es user)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// BanniÃ¨re "donnÃ©es de dÃ©monstration" dans les Ã©crans fictifs
(function initDemoBanners() {
  const css = `
    .demo-data-notice {
      background: linear-gradient(135deg,#FFF3CD,#FFEAA7);
      border: 1.5px dashed #D4A843;
      border-radius: 10px;
      padding: 8px 14px;
      margin: 8px 12px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.78rem;
      color: #856404;
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      line-height: 1.4;
    }
  `;
  const style = document.createElement('style');
  style.textContent = css;
  document.head.appendChild(style);

  function inject() {
    ['screen-commandes','screen-documents','screen-portefeuille'].forEach(id => {
      const screen = document.getElementById(id);
      if (!screen || screen.querySelector('.demo-data-notice')) return;
      const banner = document.createElement('div');
      banner.className = 'demo-data-notice';
      banner.innerHTML = 'âš ï¸ <span>DonnÃ©es de dÃ©monstration â€” seront remplacÃ©es par vos vraies donnÃ©es aprÃ¨s connexion au serveur.</span>';
      const topbar = screen.querySelector('.topbar');
      if (topbar && topbar.nextSibling) {
        screen.insertBefore(banner, topbar.nextSibling);
      } else {
        screen.prepend(banner);
      }
    });
  }
  document.addEventListener('DOMContentLoaded', inject);
  setTimeout(inject, 800);
})();

// Injection dynamique des donnÃ©es utilisateur depuis localStorage
(function initUserDataInjection() {
  function refreshUserUI() {
    const email = localStorage.getItem('ABAE_CURRENT_EMAIL') || '';
    let userData = null;
    if (email) {
      try {
        const db = JSON.parse(localStorage.getItem('ABAE_USERS_DB') || '{}');
        userData = db[email] || null;
      } catch(e) {}
    }
    const prenom = userData?.prenom || '';
    const nom = userData?.nom || '';
    const fullName = [prenom, nom].filter(Boolean).join(' ') || 'Utilisateur';

    const heroName = document.getElementById('heroUserName');
    if (heroName) heroName.textContent = fullName + ' ğŸ‘‹';

    const profileName = document.getElementById('profileHeroName');
    if (profileName) profileName.textContent = fullName;

    const successName = document.getElementById('successName');
    if (successName && prenom) successName.textContent = prenom;
  }

  document.addEventListener('DOMContentLoaded', () => setTimeout(refreshUserUI, 600));

  // Re-rafraÃ®chir Ã  chaque connexion
  const origSetAuth = window.ABAE_STATE?.setAuth?.bind(window.ABAE_STATE);
  if (origSetAuth) {
    window.ABAE_STATE.setAuth = function(v) {
      origSetAuth(v);
      if (v) setTimeout(refreshUserUI, 200);
    };
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ABAE v53 â€” OPEN-METEO : prÃ©visions 7 jours
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const JOURS_FR = ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'];

function renderForecast(daily) {
  const strip = document.getElementById('wxForecastStrip');
  if (!strip) return;

  const { time, weather_code, temperature_2m_max, temperature_2m_min, precipitation_sum } = daily;
  const todayStr = new Date().toISOString().slice(0, 10);

  strip.innerHTML = time.map((dateStr, i) => {
    const d    = new Date(dateStr + 'T12:00:00');
    const nom  = dateStr === todayStr ? 'Auj.' : JOURS_FR[d.getDay()];
    const info = WEATHER_CODES[weather_code[i]] || { icon: 'ğŸŒ¡ï¸', label: 'Variable' };
    const max  = Math.round(temperature_2m_max[i]);
    const min  = Math.round(temperature_2m_min[i]);
    const rain = precipitation_sum[i] > 0 ? `ğŸ’§${precipitation_sum[i].toFixed(1)}mm` : '';
    const isToday = dateStr === todayStr;
    return `
      <div class="wx-forecast-day${isToday ? ' today' : ''}">
        <div class="wx-forecast-day-name">${nom}</div>
        <div class="wx-forecast-icon">${info.icon}</div>
        <div class="wx-forecast-max">${max}Â°</div>
        <div class="wx-forecast-min">${min}Â°</div>
        ${rain ? `<div class="wx-forecast-rain">${rain}</div>` : ''}
      </div>`;
  }).join('');

  strip.style.display = 'flex';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ABAE v53 â€” OPENSTREETMAP / LEAFLET : carte vendeur
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Table de gÃ©ocodage des villes camerounaises (coordonnÃ©es rÃ©elles)
const CITY_COORDS = {
  'YaoundÃ©':     { lat: 3.8480, lon: 11.5021 },
  'Douala':      { lat: 4.0511, lon: 9.7679  },
  'Bafoussam':   { lat: 5.4737, lon: 10.4180 },
  'NgaoundÃ©rÃ©':  { lat: 7.3221, lon: 13.5844 },
  'Garoua':      { lat: 9.3014, lon: 13.3924 },
  'Kribi':       { lat: 2.9395, lon: 9.9091  },
  'Dschang':     { lat: 5.4416, lon: 10.0545 },
  'Maroua':      { lat: 10.5910, lon: 14.3205},
  'Bamenda':     { lat: 5.9631, lon: 10.1591 },
  'Ebolowa':     { lat: 2.9000, lon: 11.1500 },
  'Bertoua':     { lat: 4.5861, lon: 13.6850 },
  'Buea':        { lat: 4.1527, lon: 9.2412  },
  'LimbÃ©':       { lat: 4.0166, lon: 9.2055  },
  'EdÃ©a':        { lat: 3.8000, lon: 10.1375 },
};

// RÃ©soudre les coordonnÃ©es depuis une chaÃ®ne "Ville, CM"
function getCoordsFromLoc(locStr) {
  if (!locStr) return null;
  const city = locStr.split(',')[0].trim();
  return CITY_COORDS[city] || null;
}

// Calculer la distance en km entre deux points GPS (formule de Haversine)
function haversineKm(lat1, lon1, lat2, lon2) {
  const R  = 6371;
  const dL = (lat2 - lat1) * Math.PI / 180;
  const dG = (lon2 - lon1) * Math.PI / 180;
  const a  = Math.sin(dL/2) ** 2
           + Math.cos(lat1 * Math.PI/180) * Math.cos(lat2 * Math.PI/180)
           * Math.sin(dG/2) ** 2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

// â”€â”€ Carte vendeur statique (hors-ligne, sans Leaflet) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CoordonnÃ©es normalisÃ©es pour placer le pin dans le conteneur 100% x 210px
// BasÃ©es sur la bounding box Cameroun : lat 1.6Â°Nâ€“13.1Â°N, lon 8.4Â°Eâ€“16.2Â°E

// â”€â”€ Rendu SVG carte vendeur (string concat, sans backtick) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _SMS_BORDER = "M 4.4,166.2 L 13.1,168.9 L 26.2,170.7 L 34.9,173.5 L 43.6,177.1 L 52.3,180.8 L 61.0,186.3 L 65.4,189.9 L 69.7,195.4 L 76.3,200.9 L 82.8,204.5 L 91.5,206.3 L 104.6,207.3 L 122.1,208.2 L 135.1,207.8 L 148.2,206.3 L 161.3,204.5 L 174.4,202.7 L 187.4,201.8 L 200.5,200.9 L 213.6,199.0 L 226.7,196.3 L 235.4,193.6 L 244.1,189.9 L 252.8,186.3 L 261.5,182.6 L 268.1,179.0 L 272.4,174.4 L 274.6,169.8 L 276.8,164.3 L 279.0,158.9 L 281.2,153.4 L 283.3,147.9 L 287.7,142.4 L 292.1,136.0 L 294.2,129.7 L 296.4,122.3 L 298.6,115.0 L 300.8,107.7 L 305.1,100.4 L 309.5,93.1 L 313.8,85.8 L 318.2,78.5 L 322.6,71.2 L 324.7,63.9 L 326.9,56.6 L 329.1,49.3 L 331.3,42.0 L 333.5,34.7 L 335.6,27.4 L 335.6,20.1 L 333.5,14.6 L 326.9,9.1 L 318.2,3.7 L 309.5,0.0 L 296.4,0.0 L 279.0,0.9 L 265.9,1.8 L 252.8,2.7 L 239.7,3.7 L 226.7,4.6 L 213.6,5.5 L 200.5,5.5 L 187.4,5.5 L 174.4,5.5 L 161.3,5.5 L 148.2,5.5 L 135.1,5.5 L 122.1,7.3 L 109.0,11.0 L 100.3,16.4 L 91.5,21.9 L 78.5,27.4 L 69.7,32.9 L 61.0,38.3 L 52.3,43.8 L 43.6,51.1 L 34.9,58.4 L 26.2,65.7 L 17.4,73.0 L 8.7,80.3 L 4.4,87.7 L 2.2,95.0 L 4.4,102.3 L 6.5,109.6 L 7.8,116.9 L 8.7,124.2 L 7.8,131.5 L 6.5,138.8 L 4.4,146.1 L 3.5,153.4 L 3.5,160.7 L 4.4,166.2 Z";

function renderSellerMapSVG(p) {
  var coords = getCoordsFromLoc(p.loc);
  var city   = p.loc.split(",")[0].trim();
  if (!coords) return "";

  var SW=340, SH=210, LAT_MIN=1.6, LAT_MAX=13.1, LON_MIN=8.4, LON_MAX=16.2;
  var cx = ((coords.lon - LON_MIN) / (LON_MAX - LON_MIN)) * SW;
  var cy = ((LAT_MAX - coords.lat) / (LAT_MAX - LAT_MIN)) * SH;
  var px = Math.max(10, Math.min(330, cx));
  var py = Math.max(10, Math.min(195, cy));

  var lblAnchor = px > 270 ? "end" : px < 70 ? "start" : "middle";
  var lblDx     = px > 270 ? -14  : px < 70 ? 14 : 0;
  var lblDy     = py > 182 ? -18 : 20;

  var distLabel = "\ğŸ“ " + city;
  if (window.GEO_DATA && GEO_DATA.lat) {
    var km = haversineKm(GEO_DATA.lat, GEO_DATA.lon, coords.lat, coords.lon);
    distLabel = km < 1 ? "< 1 km de vous" : Math.round(km) + " km de vous";
  }

  var pinPath =
    "M" + px + "," + (py-2) +
    " C" + (px-9)  + "," + (py-12) + " " + (px-9)  + "," + (py-32) + " " + px + "," + (py-32) +
    " C" + (px+9)  + "," + (py-32) + " " + (px+9)  + "," + (py-12) + " " + px + "," + (py-2) + "Z";

  return (
    '<div class="seller-map-section">' +
    '<div class="seller-map-title">' +
    '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5">' +
    '<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>' +
    '<circle cx="12" cy="9" r="2.5"/></svg>Localisation du vendeur</div>' +
    '<div class="seller-map-wrap">' +
    '<div class="seller-map-static" data-zoom="1">' +
    '<div class="seller-map-zoomable" id="smZoomable" style="transform-origin:' + px + 'px ' + py + 'px;">' +
    '<svg class="sms-svg" viewBox="0 0 340 210" preserveAspectRatio="xMidYMid slice">' +
    '<rect class="sms-ocean" x="0" y="0" width="340" height="210"/>' +
    '<path class="sms-territory" d="' + _SMS_BORDER + '"/>' +
    '<path class="sms-route-major" d="M 135.2,168.9 L 104.6,167.6 L 78.5,166.2 L 59.6,165.2"/>' +
    '<path class="sms-route-major" d="M 135.2,168.9 L 113.3,157.0 L 100.3,147.9 L 88.0,139.3"/>' +
    '<path class="sms-route-major" d="M 88.0,139.3 L 82.8,135.1 L 76.7,130.3"/>' +
    '<path class="sms-route-major" d="M 135.2,168.9 L 165.6,162.5 L 200.5,158.9 L 230.4,155.5"/>' +
    '<path class="sms-route-major" d="M 226.0,105.5 L 221.4,93.1 L 219.3,81.3 L 217.6,69.4"/>' +
    '<path class="sms-route-major" d="M 217.6,69.4 L 235.4,60.3 L 248.5,53.0 L 258.1,45.8"/>' +
    '<path class="sms-route-minor" d="M 59.6,165.2 L 52.3,169.8 L 43.6,175.3 L 65.8,185.5"/>' +
    '<path class="sms-route-minor" d="M 135.2,168.9 L 180.0,115.0 L 226.0,105.5"/>' +
    '<circle class="sms-city-dot" cx="135.2" cy="168.9" r="2.5"/>' +
    '<text class="sms-city-label" x="140.2" y="171.9" text-anchor="start">Yaounde</text>' +
    '<circle class="sms-city-dot" cx="59.6" cy="165.2" r="2.5"/>' +
    '<text class="sms-city-label" x="64.6" y="168.2" text-anchor="start">Douala</text>' +
    '<circle class="sms-city-dot" cx="88.0" cy="139.3" r="2.5"/>' +
    '<text class="sms-city-label" x="93.0" y="142.3" text-anchor="start">Bafoussam</text>' +
    '<circle class="sms-city-dot" cx="226.0" cy="105.5" r="2.5"/>' +
    '<text class="sms-city-label" x="231.0" y="108.5" text-anchor="start">Ngaoundere</text>' +
    '<circle class="sms-city-dot" cx="217.6" cy="69.4" r="2.5"/>' +
    '<text class="sms-city-label" x="222.6" y="72.4" text-anchor="start">Garoua</text>' +
    '<circle class="sms-city-dot" cx="258.1" cy="45.8" r="2.5"/>' +
    '<text class="sms-city-label" x="263.1" y="48.8" text-anchor="start">Maroua</text>' +
    '<circle class="sms-city-dot" cx="76.7" cy="130.3" r="2.5"/>' +
    '<text class="sms-city-label" x="81.7" y="133.3" text-anchor="start">Bamenda</text>' +
    '<circle class="sms-city-dot" cx="230.4" cy="155.5" r="2.5"/>' +
    '<text class="sms-city-label" x="235.4" y="158.5" text-anchor="start">Bertoua</text>' +
    '<circle class="sms-city-dot" cx="65.8" cy="185.5" r="2.5"/>' +
    '<text class="sms-city-label" x="70.8" y="188.5" text-anchor="start">Kribi</text>' +
    '<circle class="sms-city-dot" cx="36.7" cy="163.4" r="2.5"/>' +
    '<text class="sms-city-label" x="41.7" y="166.4" text-anchor="start">Buea</text>' +
    '<circle class="sms-city-halo" cx="' + px + '" cy="' + py + '" r="18"/>' +
    '<circle class="sms-pulse"  cx="' + px + '" cy="' + py + '" r="7"/>' +
    '<circle class="sms-pulse2" cx="' + px + '" cy="' + py + '" r="7"/>' +
    '<g class="sms-pin-group">' +
    '<path class="sms-pin-body" d="' + pinPath + '"/>' +
    '<circle class="sms-pin-dot" cx="' + px + '" cy="' + (py-22) + '" r="4"/>' +
    '</g>' +
    '<text class="sms-pin-label" x="' + (px+lblDx) + '" y="' + (py+lblDy) + '" text-anchor="' + lblAnchor + '">' + city + '</text>' +
    '</svg></div>' +
    '<div class="seller-map-zoom">' +
    '<div class="seller-map-zoom-btn" onclick="smZoom(this,1)">+</div>' +
    '<div class="seller-map-zoom-btn" onclick="smZoom(this,-1)">âˆ’</div>' +
    '</div>' +
    '<div class="seller-map-zoom-level" id="smZoomLevel">z1</div>' +
    '<div class="sms-compass">N</div>' +
    '</div>' +
    '<div class="seller-map-info">' +
    '<svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>' +
    '<span>' + p.loc + '</span>' +
    '<span class="seller-map-dist">' + distLabel + '</span>' +
    '</div></div></div>'
  );
}

// â”€â”€ Zoom de la carte vendeur SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SM_ZOOM_SCALES = [1, 1.6, 2.5, 4, 6];
const SM_ZOOM_LABELS = ['z1','z2','z3','z4','z5'];
let _smZoomIdx = 0;

function smZoom(btn, direction) {
  const map = btn.closest('.seller-map-static');
  if (!map) return;

  const newIdx = Math.max(0, Math.min(SM_ZOOM_SCALES.length - 1, _smZoomIdx + direction));
  if (newIdx === _smZoomIdx) return;
  _smZoomIdx = newIdx;

  const scale    = SM_ZOOM_SCALES[_smZoomIdx];
  const zoomable = map.querySelector('.seller-map-zoomable');
  const levelEl  = map.querySelector('.seller-map-zoom-level');

  if (zoomable) {
    // transform-origin est dÃ©jÃ  rÃ©glÃ© sur le pin (px,py) via style inline
    zoomable.style.transform = scale === 1 ? '' : `scale(${scale})`;
  }
  if (levelEl) levelEl.textContent = SM_ZOOM_LABELS[_smZoomIdx];

  // Feedback boutons limites
  const btns = map.querySelectorAll('.seller-map-zoom-btn');
  btns[0].style.opacity = _smZoomIdx >= SM_ZOOM_SCALES.length - 1 ? '0.35' : '1';
  btns[1].style.opacity = _smZoomIdx <= 0 ? '0.35' : '1';
}

// RÃ©initialiser le zoom quand on ouvre un nouveau dÃ©tail
const _smZoomOrigOpenDetail = window.openDetail;
if (typeof _smZoomOrigOpenDetail === 'function') {
  window.openDetail = function(id) {
    _smZoomIdx = 0;
    _smZoomOrigOpenDetail.call(this, id);
  };
}

function _locToMapXY(lat, lon) {
  const LAT_MIN = 1.6, LAT_MAX = 13.1;
  const LON_MIN = 8.4, LON_MAX = 16.2;
  const x = ((lon - LON_MIN) / (LON_MAX - LON_MIN)) * 100; // % largeur
  const y = ((LAT_MAX - lat) / (LAT_MAX - LAT_MIN)) * 100; // % hauteur (inversÃ©)
  return { x: Math.max(8, Math.min(92, x)), y: Math.max(8, Math.min(90, y)) };
}

// Carte vendeur : rendu statique inline dans openDetail (voir template HTML)
// La fonction _locToMapXY et haversineKm restent disponibles pour d'autres usages.

</script>

</body>
</html>
